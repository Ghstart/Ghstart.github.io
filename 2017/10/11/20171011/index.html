<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Swift," />




  


  <link rel="alternate" href="/atom.xml" title="Ghcoder" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="在之前的文章中，已经介绍了一些，过滤、筛选信号量的操作符，现在列举一些复杂操作符。">
<meta property="og:type" content="article">
<meta property="og:title" content="关于RxSwift信息量的一些问题(二)">
<meta property="og:url" content="http://www.ghcoder.com/2017/10/11/20171011/index.html">
<meta property="og:site_name" content="Ghcoder">
<meta property="og:description" content="在之前的文章中，已经介绍了一些，过滤、筛选信号量的操作符，现在列举一些复杂操作符。">
<meta property="og:updated_time" content="2017-10-12T09:53:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于RxSwift信息量的一些问题(二)">
<meta name="twitter:description" content="在之前的文章中，已经介绍了一些，过滤、筛选信号量的操作符，现在列举一些复杂操作符。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"remove","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.ghcoder.com/2017/10/11/20171011/"/>





  <title>关于RxSwift信息量的一些问题(二) | Ghcoder</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ghcoder</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            列表
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.ghcoder.com/2017/10/11/20171011/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ghcoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/5730023?v=3&s=460">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ghcoder">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">关于RxSwift信息量的一些问题(二)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-11T16:50:12+08:00">
                2017-10-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/11/20171011/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/11/20171011/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <ul>
<li>在之前的文章中，已经介绍了一些，过滤、筛选信号量的操作符，现在列举一些复杂操作符。</li>
</ul>
<a id="more"></a>
<hr>
<ul>
<li><p>首先要说的一个操作符叫做<code>Scan</code>，看到在官方文档中，<code>Scan</code>是属于在<code>Transforming</code>，也就可以猜到，这个操作符，其实也是信号转换的部分。</p>
</li>
<li><p>先看一下官方的介绍</p>
</li>
</ul>
<blockquote>
<p>The Scan operator applies a function to the first item emitted by the source Observable and then emits the result of that function as its own first emission. It also feeds the result of the function back into the function along with the second item emitted by the source Observable in order to generate its second emission. It continues to feed back its own subsequent emissions along with the subsequent emissions from the source Observable in order to create the rest of its sequence.</p>
</blockquote>
<ul>
<li>在看一下github上代码的：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">scan</span>&lt;A&gt;<span class="params">(<span class="number">_</span> seed: A, accumulator: @escaping <span class="params">(A, E)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">A</span>)</div><div class="line">    -&gt; <span class="type">Observable</span>&lt;<span class="type">A</span>&gt; &#123;</div><div class="line">    <span class="keyword">return</span> <span class="type">Scan</span>(source: <span class="keyword">self</span>.asObservable(), seed: seed, accumulator: accumulator)</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="keyword">final</span> fileprivate <span class="class"><span class="keyword">class</span> <span class="title">Scan</span>&lt;<span class="title">Element</span>, <span class="title">Accumulate</span>&gt;: <span class="title">Producer</span>&lt;<span class="title">Accumulate</span>&gt; </span>&#123;</div><div class="line"><span class="keyword">typealias</span> <span class="type">Accumulator</span> = (<span class="type">Accumulate</span>, <span class="type">Element</span>) <span class="keyword">throws</span> -&gt; <span class="type">Accumulate</span></div><div class="line">    </div><div class="line">fileprivate <span class="keyword">let</span> _source: <span class="type">Observable</span>&lt;<span class="type">Element</span>&gt;</div><div class="line">fileprivate <span class="keyword">let</span> _seed: <span class="type">Accumulate</span></div><div class="line">fileprivate <span class="keyword">let</span> _accumulator: <span class="type">Accumulator</span></div><div class="line">    </div><div class="line"><span class="keyword">init</span>(source: <span class="type">Observable</span>&lt;<span class="type">Element</span>&gt;, seed: <span class="type">Accumulate</span>, accumulator: @escaping <span class="type">Accumulator</span>) &#123;</div><div class="line">    _source = source</div><div class="line">    _seed = seed</div><div class="line">    _accumulator = accumulator</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>这就可以根据官方的介绍可以知道，什么是<code>Scan</code></li>
<li><code>Scan</code>操作符，需要接受两个参数，一个参数是泛型A, 第二个参数是<code>block</code>，<code>block</code>的参数类型以及返回值的类型是<code>(A, Element) -&gt; A</code>.</li>
<li>这里的<code>Element</code>，是在也不是随编的泛型，可以看源码中知道，<code>Scan</code>在实例化的时候，出入了三个参数，其中第一个参数，是讲自己转化为可订阅的对象<code>self.asObservable()</code>,在入参中<code>Observable&lt;Element&gt;</code>,这就说明了，这个<code>Element</code>的类型，和你起初的订阅的对象的订阅类型是同一个类型。</li>
<li>看一下demo：</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">// 这里只是将字符打印出来</div><div class="line">let bag = DisposeBag()</div><div class="line">let subject = PublishSubject&lt;String&gt;()</div><div class="line">    </div><div class="line">_ = subject</div><div class="line">    .subscribe(onNext: &#123;print($<span class="number">0</span>)&#125;)</div><div class="line">    .addDisposableTo(bag)</div><div class="line">    </div><div class="line">subject.onNext(<span class="string">"gong"</span>)</div><div class="line">subject.onNext(<span class="string">"h"</span>)</div><div class="line"></div><div class="line">//终端输出</div><div class="line">gong</div><div class="line">h</div><div class="line"></div><div class="line"><span class="meta">---</span></div><div class="line"></div><div class="line">// 这里是用来计算我输入字符长度的累加</div><div class="line">let bag = DisposeBag()</div><div class="line">let subject = PublishSubject&lt;String&gt;()</div><div class="line">    </div><div class="line">_ = subject</div><div class="line">    .scan(<span class="number">0</span>) &#123;(count: Int, content: String) in</div><div class="line">        return count + content.characters.count</div><div class="line">    &#125;</div><div class="line">    .subscribe(onNext: &#123;print($<span class="number">0</span>)&#125;)</div><div class="line">    .addDisposableTo(bag)</div><div class="line">    </div><div class="line">subject.onNext(<span class="string">"gong"</span>)</div><div class="line">subject.onNext(<span class="string">"h"</span>)</div><div class="line">//终端输出</div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">5</span></div><div class="line"></div><div class="line"><span class="meta">---</span></div></pre></td></tr></table></figure>
<ul>
<li>你可以试试，看看能不能将Content的类型修改任意类型呢？答案是肯定不行的，之前在看源码的时候，我已经解释过为什么了，这里的<code>content</code>的类型必须要和我们制定定义<code>subject</code>的类型相同。</li>
</ul>
<hr>
<ul>
<li><code>skpiWhile</code>之前一直没有绕清楚，今天还是打算看一下源码，这只我已经说了，这个是用来筛选信号的时候用的，之前一直不清楚为什么为true的时候，就会过滤信号呢？</li>
<li>查看github上代码，可以看到在，关键的代码：</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function">func <span class="title">on</span>(<span class="params">_ <span class="keyword">event</span>: Event&lt;Element&gt;</span>) </span>&#123;</div><div class="line">    <span class="keyword">switch</span> <span class="keyword">event</span> &#123;</div><div class="line">    <span class="keyword">case</span> .next(<span class="keyword">let</span> <span class="keyword">value</span>):</div><div class="line">        <span class="keyword">if</span> !_running &#123;</div><div class="line">            <span class="keyword">do</span> &#123;</div><div class="line">                _running = <span class="keyword">try</span> !_parent._predicate(<span class="keyword">value</span>)</div><div class="line">            &#125; <span class="keyword">catch</span> <span class="keyword">let</span> e &#123;</div><div class="line">                forwardOn(.error(e))</div><div class="line">                dispose()</div><div class="line">                <span class="keyword">return</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> _running &#123;</div><div class="line">            forwardOn(.next(<span class="keyword">value</span>))</div><div class="line">        &#125;</div><div class="line">    <span class="keyword">case</span> .error, .completed:</div><div class="line">        forwardOn(<span class="keyword">event</span>)</div><div class="line">        dispose()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>看到代码就知道，除非是<code>.onError()/onCompleted()</code>事件，其他<code>.onNext()</code>的时间，都会先执行，你传入的<code>block</code>,看看你的返回值是什么？如果是true的话，就会执行<code>forwardOn()</code>的函数：</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function">final func <span class="title">forwardOn</span>(<span class="params">_ <span class="keyword">event</span>: Event&lt;O.E&gt;</span>) </span>&#123;</div><div class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></div><div class="line">        <span class="function"><span class="keyword">if</span> <span class="title">AtomicIncrement</span>(<span class="params">&amp;_numberOfConcurrentCalls</span>) &gt; 1 </span>&#123;</div><div class="line">            rxFatalError(<span class="string">"Warning: Recursive call or synchronization error!"</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        defer &#123;</div><div class="line">            _ = AtomicDecrement(&amp;_numberOfConcurrentCalls)</div><div class="line">        &#125;</div><div class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">    <span class="keyword">if</span> _disposed &#123;</div><div class="line">        <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">    _observer.<span class="keyword">on</span>(<span class="keyword">event</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>这里可以看到，他讲下一个值有递归传到同一个函数中了，这样就起到了过滤的效果。</li>
</ul>
<hr>
<ul>
<li>还有一些关于信号转换的问题，如何转化为数组类型,这里我用到<code>toArray()</code>,Demo:</li>
<li>这种转化是一次性的，并当你下次发送<code>.onNext()</code>的时候，他是不会转化，也就不会接受到<code>.onNext()</code>的回调.</li>
<li>如果在调用<code>.onNext()</code>值之前，你已经转化为Array，在你下次转化的时候，就无法再转化了。</li>
</ul>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Observable.of(1,2,3,4)</div><div class="line">	.toArray()</div><div class="line">    .subscribe(onNext: &#123;</div><div class="line">        dump(type(of: $0))</div><div class="line">        dump($0)</div><div class="line">    &#125;)</div><div class="line"><span class="comment"> </span></div><div class="line"> //终端输出</div><div class="line">-<span class="ruby"> Swift.Array&lt;Swift.Int&gt; <span class="comment">#0</span></span></div><div class="line">▿ 4 elements</div><div class="line">-<span class="ruby"> <span class="number">1</span></span></div><div class="line">-<span class="ruby"> <span class="number">2</span></span></div><div class="line">-<span class="ruby"> <span class="number">3</span></span></div><div class="line">-<span class="ruby"> <span class="number">4</span></span></div></pre></td></tr></table></figure>
<hr>
<ul>
<li>操作符<code>map</code>的操作，也是接受一个block，这里直接上代码：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(<span class="number">_</span> event: Event&lt;SourceType&gt;)</span></span> &#123;</div><div class="line">    <span class="keyword">switch</span> event &#123;</div><div class="line">    <span class="keyword">case</span> .next(<span class="keyword">let</span> element):</div><div class="line">        <span class="keyword">do</span> &#123;</div><div class="line">            <span class="keyword">let</span> mappedElement = <span class="keyword">try</span> _transform(element)</div><div class="line">            forwardOn(.next(mappedElement))</div><div class="line">        &#125;</div><div class="line">        ....</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>这里可以看到我们出入的block 就像一个加工厂一样，会将接受到的<code>element</code>的参数，经过我们传入的block加工后，会返回一个新的值，然后又会回传给自己。这样每次接受到的就是新值了。</li>
</ul>
<hr>
<ul>
<li>而操作符<code>mapWithIndex会回传回来两个参数，一个value值，一个是index值</code>，这里又是什么意思呢？看一下源代码：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">....</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">var</span> _index = <span class="number">0</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(<span class="number">_</span> event: Event&lt;SourceType&gt;)</span></span> &#123;</div><div class="line">    <span class="keyword">switch</span> event &#123;</div><div class="line">    <span class="keyword">case</span> .next(<span class="keyword">let</span> element):</div><div class="line">        <span class="keyword">do</span> &#123;</div><div class="line">            <span class="keyword">let</span> mappedElement = <span class="keyword">try</span> _selector(element, <span class="keyword">try</span> incrementChecked(&amp;_index))</div><div class="line">            forwardOn(.next(mappedElement))</div><div class="line">        &#125;</div><div class="line">        ...</div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">incrementChecked</span><span class="params">(<span class="number">_</span> i: <span class="keyword">inout</span> Int)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">	<span class="keyword">if</span> i == <span class="type">Int</span>.<span class="built_in">max</span> &#123;</div><div class="line">		<span class="keyword">throw</span> <span class="type">RxError</span>.overflow</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">defer</span> &#123; i += <span class="number">1</span> &#125;</div><div class="line">	<span class="keyword">return</span> i</div><div class="line">&#125;</div><div class="line">        </div><div class="line">        ...</div></pre></td></tr></table></figure>
<ul>
<li>很明显了，index初始值是从0开始，每次都会拿到指针，进行累加，然后回传回去，也就是我们所说的index了。</li>
</ul>
<hr>
<ul>
<li>下面一个比较难理解的操作符叫做<code>flatMap</code>,看官网上的介绍为是这样的：</li>
</ul>
<blockquote>
<p>transform the items emitted by an Observable into Observables, then flatten the emissions from those into a single Observable</p>
</blockquote>
<ul>
<li>这句话其实非常绕，可能不理解的人可能一直读不懂。首先理解第一句话，<code>transform the items emitted by an Observable into Observables</code>: 我的理解是，由<em>一个</em><code>可被订阅的对象</code>发出的多个值，通过我们传入的<code>block</code>,来变换为多个<code>可订阅的对象</code></li>
</ul>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> bag = DisposeBag()</div><div class="line"><span class="keyword">let</span> subject = PublishSubject&lt;GHObject&gt;()</div><div class="line">    </div><div class="line"><span class="number">_</span> = subject</div><div class="line">    .flatMap&#123;</div><div class="line">        <span class="number">$0</span>.gh<span class="number">_</span><span class="keyword">value</span>.asObservable()</div><div class="line">    &#125;</div><div class="line">    .subscribe(onNext: &#123;</div><div class="line">        print(type(<span class="keyword">of</span>: <span class="number">$0</span>))</div><div class="line">        dump(<span class="number">$0</span>)</div><div class="line">    &#125;).addDisposableTo(bag)</div><div class="line">    </div><div class="line"><span class="keyword">let</span> gh<span class="number">1</span> = GHObject(gh<span class="number">_</span><span class="keyword">value</span>: Variable(<span class="number">10</span>))</div><div class="line">    </div><div class="line">subject.onNext(gh<span class="number">1</span>)</div><div class="line">gh<span class="number">1</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">11</span></div><div class="line"></div><div class="line">...</div><div class="line">struct GHObject &#123;</div><div class="line">    var gh<span class="number">_</span><span class="keyword">value</span>: Variable&lt;Int&gt;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//终端输出</span></div><div class="line">- <span class="number">10</span></div><div class="line">- <span class="number">11</span></div></pre></td></tr></table></figure>
<ul>
<li>那第二句话怎么理解呢？<code>then flatten the emissions from those into a single Observable</code>,通过上面的代码已经知道了，我们通过<code>flatMap</code>操作符，已经将<code>GHObject</code>-&gt;<code>Int</code>，如果我存在多个<code>GHObject</code>的对象，同事发出值，此时我们就可以看做是将多个<code>Int</code>的值发送了出来，至于是哪个<code>GHObject</code>发送出来的，我们不需要关心：</li>
</ul>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> bag = DisposeBag()</div><div class="line"><span class="keyword">let</span> subject = PublishSubject&lt;GHObject&gt;()</div><div class="line">    </div><div class="line"><span class="number">_</span> = subject</div><div class="line">    .flatMap&#123;</div><div class="line">        <span class="number">$0</span>.gh<span class="number">_</span><span class="keyword">value</span>.asObservable()</div><div class="line">    &#125;</div><div class="line">    .subscribe(onNext: &#123;</div><div class="line">        dump(<span class="number">$0</span>)</div><div class="line">    &#125;).addDisposableTo(bag)</div><div class="line">    </div><div class="line"><span class="keyword">let</span> gh<span class="number">1</span> = GHObject(gh<span class="number">_</span><span class="keyword">value</span>: Variable(<span class="number">10</span>))</div><div class="line">    </div><div class="line">subject.onNext(gh<span class="number">1</span>)</div><div class="line">gh<span class="number">1</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">11</span></div><div class="line">    </div><div class="line"><span class="keyword">let</span> gh<span class="number">2</span> = GHObject(gh<span class="number">_</span><span class="keyword">value</span>: Variable(<span class="number">100</span>))</div><div class="line">subject.onNext(gh<span class="number">2</span>)</div><div class="line">    </div><div class="line">gh<span class="number">1</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">12</span></div><div class="line">gh<span class="number">2</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">101</span></div><div class="line">gh<span class="number">2</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">102</span></div><div class="line"></div><div class="line"><span class="comment">//终端输出</span></div><div class="line">- <span class="number">10</span></div><div class="line">- <span class="number">11</span></div><div class="line">- <span class="number">100</span></div><div class="line">- <span class="number">12</span></div><div class="line">- <span class="number">101</span></div><div class="line">- <span class="number">102</span></div></pre></td></tr></table></figure>
<ul>
<li>至于和<code>flatMap</code>类似的一个操作符,我们叫做<code>flatMapLatest</code>,我是这么李操操作符的：<code>一点接受了一个新的GHObject发的gh_value值之后，之前旧的GHObject_value发出的gh_value我们都会统统过滤掉</code>，Demo:</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">let bag = DisposeBag()</div><div class="line">let subject = PublishSubject&lt;GHObject&gt;()</div><div class="line">    </div><div class="line">_ = subject</div><div class="line">    .flatMapLatest&#123;</div><div class="line">        $<span class="number">0</span><span class="selector-class">.gh_value</span><span class="selector-class">.asObservable</span>()</div><div class="line">    &#125;</div><div class="line">    .subscribe(onNext: &#123;</div><div class="line">        dump($<span class="number">0</span>)</div><div class="line">    &#125;).addDisposableTo(bag)</div><div class="line">    </div><div class="line">let gh1 = GHObject(gh_value: Variable(<span class="number">10</span>))</div><div class="line">    </div><div class="line">subject.onNext(gh1)</div><div class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">11</span></div><div class="line">    </div><div class="line">let gh2 = GHObject(gh_value: Variable(<span class="number">100</span>))</div><div class="line"></div><div class="line">subject.onNext(gh2)</div><div class="line">    </div><div class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">12</span></div><div class="line">gh2<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">101</span></div><div class="line">gh2<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">102</span></div><div class="line">    </div><div class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">13</span></div><div class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">14</span></div><div class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">15</span></div><div class="line"></div><div class="line"><span class="comment">//终端输出</span></div><div class="line">- <span class="number">10</span></div><div class="line">- <span class="number">11</span></div><div class="line">- <span class="number">100</span></div><div class="line">- <span class="number">101</span></div><div class="line">- <span class="number">102</span></div></pre></td></tr></table></figure>
<ul>
<li>这个<code>flatMapLatest</code>听上去比较绕，但是一旦拿起笔画画，就会很清晰了。</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Swift/" rel="tag"># Swift</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/08/20171007/" rel="next" title="关于RxSwift信息量的一些问题">
                <i class="fa fa-chevron-left"></i> 关于RxSwift信息量的一些问题
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ghcoder</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://ghcoder1024.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://www.ghcoder.com/2017/10/11/20171011/';
          this.page.identifier = '2017/10/11/20171011/';
          this.page.title = '关于RxSwift信息量的一些问题(二)';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://ghcoder1024.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  













  





  

  

  

  

  

</body>
</html>
