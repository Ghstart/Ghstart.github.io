<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Appä¸»é¢˜åˆ‡æ¢åŠŸèƒ½&èµ„æºç®¡ç†åŠŸèƒ½]]></title>
    <url>%2F2019%2F01%2F26%2F20190126%2F</url>
    <content type="text"><![CDATA[ä¸»é¢˜çš®è‚¤åˆ‡æ¢æ¨¡å—GCTThemeé…ç½®ç¯‡ è°ƒç”¨GCTThemeManagerä¹‹å‰éœ€è¦æ³¨å†Œé…ç½®æ•°æ®, è°ƒç”¨çš„æ—¶æœºç›®å‰æ˜¯åœ¨didFinishLaunchingWithOptionsçš„æ—¶å€™ ï¼ˆè¿™ä¸ªåæœŸå¯ä»¥ä¿®æ”¹ï¼ï¼ï¼‰ 12345// 1. GCTThemeSwitchObject æ§åˆ¶å¼€å…³çš„ç±»ï¼Œçµæ´»æ§åˆ¶å¼€å…³å°±å¯ä»¥é…ç½®è¿™ä¸ªç±» ï¼ˆé¢å‘åè®®ï¼‰GCTThemeSwitchObject *switchObj = [GCTThemeSwitchObject new];[switchObj setGCTThemeSwitch:YES];// 2. GCTThemeData æ•°æ®æºçš„ç±»ï¼Œç›®å‰åªè¯»å–æœ¬åœ°æ•°æ®ï¼ŒåæœŸè¿œç¨‹æ•°æ®åªéœ€è¦é…ç½®å®ƒï¼ˆé¢å‘åè®®ï¼‰[[GCTThemeManager sharedInstanceWithThemeData:[GCTThemeData new]] switchBaseOn:switchObj]; GCTThemeä½¿ç”¨ç¯‡ æ–¹æ³•1ï¼šå¦‚æœè¦ä¿®æ”¹çš„æ§ä»¶æ˜¯UIViewæˆ–è€…æ˜¯å®ƒçš„å­ç±»å¹¶ä¸”è¿™ä¸ªUIViewä¸ç­‰äºnilï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨æ–¹æ³• ï¼ï¼è¿™é‡Œçš„GCTThemeModuleTypeså·²ç»ä¸å†éœ€è¦ï¼Œå› ä¸ºGCT.Rå¯ä»¥è‡ªå·±ç”Ÿæˆç›¸åº”çš„ç±»ã€å±æ€§ 1- (void)configSkinWithModule:(GCTThemeModuleTypes)module skinDatas:(NSDictionary&lt;NSString *, NSString *&gt; *)skinDatas; æ–¹æ³•2ï¼šå¦‚æœä¸Šé¢çš„æ¡ä»¶æœ‰å…¶ä¸­ä¸€ä¸ªä¸æ»¡è¶³ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨å•ä¾‹GCTThemeManager ï¼ï¼è¿™é‡Œçš„GCTThemeModuleTypeså·²ç»ä¸å†éœ€è¦ï¼Œå› ä¸ºGCT.Rå¯ä»¥è‡ªå·±ç”Ÿæˆç›¸åº”çš„ç±»ã€å±æ€§ 1234567// éœ€è¦é…ç½®çš®è‚¤æ›¿æ¢åŠŸèƒ½çš„ï¼Œå›¾ç‰‡è·å–éœ€è¦ 1. moduleName 2. imgKey- (UIImage *)getImageByKey:(NSString *)imgKey from:(GCTThemeModuleTypes)module;- (NSString *)getImageNameByKey:(NSString *)imgKey from:(GCTThemeModuleTypes)module;// éœ€è¦é…ç½®çš®è‚¤æ›¿æ¢åŠŸèƒ½çš„ï¼Œé¢œè‰²è·å–éœ€è¦ 1. moduleName 2. colorKey- (UIColor *)getColorByKey:(NSString *)colorKey from:(GCTThemeModuleTypes)module;// éœ€è¦é…ç½®çš®è‚¤æ›¿æ¢åŠŸèƒ½çš„ï¼Œæ–‡å­—è·å–éœ€è¦ 1. moduleName 2. titleKey- (NSString *)getTitleByKey:(NSString *)titleKey from:(GCTThemeModuleTypes)module; å®é™…ä½¿ç”¨æƒ…å†µ ç›´æ¥é…ç½®TabBarControllerå›¾ç‰‡ã€æ–‡å­—ã€‚ã€å› ä¸ºtabBarItemé»˜è®¤æ˜¯æ‡’åŠ è½½çš„ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡GCTThemeManagerå»å®ç°ã€‘ 1234navController.tabBarItem.title = [[GCTThemeManager sharedInstance] getTitleByKey:model.titleKey from:GCTThemeModuleTypeHomeTabbar];navController.tabBarItem.image = [UIImage imageMakeWithName:model.imageName type:@"png"];NSString *imageName = [[GCTThemeManager sharedInstance] getImageNameByKey:model.imageSelectedKey from:GCTThemeModuleTypeHomeTabbar];navController.tabBarItem.selectedImage = [[UIImage imageMakeWithName:imageName type:@"png"] imageWithRenderingMode:UIImageRenderingModeAlwaysOriginal]; åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„æ˜¯èƒŒæ™¯è‰²ã€‚ 2. åœ¨æ˜¥èŠ‚çš®è‚¤çš„é…ç½®ä¸‹ä½¿ç”¨çš„æ˜¯å›¾ç‰‡ ã€è¿™é‡Œå¯ä»¥ä»¥æ­¤ç±»æ¨ï¼ŒæŸç§çš®è‚¤ä¸‹é¢ä½¿ç”¨çš„å±æ€§1ï¼Œåœ¨å¦ä¸€ç§çš®è‚¤ä¸‹ä½¿ç”¨çš„æ˜¯å±æ€§2ï¼Œå› ä¸ºå½“æ‰¾ä¸åˆ°å¯¹åº”çš„å±æ€§å€¼çš„æ—¶å€™è¿”å›nilï¼Œä¹Ÿå°±æ˜¯ä¸å®ç°ã€‘ 12self.tipsView.homeBG.image = [[GCTThemeManager sharedInstance] getImageByKey:@"home_wifi_scaning_unconnected" from:GCTThemeModuleTypeHomeWifi];self.backgroundColor = [[GCTThemeManager sharedInstance] getColorByKey:@"home_wifi_found_scaning" from:GCTThemeModuleTypeHomeWifi]; GCTThemeåŸç†ç¯‡ GCTThemeSwitchObjectéµå¾ªçš„åè®® 123456@protocol GCTThemeSwitchProtocol &lt;NSObject&gt;- (void)setGCTThemeSwitch:(BOOL)isOpen;- (BOOL)GCTThemeSwitchIsOpen;@end æ•°æ®æºGCTThemeDataéµå¾ªçš„åè®® 12345678910111213141516typedef enum : NSUInteger &#123; GCTThemeDefaultData, GCTThemeFestivalData&#125; GCTThemeDataTypes;NS_ASSUME_NONNULL_BEGIN@protocol GCTThemeDataProtocol &lt;NSObject&gt;// Getter Method- (NSDictionary *)skinDataFor:(GCTThemeDataTypes)themeType;// Setter Method- (void)setSkinData:(NSDictionary *)data for:(GCTThemeDataTypes)themeType;@end GCTThemeManageræ ¸å¿ƒä»£ç  1234567891011- (NSString *)findResourceBy:(NSString *)key from:(GCTThemeModuleTypes)module with:(NSString *)subKey &#123; // åˆ‡æ¢æ•°æ® NSDictionary *resourcesData = self.switchIsOpen ? self.tempSkinData : self.skinData; NSString *moduleString = [self convertThemeType2String:module]; if (moduleString == nil || [moduleString isEqualToString:@""] || resourcesData == nil || ![resourcesData.allKeys containsObject:moduleString]) return nil; NSDictionary *moduleDic = resourcesData[moduleString]; if (![moduleDic.allKeys containsObject:subKey]) &#123; return nil; &#125; NSDictionary *Dic = moduleDic[subKey]; if (![Dic.allKeys containsObject:key]) &#123; return nil; &#125; return Dic[key];&#125; æµ‹è¯•ç¯‡ é…ç½®ä»¥åŠMockæ•°æ® 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192- (void)setUp &#123; self.themeData = [GCTThemeData new]; // Mock Data [self.themeData setSkinData:@&#123;@"home_tabbar": @&#123;@"images": @&#123;@"image_home_button_selected": @"Home_Selected", @"image_video_button_selected": @"Provider_Selected", @"image_discovery_button_selected": @"Discovery_Selected", @"image_mine_button_selected": @"Mine_Selected"&#125;&#125;&#125; for:GCTThemeDefaultData]; [self.themeData setSkinData:@&#123;@"home_middle": @&#123;@"colors": @&#123;@"color_before_background": @"#cccccc"&#125;, @"values": @&#123;@"value_home_title": @"æµ‹è¯•"&#125; &#125;&#125; for:GCTThemeFestivalData]; // Mock Switch self.switchObject = [GCTThemeSwitchObject new]; [self.switchObject setGCTThemeSwitch:NO]; self.manager = [GCTThemeManager sharedInstanceWithThemeData:self.themeData]; [self.manager switchBaseOn:self.switchObject];&#125;/* ** æµ‹è¯•æ˜¯å¦ä¸ºå•ä¾‹ */- (void)testGCTThemeManagerIsSingle &#123; NSMutableArray *managers = [NSMutableArray array]; for (int i = 0; i &lt; 3; i++) &#123; dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123; GCTThemeManager *tempManager = [[GCTThemeManager alloc] init]; [managers addObject:tempManager]; &#125;); &#125; [managers enumerateObjectsUsingBlock:^(GCTThemeManager *obj, NSUInteger idx, BOOL * _Nonnull stop) &#123; XCTAssertEqual(self.manager, obj, @"GCTThemeManager is not single"); &#125;];&#125;/* ** æµ‹è¯•å¼€å…³ */- (void)testGCTThemeSwitch &#123; XCTAssertFalse(self.manager.switchIsOpen, "default switch is closed"); [self.switchObject setGCTThemeSwitch:YES]; [self.manager switchBaseOn:self.switchObject]; XCTAssertTrue(self.manager.switchIsOpen, "switch is open");&#125;/* ** åˆå§‹åŒ–åæ•°æ®æ˜¯å¦æ­£ç¡® */- (void)testGCTThemeInitNoMockDataIsNotNil &#123; XCTAssertNotNil(self.manager.skinData, "default data is not to be nil"); XCTAssertTrue(self.manager.skinData.count != 0, "default data is not to be nil"); XCTAssertNotNil(self.manager.tempSkinData, "temp data is not to be nil"); XCTAssertTrue(self.manager.tempSkinData.count != 0, "temp data is not be nil");&#125;/* ** é€šè¿‡keyæ¥è·å–å›¾ç‰‡ */- (void)testGCTThemeGetImageByKey &#123; XCTAssertNil([self.manager getImageByKey:@"" from:GCTThemeModuleTypeHomeTabbar], "key is nil image should be nil"); XCTAssertNil([self.manager getImageByKey:@"image_home_button_selected_error" from:GCTThemeModuleTypeHomeTabbar], "key error image should be nil"); XCTAssertNil([self.manager getImageByKey:@"image_home_button_selected" from:GCTThemeModuleTypeHomeWifi], @"type is error image should be nil"); XCTAssertNotNil([self.manager getImageByKey:@"image_home_button_selected" from:GCTThemeModuleTypeHomeTabbar], "key and type is right and data has value, image should not be nil");&#125;/* ** é€šè¿‡keyæ¥è·å–å›¾ç‰‡åå­— */- (void)testGCTThemeGetImageNameByKey &#123; XCTAssertEqual([self.manager getImageNameByKey:@"image_home_button_selected" from:GCTThemeModuleTypeHomeTabbar], @"Home_Selected", "image name should be equal");&#125;/* ** é€šè¿‡keyæ¥è·å–é¢œè‰² */- (void)testGetColorByKey &#123; // ä»æ˜¥èŠ‚ä¸»é¢˜ä¸­è·å– [self.switchObject setGCTThemeSwitch:YES]; [self.manager switchBaseOn:self.switchObject]; XCTAssertTrue([[self.manager getColorByKey:@"color_before_background" from:GCTThemeModuleTypeHomeMiddleContent] isEqual:[UIColor colorWithHexString:@"#cccccc"]], "UIColor should be equal");&#125;- (void)testGCTThemeGetTitleByKey &#123; // ä»æ˜¥èŠ‚ä¸»é¢˜ä¸­è·å– [self.switchObject setGCTThemeSwitch:YES]; [self.manager switchBaseOn:self.switchObject]; XCTAssertTrue([[self.manager getTitleByKey:@"value_home_title" from:GCTThemeModuleTypeHomeMiddleContent] isEqual:@"æµ‹è¯•"], "Title should be equal");&#125; æ€è€ƒç¯‡ğŸ¤” é…ç½®çš„æ—¶æœºï¼Œéœ€è¦åˆ‡æ¢ï¼Œå°½é‡ä¸è¦æ”¾åˆ°AppDelegateä¸­ï¼Œå½±å“å¯åŠ¨æ—¶é—´ã€‚å·²ç»é€šè¿‡GCT.Rå»¶æ—¶å¤„ç†äº† GCTThemeManagerä¸­çš„å¼€å…³GCTThemeSwitchObjectä»¥åŠæ•°æ®æºGCTThemeDataç›¸åº”çš„å±æ€§éƒ½æ˜¯åŒæ—¶åˆGetter/Setteræ–¹æ³•çš„ï¼Œæ•°æ®ä¸å®‰å…¨ï¼ï¼ ï¼ï¼éƒ½è¦é€šè¿‡å­—ç¬¦ä¸²å»æŸ¥æ‰¾ï¼Œç¼–ç ä¸æ˜¯å¾ˆå‹å¥½ï¼ï¼ˆåæœŸä¼šé€šè¿‡R.Objå»ä¿®æ­£è¿™ä¸ªé—®é¢˜ã€‚ï¼‰ å·²ç»é€šè¿‡GCT.Rå¤„ç†äº† ç»Ÿä¸€ä¿®æ”¹çš„æ—¶æœºæ¯æ¬¡å¯åŠ¨åªæœ‰ä¸€æ¬¡ï¼ŒåæœŸè¿™é‡Œéœ€è¦ä¿®æ”¹ã€‚ ##GCT.Rä½¿ç”¨è¯´æ˜ï¼š ä»£ç å®åœ¨R.objcä¸Šä»£ç çš„ä¿®æ”¹ï¼Œæ€è·¯ç±»ä¼¼äºR.Swiftä¸€æ · ###CGT.Rä½¿ç”¨æ­¥éª¤ï¼šæ·»åŠ ä¹‹å‰é…ç½®ä¸€ä¸‹è‡ªå·±çš„xcode, è®©xcodeé‡åˆ°é”™è¯¯çš„æ—¶å€™ç»§ç»­ç¼–è¯‘ï¼Œå‹¾é€‰: Perferences-&gt;General-&gt;Continue building after errors pod &#39;GCT.R TARGETS -&gt; Build Phases -&gt; New Run Script Phase æ·»åŠ ä¸‹é¢çš„å‘½ä»¤&quot;${PODS_ROOT}/GCT.R/GCT.R/GCTR&quot; -p &quot;$SRCROOT&quot; buildæˆ–è€…runé¡¹ç›®ï¼Œä½ ä¼šå‘ç°å¤šäº†ä¸ªR.hå’ŒR.mä¸¤ä¸ªæ–‡ä»¶ï¼Œæ‹–è¿›é¡¹ç›®ä¸­ï¼Œä¸è¦å‹¾é€‰Copy items if needed GCTThemeå’ŒGCT.Ré…åˆä½¿ç”¨ ä¸¤ä¸ªä¸œè¥¿çš„ä½œç”¨æ˜¯ç›¸å¯¹ç‹¬ç«‹ï¼Œä¹Ÿæœ‰ä¸€å®šçš„è¦†ç›–ï¼š GCThemeèµ‹å€¼åˆ‡æ¢çš®è‚¤ï¼ˆè¿™é‡ŒåŒ…è£¹å›¾ç‰‡ã€æ–‡å­—ï¼Œé¢œè‰²ï¼Œè¿™é‡Œéƒ½æ˜¯æœ¬åœ°èµ„æºï¼‰ï¼ŒåæœŸä¼šåŠ å…¥æœåŠ¡ç«¯èµ„æºï¼Œä»¥åŠå…¶ä»–ç±»å‹çš„èµ„æºæ–‡ä»¶ã€‚ é…ç½®çš„æ—¶æœºï¼Œéœ€è¦åˆ‡æ¢ï¼Œå°½é‡ä¸è¦æ”¾åˆ°AppDelegateä¸­ï¼Œå½±å“å¯åŠ¨æ—¶é—´ã€‚å·²ç»é€šè¿‡GCT.Rå»¶æ—¶å¤„ç†äº† ï¼ï¼éƒ½è¦é€šè¿‡å­—ç¬¦ä¸²å»æŸ¥æ‰¾ï¼Œç¼–ç ä¸æ˜¯å¾ˆå‹å¥½ï¼ï¼ˆåæœŸä¼šé€šè¿‡R.Objå»ä¿®æ­£è¿™ä¸ªé—®é¢˜ã€‚ï¼‰ å·²ç»é€šè¿‡GCT.Rå¤„ç†äº† GCT.Rä»£ç çš„åŠŸèƒ½ï¼Œå°±æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œç”Ÿæˆä¸€ç³»åˆ—çš„ç±»ã€å±æ€§ï¼Œä»è€Œé¿å…é€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼æ¥è·å–å›¾ç‰‡ã€æ–‡å­—ç­‰èµ„æºæ–‡ä»¶[åæœŸè¿™ä¸ªä¹Ÿå¯ä»¥åšæ‰©å±•ã€storyboard/xib/æœ¬åœ°strings/å¤šè¯­è¨€/åŸºæœ¬æ ¡éªŒä»£ç åŠŸèƒ½] ä¸ºäº†è§£å†³ä¸Šé¢å‰ä¸‰ä¸ªé—®é¢˜ï¼Œå¼€å§‹åœ¨GCT.Rçš„ä»£ç åšè¿›ä¸€æ­¥çš„ä¿®æ”¹ï¼šä¿®æ”¹é—®é¢˜1ã€3 é¦–å…ˆåŒä¸€å¼ å›¾ç‰‡æ–‡ä»¶ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯å±äºçš®è‚¤ç®¡ç†çš„æ–‡ä»¶ï¼ŒRéƒ½ä¼šç”ŸæˆRImagesç±»ï¼Œé‡Œé¢ä¼šå°†ä¸ªä¸ªå›¾ç‰‡çš„åå­—è½¬æ¢ä¸ºå±æ€§åã€‚ å¦‚æœæ˜¯çš®è‚¤ç®¡ç†çš„èµ„æºï¼Œä¼šåœ¨Rä¸‹é¢ç”Ÿæˆä¸€ä¸ªRThemeçš„ç±»ï¼Œä¸‹ä¸€çº§å°±æ˜¯å„ä¸ªplistæ–‡ä»¶ä¸­æŒ‡å‘çš„key è€Œå…·ä½“çš„å®ç°æ˜¯äº¤ç»™äº†GCTThemeæ¥åˆ¤æ–­ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345@implementation RThemes- (NSString *)value_home_title &#123; return GCTThemeTitle(@"value_home_title", @"home_tabbar"); &#125;- (UIImage *)home_wifi_scaning_unconnected &#123; return GCTThemeImg(@"home_wifi_scaning_unconnected", @"home_wifi"); &#125;- (UIColor *)home_wifi_connected &#123; return GCTThemeColor(@"home_wifi_connected", @"home_wifi"); &#125;@end ä½†æ˜¯è¿™é‡Œå…¶å®ä¹Ÿæ˜¯æœ‰ç‚¹é—®é¢˜çš„ï¼šå¦‚æœåœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­ï¼ˆhome_tabbar/home_wifiï¼‰ä¸­ï¼Œimagesæˆ–è€…colorså–äº†ä¸€ä¸ªç›¸åŒçš„key, ä½†æ˜¯å¯¹äºçš„valueåˆæ˜¯ä¸ä¸€æ ·çš„ã€‚[è¿™é‡Œè®¤ä¸ºæ˜¯è®¤ä¸ºçš„æ“ä½œé”™è¯¯âŒï¼Œåº”è¯¥å»ä¿®æ­£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»£ç çš„æ–¹å¼ä¿®æ”¹ï¼Œç»Ÿä¸€åœ¨RThemeä¸‹é¢ç”ŸæˆRColors/RImages/RStrings, ç„¶ååœ¨å“åº”çš„RColors/RImages/RStringsä¸‹é¢ç”Ÿæˆå¯¹äºçš„èµ„æºåç§°]ï¼Œé—®é¢˜å¯ä»¥ä¿®æ”¹ï¼Œä½†æ˜¯ä½¿ç”¨è€…çš„æˆæœ¬ä¹Ÿä¼šæé«˜ã€‚ ä¿®æ”¹é—®é¢˜2 ç¬¬äºŒä¸ªé—®é¢˜çš„ä¿®æ”¹ï¼Œé¿å…åœ¨Appdelegateä¸­å®æ–½æ³¨å†Œï¼Œè¿™é‡Œé€šè¿‡åœ¨Rå¯¹è±¡æ‡’åŠ è½½ä¸­å®ä¾‹åŒ–ï¼š è¿™é‡Œå› ä¸ºRçš„å¯¹è±¡å°±æ˜¯å•ä¾‹ï¼Œå¹¶ä¸”UIçš„ä¿®æ”¹åº”è¯¥éƒ½æ˜¯ä¸»çº¿ç¨‹ä¸­çš„ï¼Œæ‰€æœ‰è¿™é‡Œå°±ä¸éœ€è¦ä¸ºRThemesçš„å®åŠ›ç”Ÿæˆä¸ºå•ä¾‹ã€‚ 123456789101112131415+ (RThemes*)theme &#123; GCTThemeSwitchObject *switchObj = [GCTThemeSwitchObject new]; [switchObj setGCTThemeSwitch:YES]; [[GCTThemeManager sharedInstanceWithThemeData:[GCTThemeData new]] switchBaseOn:switchObj]; return [[R sharedInstance] theme]; &#125; - (RThemes*)theme&#123; if (!_theme) &#123; _theme = [RThemes new]; &#125; return _theme;&#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Object-C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºKiwiæµ‹è¯•]]></title>
    <url>%2F2019%2F01%2F17%2F20190117%2F</url>
    <content type="text"><![CDATA[Kiwi æµ‹è¯•æ¡†æ¶å®‰è£… é€šè¿‡Cocoapodså®‰è£…Kiwiï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 12345target 'xxxTests' do inherit! :search_paths # Pods for testing pod 'Kiwi'end å®‰è£…Kiwiçš„Xcode Template ä¸‹è½½ Kiwi Template æ‰§è¡Œå®‰è£…è„šæœ¬ sh ./install-templates.sh åˆ›å»º é€šè¿‡Xcode-&gt; File -&gt; New -&gt; File... è¾“å…¥Kiwiè¿‡æ»¤å‡ºKiwi Spec -&gt; Next åˆ›å»ºå®Œæˆ [ è¿™é‡Œè¾“å…¥çš„æ–‡ä»¶åå°±æ˜¯ä½ è¦æµ‹è¯•çš„ç±»å ] ä½¿ç”¨ Kiwiæµ‹è¯•ä¸­çš„è¡Œä¸ºæè¿°ï¼šGivenã€Whenã€Thenä¸€ä¸ªæµ‹è¯•ç±»ä¸­ï¼Œä¸€ä¸ªæµ‹è¯•ç±»åªä¼šå­˜åœ¨ä¸€ä¸ªdescribe (ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶åº”è¯¥ä¸“æ³¨äºä¸€ä¸ªæµ‹è¯•ç±»)ä¸€ä¸ªdescribeå¯ä»¥å­˜åœ¨å¤šä¸ªcontextä¸€ä¸ªcontextå¯ä»¥å­˜åœ¨å¤šä¸ªit è¿™é‡Œå†™äº†ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç®€å•çš„Userå¯¹è±¡, åŸºæœ¬æ–­è¨€æµ‹è¯•æ–‡æ¡£ Demoä¸‹è½½ 123456789101112131415161718192021222324252627#import &lt;Foundation/Foundation.h&gt;@class DataBaseManager;NS_ASSUME_NONNULL_BEGIN@interface GCTUser : NSObject@property (nonatomic, copy, readonly) NSString *userName;@property (nonatomic, assign, readonly) NSInteger password;@property (nonatomic, strong, readonly) NSArray *addressDatas;- (instancetype)initWithUserName:(NSString *)userName password:(NSInteger)password;- (void)registerAddressWith:(NSString *)addressName;- (void)unregisterAddress;// æµ‹è¯•Exceptionæ–­è¨€- (void)forceUnregisterAddress;// è·å–ç”¨æˆ·ä¿¡æ¯æ•°æ®// 1. - (NSDictionary *)userInfos;// 2. å¤–éƒ¨ä¼ å…¥- (NSDictionary *)getUserInfosFrom:(DataBaseManager *)dataBaseManager;@endNS_ASSUME_NONNULL_END 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879describe(@"Given a GCTUser", ^&#123; // &lt;--Given /* -- 1 -- */ context(@"when user userName is 'Hello world' and password is '123456'", ^&#123;// &lt;-- When GCTUser *user = [[GCTUser alloc] initWithUserName:@"Hello world" password:123456]; it(@"user is exists", ^&#123; [[user shouldNot] beNil]; &#125;); it(@"userName is 'Hello world'", ^&#123; // &lt;-- Then (with description) [[user.userName should] equal:@"Hello world"]; &#125;); specify(^&#123; [[theValue(123456) should] equal:theValue(user.password)]; // &lt;-- Then (without description) &#125;); &#125;); /* -- 2 -- */ context(@"when user created", ^&#123;// &lt;-- When __block GCTUser *user = nil; beforeAll(^&#123; user = [GCTUser new]; &#125;); afterAll(^&#123; user = nil; &#125;); it(@"when user is created, address data should be empty", ^&#123; // &lt;-- Then (with description) [[user.addressDatas should] beEmpty]; &#125;); &#125;); /* -- 3 -- */ context(@"when register address name", ^&#123;// &lt;-- When GCTUser *user = [GCTUser new]; beforeEach(^&#123; [user registerAddressWith:@"hangzhou"]; &#125;); afterEach(^&#123; [user unregisterAddress]; &#125;); it(@"after user register, then", ^&#123; // &lt;-- Then (with description) [[user.addressDatas.firstObject should] equal:@"hangzhou"]; &#125;); &#125;); /* -- 4 -- */ context(@"when unregister address", ^&#123;// &lt;-- When GCTUser *user = [GCTUser new]; beforeAll(^&#123; [user registerAddressWith:@"beijing"]; &#125;); beforeEach(^&#123; [user unregisterAddress]; &#125;); it(@"after user unregister", ^&#123;// &lt;-- Then (with description) [[user.addressDatas should] beEmpty]; &#125;); &#125;); /* -- 5 -- */ context(@"when user addresses are empty", ^&#123; GCTUser *user = [GCTUser new]; it(@"called force ungister, will throw exception", ^&#123; [[theBlock(^&#123; [user forceUnregisterAddress]; &#125;) should] raiseWithName:@"GCTUserAddressDatasEmptyException"] ; &#125;); &#125;);&#125;); ç¬¬äºŒä¸ªä¾‹å­ï¼Œæˆ‘ç”¨MVVMæ¨¡å¼ï¼Œå†™äº†ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œè¿™é‡Œé¢ç”¨åˆ°äº†UITableView, é‡ç‚¹æµ‹è¯•ViewModel, viewModelä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324#import &lt;UIKit/UIKit.h&gt;#import "HttpClient.h"typedef void(^TableViewCellConfigBlock)(id cell, id item);typedef void(^HomeViewModelSuccessBlock)(void);typedef void(^HomeViewModelFailureBlock)(NSError *e);NS_ASSUME_NONNULL_BEGIN@interface HomeViewModel : NSObject&lt;UITableViewDataSource&gt;//**??**@property (strong, nonatomic) HttpClient *httpClient; // å…·ä½“å®ç°ç½‘ç»œè¯·æ±‚çš„ç±»// å®ä¾‹åŒ–æ–¹æ³•- (instancetype)initWithCellIdentifior:(NSString *)cellIdentifior configureCellBlock:(TableViewCellConfigBlock)configureCellBlock;// ç½‘ç»œè¯·æ±‚æ–¹æ³•- (void)requestHomeDatasBasedOn:(NSString *)homeID success:(HomeViewModelSuccessBlock)success failure:(HomeViewModelFailureBlock)failure;@endNS_ASSUME_NONNULL_END æµ‹è¯•ç½‘ç»œè¯·æ±‚ç±»ï¼š è¿™é‡Œä¸»è¦ç”¨åˆ°äº†å¼‚æ­¥æ–­è¨€[[expectFutureValue(theValue(errorOccur)) shouldEventuallyBeforeTimingOutAfter(2.0)] equal:theValue(YES)]; Asynchronousæµ‹è¯•å‚è€ƒæ–‡æ¡£ 12345678910111213141516171819202122232425262728describe(@"HomeViewModel", ^&#123; context(@"Normal Request", ^&#123; HomeViewModel *viewModel = [HomeViewModel new]; __block NSError *noInputError = nil; __block BOOL errorOccur = NO; __block BOOL successOccur = NO; it(@"å½“å…¥å‚HomeIDä¸ºç©ºçš„æ—¶å€™ï¼Œå°†ä¼šè°ƒç”¨failureçš„callback, å¹¶ä¸”ä¼šè¿”å›åˆ¶å®šçš„error", ^&#123; [viewModel requestHomeDatasBasedOn:@"" success:^&#123;&#125; failure:^(NSError * _Nonnull error) &#123; noInputError = error; errorOccur = YES; &#125;]; [[expectFutureValue(theValue(errorOccur)) shouldEventuallyBeforeTimingOutAfter(2.0)] equal:theValue(YES)]; [[noInputError shouldNot] beNil]; [[noInputError should] equal:[NSError errorWithDomain:@"empty input" code:1011 userInfo:nil]]; &#125;); it(@"å½“ä¼ å…¥HomeIDçš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨successçš„callBack, å¹¶ä¸”ä¼šè¿”å›æ•°æ®", ^&#123; [viewModel requestHomeDatasBasedOn:@"HomeID" success:^&#123; successOccur = YES; &#125; failure:^(NSError * _Nonnull error) &#123;&#125;]; [[expectFutureValue(theValue(successOccur)) shouldEventuallyBeforeTimingOutAfter(2.0)] equal:theValue(YES)]; &#125;); &#125;);&#125;); è¿™é‡Œæˆ‘å¯ä»¥é€šè¿‡Mock HttpClientçš„è¿”å›æ•°æ®æ¥æµ‹è¯•è¿”å›ç»“æœ 12345678910111213141516171819202122232425 context(@"Mock Request", ^&#123; HomeViewModel *homeViewModel = [HomeViewModel new]; id mockTableView = [UITableView mock]; it(@"å¦‚æœç½‘ç»œè¯·æ±‚è¿”å›çš„æ˜¯ä¸¤ä¸ªæ•°æ®ï¼Œåˆ™UITableView DataSourceçš„æ•°æ®æºä¹Ÿæ˜¯ä¸¤ä¸ª", ^&#123; HttpClient *client = [HttpClient new]; NSArray *mockDatas = @[[[HomeModel alloc] initWithTitle:@"test-1"], [[HomeModel alloc] initWithTitle:@"test-2"], [[HomeModel alloc] initWithTitle:@"test-2"]]; [client stub:@selector(requestHomeDataBy:success:failure:) withBlock:^id(NSArray *params) &#123; HttpClientSuccessBlock successB = [params objectAtIndex:1]; successB(mockDatas); return nil; &#125;]; homeViewModel.httpClient = client; [homeViewModel requestHomeDatasBasedOn:@"test" success:^&#123; NSInteger count = [homeViewModel tableView:mockTableView numberOfRowsInSection:0]; [[theValue(count) should] equal:theValue(3)]; &#125; failure:^(NSError *e) &#123;&#125;]; &#125;);&#125;); æµ‹è¯•blockçš„å›è°ƒä»£ç å¦‚ä¸‹ï¼Œå’Œä¸Šé¢çš„mock httpClienté›·åŒ 12345678910111213141516171819202122232425262728293031323334353637383940414243context(@"Configuration", ^&#123; __block UITableViewCell *configuredCell = nil; __block id configuredObject = nil; TableViewCellConfigBlock block = ^(UITableViewCell *a, id b)&#123; configuredCell = a; configuredObject = b; &#125;; HomeViewModel *homeViewModel = [[HomeViewModel alloc] initWithCellIdentifior:@"HomeTableViewCell" configureCellBlock:block]; id mockTableView = [UITableView mock]; UITableViewCell *cell = [[UITableViewCell alloc] init]; __block id result = nil; NSIndexPath *indexPath = [NSIndexPath indexPathForRow:0 inSection:0]; it(@"å¦‚æœç½‘ç»œè¯·æ±‚è¿”å›çš„æ˜¯ä¸¤ä¸ªæ•°æ®ï¼Œåˆ™UITableView DataSourceçš„æ•°æ®æºä¹Ÿæ˜¯ä¸¤ä¸ª", ^&#123; HttpClient *client = [HttpClient new]; NSArray *mockDatas = @[[[HomeModel alloc] initWithTitle:@"test-1"], [[HomeModel alloc] initWithTitle:@"test-2"], [[HomeModel alloc] initWithTitle:@"test-2"]]; [client stub:@selector(requestHomeDataBy:success:failure:) withBlock:^id(NSArray *params) &#123; HttpClientSuccessBlock successB = [params objectAtIndex:1]; successB(mockDatas); return nil; &#125;]; homeViewModel.httpClient = client; [homeViewModel requestHomeDatasBasedOn:@"test" success:^&#123; [[mockTableView should] receive:@selector(dequeueReusableCellWithIdentifier:forIndexPath:) andReturn:cell withArguments:@"HomeTableViewCell",indexPath]; result = [homeViewModel tableView:mockTableView cellForRowAtIndexPath:indexPath]; [[result should] equal:cell]; [[configuredCell should] equal:cell]; [[configuredObject should] beKindOfClass:[HomeModel class]]; HomeModel *hM = (HomeModel *)configuredObject; [[hM.showTitle should] equal:@"test-1"]; &#125; failure:^(NSError *e) &#123;&#125;]; &#125;); &#125;); è¿™é‡Œæœ‰ç‚¹é—®é¢˜ï¼š é¦–å…ˆï¼Œæµ‹è¯•ç»“æœä»æ—§å–å†³äºç½‘ç»œçŠ¶å†µï¼Œå› æ­¤æˆ‘ä»¬å¾ˆéš¾ä¿è¯å¤šæ¬¡æµ‹è¯•ç»“æœçš„ä¸€è‡´æ€§ï¼› å…¶æ¬¡ï¼Œå½“æˆ‘ä»¬è¦æµ‹è¯•ä¸€ä¸ªRESTæœåŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæ¯ä¸ªURLçš„æµ‹è¯•éƒ½åŸºäºå®é™…ç½‘ç»œè®¿é—®å’Œè¶…æ—¶çš„æœºåˆ¶ï¼Œå°†ä¼šæ˜¾è‘—å¢åŠ æµ‹è¯•æ‰§è¡Œçš„æ—¶é—´ æˆ‘çš„è§‚ç‚¹æ˜¯ 1. æµ‹è¯•è¿‡ç¨‹è¦ä¸ä¾èµ–äºä»»ä½•å¤–éƒ¨æ¡ä»¶å’Œç³»ç»Ÿï¼›2. åœ¨ä»»ä½•ç¯å¢ƒã€æµ‹è¯•ä»»æ„å¤šæ¬¡ï¼Œç»“æœåº”è¯¥ä¿æŒä¸å˜ï¼› é¡µé¢çš„è·³è½¬æµ‹è¯• è¿™é‡Œä¸»è¦ç”¨åˆ°äº†stubå’Œmock ç»´åŸºç™¾ç§‘å¯¹stubçš„è§£é‡Š : æ¡©[1]ï¼ˆStub / Method Stubï¼‰æ˜¯æŒ‡ç”¨æ¥æ›¿æ¢ä¸€éƒ¨åˆ†åŠŸèƒ½çš„ç¨‹åºæ®µã€‚æ¡©ç¨‹åºå¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿå·²æœ‰ç¨‹åºçš„è¡Œä¸ºï¼ˆæ¯”å¦‚ä¸€ä¸ªè¿œç«¯æœºå™¨çš„è¿‡ç¨‹ï¼‰æˆ–æ˜¯å¯¹å°†è¦å¼€å‘çš„ä»£ç çš„ä¸€ç§ä¸´æ—¶æ›¿ä»£ã€‚å› æ­¤ï¼Œæ‰“æ¡©æŠ€æœ¯åœ¨ç¨‹åºç§»æ¤ã€åˆ†å¸ƒå¼è®¡ç®—ã€é€šç”¨è½¯ä»¶å¼€å‘å’Œæµ‹è¯•ä¸­ç”¨å¤„å¾ˆå¤§ç»´åŸºç™¾ç§‘å¯¹mockçš„è§£é‡Š : åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­ï¼Œæ¨¡æ‹Ÿå¯¹è±¡ï¼ˆè‹±è¯­ï¼šmock objectï¼Œä¹Ÿè¯‘ä½œæ¨¡ä»¿å¯¹è±¡ï¼‰æ˜¯ä»¥å¯æ§çš„æ–¹å¼æ¨¡æ‹ŸçœŸå®å¯¹è±¡è¡Œä¸ºçš„å‡çš„å¯¹è±¡ã€‚ç¨‹åºå‘˜é€šå¸¸åˆ›é€ æ¨¡æ‹Ÿå¯¹è±¡æ¥æµ‹è¯•å…¶ä»–å¯¹è±¡çš„è¡Œä¸ºï¼Œå¾ˆç±»ä¼¼æ±½è½¦è®¾è®¡è€…ä½¿ç”¨ç¢°æ’æµ‹è¯•å‡äººæ¥æ¨¡æ‹Ÿè½¦è¾†ç¢°æ’ä¸­äººçš„åŠ¨æ€è¡Œä¸ºã€‚ æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œå¦‚æœä½ åªæ˜¯éœ€è¦ä»¿ç…§æ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå°±ç”¨stubï¼Œå¦‚æœéœ€è¦ä»¿ç…§çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ç”¨mock 1234567891011121314151617181920describe(@"HomeViewController", ^&#123; context(@"when click a cell in table view", ^&#123; it(@"A PushViewController should be pushed", ^&#123; HomeViewController *homeViewController = [[HomeViewController alloc] init]; UIView *view = homeViewController.view; [[view shouldNot] beNil]; UINavigationController *mockNavController = [UINavigationController mock]; [homeViewController stub:@selector(navigationController) andReturn:mockNavController]; [[mockNavController should] receive:@selector(pushViewController:animated:)]; KWCaptureSpy *spy = [mockNavController captureArgument:@selector(pushViewController:animated:) atIndex:0]; [homeViewController tableView:homeViewController.tableView didSelectRowAtIndexPath:[NSIndexPath indexPathForRow:0 inSection:0]]; id obj = spy.argument; PushViewController *vc = obj; [[vc should] beKindOfClass:[PushViewController class]]; &#125;); &#125;);&#125;);]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Object-Cï¼ŒUnit-Test</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºR.Objå·¥å…·]]></title>
    <url>%2F2019%2F01%2F09%2F20190109%2F</url>
    <content type="text"><![CDATA[ç›®çš„ æƒ³é€šè¿‡R.Objè¿™ä¸ªå·¥å…·åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå»ç®¡ç†å›¾ç‰‡ã€å­—ç¬¦ä¸²ã€ä¸»é¢˜çš„èµ„æºæ–‡ä»¶ï¼Ÿï¼Ÿ å¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªé™æ€åº“ã€æˆ–è€…åŠ¨æ€åº“ï¼Ÿï¼Ÿ ä»¥åŠåæœŸå¦‚ä½•è‡ªå®šä¹‰ï¼Ÿï¼Ÿ R.obj é—®é¢˜ï¼š å¦‚æœå›¾ç‰‡ä¸æ”¾åœ¨Assestä¸­çš„è¯ï¼Œä¼šæœ‰é—®é¢˜ï¼šä¾‹å¦‚å­˜åœ¨å›¾ç‰‡ `Test@2x.pngã€Test@3x.png, æœ€åç¼–è¯‘æˆçš„æ¨¡æ¿ä¼šå­˜åœ¨ä¸¤å¼ å›¾ç‰‡åç§°Test2xã€Test3x`ï¼Œå¦‚æœç»Ÿä¸€å°†å›¾ç‰‡ç»Ÿä¸€æ”¾å…¥åˆ°Assestä¸­ï¼Œå°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚âŒ å¦‚æœå›¾ç‰‡ä¸æ”¾åœ¨Assestä¸­çš„è¯ï¼Œå®ƒå½¢æˆçš„æ¨¡æ¿çš„ä»£ç å¦‚ä¸‹, è‡ªåŠ¨ä¼šå¸¦ä¸Šå›¾ç‰‡çš„åç¼€ï¼Œä½†æ˜¯æ”¾å…¥åˆ°Asstetä¸­åˆ™æ­£å¸¸ã€‚âŒ 1- (UIImage*)wifiConnectingShowBg &#123; return [UIImage imageNamed:@"Wifi_connecting_show_bg.png"]; &#125; âƒ * å¦‚æœä¸»é¡¹ç›®ä¸­å­˜åœ¨`R.obj`,é‚£ä¹ˆå­˜åœ¨äºä¸»ç›®å½•ä¸­çš„ä»»æ„å¤šä¸ª`Bundle`ï¼Œå…¶ä¸­å›¾ç‰‡å¯èƒ½å­˜åœ¨é‡å¤å¤šä¸ªï¼Œä½†æ˜¯ç”Ÿæˆçš„`R.obj`çš„æ¨¡æ¿æ–‡ä»¶æ˜¯å”¯ä¸€çš„ã€‚ä½†æ˜¯æœ¬è´¨ä¸Šæ²¡æœ‰å»é‡ã€‚âŒ (è¿™é‡Œå¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬åˆ é™¤ï¼Œåœ¨elseçš„æ—¶å€™æ‰§è¡Œåˆ é™¤è„šæœ¬)ã€‚ ç›´æ¥æ›¿æ¢æ‰å›¾ç‰‡ï¼Œå¯ä»¥åŒæ­¥ã€‚âœ”ï¸ ï¼ˆæ¯æ¬¡ç¼–è¯‘çš„æ—¶å€™ï¼Œéƒ½ä¼šæ¯æ¬¡ç”Ÿæˆä¸€æ¬¡æ¨¡æ¿ï¼‰ é™æ€åº“å’ŒR.obj é…åˆä½¿ç”¨çš„é—®é¢˜ï¼šæƒ…å†µä¸€ï¼š åˆ›å»ºäº†ä¸€å¥—.frameworkã€.açš„é™æ€åº“ã€‚ åˆ›å»ºäº†ä¸€å¥—.bundleçš„èµ„æºæ–‡ä»¶ã€‚ï¼ˆé™æ€åº“æ²¡æœ‰ç›´æ¥è°ƒç”¨bundleé‡Œé¢çš„èµ„æºï¼‰ ç»è¿‡R.objç¼–è¯‘è¿‡åã€‚ ç»“æœï¼š å¤–éƒ¨å¯ä»¥ç›´æ¥è°ƒç”¨é™æ€åº“ä¸­çš„ä»£ç  âœ”ï¸ å›¾ç‰‡èµ„æºçš„åç§°ï¼Œç›®å‰æ²¡æ³•åˆ¶å®šBundleçš„å‰ç¼€åç§° âŒ æƒ…å†µäºŒï¼š åˆ›å»ºäº†ä¸€å¥—.frameworkã€.açš„é™æ€åº“, ç›´æ¥é€šè¿‡ä»£ç çš„æ–¹å¼è·å–å¤–éƒ¨å…¬ç”¨bundleçš„èµ„æºã€‚ ç»è¿‡R.objç¼–è¯‘è¿‡åã€‚ä»£ç å¦‚ä¸‹ï¼š 1icon.image = [UIImage imageNamed:@"å¤–éƒ¨bundle/é€šè¿‡R.objç”Ÿæˆçš„å›¾ç‰‡"]; ç»“æœï¼š é¦–å…ˆè‡ªåŠ¨ç”Ÿæˆçš„R.objä¼šå†²çªï¼Œæ— ä¸å‘ç¼–è¯‘ã€‚âŒ åœ¨é™æ€åº“ä¸­é€šè¿‡è°ƒç”¨R.objç¼–è¯‘åçš„æ¨¡æ¿ä»£ç ï¼Œæ˜¯å¯ä»¥æ˜¾ç¤ºæ­£å¸¸ï¼Œå¹¶ä¸”å¤–éƒ¨å¯ä»¥é€šè¿‡é™æ€åº“è°ƒèµ·è§†å›¾ã€‚âœ”ï¸ æƒ…å†µä¸‰ï¼š åˆ›å»ºäº†ä¸€å¥—.frameworkã€.açš„é™æ€åº“ã€‚ å¤šå¥—bundleèµ„æºã€‚ï¼ˆè¿™é‡Œå¯èƒ½ä¼šé‡å¤ï¼‰ ç»è¿‡R.objç¼–è¯‘è¿‡åã€‚ ç»“æœ å¦‚æœä¸»é¡¹ç›®ä¸­å­˜åœ¨R.obj,é‚£ä¹ˆå­˜åœ¨äºä¸»ç›®å½•ä¸­çš„ä»»æ„å¤šä¸ªBundleï¼Œå…¶ä¸­å›¾ç‰‡å¯èƒ½å­˜åœ¨é‡å¤å¤šä¸ªï¼Œä½†æ˜¯ç”Ÿæˆçš„R.objçš„æ¨¡æ¿æ–‡ä»¶æ˜¯å”¯ä¸€çš„ã€‚ä½†æ˜¯æœ¬è´¨ä¸Šæ²¡æœ‰å»é‡ã€‚âŒ (è¿™é‡Œå¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬åˆ é™¤ï¼Œåœ¨elseçš„æ—¶å€™æ‰§è¡Œåˆ é™¤è„šæœ¬)]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Object-C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ”¶é“¶å°å¼€å‘-å·¥å‚æ¨¡å¼-è®¾è®¡æ¨¡å¼(3)]]></title>
    <url>%2F2018%2F12%2F16%2F20181216%2F</url>
    <content type="text"><![CDATA[åœ¨å¼€å‘è¿™ä¸ªæ”¶é“¶å°é¡¹ç›®çš„æ—¶å€™ï¼Œå…¶å®ç”¨åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿ç”¨æœ€æœ€å¹¿æ³›çš„ï¼Œæˆ‘æƒ³é™¤äº†å•ä¾‹æ¨¡å¼ï¼Œå°±è¦æ•°ä»Šå¤©è¦è¯´çš„å·¥å‚æ¨¡å¼ï¼šé—®é¢˜ï¼šæˆ‘ä»¬åœ¨é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªæ”¯ä»˜åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº†é“¶è¡Œå¡æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è‡ªå·±çš„æ”¯ä»˜ï¼Œä½†æ˜¯è¿™ä¸ªæ”¯ä»˜çš„æ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯å…±æ€§å°±æ˜¯å¯ä»¥æ”¯ä»˜ï¼Œè¿™é‡Œå¦‚ä½•æŠ½è±¡å‘¢ï¼Ÿè§£ç­”ï¼šæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨å·¥å‚æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š å·¥å‚æ¨¡å¼è®¾è®¡ä¸­çš„è§’è‰²æœ‰å“ªäº›ï¼š æŠ½è±¡å·¥å‚(åè®®ã€æ¥å£)ã€‚ å…·ä½“å·¥å‚(éµå¾ªäº†ä¸Šé¢æ¥å£çš„å…·ä½“å·¥å‚)ã€‚ æŠ½è±¡äº§å“(å·¥å‚ç”Ÿäº§äº§å“çš„åè®®ã€æ¥å£)ã€‚ å…·ä½“äº§å“(éµå¾ªäº†ä¸Šé¢æ¥å£çš„å…·ä½“äº§å“)ã€‚ Demoå±•ç¤ºï¼Œè¿™é‡Œä»¥ä¸¤ç§æ”¯ä»˜æ–¹å¼ï¼ˆ1. AliPay 2. WeChatPayï¼‰ æŠ½è±¡çš„æ”¯ä»˜â€å·¥å‚â€(è¯´ç™½äº†ï¼Œå°±æ˜¯äº§ç”Ÿæ”¯ä»˜çš„ä¸€ä¸ªç±»)ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸ºPayProtocolä»£ç å¦‚ä¸‹ï¼š 12345@protocol PayProtocol &lt;NSObject&gt;- (id&lt;PayItemProtocol&gt;)getPayItem;@end ä¸Šé¢è¿™ä¸ªå·¥å‚åªä¼šç”Ÿäº§ä¸€ç§ä¸œè¥¿, è¿™ç§ä¸œè¥¿æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå«PayItemProtocol,è¯´ç™½äº†å°±æ˜¯æˆ‘ä»¬æ ¹æ®è¿™ç§æ”¯ä»˜æ–¹å¼ï¼Œäº§ç”Ÿçš„Dictionaryçš„æ•°æ®ç»“æ„ï¼Œæœ€åå¯ä»¥æäº¤åˆ°åå°å»ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345@protocol PayItemProtocol &lt;NSObject&gt;- (NSDictionary *)createPayRequestDatas;@end ä¸‹é¢çœ‹ä¸€ä¸‹å…·ä½“ç±»å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/*--AliPayçš„å…·ä½“å·¥å‚ç±»AliPayManager*/@interface AliPayManager : NSObject&lt;PayProtocol&gt;@end#import "AliPay.h"@implementation AliPayManager- (id&lt;PayItemProtocol&gt;)getPayItem &#123; return [[AliPay alloc] init]; &#125;@end/*--AliPayItemçš„å…·ä½“å®ç°ç±»--*/@interface AliPay : NSObject&lt;PayItemProtocol&gt;@end@implementation AliPay- (NSDictionary *)createPayRequestDatas &#123; return @&#123;@"uid": @"aid_111"&#125;;&#125;@end/*-----------------ä¸‹é¢æ˜¯WeChatPay----------------------*//*--WeChatPayManager--*/@interface WeChatPayManager : NSObject&lt;PayProtocol&gt;@end#import "WeChatPay.h"@implementation WeChatPayManager- (id&lt;PayItemProtocol&gt;)getPayItem &#123; return [[WeChatPay alloc] init]; &#125;@end/*--WeChatPay--*/@interface WeChatPay : NSObject&lt;PayItemProtocol&gt;@end@implementation WeChatPay- (NSDictionary *)createPayRequestDatas &#123; return @&#123;@"uid": @"we_222"&#125;;&#125;@end å…·ä½“ä½¿ç”¨, éœ€è¦æ”¹å˜çš„åªæœ‰ä¸€ä¸ªåœ°æ–¹ï¼Œè¿™é‡Œå°±èƒ½çœ‹å‡ºæ¥å·¥å‚ç±»çš„ä¼˜åŠ¿äº†ï¼š 12345678910/*--AliPayçš„ä½¿ç”¨æ–¹å¼--*/id&lt;PayProtocol&gt;manager = [[AliPayManager alloc] init];id&lt;PayItemProtocol&gt;payItem = [manager getPayItem];NSLog(@"%@", [payItem createPayRequestDatas]);/*--WeChatPayçš„ä½¿ç”¨æ–¹å¼--*/id&lt;PayProtocol&gt;manager = [[WeChatPayManager alloc] init];id&lt;PayItemProtocol&gt;payItem = [manager getPayItem];NSLog(@"%@", [payItem createPayRequestDatas]);]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Object-Cã€è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ”¶é“¶å°å¼€å‘-è¿­ä»£å™¨æ¨¡å¼-è®¾è®¡æ¨¡å¼(2)]]></title>
    <url>%2F2018%2F12%2F14%2F20181214%2F</url>
    <content type="text"><![CDATA[é—®é¢˜ï¼š æ”¶é“¶å°å…¶ä¸­ä¸€ä¸ªå¤æ‚ç‚¹ï¼šå¯¹æ¥çš„åå°æ•°æ®ï¼Œä¼šæœ‰å¾ˆå¤šç§è¯·æ±‚æ•°æ®ç»“æ„ï¼Œä½ éƒ½éœ€è¦å°†è¿™äº›ä¸åŒçš„æ•°æ®ç»„è£…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å±•ç¤ºï¼Œä¾‹å¦‚ï¼š ä¾‹å¦‚å¯ç”¨æ”¯ä»˜æ–¹å¼çš„å±•ç¤ºï¼ˆå±•ç¤ºå„ä¸ªå¯ç”¨é“¶è¡Œå¡å‚¨è“„å¡ã€ä¿¡ç”¨å¡ã€ç§¯åˆ†ç­‰ç­‰ï¼‰ ä¾‹å¦‚è®¢å•æ˜ç»†çš„å±•ç¤ºï¼ˆå±•ç¤ºå„ä¸ªå¯ç”¨é“¶è¡Œå¡å‚¨è“„å¡ã€ä¿¡ç”¨å¡ã€ç§¯åˆ†ç­‰ç­‰ä¸åŒæ¸ é“æ¥æºæ•°æ®ï¼‰ è§£å†³ è¿™é‡Œå°±éœ€è¦ç”¨åˆ°è¿­ä»£å™¨çš„è®¾è®¡æ¨¡å¼ è§’è‰² è¿­ä»£å™¨æ¥å£ (æ–¹æ³•ï¼šfunc hasNext() -&gt; Boolã€ func next() -&gt; BaseModelProtocol?) éµå¾ªè¿­ä»£å™¨æ¥å£çš„å®ä½“ç±»(DefaultIteratorConcrete-&gt; çˆ¶ç±»ï¼Œå…¶ä»–çš„å­ç±»å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°) å®¹å™¨æ¥å£ ContainerProtocol éµå¾ªå®¹å™¨æ¥å£çš„å®ä½“ç±» AliPayContainerã€WeChatContainer ä¸¾ä¸ªæ —å­ æ•°æ®æ¨¡å‹å±‚æ¥å£çš„è®¾è®¡BaseModelProtocol: 123456789101112131415161718192021/*-----æ¨¡å‹å±‚æ¥å£çš„å®šä¹‰------*/protocol BaseModelProtocol &#123; var uid: String &#123; set get &#125;&#125;/*------æ¨¡å‹å±‚çš„ä¸¤ä¸ªå®ä½“ç±»AliPayModelã€WeChatModel----------*/class AliPayModel: NSObject, BaseModelProtocol &#123; var uid: String init(aliPayID: String) &#123; self.uid = aliPayID &#125;&#125;class WeChatModel: NSObject, BaseModelProtocol &#123; var uid: String init(weChatID: String) &#123; self.uid = weChatID &#125;&#125; è¿­ä»£å™¨æ¥å£çš„å®šä¹‰ï¼š è¿™é‡ŒDefaultIteratorConcreteï¼Œå¯ä»¥é€šè¿‡Protocol Extensionçš„åŠŸèƒ½ï¼Œå¯¹åè®®IteratorProtocolå®ç°é»˜è®¤çš„ï¼Œä½†æ˜¯è¿™é‡Œä¸ºäº†åœ¨Javaç­‰å…¶ä»–å¹³å°éƒ½èƒ½è¿ç”¨åŒä¸€å¥—æ¶æ„æ¨¡å¼ï¼Œæ‰€ä»¥é€‰ç”¨äº†åŸºç±»çš„å®ç°æ–¹å¼ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970/*----è¿­ä»£å™¨æ¥å£çš„å®šä¹‰-------*/protocol IteratorProtocol &#123; func hasNext() -&gt; Bool func next() -&gt; BaseModelProtocol?&#125;/*------éµå¾ªè¿­ä»£å™¨æ¥å£çš„åŸºç±»å®ç°-------*//*--------è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªæ³›å‹---------*//*--æ³¨æ„ï¼šè¿™é‡Œå¯ä»¥é€šè¿‡Protcol Extension, è€Œä¸éœ€è¦ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼å»å®ç°ï¼Œè¿™æ ·çš„è¯å°±ä¸è¦è¿™ä¸ªDefaultIteratorConcreteç±»äº†--*/class DefaultIteratorConcrete&lt;T&gt;: IteratorProtocol &#123; var obj: T init(obj: T) &#123; self.obj = obj &#125; func hasNext() -&gt; Bool &#123; return false &#125; func next() -&gt; BaseModelProtocol? &#123; return nil &#125;&#125;/*--AliPayçš„è¿­ä»£å™¨ï¼Œè¿™é‡Œçš„æ•°æ®ç»“æ„ç»Ÿä¸€æ”¾å…¥åˆ°æ•°ç»„ä¸­å»å®ç°ï¼Œå…·ä½“çš„å®ç°é€šè¿‡è¦†å†™å­ç±»çš„æ–¹å¼--*//*--å¦‚æœç”¨äº†ä¸Šé¢Protocol Extensionçš„æ–¹å¼å»å®ç°ï¼Œå°±ä¸éœ€è¦è¦†å†™çš„æ–¹å¼å»å®ç°äº†--*//*--æ³¨æ„ï¼šå› ä¸ºä¸Šé¢åŸºç±»é‡Œé¢æˆ‘éœ€è¦ç”¨åˆ°çš„æ˜¯ä¸€ä¸ªé›†åˆçš„æ•°æ®ç±»å‹ï¼Œå› ä¸ºç”¨åˆ°äº†æ³›å‹ï¼Œè¿™é‡Œæˆ‘å°±ç”¨åˆ°äº†åµŒå¥—çš„æ³›å‹æ•°æ®é›†åˆ--*/class AliPayIterator: DefaultIteratorConcrete&lt;Array&lt;AliPayModel&gt;&gt; &#123; private var datas: Array&lt;AliPayModel&gt; = Array&lt;AliPayModel&gt;() private var index = 0 override init(obj: Array&lt;AliPayModel&gt;) &#123; super.init(obj: obj) &#125; override func next() -&gt; BaseModelProtocol? &#123; if self.hasNext() &#123; let result = self.obj[self.index] index += 1 return result &#125; return nil &#125; override func hasNext() -&gt; Bool &#123; return self.index != self.obj.count &#125;&#125;/*--WeChatçš„è¿­ä»£å™¨å’Œä¸Šé¢çš„åŸºæœ¬ä¸€è‡´ï¼Œå”¯ä¸€çš„åŒºåˆ«è¿™é‡Œä½¿ç”¨çš„æ˜¯Setçš„æ•°æ®ç»“æ„--*/class WeChatItrator: DefaultIteratorConcrete&lt;Set&lt;WeChatModel&gt;&gt; &#123; private var datas: Set&lt;WeChatModel&gt; = Set&lt;WeChatModel&gt;() private var iterator: SetIterator&lt;WeChatModel&gt; private var index: Int = 0 override init(obj: Set&lt;WeChatModel&gt;) &#123; self.iterator = obj.makeIterator() super.init(obj: obj) &#125; override func next() -&gt; BaseModelProtocol? &#123; if self.hasNext() &#123; let result = self.iterator.next() index += 1 return result &#125; return nil &#125; override func hasNext() -&gt; Bool &#123; return index != self.obj.count &#125;&#125; å®¹å™¨æ¥å£çš„å®šä¹‰ï¼š 1234567891011protocol ContainerProtocol &#123; associatedtype DataType func add(obj: DataType) func remove(obj: DataType) func getIterator() -&gt; IteratorProtocol func forEach()&#125; éµå¾ªå®¹å™¨æ¥å£çš„å®ä½“ç±»çš„å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344/*--AliPayContainer--*/class AliPayContainer&lt;T: BaseModelProtocol&gt;: ContainerProtocol &#123; private var data: Array&lt;T&gt; = Array&lt;T&gt;() private lazy var it = AliPayIterator(obj: self.data as! Array&lt;AliPayModel&gt;) typealias DataType = T func add(obj: DataType) &#123; self.data.append(obj) &#125; func remove(obj: DataType) &#123; &#125; func getIterator() -&gt; IteratorProtocol &#123; return self.it &#125; func forEach() &#123; for item in data &#123; print(item) &#125; &#125;&#125;/*--WeChatContainer--*/class WeChatContainer&lt;T: WeChatModel&gt;: ContainerProtocol &#123; private var data: Set&lt;T&gt; = Set&lt;T&gt;() private lazy var it = WeChatItrator(obj: self.data) typealias DataType = T func add(obj: DataType) &#123; self.data.insert(obj) &#125; func remove(obj: DataType) &#123; &#125; func getIterator() -&gt; IteratorProtocol &#123; return self.it &#125; func forEach() &#123; for item in data &#123; print(item) &#125; &#125;&#125; ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘è‡ªå·±åˆå®šä¹‰äº†ä¸€ä¸ªContainerçš„å®¹å™¨ç±»ï¼Œä¸ºäº†å°±æ˜¯æ–¹ä¾¿è°ƒç”¨ï¼Œéšè—å®ç°ç»†èŠ‚ï¼š è¿™é‡Œæˆ‘è§‰å¾—å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œä»£ç å°±æœ‰ç‚¹å†™æ­»äº†ï¼Œå› ä¸ºåœ¨addä¸­éœ€è¦å…·ä½“æ ¹æ®ç±»å‹å»åˆ¤æ–­ï¼Œè¿™é‡Œæˆ‘è¿˜æ²¡æœ‰æƒ³å¥½ï¼ï¼ 12345678910111213141516171819class Container &#123; private lazy var aliPayContainer = AliPayContainer&lt;AliPayModel&gt;() private lazy var weChatContainer = WeChatContainer&lt;WeChatModel&gt;() func add(_ item: BaseModelProtocol) &#123; if item is AliPayModel &#123; aliPayContainer.add(obj: item as! AliPayModel) &#125; else if item is WeChatModel &#123; weChatContainer.add(obj: item as! WeChatModel) &#125; &#125; func allObjects() &#123; if (aliPayContainer.getIterator().hasNext()) &#123; aliPayContainer.forEach() &#125; if (weChatContainer.getIterator().hasNext()) &#123; weChatContainer.forEach() &#125; &#125; &#125; å…·ä½“å®ç°ï¼š 1234let container = Container()container.add(AliPayModel(aliPayID: "a2"))container.add(WeChatModel(weChatID: "w3"))container.allObjects()]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swiftã€è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ”¶é“¶å°å¼€å‘-è´£ä»»é“¾æ¨¡å¼-è®¾è®¡æ¨¡å¼(1)]]></title>
    <url>%2F2018%2F12%2F13%2F20181213%2F</url>
    <content type="text"><![CDATA[åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¸»è¦ç‹¬è‡ªå¼€å‘ä¸€ä¸ªæ”¶é“¶å°çš„æ¨¡å—ã€è¿™ä¸ªæ¨¡å—è®¾è®¡åˆ°çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥è‡ªå·±ä¹ŸèŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå»ç ”ç©¶è®¾è®¡æ¨¡å¼ï¼ŒæŠŠä»£ç å†™å¥½ï¼Œä¸‹é¢å°±ä¼šåˆ†å‡ ä¸ªç« èŠ‚åˆ†äº«ä¸€ä¸‹æˆ‘çš„å‡ ä¸ªå¿ƒå¾— é‡åˆ°æƒ…å†µï¼š åŠ¨æ€çš„å»å†³å®šæ”¯ä»˜çš„æ–¹å¼(ç±»ä¼¼æ”¯ä»˜åŒ…åŠ¨æ€æ”¯ä»˜ï¼Œå¯èƒ½åœ¨ä¸åŒåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¼šèµ°ä¸åŒæ”¯ä»˜æ–¹å¼ï¼Œå¯ä»¥æ˜¯ä½™é¢ï¼Œå¯ä»¥æ˜¯æŸé“¶è¡Œã€å¯ä»¥æ˜¯ä½™é¢å®ã€å¯ä»¥æ˜¯èŠ±å‘—ï¼Œé‚£è¿™æ ·çš„è¯ï¼Œå¯èƒ½ä¼šæ ¹æ®å¤šä¸ªå› ç´ ç»¼åˆå»åˆ¤æ–­ï¼Œåˆ°åº•æ˜¯èµ°ä»€ä¹ˆæ”¯ä»˜)ã€‚ æˆ‘ä»¬è¿™é‡Œä¸ºäº†è¯´æ˜æƒ…å†µï¼Œå°±å•ä¸€åªä»é‡‘é¢å»åˆ¤æ–­ï¼ˆè¿™é‡Œå‡è®¾ä½ çš„å‡ ç§æ”¯ä»˜æ¸ é“éƒ½æ˜¯å­˜åœ¨é’±çš„ï¼â€“&gt; ä½†æ˜¯å…¶å®è¿™é‡Œçš„æœ‰æ²¡æœ‰é’±ï¼Œå…¶å®ä½ è¿˜æ˜¯è¦èµ°æœåŠ¡å™¨å»æŸ¥è¯¢çš„ï¼‰ è§£å†³é—®é¢˜ï¼šå­˜åœ¨ä»¥ä¸‹å‡ ä¸ªè§’è‰² æŠ½è±¡AbsPayWayç±»ï¼šï¼ˆ1. ä¸‹ä¸€èŠ‚ç‚¹çš„å±æ€§ 2. chooseToPayçš„æ–¹æ³•ï¼‰ å…·ä½“çš„PayWayç±»ï¼šï¼ˆ1. ä½™é¢ï¼ˆBalancePayWayï¼‰2. èŠ±å‘—ï¼ˆHuaPayWayï¼‰3. é“¶è¡Œï¼ˆBankPayWayï¼‰ï¼‰ PayWayParamtersç±» ï¼ˆ1. æ”¯ä»˜é‡‘é¢ï¼ˆpayMentAmountï¼‰ï¼‰ å…·ä½“ä»£ç  AbsPayWayç±» 123456789101112131415161718class AbsPayWay &#123; var nextPayWay: AbsPayWay? // è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±é¡¹ç›®çš„æƒ…å†µæ¥é…ç½®ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œæ˜¯å¯ä»¥æœ‰è‡ªå·±æ¥æ”¯ä»˜çš„ï¼Œä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦äº¤ç”±ä¸‹ä¸€çº§æ¥æ”¯ä»˜ final func chooseToPay(paywayParamters: PayWayParamters) &#123; if paywayParamters.payMentAmount &lt;= self.configPayAmount() &#123; self.configAndToPay(paywayParamters: paywayParamters) &#125; else if let _ = self.nextPayWay &#123; self.nextPayWay?.chooseToPay(paywayParamters: paywayParamters) &#125; else &#123; print("å·²ç»è¶…å‡ºæœ€å¤§é™é¢äº†ï¼ï¼ï¼") &#125; &#125; func configPayAmount() -&gt; Int &#123; return 0 &#125; func configAndToPay(paywayParamters: PayWayParamters) &#123;&#125;&#125; PayWayParamtersç±»ç»“æ„ 1234567class PayWayParamters &#123; var payMentAmount: Int init(payMentAmount: Int) &#123; self.payMentAmount = payMentAmount &#125;&#125; æ”¯ä»˜çš„å…·ä½“å‡ ç§æ–¹å¼ï¼š 1234567891011121314151617181920212223242526272829303132333435363738/*----1.BalancePayWayï¼ˆä½™é¢ï¼‰------*/class BalancePayWay: AbsPayWay &#123; // ä½™é¢çš„æ”¯ä»˜é¢åº¦åªæœ‰10å…ƒ override func configPayAmount() -&gt; Int &#123; return 10 &#125; // å¦‚æœä½™é¢æ”¯ä»˜äº†ï¼Œæˆ‘è¿™é‡Œéœ€è¦æ ¹æ®è¿™ç§æƒ…å†µå®Œæˆè‡ªå·±çš„æ–¹æ³• override func configAndToPay(paywayParamters: PayWayParamters) &#123; print("ä½™é¢æ”¯ä»˜äº†\(paywayParamters.payMentAmount)") &#125;&#125;/*----2.HuaPayWayï¼ˆèŠ±å‘—ï¼‰------*/class HuaPayWay: AbsPayWay &#123; // èŠ±å‘—çš„æ”¯ä»˜é¢åº¦åªæœ‰100å…ƒ override func configPayAmount() -&gt; Int &#123; return 100 &#125; // å¦‚æœèŠ±å‘—æ”¯ä»˜äº†ï¼Œæˆ‘è¿™é‡Œéœ€è¦æ ¹æ®è¿™ç§æƒ…å†µå®Œæˆè‡ªå·±çš„æ–¹æ³• override func configAndToPay(paywayParamters: PayWayParamters) &#123; print("èŠ±å‘—æ”¯ä»˜äº†\(paywayParamters.payMentAmount)") &#125;&#125;/*----3.BankPayWayï¼ˆé“¶è¡Œæ”¯ä»˜ï¼‰------*/class BankPayWay: AbsPayWay &#123; // é“¶è¡Œçš„æ”¯ä»˜é¢åº¦åªæœ‰10000å…ƒ override func configPayAmount() -&gt; Int &#123; return 10000 &#125; // å¦‚æœé“¶è¡Œæ”¯ä»˜äº†ï¼Œæˆ‘è¿™é‡Œéœ€è¦æ ¹æ®è¿™ç§æƒ…å†µå®Œæˆè‡ªå·±çš„æ–¹æ³• override func configAndToPay(paywayParamters: PayWayParamters) &#123; print("é“¶è¡Œæ”¯ä»˜äº†\(paywayParamters.payMentAmount)") &#125;&#125; å…·ä½“ä½¿ç”¨ï¼Œè¿™é‡Œä¸ºäº†æ”¶æ‹¢ï¼Œéšè—å®ç°ç»†èŠ‚ï¼Œåˆ›å»ºä¸€ä¸ªæ”¯ä»˜çš„ç±»Pay 123456789101112131415161718192021222324252627class PayObject &#123; class func pay(amount: Int) &#123; let balancePayWay = BalancePayWay() let huaPayWay = HuaPayWay() let bankPayWay = BankPayWay() balancePayWay.nextPayWay = huaPayWay huaPayWay.nextPayWay = bankPayWay let payparamters = PayWayParamters(payMentAmount: amount) balancePayWay.chooseToPay(paywayParamters: payparamters) &#125; &#125;/*----Final: å…·ä½“ä½¿ç”¨-----*/ PayObject.pay(amount: 1)// ç»ˆç«¯æ˜¾ç¤º ä½™é¢æ”¯ä»˜äº†1PayObject.pay(amount: 11)// ç»ˆç«¯æ˜¾ç¤º èŠ±å‘—æ”¯ä»˜äº†11PayObject.pay(amount: 101)// ç»ˆç«¯æ˜¾ç¤º é“¶è¡Œæ”¯ä»˜äº†101PayObject.pay(amount: 100000001)// ç»ˆç«¯æ˜¾ç¤º å·²ç»è¶…å‡ºæœ€å¤§é™é¢äº†ï¼ï¼ï¼ å­˜åœ¨é—®é¢˜ï¼š è¿™é‡Œä½¿ç”¨çš„åœºæ™¯æ˜¯ä¼šå­˜åœ¨ç­‰çº§ã€æˆ–è€…å…ˆåé¡ºåºçš„ï¼Œéœ€è¦å…·ä½“è€ƒè™‘ã€‚ è¿™é‡Œçš„PayWayParamtersï¼Œæ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œä¹Ÿå¯ä»¥å£°æ˜æˆä¸€ä¸ªæŠ½è±¡çš„ç±»ï¼Œç„¶ååœ¨ç”¨ä¸åŒçš„å®ä½“PayWayParamtersæ¥ä½¿ç”¨ã€‚ è¿™é‡Œå¯ä»¥è€ƒè™‘ä¸ç”¨ç»§æ‰¿æ¢åšåè®®å¯ä»¥è¯•è¯•ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swiftã€è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[éè¶Šç‹±æ‰‹æœºæ¤å…¥åŠ¨æ€åº“]]></title>
    <url>%2F2018%2F12%2F12%2F20181212%2F</url>
    <content type="text"><![CDATA[ç›®æ ‡ï¼š1.ä¿®æ”¹çˆ±å¥‡è‰ºApp2.å°†è¿™ä¸ªä¿®æ”¹è¿‡çš„Appé‡ç­¾å3.å®‰è£…åœ¨æœªè¶Šç‹±æ‰‹æœºä¸Š å‡†å¤‡ï¼š1.è¶Šç‹±æ‰‹æœºå’Œä¸€å°æœªè¶Šç‹±æ‰‹æœº2.Macç”µè„‘ 1. ä¿®æ”¹çˆ±å¥‡è‰ºApp æ­¥éª¤1. åœ¨è¶Šç‹±æ‰‹æœºAppStoreä¸Šä¸‹è½½çˆ±å¥‡è‰ºApp. æ­¥éª¤2. åœ¨è¶Šç‹±æ‰‹æœºä¸Šæ‰¾åˆ°çˆ±å¥‡è‰ºçš„AppID, è¿™é‡Œå¯ä»¥é€šè¿‡MJAppTools, å¿«é€ŸæŸ¥è¯¢(è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡Cycriptæ¥æ‰¾åˆ°)ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678// ç»ˆç«¯MJAppTools -l// æ˜¾ç¤ºã€çˆ±å¥‡è‰ºã€‘ &lt;com.qiyi.iphone&gt;/private/var/mobile/Containers/Bundle/Application/C8575DD1-889E-4E70-AF66-4E4CC920F6AC/iQiYiPhoneVideo.app/private/var/mobile/Containers/Data/Application/CD9280DD-C4C3-4CF2-84E0-5F484596E211 arm_64 åŠ å£³ æ­¥éª¤3. åˆ›å»ºä¸€ä¸ªåå«libReveal.plistçš„æ–‡ä»¶ï¼Œå°†åˆšæ‰çš„AppIDcopyè¿›plistä¸­ï¼Œå¦‚ä¸‹: 1234567&#123; Filter = &#123; Bundles = ( "com.qiyi.iphone" ); &#125;;&#125; æ­¥éª¤4. æ‰“å¼€Reveal 1234//1. æ‰¾åˆ°Helpe -&gt; Show Reveal Library in Finder -&gt; iOS Library//2. é‡å‘½åRevealServer -&gt; libReveal æ­¥éª¤5. å°†libReveal.plist å’Œ libReveal.dylib åŒæ—¶ä¸Šä¼ åˆ°è¶Šç‹±æœºå™¨ä»¥ä¸‹è·¯å¾„ï¼ˆå¯ä»¥é€šè¿‡iFunBoxï¼‰ï¼š 1Device/Library/MobileSubStrate/DynamicLibraries æ­¥éª¤6. æ­¤æ—¶æ‰“å¼€Revealå’Œè¶Šç‹±æœºå™¨ä¸Šçš„çˆ±å¥‡è‰ºAppï¼Œç»“åˆCycriptæˆ–è€…mjcript, å¯ä»¥æ‰¾åˆ°ä½ æƒ³è¦ä¿®æ”¹çš„ä¸œè¥¿æ‰€å±çš„ç±»ï¼Œè¿™é‡Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¿®æ”¹æ’­æ”¾çš„å¹¿å‘Šã€‚ æ­¥éª¤7. é€šè¿‡Revealå¯ä»¥æ‰¾åˆ°å¯åŠ¨é¡µé¢ç›¸å…³çš„å¹¿å‘ŠViewæ˜¯QYStartADView, å®ƒæ‰€å±çš„ç±»æ˜¯QYStartADViewController æ­¥éª¤8. é€šè¿‡Clutchæˆ–dumpdecryptedè„±å£³ï¼Œå¾—åˆ°è„±å£³åçš„æ–°Appã€‚æˆ‘ç”¨çš„æ˜¯Clutch,ä»£ç å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233// ç½—åˆ—æ‰‹æœºä¸Šå¯ä»¥è„±å£³çš„AppClutch -i// è„±å£³æŒ‡å®šAppClutch -d x(çˆ±å¥‡å¼‚çš„å‰é¢çš„æ•°å­—)// è¿”å›com.qiyi.iphone contains watchOS 2 compatible application. It's not possible to dump watchOS 2 apps with Clutch 2.0.4 at this moment.Zipping iQiYiPhoneVideo.appASLR slide: 0x100004000Dumping &lt;QiYiUserNotification&gt; (arm64)Patched cryptid (64bit segment)ASLR slide: 0x1000dc000Dumping &lt;QYToday&gt; (arm64)Patched cryptid (64bit segment)ASLR slide: 0x1000bc000Dumping &lt;QYSiriShortCuts&gt; (arm64)Patched cryptid (64bit segment)Writing new checksumWriting new checksumWriting new checksumobjc[4015]: Class ZipArchive is implemented in both /var/tmp/clutch/1C8BA028-6FC4-4975-B4E9-644D2935FB55/clutch and /private/var/mobile/Containers/Bundle/Application/C8575DD1-889E-4E70-AF66-4E4CC920F6AC/iQiYiPhoneVideo.app/Frameworks/QYUniversalFramework.framework/QYUniversalFramework. One of the two will be used. Which one is undefined.Dumping &lt;QYUniversalFramework&gt; arm64ASLR slide: 0x100054000Dumping &lt;iQiYiPhoneVideo&gt; (arm64)Patched cryptid (64bit segment)Successfully dumped framework QYUniversalFramework!Child exited with status 0Zipping QYUniversalFramework.frameworkZipping QYSiriShortCuts.appexZipping QYToday.appexZipping QiYiUserNotification.appexWriting new checksumDONE: /private/var/mobile/Documents/Dumped/com.qiyi.iphone-iOS9.0-(Clutch-2.0.4).ipaFinished dumping com.qiyi.iphone in 38.5 seconds æ­¥éª¤9. copyå‡ºæ¥å·²ç»è„±å£³äº†çš„App,ç„¶åæ‰¾åˆ°åŒ…ä¸­çš„Mach-Oæ–‡ä»¶ï¼Œæœ€åè¿ç”¨class-dump, æ‰§è¡Œä»¥ä¸‹çš„å‘½ä»¤å¾—åˆ°ç›¸åº”çš„å¤´æ–‡ä»¶ï¼š 1class-dump -H -o iqiHeaders iQiYiPhoneVideo.app æ­¥éª¤10. é€šè¿‡æŸ¥çœ‹ç±»QYStartADViewçš„ç›¸å…³å¤´æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384//// Generated by class-dump 3.5 (64 bit).//// class-dump is Copyright (C) 1997-1998, 2000-2001, 2004-2013 by Steve Nygard.//#import "UIView.h"#import "QYStartADViewControllerDelegate.h"#import "QYStartAdPlayerControllerDelegate.h"@class AdsClient, CupidAd, NSString, NSTimer, QYStartADViewController, QYStartAdPlayerController, QYWebContainer, UILabel, UIWindow;@interface QYStartADView : UIView &lt;QYStartAdPlayerControllerDelegate, QYStartADViewControllerDelegate&gt;&#123; UIWindow *_window; NSTimer *_adTimer; float _iAdTime; _Bool _shouldRun; long long _addedTime; float _adShowTime; _Bool _isFullScreenAd; int _type; id &lt;QYPhoneStartADViewDelegate&gt; _delegate; UILabel *_secords; long long _duration; double _logoBackHeight; double _needToCut; UIView *_adImageView; QYWebContainer *_webView; AdsClient *_adClient; CupidAd *_adCupid; QYStartAdPlayerController *_player; QYStartADViewController *_startAdViewController;&#125;@property(retain, nonatomic) QYStartADViewController *startAdViewController; // @synthesize startAdViewController=_startAdViewController;@property(retain, nonatomic) QYStartAdPlayerController *player; // @synthesize player=_player;@property(nonatomic) int type; // @synthesize type=_type;@property(retain, nonatomic) CupidAd *adCupid; // @synthesize adCupid=_adCupid;@property(retain, nonatomic) AdsClient *adClient; // @synthesize adClient=_adClient;@property(retain, nonatomic) QYWebContainer *webView; // @synthesize webView=_webView;@property(retain, nonatomic) UIView *adImageView; // @synthesize adImageView=_adImageView;@property(nonatomic) double needToCut; // @synthesize needToCut=_needToCut;@property(nonatomic) double logoBackHeight; // @synthesize logoBackHeight=_logoBackHeight;@property(nonatomic) long long duration; // @synthesize duration=_duration;@property(retain, nonatomic) UILabel *secords; // @synthesize secords=_secords;@property(nonatomic) _Bool isFullScreenAd; // @synthesize isFullScreenAd=_isFullScreenAd;@property(nonatomic) __weak id &lt;QYPhoneStartADViewDelegate&gt; delegate; // @synthesize delegate=_delegate;- (void).cxx_destruct;- (id)imageFromImage:(id)arg1 inRect:(struct CGRect)arg2;- (void)playToEnd;- (void)playError;- (void)h5WillJumpToPage;- (void)userInteractWithHtml;- (void)sendH5AdClickPingback;- (void)finishDisplayHtml;- (void)keyboardDidHide;- (id)labelWithFrame:(struct CGRect)arg1 backgroundColor:(id)arg2 textColor:(id)arg3 font:(id)arg4 text:(id)arg5 textAlignment:(long long)arg6;- (id)imageViewWithFrame:(struct CGRect)arg1 image:(id)arg2;- (void)delegateCallStartADViewDidEnd;- (void)showEnds;- (void)updateTime;- (void)updateUI:(id)arg1;- (void)finishAdShowForHtml;- (void)prepareForEndAd;- (void)secondChange;- (void)timerStart;- (void)showAdDetail;- (void)skipAd;- (id)createTouchScreenPromptView;- (id)createViewWithType:(int)arg1 withURL:(id)arg2;- (void)addBottomView;- (void)addTimeBg;- (id)initWithType:(int)arg1 withURL:(id)arg2 withDur:(long long)arg3 withAdData:(id)arg4 withADCupid:(id)arg5;- (void)dealloc;// Remaining properties@property(readonly, copy) NSString *debugDescription;@property(readonly, copy) NSString *description;@property(readonly) unsigned long long hash;@property(readonly) Class superclass;@end è¿™é‡Œçš„ä»£ç é‡ä¸æ˜¯å¾ˆå¤šï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™ä¸ª- (id)initWithType:(int)arg1 withURL:(id)arg2 withDur:(long long)arg3 withAdData:(id)arg4 withADCupid:(id)arg5;æœ‰å¯èƒ½å°±æ˜¯ä¸€ä¸ªå®ä¾‹åŒ–æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¦†å†™è¿™ä¸ªæ–¹æ³•æ¥è¾¾åˆ°å–æ¶ˆå¯åŠ¨å¹¿å‘Šçš„æ•ˆæœï¼ˆè¿™é‡Œåªæ˜¯ä¸€ä¸ªçŒœæµ‹ï¼ï¼‰ æ­¥éª¤11. ä¸‹é¢é€šè¿‡ç¼–å†™theos, æ¥è¦†å†™è¿™ä¸ªå®ä¾‹åŒ–æ–¹æ³•ï¼Œå‡è®¾ä½ å·²ç»æŒ‰ç…§githubä¸Šçš„æ•™ç¨‹å®‰è£…å¥½äº†ï¼Œæ­¤æ—¶å°±å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æµç¨‹å¼€å§‹ï¼š xxx.xmçš„ç›¸å…³è¯­æ³•çš„ç¼–å†™å¯ä»¥å‚è€ƒè¯­æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/*------1-------*/// åœ¨åˆé€‚çš„ä½ç½®æ‰§è¡Œï¼Œä¸‹é¢çš„å‘½ä»¤nic.pl/*------2-------*/// ç»ˆç«¯çš„æ˜¾ç¤ºNIC 2.0 - New Instance Creator------------------------------ [1.] iphone/activator_event [2.] iphone/application_modern [3.] iphone/application_swift [4.] iphone/cydget [5.] iphone/flipswitch_switch [6.] iphone/framework [7.] iphone/ios7_notification_center_widget [8.] iphone/library [9.] iphone/notification_center_widget [10.] iphone/preference_bundle_modern [11.] iphone/tool [12.] iphone/tool_swift [13.] iphone/tweak [14.] iphone/xpc_serviceChoose a Template (required):/*------3-------*/// è¿™é‡Œæˆ‘ä»¬é€‰æ‹©13ï¼Œç„¶åå›è½¦, è¿™é‡Œå”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯è¿™ä¸ªAppID,å¿…é¡»è¦å¡«å†™çˆ±å¥‡è‰ºçš„AppID, å…¶ä»–çš„å¯ä»¥éšä¾¿å¡«å†™ã€æˆ–è€…ç›´æ¥å›è½¦Choose a Template (required): 13Project Name (required): ghiqyTestPackage Name [com.yourcompany.ghiqytest]: com.ghcoder.ghiqyTestAuthor/Maintainer Name [é¾šæ¬¢]:[iphone/tweak] MobileSubstrate Bundle filter [com.apple.springboard]: com.qiyi.iphone[iphone/tweak] List of applications to terminate upon installation (space-separated, '-' for none) [SpringBoard]:Instantiating iphone/tweak in ghiqytest/...Done./*------4-------*/// åˆ›å»ºå®Œæˆä¹‹åï¼Œä¼šå‘ç°è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªåå«ghiqytestçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜åœ¨å››ä¸ªæ–‡ä»¶ï¼Œä¾æ¬¡æ˜¯:control(ç›¸å…³çš„é…ç½®ä¿¡æ¯)ã€ghiqyTest.plist(ä½ éœ€è¦ä¿®æ”¹çš„åº”ç”¨çš„AppID)ã€Makefile(é…ç½®æ–‡ä»¶)ã€Tweak.xm(éœ€è¦ä¿®æ”¹çš„ç›¸å…³ç±»)// ä¸‹é¢æ˜¯æˆ‘å¯¹Tweak.xmä¿®æ”¹çš„å†…å®¹å¦‚ä¸‹ï¼š%hook QYStartADView- (id)initWithType:(int)arg1 withURL:(id)arg2 withDur:(long long)arg3 withAdData:(id)arg4 withADCupid:(id)arg5 &#123; return nil;&#125;%end/*------5-------*/// sshåˆ°è¶Šç‹±æ‰‹æœºï¼Œå¹¶ä¸”è¦åœ¨Makefileçš„å¼€å¤´åŠ ä¸Šä¸‹é¢ä¸¤è¡Œé…ç½®export THEOS_DEVICE_IP=127.0.0.1export THEOS_DEVICE_PORT=10010/*------6-------*/// å¦‚æœä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œæ‰§è¡Œå®Œæˆä¹‹åï¼Œè¶Šç‹±æœºå™¨å°±ä¼šè‡ªåŠ¨é‡å¯äº†make clean &amp;&amp; make package &amp;&amp; make install 2. å°†è¿™ä¸ªä¿®æ”¹è¿‡çš„Appé‡ç­¾å æ­¥éª¤1. è¦å®Œæˆè¿™ä¸ªé‡ç­¾åï¼Œæˆ‘ä»¬éœ€è¦æœ‰å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ æˆ‘ä»¬åˆšæ‰ç¼–å†™çš„xxx.xmæ–‡ä»¶ï¼Œå…¶å®åˆšæ‰åœ¨æˆ‘ä»¬é‡å¯ä¹‹åï¼Œå®ƒå°±ç”Ÿæˆä¸€ä¸ªåŠ¨æ€åº“æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å­˜æ”¾åœ¨è¶Šç‹±æœºçš„å¦‚ä¸‹è·¯å¾„ä¸­ï¼š(Device-&gt;Library-&gt;MobileSubstrate-&gt;DynamicLibraries-&gt;ghiqyTest.dylib). åœ¨è¶Šç‹±æœºå™¨ä¸­åŠ è½½è¿™ä¸ªåŠ¨æ€åº“çš„Frameworkï¼ˆCydiaSubstrate) [è·¯å¾„å¦‚ä¸‹Device-&gt;Library-&gt;Frameworks-&gt;CydiaSubstrate.framework-&gt;CydiaSubstrate] å·²ç»è„±å£³äº†çš„App xxx.mobileprovisionæ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯éœ€è¦ä¸€å¹´99ç¾é‡‘æ‰å¯ä»¥ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªç©ºçš„Xcodeé¡¹ç›®ï¼Œç¼–è¯‘ä¹‹ååœ¨Targetçš„Appä¸­æ‰¾åˆ°è¿™ä¸ªxxx.mobileprovisionæ–‡ä»¶ï¼ˆæˆ–è€…å¯ä»¥å»apple.developer.comåå°å»ä¸‹è½½ï¼‰ æ­¥éª¤2. ç„¶åå°†ä¸Šé¢æåˆ°ä¸‰ä¸ªæ–‡ä»¶ghiqyTest.dylibã€CydiaSubstrateã€xxx.mobileprovisionä¸€èµ·æ‹·è´åˆ°å·²ç»è„±å£³äº†çš„Appä¸­ã€‚ æ­¥éª¤3. åœ¨è„±å£³äº†çš„Appä¸­æ‰¾åˆ°info.plistæ–‡ä»¶ï¼ŒæŠŠé‡Œé¢çš„UISupportedDevicesè¿™ä¸€æ ç»Ÿä¸€åˆ é™¤æ‰ã€‚ æ­¥éª¤4. æ­¤æ—¶æˆ‘ä»¬éœ€è¦æŸ¥çœ‹ä¸€äº›åŠ¨æ€åº“ï¼Œä»¥åŠæˆ‘ä»¬çš„Mach-Oæ–‡ä»¶ä¾èµ–çš„åº“æ˜¯å¦é…ç½®æ­£ç¡®: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100/*------1-------*/// æŸ¥çœ‹çˆ±å¥‡è‰ºMach-Oä¾èµ–çš„åŠ¨æ€åº“otool -L iQiYiPhoneVideo// ç»ˆç«¯æ˜¾ç¤º /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 400.9.4) /usr/lib/libresolv.9.dylib (compatibility version 1.0.0, current version 1.0.0) /usr/lib/libsqlite3.dylib (compatibility version 9.0.0, current version 274.20.0) /usr/lib/libxml2.2.dylib (compatibility version 10.0.0, current version 10.9.0) /usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.11) /System/Library/Frameworks/AVFoundation.framework/AVFoundation (compatibility version 1.0.0, current version 2.0.0) /System/Library/Frameworks/Accelerate.framework/Accelerate (compatibility version 1.0.0, current version 4.0.0) /System/Library/Frameworks/AdSupport.framework/AdSupport (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/AssetsLibrary.framework/AssetsLibrary (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/CFNetwork.framework/CFNetwork (compatibility version 1.0.0, current version 974.2.1) /System/Library/Frameworks/CoreFoundation.framework/CoreFoundation (compatibility version 150.0.0, current version 1556.0.0) /System/Library/Frameworks/CoreGraphics.framework/CoreGraphics (compatibility version 64.0.0, current version 1245.8.0) /System/Library/Frameworks/CoreLocation.framework/CoreLocation (compatibility version 1.0.0, current version 2245.4.104) /System/Library/Frameworks/CoreMotion.framework/CoreMotion (compatibility version 1.0.0, current version 2245.4.104) /System/Library/Frameworks/CoreTelephony.framework/CoreTelephony (compatibility version 1.0.0, current version 0.0.0) /System/Library/Frameworks/Foundation.framework/Foundation (compatibility version 300.0.0, current version 1556.0.0) /System/Library/Frameworks/ImageIO.framework/ImageIO (compatibility version 1.0.0, current version 0.0.0) /System/Library/Frameworks/MapKit.framework/MapKit (compatibility version 1.0.0, current version 14.0.0) /System/Library/Frameworks/MobileCoreServices.framework/MobileCoreServices (compatibility version 1.0.0, current version 932.2.0) /System/Library/Frameworks/OpenAL.framework/OpenAL (compatibility version 1.0.0, current version 1.0.0) @rpath/QYUniversalFramework.framework/QYUniversalFramework (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/QuartzCore.framework/QuartzCore (compatibility version 1.2.0, current version 1.11.0) /System/Library/Frameworks/SceneKit.framework/SceneKit (compatibility version 1.0.0, current version 470.0.0) /System/Library/Frameworks/Security.framework/Security (compatibility version 1.0.0, current version 58286.202.3) /System/Library/Frameworks/StoreKit.framework/StoreKit (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/SystemConfiguration.framework/SystemConfiguration (compatibility version 1.0.0, current version 963.200.27) /System/Library/Frameworks/UIKit.framework/UIKit (compatibility version 1.0.0, current version 61000.0.0) /System/Library/Frameworks/WebKit.framework/WebKit (compatibility version 1.0.0, current version 606.1.36) /System/Library/Frameworks/Intents.framework/Intents (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/IntentsUI.framework/IntentsUI (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/ReplayKit.framework/ReplayKit (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/UserNotifications.framework/UserNotifications (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/Speech.framework/Speech (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/CoreData.framework/CoreData (compatibility version 1.0.0, current version 865.0.0) /System/Library/Frameworks/EventKit.framework/EventKit (compatibility version 1.0.0, current version 100.0.0) /System/Library/Frameworks/WatchConnectivity.framework/WatchConnectivity (compatibility version 1.0.0, current version 175.0.0) /System/Library/Frameworks/PassKit.framework/PassKit (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/GLKit.framework/GLKit (compatibility version 1.0.0, current version 103.2.0) /System/Library/Frameworks/Photos.framework/Photos (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/CoreSpotlight.framework/CoreSpotlight (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/LocalAuthentication.framework/LocalAuthentication (compatibility version 1.0.0, current version 425.202.1) /System/Library/Frameworks/VideoToolbox.framework/VideoToolbox (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/AVKit.framework/AVKit (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/MessageUI.framework/MessageUI (compatibility version 1.0.0, current version 3445.100.35) /usr/lib/libiconv.2.dylib (compatibility version 7.0.0, current version 7.0.0) /System/Library/Frameworks/CoreText.framework/CoreText (compatibility version 1.0.0, current version 1.0.0) /usr/lib/libbz2.1.0.dylib (compatibility version 1.0.0, current version 1.0.5) /System/Library/Frameworks/CoreMedia.framework/CoreMedia (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/MediaPlayer.framework/MediaPlayer (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/AudioToolbox.framework/AudioToolbox (compatibility version 1.0.0, current version 492.0.0) /usr/lib/libicucore.A.dylib (compatibility version 1.0.0, current version 62.1.0) /usr/lib/libobjc.A.dylib (compatibility version 1.0.0, current version 228.0.0) /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1252.200.5) /System/Library/Frameworks/CoreImage.framework/CoreImage (compatibility version 1.0.0, current version 5.0.0) /System/Library/Frameworks/CoreML.framework/CoreML (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/CoreVideo.framework/CoreVideo (compatibility version 1.2.0, current version 1.5.0) /System/Library/Frameworks/JavaScriptCore.framework/JavaScriptCore (compatibility version 1.0.0, current version 606.1.36) /System/Library/Frameworks/OpenGLES.framework/OpenGLES (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/SpriteKit.framework/SpriteKit (compatibility version 1.0.0, current version 2.0.0) /*------2-------*/// éœ€è¦æŠŠæˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„åŠ¨æ€åº“é“¾æ¥è¿›æ¥ï¼Œæ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤insert_dylib @executable_path/ghiqyTest.dylib iQiYiPhoneVideo iQiYiPhoneVideo --all-yes/*------3-------*/// å†æ¬¡æ‰§è¡Œç¬¬ä¸€æ­¥çš„å‘½ä»¤ï¼Œä¼šå‘ç°æœ€ä¸‹å¤šäº†ä¸€è¡Œï¼Œå°±ä»£è¡¨é“¾æ¥æˆåŠŸ@executable_path/ghiqyTest.dylib (compatibility version 0.0.0, current version 0.0.0)/*------4-------*/// æ­¤æ—¶æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ghiqyTest.dylib, è¿™ä¸ªåŠ¨æ€åº“æœ‰æ²¡æœ‰ä¾èµ–çš„å…¶ä»–åŠ¨æ€åº“otool -L ghiqyTest.dylib// ç»ˆç«¯æ˜¾ç¤ºghiqyTest.dylib (architecture arm64): /Library/MobileSubstrate/DynamicLibraries/ghiqyTest.dylib (compatibility version 0.0.0, current version 0.0.0) /usr/lib/libobjc.A.dylib (compatibility version 1.0.0, current version 228.0.0) /System/Library/Frameworks/Foundation.framework/Foundation (compatibility version 300.0.0, current version 1560.10.0) /System/Library/Frameworks/CoreFoundation.framework/CoreFoundation (compatibility version 150.0.0, current version 1560.10.0) /Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate (compatibility version 0.0.0, current version 0.0.0) /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 400.9.4) /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1252.200.5) /*------5-------*/// è¿™é‡Œéœ€è¦ä¿®æ”¹/Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrateè·¯å¾„ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥ä¿®æ”¹äº†install_name_tool -change /Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate @loader_path/CydiaSubstrate ghiqyTest.dylib// å†æ¬¡æ‰§è¡Œç¬¬å››éƒ¨ï¼šå°±ä¼šå‘ç°ä¹‹å‰è·¯å¾„ä¿®æ”¹äº†ghiqyTest.dylib (architecture arm64): /Library/MobileSubstrate/DynamicLibraries/ghiqyTest.dylib (compatibility version 0.0.0, current version 0.0.0) /usr/lib/libobjc.A.dylib (compatibility version 1.0.0, current version 228.0.0) /System/Library/Frameworks/Foundation.framework/Foundation (compatibility version 300.0.0, current version 1560.10.0) /System/Library/Frameworks/CoreFoundation.framework/CoreFoundation (compatibility version 150.0.0, current version 1560.10.0) @loader_path/CydiaSubstrate (compatibility version 0.0.0, current version 0.0.0) /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 400.9.4) /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1252.200.5) æ­¥éª¤5. æˆ‘ä»¬è¦å…ˆæ‰¾åˆ°æˆ‘ä»¬ç­¾åè¯ä¹¦çš„Identity,é€šè¿‡å¦‚ä¸‹çš„å‘½ä»¤å¯ä»¥æ‰¾åˆ° 123456security find-identity -v -p codesigning// ç»ˆç«¯æ˜¾ç¤º1) E797391C5ABBC9FB40EE04252C5679A6FEC1B351 "iPhone Developer: ******"2) EF3725BCB7AB3C3F12AFC9C3A82C16B84A2925EC "iPhone Developer: *******" (CSSMERR_TP_CERT_REVOKED) 2 valid identities found æ­¥éª¤6. å¼€å§‹ç­¾åï¼š 1234âœ iQiYiPhoneVideo.app codesign -fs E797391C5ABBC9FB40EE04252C5679A6FEC1B351 ghiqyTest.dylibghiqyTest.dylib: replacing existing signatureâœ iQiYiPhoneVideo.app codesign -fs E797391C5ABBC9FB40EE04252C5679A6FEC1B351 CydiaSubstrateCydiaSubstrate: replacing existing signature æ­¥éª¤7. æœ€åæˆ‘ä»¬å¯¹Appæ•´ä½“ç­¾åï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–¹ä¾¿å·¥å…·iOSAppSinger æ­¥éª¤7.1 ä¹Ÿå¯ä»¥é€šè¿‡codesignï¼Œæ¥å®Œæˆå¯¹Appçš„æ•´ä½“ç­¾å: 1234567891011/*------1-------*/// å…ˆä»xxx.mobileprovisionå¯¼å‡ºxxx.entitlementssecurity cms -D -i embedded.mobileprovision &gt; temp.plist/usr/libexec/PlistBuddy -x -c 'Print:Entitlements' temp.plist &gt; entitlements.plist/*------2-------*/// ç”Ÿæˆå®Œæˆä¹‹åçš„entitlements.plistï¼Œé…åˆcodeSignè¿›è¡Œé‡ç­¾åcodesign -fs E797391C5ABBC9FB40EE04252C5679A6FEC1B351 --entitlements entitlements.plist xxx.app/*------3-------*/// ç”Ÿæˆä¹‹åçš„xxx.app,æ”¾åˆ°Payloadçš„æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åè¿›è¡Œå‹ç¼©ï¼Œç„¶åå†ä¿®æ”¹åç¼€åä¸º.ipa 3. å®‰è£…åœ¨æœªè¶Šç‹±æ‰‹æœºä¸Š ç›´æ¥é€šè¿‡iFunboxå®‰è£…åœ¨éè¶Šç‹±æœºå™¨ä¸Šã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Object-Cã€åŠ å¯†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Swiftè¯­æ³•å¤‡å¿˜å½•]]></title>
    <url>%2F2018%2F11%2F03%2F20181103%2F</url>
    <content type="text"><![CDATA[for(xx;xx;xx) åœ¨swiftä¸­çš„å†™æ³•ï¼š-&gt; stride(from:to:by:) ä»èµ·å§‹ä½ç½®å¼€å§‹ï¼Œæ¯æ¬¡å¢åŠ æˆ–è€…å‡å°‘ç¡®å®šçš„æ•°é‡ï¼Œåˆ°ç»ˆç‚¹ä¸ºæ­¢ï¼ˆä¸åŒ…å«ç»ˆç‚¹ä¸ºæ­¢ï¼‰ Returns a sequence from a starting value to, but not including, an end value, stepping by the specified amount. 12345678910111213141516for index in stride(from: 10, to: 1, by: -1) &#123; print("index:\(index)")&#125;&lt;!-- more --&gt;// ç»ˆç«¯æ‰“å°index:10index:9index:8index:7index:6index:5index:4index:3index:2 å°†ä¸€ä¸ªStringç”¨ä¸€ä¸ªCharacter/Stringåˆ†éš”ï¼š1let stringArray = string.components(separatedBy: "xx") æ‰¾åˆ°æŸä¸ªsubStringï¼Œå¹¶ä¸”removeæ‰(ps: è¿™é‡Œåªèƒ½æ‰¾åˆ°ä¸€å¤„å¹¶ä¸”åˆ é™¤æ‰)ï¼š1234var conetent = "Hello World"let range = conetent.range(of: " ")!let index = conetent.distance(from: conetent.startIndex, to: range.lowerBound)conetent = String(conetent[..&lt;conetent.index(conetent.startIndex, offsetBy: index)]) + String(conetent[conetent.index(conetent.startIndex, offsetBy: index+1)..&lt;conetent.endIndex]) æ›¿æ¢æŸä¸ªå­—ç¬¦12let conetent = "Hello World"let newContent = conetent.replacingOccurrences(of: " ", with: "&amp;")]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¯æ—¥ä¸€åˆ·LeetCodeç®—æ³•]]></title>
    <url>%2F2018%2F02%2F23%2F20180223%2F</url>
    <content type="text"><![CDATA[è¿™é“é¢˜æ˜¯LeetCodeä¸Šçš„ç¬¬2é¢˜ï¼Œéš¾åº¦ä¸ºMideaçš„ä¸€åˆ°é¢˜ç›®ï¼Œè¿™æ˜¯ä¸€é“å…³äºé“¾è¡¨çš„é¢˜ç›®ï¼ŒåŸé¢˜å¦‚ä¸‹ï¼š You are given two non-empty linked lists representing two non-negative integers. The digits are stored in reverse order and each of their nodes contain a single digit. Add the two numbers and return it as a linked list.You may assume the two numbers do not contain any leading zero, except the number 0 itself. 12345//ExampleInput: (2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)Output: 7 -&gt; 0 -&gt; 8Explanation: 342 + 465 = 807. çœ‹åˆ°è¿™é“é¢˜ç›®æˆ‘ä¸»è¦çš„æƒ³æ³•å°±æ˜¯åˆ©ç”¨é€’å½’å¾ªç¯å»éå†é“¾è¡¨ï¼Œå¹¶ä¸”å°†æ•°å€¼ç›¸åŠ èµ·æ¥ï¼Œå¦‚æœè¶…å¤šæ•°å€¼9ï¼Œç›¸åº”ä½ç½®ä¸Šçš„æ•°å€¼å‡10ï¼Œå¹¶ä¸”è¿›ä¸€ä½ å¾ªç¯çš„éå†æ¡ä»¶æ˜¯Inputä¸­ä¸¤ä¸ªNodeListåªè¦æœ‰ä¸€ä¸ªå­˜åœ¨å€¼ï¼Œå°±ä¼šç»§ç»­é€’å½’ã€‚ å¦‚ä½•åˆ›å»ºé“¾è¡¨ è¿™ä¸ªé—®é¢˜æˆ‘æƒ³äº†ä¸€ä¼šï¼Œæœ€å¥½çš„åˆ›å»ºæ–¹å¼ï¼Œå°±æ˜¯å…¥å‚å°±æ˜¯å°±æ˜¯ä¸€ä¸ªArrayçš„æ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿè¿”å›ä¸€ä¸ªListNode?å€¼ï¼Œå‡½æ•°å¦‚ä¸‹ï¼š 1234567891011121314func createList(_ values: [Int]) -&gt; ListNode? &#123; var head: ListNode? = nil var trail: ListNode? = nil values.forEach &#123; (value) in let node = ListNode(value) if head == nil &#123; head = node &#125; else &#123; trail!.next = node &#125; trail = node &#125; return head&#125; å¦‚ä½•é€’å½’ï¼š è¿™é‡Œå¼€å§‹ç¬¬ä¸€æ¬¡æäº¤çš„æ—¶å€™ï¼Œé”™è¯¯äº†ï¼Œå°±æ˜¯å…¥å‚åœ¨[5][5]çš„æ—¶å€™ï¼Œæˆ‘çš„è¿”å›å€¼æ˜¯[0],ä½†æ˜¯åº”è¯¥æ˜¯[0,1],æ˜¯å› ä¸ºæˆ‘çš„å¾ªç¯æ¡ä»¶å¿½ç•¥äº†resultNodeå€¼çš„åˆ¤æ–­ã€‚ 12345678910111213141516171819202122232425262728293031323334func addTwoNumbers(_ l1: ListNode?, _ l2: ListNode?) -&gt; ListNode? &#123; var n1 = l1 var n2 = l2 var resultNode: ListNode? var arr: [Int] = [] while n1?.val != nil || n2?.val != nil || resultNode?.val != nil &#123; var temp1: Int = 0 var temp2: Int = 0 if let v1 = n1?.val &#123; temp1 = v1 &#125; if let v2 = n2?.val &#123; temp2 = v2 &#125; var last: Int = temp1 + temp2 if let resultNode = resultNode &#123; last += resultNode.val &#125; if (last &gt; 9) &#123; resultNode = ListNode(last - 10) resultNode?.next = ListNode(1) &#125; else &#123; resultNode = ListNode(last) &#125; arr.append(resultNode!.val) n1 = n1?.next n2 = n2?.next resultNode = resultNode?.next &#125; return createList(arr)&#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swiftã€Algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è‡ªå®šä¹‰åˆ›å»ºUIViewController Transitionçš„åŠ¨ç”»æ•ˆæœ]]></title>
    <url>%2F2017%2F12%2F20%2F20171221%2F</url>
    <content type="text"><![CDATA[è¿™ç¯‡æ–‡ç« ç¿»è¯‘è‡ªraywenderlichä¸Šçš„æœ€æ–°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸé“¾æ¥è¿™é‡Œ[https://www.raywenderlich.com/167198/make-uiviewcontroller-transition-animation-like-ping-app] ä½œè€…çš„ç›®æ ‡å°±æ˜¯å¼€å‘ä¸€ä¸ªè¿™æ ·çš„åˆ‡æ¢æ ·å¼ï¼Œä¸»è¦æ˜¯å®ç°çš„æ˜¯ä¸»é¡µé¢ä¸ menué¡µé¢åˆ‡æ¢ã€‚ è¿™ä¸ªæ•™ç¨‹ä¸­ä¸»è¦æ˜¯ç”¨UIViewController transition animationæ¥å®Œæˆè¿™ä¸ªåŠ¨ç”»æ•ˆæœï¼Œåœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ä½ ä¼šå­¦åˆ°ä¸‹é¢çš„çŸ¥è¯†ç‚¹ï¼š shape layer masking UIViewControllerAnimatedTransitioning protocol UIPercentDrivenInteractiveTransition class â€¦ åˆå§‹é¡¹ç›® é¡¹ç›®çš„èµ·å§‹ä»£ç åœ¨è¿™é‡Œ[https://www.raywenderlich.com/170144/custom-uiviewcontroller-transitions-getting-started] å¼€å§‹1.æƒ…å†µä»‹ç» é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“æˆ‘ä»¬è¦åšçš„è¿™ä¸ªåŠ¨ç”»æ•ˆæœä¸»è¦æ˜¯ç”¨åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š ä»ä¸€ä¸ªVCåˆ‡æ¢åˆ°å…¶ä»–çš„VCæ—¶å€™æ‰€å‘ç”Ÿçš„åŠ¨ç”»[è¿™é‡Œçš„VCæŒ‡çš„å°±æ˜¯ViewController]ã€‚ åœ¨iOSä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ä¸€ç³»åˆ—çš„VCç»Ÿä¸€éƒ½æ”¾å…¥åˆ°ä¸€ä¸ªUINavigationControllerä¸­ï¼Œé€šè¿‡éµå¾ªUIViewControllerAnimatedTransitioningçš„ä»£ç†æ¥å®ç°è‡ªå®šä¹‰çš„åŠ¨ç”»ã€‚ å…¶å®è¿™é‡Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ UIView/UIKit Dynamics æˆ–è€…æ˜¯ä¸€äº›æ›´åº•å±‚Core Animation APIæ¥å®ç°ä¸Šè¿°çš„åŠ¨ç”»æ•ˆæœï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸»è¦ä½¿ç”¨çš„æ˜¯UIViewå’ŒCore Animation APISæ¥å®ç°è¿™äº›æ•ˆæœã€‚ 2.è¡¨è±¡ è¿™é‡Œçš„åŠ¨ç”»æ˜¯ä»å³ä¸Šè§’å¼€å§‹ï¼Œæ…¢æ…¢æ‰©å¤§ï¼Œç›´åˆ°æ•´ä¸ªç•Œé¢å®Œæ•´å‡ºç°ã€‚ æ¶ˆå¤±VCä¸Šçš„æ–‡å­—æ˜¯ä»å·¦è¾¹æ¶ˆå¤±çš„ã€‚ å‡ºç°çš„VCä¸Šçš„æ–‡å­—æ˜¯ä»å³è¾¹æ˜¾ç¤ºå‡ºæ¥ 3.å¼€å§‹æ è¿è¡Œå¼€å§‹çš„ä»£ç ï¼Œå°±ä¼šå‘ç°ï¼Œç°åœ¨æ˜¯æœ€ç®€å•çš„æ ·å¼ï¼Œä¸¤ä¸ªVCé€šè¿‡UINavigationControlleræ¥pushå’Œpopã€‚ åœ¨UINavigationControllerçš„å®ä¾‹å˜é‡æœ‰ä¸€ä¸ªUINavigationControllerDelegateçš„åè®®ï¼Œè¿™ä¸ªåè®®æœ‰å››ä¸ªæ–¹æ³•ï¼Œèƒ½å¤Ÿç¡®å®šVCä»¥åŠVCçš„æ»‘åŠ¨æ–¹å‘ã€‚ æ–°å»ºä¸€ä¸ªTransitionCoordinatorç±»çš„æ–‡ä»¶ï¼Œç»§æ‰¿è‡ªNSObject,å¹¶ä¸”éµå¾ªUINavigationControllerDelegateçš„åè®®ï¼š 1class TransitionCoordinator: NSObject, UINavigationControllerDelegate &#123;&#125; ç„¶åç»™è¿™ä¸ªç±»é‡Œé¢æ·»åŠ ä¸€ä¸ªåè®®æ–¹æ³•ï¼Œæ–¹æ³•åå¦‚ä¸‹, ç›®å‰å…ˆè¿”å›nilï¼Œåé¢ä¼šæ¥è¡¥å……è¿›å»ï¼š è¿™ä¸ªæ–¹æ³•ä¸»è¦ç¡®å®šäº†è¿›å…¥çš„VC/ç¦»å¼€çš„VC,å¹¶ä¸”è¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªanimationçš„å¯¹è±¡ã€‚ å½“navigationControlleræƒ³è¦çŸ¥é“è¿™ä¸ªanimationçš„å¯¹è±¡çš„æ—¶å€™ï¼Œè€Œè¿™é‡Œä½ å´è¿”å›äº†ä¸€ä¸ªnilçš„å¯¹è±¡ï¼Œè¿™æ ·çš„è¯ï¼Œç³»ç»Ÿå°±ä¼šç”¨é»˜è®¤çš„pushã€popçš„åŠ¨ç”»æ•ˆæœã€‚ 123456func navigationController(_ navigationController: UINavigationController, animationControllerFor operation: UINavigationControllerOperation, from fromVC: UIViewController, to toVC: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? &#123;return nil&#125; â€“ è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸ºUINavigationControllerçš„ä»£ç†æŒ‡å®šä¸€ä¸‹ï¼Œå›åˆ°Appdelegateçš„æ–‡ä»¶é‡Œé¢ï¼š 123456// åœ¨æ–‡ä»¶çš„Appdelegate.swiftçš„æ–‡ä»¶å¤´ä¸Šå£°æ˜ä¸€ä¸ªå˜é‡let transitionCoordinator = TransitionCoordinator()// å¹¶ä¸”åœ¨didFinishLaunch...nav.isNavigationBarHidden = truenav.delegate = transitionCoordinator åœ¨TransitionCoordinatorè¿™ä¸ªç±»é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›çš„æ˜¯ä¸€ä¸ªéµå¾ªUIViewControllerAnimatedTransitioningåè®®çš„å¯¹è±¡ã€‚éµå¾ªè¿™ä¸ªåè®®ä¹Ÿæ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…ã€‚éµå¾ªè¿™ä¸ªåè®®éœ€è¦ç¡®å®šä¸¤ä¸ªå‡½æ•°ï¼š ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ï¼šè¿”å›äº†åŠ¨ç”»éœ€è¦æ‰§è¡Œçš„æ—¶é—´ã€‚ ç¬¬äºŒä¸ªå‡½æ•°æ˜¯ï¼šè¿™ä¸ªå‡½æ•°é‡Œé¢å…¥å‚æ˜¯ä¸€ä¸ªcontextçš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†åœ¨æ‰§è¡Œè¿™ä¸ªåŠ¨ç”»æ—¶å€™éœ€è¦çš„ä¿¡æ¯ã€‚ â€“ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åå­—ä¸ºCircularTransition,ç»§æ‰¿è‡ªNSObjectï¼ŒåŒäº‹è¿˜éœ€è¦ç»§æ‰¿UIViewControllerAnimatedTransitioningåè®®çš„å¯¹è±¡ï¼Œå®ç°ä¸‹é¢çš„ä¸¤ä¸ªæ–¹æ³•ï¼š 12345678910func transitionDuration(using transitionContext: UIViewControllerContextTransitioning?) -&gt; TimeInterval &#123; return 0.5&#125;// è¿™é‡Œå…ˆç©ºç€ï¼Œåé¢ä¼šé‡ç‚¹æ¥å†™è¿™é‡Œçš„ä»£ç func animateTransition(using transitionContext: UIViewControllerContextTransitioning) &#123; //make some magic happen &#125; å¹¶ä¸”å°†ä¹‹å‰çš„TransitionCoordinator.swiftæ–‡ä»¶é‡Œé¢è¿”å›nilçš„ä¿®æ”¹ä¸ºï¼š 1return CircularTransition() è¿™æ ·ä½ å°±å·²ç»å®Œæˆäº†ä¸€ä»¶äº‹æƒ…ï¼Œå‘Šè¯‰UINavigationController,ç°åœ¨æ‰€æœ‰VCä¹‹å‰çš„åˆ‡æ¢éƒ½éœ€è¦å»è¯¢é—®UIViewControllerAnimatedTransitioning object,è¿™é‡Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ–°å»ºçš„é‚£ä¸ªå¯¹è±¡CircularTransition é¦–å…ˆåœ¨CircularTransition.swiftçš„å¼€å¤´ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªåè®®ï¼Œåè®®å¦‚ä¸‹ï¼š 12345protocol CircleTransitionable &#123; var triggerButton: UIButton &#123; get &#125; var contentTextView: UITextView &#123; get &#125; var mainView: UIView &#123; get &#125;&#125; é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªtriggerButton,è¿™å°†æ˜¯æˆ‘ä»¬VCä¸­éœ€è¦ç‚¹å‡»åˆ‡æ¢çš„æŒ‰é’®ã€‚ å®šä¹‰äº†ä¸€ä¸ªcontentTextViewæˆ‘ä»¬éœ€è¦åŠ¨ç”»ç§»å…¥ç§»é™¤çš„Viewã€‚ mainViewæ˜¯æ˜¾ç¤ºçš„ä¸»å†…å®¹ã€‚ ä¸‹é¢æˆ‘ä»¬åˆ‡æ¢åˆ°ColoredViewController.swift,è¿™ä¸ªColoredViewController.swiftæ˜¯BlackViewController WhiteViewControllerçš„çˆ¶ç±»,è®©è¿™ä¸ªVCçš„éµå¾ªè¿™ä¸ªåè®®ï¼Œå¹¶ä¸”è¿™ä¸ªVCé‡Œé¢å·²ç»å­˜åœ¨triggerButtonå’ŒcontentTextViewï¼Œåªéœ€è¦æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼š 123var mainView: UIView &#123; return view&#125; â€“ ä¸‹é¢çœŸæ­£å¼€å§‹åŠ¨æ‰‹å†™åŠ¨ç”»çš„ä»£ç ,åˆ‡æ¢åˆ°CircularTransition.swifté‡Œçš„animateTransition(transitionContext:)çš„å‡½æ•°ï¼Œæ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 123456guard let fromVC = transitionContext.viewController(forKey: .from) as? CircleTransitionable, let toVC = transitionContext.viewController(forKey: .to) as? CircleTransitionable, let snapshot = fromVC.mainView.snapshotView(afterScreenUpdates: false) else &#123; transitionContext.completeTransition(false) return&#125; è¿™é‡Œè¦ç¡®ä¿ä½ èƒ½è·å¾—æ‰€æœ‰çš„ä¸œè¥¿ï¼Œé€šè¿‡transitionContextçš„å¯¹è±¡ï¼Œå¯ä»¥è·å–åˆ°åˆ‡æ¢çš„viewcontrollers,å¹¶ä¸”å°†è¿™äº›vcä¿®é¥°ä¸ºCircleTransitionable,è¿™æ ·ä½ å°±å¯ä»¥è·å¾—main viewsä»¥åŠtext views. snapshotView(afterScreenUpdates:)èƒ½å¤Ÿç›´æ¥è¿”å›fromVCçš„æš‚å­˜äºŒè¿›åˆ¶ç…§ç‰‡ã€‚è¿™æ˜¯ä¸€ä¸ªè§†å›¾çš„å‰¯æœ¬æ‹·è´ã€‚ åœ¨elseçš„æƒ…å†µä¸‹ï¼Œä½ è°ƒç”¨äº†transitionContext.completeTransition(false),ä½ è¿™é‡Œä¼ é€’ç»™UIKitä¸€ä¸ªfalseå°±æ˜¯è¦å‘Šè¯‰ä½ æ²¡æœ‰å®ŒæˆåŠ¨ç”»ï¼Œä¹Ÿä¸åº”è¯¥åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªVC é€šè¿‡contextæ¥è·å–åˆ‡æ¢çš„å®¹å™¨è§†å›¾å†…å®¹ï¼šlet containerView = transitionContext.containerView,è¿™ä¸ªviewï¼Œå°±æ˜¯åœ¨VCåˆ‡æ¢ä¸­çš„ä¸»å†…å®¹è§†å›¾ã€‚[1. å½“ä½ åšåŠ¨ç”»çš„æ—¶å€™ï¼Œå…¶å®æ“ä½œçš„å°±æ˜¯è¿™ä¸ªcontainerViewå¯¹è±¡ã€‚2. ä»è¿™ä¸ªcontainerViewä¸­ç§»é™¤fromVC çš„view, 3. åœ¨containerViewä¸­æ·»åŠ toVCçš„view] â€“ ä¸ºäº†ç§»åŠ¨ä¹‹å‰é¡µé¢ï¼Œè€Œä¸ä¼šæ‰“ä¹±ä¹‹å‰çš„å¸ƒå±€ï¼Œè¿™è¿™é‡Œæˆ‘ä»¬å®é™…åŠ¨ç”»æ“ä½œçš„æ˜¯ä¹‹å‰é¡µé¢çš„å‰¯æœ¬åœ¨å‡½æ•°animateTransition(transitionContext:):çš„ç»“å°¾æ·»åŠ å¦‚ä¸‹çš„æ–¹æ³•ï¼š 1containerView.addSubview(snapshot) è€Œä½ çœŸæ­£éœ€è¦ç§»é™¤çš„å½“å‰çš„viewï¼Œéœ€è¦åœ¨ä¸‹é¢è°ƒç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼š 1fromVC.mainView.removeFromSuperview() â€“ åœ¨ä¸‹é¢æ·»åŠ å¦‚ä¸‹çš„æ–¹æ³•: 12345678910111213func animateOldTextOffscreen(fromView: UIView) &#123; // 1 UIView.animate(withDuration: 0.25, delay: 0.0, options: [.curveEaseIn], animations: &#123; // 2 fromView.center = CGPoint(x: fromView.center.x - 1300, y: fromView.center.y + 1500) // 3 fromView.transform = CGAffineTransform(scaleX: 5.0, y: 5.0) &#125;, completion: nil)&#125; å®šä¹‰äº†ä¸€ä¸ª0.25ç§’æ—¶é—´é—´éš”çš„åŠ¨ç”»ã€‚ ç§»åŠ¨viewçš„centerçš„åæ ‡ã€‚ å¹¶ä¸”å°†viewçš„å°ºå¯¸æ”¾å¤§5å€ã€‚ è¿™å°†ä¼šå¯¼è‡´textçš„è§†å›¾æ”¾å¤§ã€å¹¶ä¸”åŒæ—¶ç§»é™¤ç•Œé¢ã€‚ â€“ åœ¨animateTransition(transitionContext:):çš„åº•éƒ¨æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 1animateOldTextOffscreen(fromView: snapshot) â€“ æ­¤æ—¶è¿è¡Œä»£ç çš„æ—¶å€™ï¼Œä¼šå‘ç°å¯ä»¥æ­£å¸¸ç§»åŠ¨äº†ï¼Œä½†æ˜¯åœ¨ä»¥åçš„æ—¶å€™èƒŒæ™¯è‰²ä¸€ç›´æ˜¯ä¸ªé»‘è‰²èƒŒæ™¯ã€‚ è¿™ä¸ªé»‘è‰²çš„èƒŒæ™¯å…¶å®å°±æ˜¯containerViewçš„èƒŒæ™¯è‰²ï¼Œå…¶å®è¿™é‡Œä½œè€…æƒ³åŠ¨ç”»çš„ä¸œè¥¿æ˜¯æ–‡æœ¬ï¼Œè€Œä¸æ˜¯æ•´ä¸ªviewçš„åŠ¨ç”»ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„èƒŒæ™¯ï¼Œå¹¶ä¸”è¿™ä¸ªæ–°çš„èƒŒæ™¯æˆ‘ä»¬ä¸éœ€è¦æ·»åŠ åŠ¨ç”»ã€‚åˆ‡æ¢åˆ°CircularTransition.swifté‡Œçš„animateTransition(using:)ï¼Œåœ¨æ·»åŠ snapshotViewä½œä¸ºå­è§†å›¾ä¹‹å‰æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 1234let backgroundView = UIView()backgroundView.frame = toVC.mainView.framebackgroundView.backgroundColor = fromVC.mainView.backgroundColorcontainerView.addSubview(backgroundView) â€“ ä»¥æ­¤åœ¨ä¸‹é¢æ·»åŠ å¦‚ä¸‹çš„ä»£ç ,è¿™ä¸ªå‡½æ•°ä¸»è¦å®Œæˆåœ†çš„åŠ¨ç”»æ•ˆæœ: 123func animate(toView: UIView, fromTriggerButton triggerButton: UIButton) &#123; &#125; å¹¶ä¸”åœ¨animateTransition(using:)ä¸­ï¼Œåœ¨æ–¹æ³•animateOldTextOffscreen(fromView:snapshot):ä¹‹åæ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 12containerView.addSubview(toVC.mainView)animate(toView: toVC.mainView, fromTriggerButton: fromVC.triggerButton) â€“ è¿™é‡Œå…¶å®ä½ å·²ç»å¤§æ¦‚çš„äº†è§£äº†åŠ¨ç”»çš„å¤§ä½“æƒ³æ³•äº†ï¼Œä½†æ˜¯å…·ä½“è¿™ä¸ªåŠ¨ç”»ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç”¨åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯CAShapeLayer,CAShapeLayeræ˜¯CALayerçš„ä¸€ä¸ªç‰¹æ®Šç±»ï¼Œä»–ä¸ä»…ä»…æ€»æ˜¯å‘ˆç°æ­£æ–¹å½¢çš„å›¾å½¢ï¼Œè€Œæ˜¯å¯ä»¥é€šè¿‡å®šä¹‰è´èµ›å°”æ›²çº¿è·¯å¾„ï¼Œç„¶åå°†è·¯å¾„ä¸¢ç»™å›¾å±‚çš„è·¯å¾„ï¼Œå°±å¯ä»¥å®ç°è‡ªå®šä¹‰çš„å›¾æ¡ˆäº†ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸¤ç§ä¸åŒçš„è´èµ›å°”æ›²çº¿è·¯å¾„ã€‚ åœ¨å‡½æ•°animate(toView:triggerButton:):é‡Œé¢æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 1234567// 1let rect = CGRect(x: triggerButton.frame.origin.x, y: triggerButton.frame.origin.y, width: triggerButton.frame.width, height: triggerButton.frame.width)// 2let circleMaskPathInitial = UIBezierPath(ovalIn: rect) è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è´èµ›å°”æ›²çº¿ï¼Œåˆ›å»ºçš„æ˜¯ä¸€ä¸ªå°å°çš„åœ†ï¼Œèµ·å§‹çš„ä½ç½®ï¼Œèµ·å§‹å°±æ˜¯triggerButtonçš„åæ ‡ã€‚è¿™ä¹Ÿå°±æ˜¯èµ·å§‹åŠ¨ç”»çš„åœ†çš„çŠ¶æ€ã€‚ ä¸‹é¢åœ¨åˆ›å»ºç›¸åº”çš„åŠ¨ç”»ç»“æŸçŠ¶æ€ï¼Œç”±äºä½ çœ‹åˆ°åªæ˜¯ä¸€ä¸ªåœˆåœˆå†…çš„ä¸œè¥¿ï¼Œåœˆåœˆè¾¹ç¼˜ä»¥åŠå¤–éƒ¨çš„ä¸œè¥¿éƒ½æ˜¯çœ‹ä¸åˆ°çš„ï¼Œå› æ­¤æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 12345678910// 1let fullHeight = toView.bounds.heightlet extremePoint = CGPoint(x: triggerButton.center.x, y: triggerButton.center.y - fullHeight)// 2let radius = sqrt((extremePoint.x*extremePoint.x) + (extremePoint.y*extremePoint.y))// 3let circleMaskPathFinal = UIBezierPath(ovalIn: triggerButton.frame.insetBy(dx: -radius, dy: -radius)) é¦–å…ˆå®šä¹‰äº†ç•Œé¢çš„æ€»é«˜åº¦ã€‚ é€šè¿‡å‹¾è‚¡å®šç†æ¥è®¡ç®—åœ†çš„åŠå¾„ã€‚ ç„¶åå®šä¹‰å‡ºæ–°çš„è´èµ›å°”æ›²çº¿è·¯å¾„ã€‚è¿™é‡Œè¿˜ç”¨åˆ°ä¸€ä¸ªæ–°çš„apiå«åšinsetByï¼Œè¿™é‡Œçš„ä½œç”¨å°±æ˜¯è®¾ç½®è¾¹æ¡†çš„å¤§å°ï¼Œå½“è®¾ç½®çš„å€¼ä¸ºè´Ÿå€¼çš„æ—¶å€™ï¼ŒåŸæ¥çš„frameå€¼å°±ä¼šå˜å¤§ â€“ ç°åœ¨å·²ç»è·å¾—äº†èµ·å§‹ã€ç»ˆç‚¹çš„çŠ¶æ€çš„è´å¡å°”æ›²çº¿è·¯å¾„ï¼Œæ‰€ä»¥åœ¨å‡½æ•°animate(toView:triggerButton:)ä¸­æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 123let maskLayer = CAShapeLayer()maskLayer.path = circleMaskPathFinal.cgPathtoView.layer.mask = maskLayer è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªCAShapeLayerçš„å¯¹è±¡ï¼Œå¹¶ä¸”å°†å®ƒçš„pathçš„å±æ€§å€¼è®¾ç½®ä¸ºæˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„æœ€ç»ˆçŠ¶æ€çš„è´å¡å°”æ›²çº¿å€¼ï¼Œå¹¶ä¸”å°†è¿™ä¸ªmaskçš„å€¼èµ‹å€¼ç»™toView.layer.maskã€‚ â€“ CALayer Maskingæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿ å½“ä¸€ä¸ªviewçš„alphaä¸º1çš„æ—¶å€™ï¼Œå°†ä¼šæ˜¾ç¤ºmaskå›¾å±‚ä¸‹çš„ä¸œè¥¿ã€‚ è€Œå½“alphaä¸º0çš„æ—¶å€™ï¼Œå°±ä¼šéšè—maskä¸‹é¢çš„ä¸œè¥¿ï¼Œè¿™ä¸ªå°±æ˜¯å›¾è¡¨è§£é‡Šï¼š â€“ åœ¨å‡½æ•°animate(toView:triggerButton:)é‡Œåˆ›å»ºäº†ä¸€ä¸ªCABasicAnimationçš„å¯¹è±¡,å¹¶ä¸”å‘Šè¯‰å®ƒanimationä¿®æ”¹pathçš„å±æ€§: 12345let maskLayerAnimation = CABasicAnimation(keyPath: "path")maskLayerAnimation.fromValue = circleMaskPathInitial.cgPathmaskLayerAnimation.toValue = circleMaskPathFinal.cgPathmaskLayerAnimation.duration = 0.15maskLayerAnimation.delegate = self ç„¶ååˆ°æ–‡ä»¶çš„æœ€åº•ä¸‹ï¼Œåˆ›å»ºå¦‚ä¸‹çš„ä»£ç ï¼š 12345extension CircularTransition: CAAnimationDelegate &#123; func animationDidStop(_ anim: CAAnimation, finished flag: Bool) &#123; &#125;&#125; å½“å›è°ƒåˆ°è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå°±ä»£è¡¨è¿™ä¸ªåŠ¨ç”»å·²ç»è¿è¡ŒæˆåŠŸï¼Œå¹¶ä¸”ç»“æŸäº†ã€‚åœ¨è¿™ä¸ªå›è°ƒä¸­ï¼Œä½ éœ€è¦ç»™è¿™ä¸ªcontextè°ƒç”¨completeTransition()çš„æ–¹æ³•,éœ€è¦åœ¨è¿™ä¸ªå›è°ƒçš„æ–¹æ³•ä¸­è·å¾—contextçš„å¯¹è±¡ï¼Œä½ éœ€è¦å°†è¿™ä¸ªå¯¹è±¡è®¾ç½®ä¸ºå…¨å±€çš„ï¼Œåœ¨CircularTransition`å¤´éƒ¨ï¼Œæ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 1weak var context: UIViewControllerContextTransitioning? å¹¶ä¸”åœ¨å‡½æ•°animateTransition(transitionContext:)ä¸­çš„guardä¹‹åæ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 1context = transitionContext æœ€åè¿˜éœ€è¦å°†è¿™ä¸ªåŠ¨ç”»æ•ˆæœæ·»åŠ è¿™ä¸ªLayerä¸Šï¼š 1maskLayer.add(maskLayerAnimation, forKey: "path") â€“ æ•ˆæœçš„å®Œå–„ åœ¨CircularTransitionç±»é‡Œæ·»åŠ å¦‚ä¸‹çš„æ–¹æ³•ï¼š 1234567891011func animateToTextView(toTextView: UIView, fromTriggerButton: UIButton) &#123; let originalCenter = toTextView.center toTextView.alpha = 0.0 toTextView.center = fromTriggerButton.center toTextView.transform = CGAffineTransform(scaleX: 0.1, y: 0.1) UIView.animate(withDuration: 0.25, delay: 0.1, options: [.curveEaseOut], animations: &#123; toTextView.transform = CGAffineTransform(scaleX: 1.0, y: 1.0) toTextView.center = originalCenter toTextView.alpha = 1.0 &#125;, completion: nil)&#125; æœ€åå†animateTransition(transitionContext:).æ–¹æ³•ä¸­æ·»åŠ å¦‚ä¸‹çš„æŒ‰é’®ï¼š 1animateToTextView(toTextView: toVC.contentTextView, fromTriggerButton: fromVC.triggerButton)]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swiftã€Animation</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºRxSwiftä¿¡æ¯é‡çš„ä¸€äº›é—®é¢˜(äºŒ)]]></title>
    <url>%2F2017%2F10%2F11%2F20171011%2F</url>
    <content type="text"><![CDATA[åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œå·²ç»ä»‹ç»äº†ä¸€äº›ï¼Œè¿‡æ»¤ã€ç­›é€‰ä¿¡å·é‡çš„æ“ä½œç¬¦ï¼Œç°åœ¨åˆ—ä¸¾ä¸€äº›å¤æ‚æ“ä½œç¬¦ã€‚ é¦–å…ˆè¦è¯´çš„ä¸€ä¸ªæ“ä½œç¬¦å«åšScanï¼Œçœ‹åˆ°åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼ŒScanæ˜¯å±äºåœ¨Transformingï¼Œä¹Ÿå°±å¯ä»¥çŒœåˆ°ï¼Œè¿™ä¸ªæ“ä½œç¬¦ï¼Œå…¶å®ä¹Ÿæ˜¯ä¿¡å·è½¬æ¢çš„éƒ¨åˆ†ã€‚ å…ˆçœ‹ä¸€ä¸‹å®˜æ–¹çš„ä»‹ç» The Scan operator applies a function to the first item emitted by the source Observable and then emits the result of that function as its own first emission. It also feeds the result of the function back into the function along with the second item emitted by the source Observable in order to generate its second emission. It continues to feed back its own subsequent emissions along with the subsequent emissions from the source Observable in order to create the rest of its sequence. åœ¨çœ‹ä¸€ä¸‹githubä¸Šä»£ç çš„ï¼š 1234567891011121314151617181920public func scan&lt;A&gt;(_ seed: A, accumulator: @escaping (A, E) throws -&gt; A) -&gt; Observable&lt;A&gt; &#123; return Scan(source: self.asObservable(), seed: seed, accumulator: accumulator)&#125;...final fileprivate class Scan&lt;Element, Accumulate&gt;: Producer&lt;Accumulate&gt; &#123;typealias Accumulator = (Accumulate, Element) throws -&gt; Accumulate fileprivate let _source: Observable&lt;Element&gt;fileprivate let _seed: Accumulatefileprivate let _accumulator: Accumulator init(source: Observable&lt;Element&gt;, seed: Accumulate, accumulator: @escaping Accumulator) &#123; _source = source _seed = seed _accumulator = accumulator&#125;&#125; è¿™å°±å¯ä»¥æ ¹æ®å®˜æ–¹çš„ä»‹ç»å¯ä»¥çŸ¥é“ï¼Œä»€ä¹ˆæ˜¯Scan Scanæ“ä½œç¬¦ï¼Œéœ€è¦æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå‚æ•°æ˜¯æ³›å‹A, ç¬¬äºŒä¸ªå‚æ•°æ˜¯blockï¼Œblockçš„å‚æ•°ç±»å‹ä»¥åŠè¿”å›å€¼çš„ç±»å‹æ˜¯(A, Element) -&gt; A. è¿™é‡Œçš„Elementï¼Œæ˜¯åœ¨ä¹Ÿä¸æ˜¯éšç¼–çš„æ³›å‹ï¼Œå¯ä»¥çœ‹æºç ä¸­çŸ¥é“ï¼ŒScanåœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå‡ºå…¥äº†ä¸‰ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯è®²è‡ªå·±è½¬åŒ–ä¸ºå¯è®¢é˜…çš„å¯¹è±¡self.asObservable(),åœ¨å…¥å‚ä¸­Observable&lt;Element&gt;,è¿™å°±è¯´æ˜äº†ï¼Œè¿™ä¸ªElementçš„ç±»å‹ï¼Œå’Œä½ èµ·åˆçš„è®¢é˜…çš„å¯¹è±¡çš„è®¢é˜…ç±»å‹æ˜¯åŒä¸€ä¸ªç±»å‹ã€‚ çœ‹ä¸€ä¸‹demoï¼š 1234567891011121314151617181920212223242526272829303132333435// è¿™é‡Œåªæ˜¯å°†å­—ç¬¦æ‰“å°å‡ºæ¥let bag = DisposeBag()let subject = PublishSubject&lt;String&gt;() _ = subject .subscribe(onNext: &#123;print($0)&#125;) .addDisposableTo(bag) subject.onNext("gong")subject.onNext("h")//ç»ˆç«¯è¾“å‡ºgongh---// è¿™é‡Œæ˜¯ç”¨æ¥è®¡ç®—æˆ‘è¾“å…¥å­—ç¬¦é•¿åº¦çš„ç´¯åŠ let bag = DisposeBag()let subject = PublishSubject&lt;String&gt;() _ = subject .scan(0) &#123;(count: Int, content: String) in return count + content.characters.count &#125; .subscribe(onNext: &#123;print($0)&#125;) .addDisposableTo(bag) subject.onNext("gong")subject.onNext("h")//ç»ˆç«¯è¾“å‡º45--- ä½ å¯ä»¥è¯•è¯•ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å°†Contentçš„ç±»å‹ä¿®æ”¹ä»»æ„ç±»å‹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šä¸è¡Œçš„ï¼Œä¹‹å‰åœ¨çœ‹æºç çš„æ—¶å€™ï¼Œæˆ‘å·²ç»è§£é‡Šè¿‡ä¸ºä»€ä¹ˆäº†ï¼Œè¿™é‡Œçš„contentçš„ç±»å‹å¿…é¡»è¦å’Œæˆ‘ä»¬åˆ¶å®šå®šä¹‰subjectçš„ç±»å‹ç›¸åŒã€‚ skpiWhileä¹‹å‰ä¸€ç›´æ²¡æœ‰ç»•æ¸…æ¥šï¼Œä»Šå¤©è¿˜æ˜¯æ‰“ç®—çœ‹ä¸€ä¸‹æºç ï¼Œè¿™åªæˆ‘å·²ç»è¯´äº†ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥ç­›é€‰ä¿¡å·çš„æ—¶å€™ç”¨çš„ï¼Œä¹‹å‰ä¸€ç›´ä¸æ¸…æ¥šä¸ºä»€ä¹ˆä¸ºtrueçš„æ—¶å€™ï¼Œå°±ä¼šè¿‡æ»¤ä¿¡å·å‘¢ï¼Ÿ æŸ¥çœ‹githubä¸Šä»£ç ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ï¼Œå…³é”®çš„ä»£ç ï¼š 123456789101112131415161718192021func on(_ event: Event&lt;Element&gt;) &#123; switch event &#123; case .next(let value): if !_running &#123; do &#123; _running = try !_parent._predicate(value) &#125; catch let e &#123; forwardOn(.error(e)) dispose() return &#125; &#125; if _running &#123; forwardOn(.next(value)) &#125; case .error, .completed: forwardOn(event) dispose() &#125;&#125; çœ‹åˆ°ä»£ç å°±çŸ¥é“ï¼Œé™¤éæ˜¯.onError()/onCompleted()äº‹ä»¶ï¼Œå…¶ä»–.onNext()çš„æ—¶é—´ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œï¼Œä½ ä¼ å…¥çš„block,çœ‹çœ‹ä½ çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœæ˜¯trueçš„è¯ï¼Œå°±ä¼šæ‰§è¡ŒforwardOn()çš„å‡½æ•°ï¼š 123456789101112131415final func forwardOn(_ event: Event&lt;O.E&gt;) &#123; #if DEBUG if AtomicIncrement(&amp;_numberOfConcurrentCalls) &gt; 1 &#123; rxFatalError("Warning: Recursive call or synchronization error!") &#125; defer &#123; _ = AtomicDecrement(&amp;_numberOfConcurrentCalls) &#125; #endif if _disposed &#123; return &#125; _observer.on(event)&#125; è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä»–è®²ä¸‹ä¸€ä¸ªå€¼æœ‰é€’å½’ä¼ åˆ°åŒä¸€ä¸ªå‡½æ•°ä¸­äº†ï¼Œè¿™æ ·å°±èµ·åˆ°äº†è¿‡æ»¤çš„æ•ˆæœã€‚ è¿˜æœ‰ä¸€äº›å…³äºä¿¡å·è½¬æ¢çš„é—®é¢˜ï¼Œå¦‚ä½•è½¬åŒ–ä¸ºæ•°ç»„ç±»å‹,è¿™é‡Œæˆ‘ç”¨åˆ°toArray(),Demo: è¿™ç§è½¬åŒ–æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå¹¶å½“ä½ ä¸‹æ¬¡å‘é€.onNext()çš„æ—¶å€™ï¼Œä»–æ˜¯ä¸ä¼šè½¬åŒ–ï¼Œä¹Ÿå°±ä¸ä¼šæ¥å—åˆ°.onNext()çš„å›è°ƒ. å¦‚æœåœ¨è°ƒç”¨.onNext()å€¼ä¹‹å‰ï¼Œä½ å·²ç»è½¬åŒ–ä¸ºArrayï¼Œåœ¨ä½ ä¸‹æ¬¡è½¬åŒ–çš„æ—¶å€™ï¼Œå°±æ— æ³•å†è½¬åŒ–äº†ã€‚ 1234567891011121314Observable.of(1,2,3,4) .toArray() .subscribe(onNext: &#123; dump(type(of: $0)) dump($0) &#125;) //ç»ˆç«¯è¾“å‡º- Swift.Array&lt;Swift.Int&gt; #0â–¿ 4 elements- 1- 2- 3- 4 æ“ä½œç¬¦mapçš„æ“ä½œï¼Œä¹Ÿæ˜¯æ¥å—ä¸€ä¸ªblockï¼Œè¿™é‡Œç›´æ¥ä¸Šä»£ç ï¼š 123456789func on(_ event: Event&lt;SourceType&gt;) &#123; switch event &#123; case .next(let element): do &#123; let mappedElement = try _transform(element) forwardOn(.next(mappedElement)) &#125; ....&#125; è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å‡ºå…¥çš„block å°±åƒä¸€ä¸ªåŠ å·¥å‚ä¸€æ ·ï¼Œä¼šå°†æ¥å—åˆ°çš„elementçš„å‚æ•°ï¼Œç»è¿‡æˆ‘ä»¬ä¼ å…¥çš„blockåŠ å·¥åï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„å€¼ï¼Œç„¶ååˆä¼šå›ä¼ ç»™è‡ªå·±ã€‚è¿™æ ·æ¯æ¬¡æ¥å—åˆ°çš„å°±æ˜¯æ–°å€¼äº†ã€‚ è€Œæ“ä½œç¬¦mapWithIndexä¼šå›ä¼ å›æ¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªvalueå€¼ï¼Œä¸€ä¸ªæ˜¯indexå€¼ï¼Œè¿™é‡Œåˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿçœ‹ä¸€ä¸‹æºä»£ç ï¼š 1234567891011121314151617181920212223242526....private var _index = 0...func on(_ event: Event&lt;SourceType&gt;) &#123; switch event &#123; case .next(let element): do &#123; let mappedElement = try _selector(element, try incrementChecked(&amp;_index)) forwardOn(.next(mappedElement)) &#125; ... func incrementChecked(_ i: inout Int) throws -&gt; Int &#123; if i == Int.max &#123; throw RxError.overflow &#125; defer &#123; i += 1 &#125; return i&#125; ... å¾ˆæ˜æ˜¾äº†ï¼Œindexåˆå§‹å€¼æ˜¯ä»0å¼€å§‹ï¼Œæ¯æ¬¡éƒ½ä¼šæ‹¿åˆ°æŒ‡é’ˆï¼Œè¿›è¡Œç´¯åŠ ï¼Œç„¶åå›ä¼ å›å»ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„indexäº†ã€‚ ä¸‹é¢ä¸€ä¸ªæ¯”è¾ƒéš¾ç†è§£çš„æ“ä½œç¬¦å«åšflatMap,çœ‹å®˜ç½‘ä¸Šçš„ä»‹ç»ä¸ºæ˜¯è¿™æ ·çš„ï¼š transform the items emitted by an Observable into Observables, then flatten the emissions from those into a single Observable è¿™å¥è¯å…¶å®éå¸¸ç»•ï¼Œå¯èƒ½ä¸ç†è§£çš„äººå¯èƒ½ä¸€ç›´è¯»ä¸æ‡‚ã€‚é¦–å…ˆç†è§£ç¬¬ä¸€å¥è¯ï¼Œtransform the items emitted by an Observable into Observables: æˆ‘çš„ç†è§£æ˜¯ï¼Œç”±ä¸€ä¸ªå¯è¢«è®¢é˜…çš„å¯¹è±¡å‘å‡ºçš„å¤šä¸ªå€¼ï¼Œé€šè¿‡æˆ‘ä»¬ä¼ å…¥çš„block,æ¥å˜æ¢ä¸ºå¤šä¸ªå¯è®¢é˜…çš„å¯¹è±¡ 12345678910111213141516171819202122232425let bag = DisposeBag()let subject = PublishSubject&lt;GHObject&gt;() _ = subject .flatMap&#123; $0.gh_value.asObservable() &#125; .subscribe(onNext: &#123; print(type(of: $0)) dump($0) &#125;).addDisposableTo(bag) let gh1 = GHObject(gh_value: Variable(10)) subject.onNext(gh1)gh1.gh_value.value = 11...struct GHObject &#123; var gh_value: Variable&lt;Int&gt;&#125;//ç»ˆç«¯è¾“å‡º- 10- 11 é‚£ç¬¬äºŒå¥è¯æ€ä¹ˆç†è§£å‘¢ï¼Ÿthen flatten the emissions from those into a single Observable,é€šè¿‡ä¸Šé¢çš„ä»£ç å·²ç»çŸ¥é“äº†ï¼Œæˆ‘ä»¬é€šè¿‡flatMapæ“ä½œç¬¦ï¼Œå·²ç»å°†GHObject-&gt;Intï¼Œå¦‚æœæˆ‘å­˜åœ¨å¤šä¸ªGHObjectçš„å¯¹è±¡ï¼ŒåŒäº‹å‘å‡ºå€¼ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥çœ‹åšæ˜¯å°†å¤šä¸ªIntçš„å€¼å‘é€äº†å‡ºæ¥ï¼Œè‡³äºæ˜¯å“ªä¸ªGHObjectå‘é€å‡ºæ¥çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒï¼š 123456789101112131415161718192021222324252627282930let bag = DisposeBag()let subject = PublishSubject&lt;GHObject&gt;() _ = subject .flatMap&#123; $0.gh_value.asObservable() &#125; .subscribe(onNext: &#123; dump($0) &#125;).addDisposableTo(bag) let gh1 = GHObject(gh_value: Variable(10)) subject.onNext(gh1)gh1.gh_value.value = 11 let gh2 = GHObject(gh_value: Variable(100))subject.onNext(gh2) gh1.gh_value.value = 12gh2.gh_value.value = 101gh2.gh_value.value = 102//ç»ˆç«¯è¾“å‡º- 10- 11- 100- 12- 101- 102 è‡³äºå’ŒflatMapç±»ä¼¼çš„ä¸€ä¸ªæ“ä½œç¬¦,æˆ‘ä»¬å«åšflatMapLatest,æˆ‘æ˜¯è¿™ä¹ˆææ“æ“ä½œç¬¦çš„ï¼šä¸€ç‚¹æ¥å—äº†ä¸€ä¸ªæ–°çš„GHObjectå‘çš„gh_valueå€¼ä¹‹åï¼Œä¹‹å‰æ—§çš„GHObject_valueå‘å‡ºçš„gh_valueæˆ‘ä»¬éƒ½ä¼šç»Ÿç»Ÿè¿‡æ»¤æ‰ï¼ŒDemo: 12345678910111213141516171819202122232425262728293031323334let bag = DisposeBag()let subject = PublishSubject&lt;GHObject&gt;() _ = subject .flatMapLatest&#123; $0.gh_value.asObservable() &#125; .subscribe(onNext: &#123; dump($0) &#125;).addDisposableTo(bag) let gh1 = GHObject(gh_value: Variable(10)) subject.onNext(gh1)gh1.gh_value.value = 11 let gh2 = GHObject(gh_value: Variable(100))subject.onNext(gh2) gh1.gh_value.value = 12gh2.gh_value.value = 101gh2.gh_value.value = 102 gh1.gh_value.value = 13gh1.gh_value.value = 14gh1.gh_value.value = 15//ç»ˆç«¯è¾“å‡º- 10- 11- 100- 101- 102 è¿™ä¸ªflatMapLatestå¬ä¸Šå»æ¯”è¾ƒç»•ï¼Œä½†æ˜¯ä¸€æ—¦æ‹¿èµ·ç¬”ç”»ç”»ï¼Œå°±ä¼šå¾ˆæ¸…æ™°äº†ã€‚ åœ¨è·å–æŸäº›ä¿¡å·é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ­¤ä¹‹å‰è·å–å…¶ä»–çš„ä¿¡å·ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨åˆ°.startWith(_ elements: E ...)ï¼Œçœ‹ä¸€ä¸‹githubä¸­çš„æºç ï¼Œå°±ä¼šå‘ç°äº†ï¼š 12345678910111213141516public func startWith(_ elements: E ...) -&gt; Observable&lt;E&gt; &#123; return StartWith(source: self.asObservable(), elements: elements)&#125;...override func run&lt;O : ObserverType&gt;(_ observer: O, cancel: Cancelable) -&gt; (sink: Disposable, subscription: Disposable) where O.E == Element &#123; for e in elements &#123; observer.on(.next(e)) &#125; return (sink: Disposables.create(), subscription: source.subscribe(observer))&#125;... çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥ä¹Ÿå°±çŸ¥é“äº†ï¼Œè¿™ä¸ªstartWithæ¥å—çš„æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œåœ¨æ­£åœ¨è®¢é˜…åˆ°è‡ªå·±æƒ³è¦çš„æ•°æ®ä¹‹å‰ï¼Œä¼šå…ˆéå†æ‰“å°ä¹‹å‰çš„ä¿¡å·ã€‚çœ‹ä¸€ä¸‹Demo: 1234567891011121314151617181920let bag = DisposeBag()let subject = PublishSubject&lt;String&gt;() subject .startWith("Step1", "Step2", "Step3") .subscribe(onNext: &#123; print($0) &#125;).addDisposableTo(bag) subject.onNext("Do somethingA")print("----")subject.onNext("Do somethingB")//ç»ˆç«¯è¾“å‡ºStep1Step2Step3Do somethingA----Do somethingB å¯ä»¥çœ‹å‡ºï¼Œä»–ä¸æ˜¯æ¯æ¬¡è®¢é˜…çš„æ—¶å€™ï¼Œéƒ½ä¼šå°†startWithä¸­çš„å€¼æ‰“å°ä¸€éï¼Œåªä¼šæ‰“å°ä¸€æ¬¡ã€‚ ä¸²è”é“¾æ¥å¤šä¸ªäº‹ä»¶çš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨concat,è°ƒç”¨æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œçœ‹ä¸€ä¸‹æºç ï¼š 1234567891011121314extension ObservableType &#123; /** Concatenates the second observable sequence to `self` upon successful termination of `self`. - seealso: [concat operator on reactivex.io](http://reactivex.io/documentation/operators/concat.html) - parameter second: Second observable sequence. - returns: An observable sequence that contains the elements of `self`, followed by those of the second sequence. */ public func concat&lt;O: ObservableConvertibleType&gt;(_ second: O) -&gt; Observable&lt;E&gt; where O.E == E &#123; return Observable.concat([self.asObservable(), second.asObservable()]) &#125;&#125; çœ‹è¿™ç§å®šä¹‰çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°concat: 1234567891011121314151617181920let bag = DisposeBag() let subjectA = PublishSubject&lt;String&gt;()let subjectB = PublishSubject&lt;String&gt;()let subjectC = PublishSubject&lt;String&gt;() _ = subjectA.concat(subjectB.concat(subjectC)).subscribe(onNext: &#123; print($0)&#125;).addDisposableTo(bag) subjectA.onNext("A1")subjectA.onCompleted()subjectB.onNext("B1")subjectB.onCompleted()subjectC.onNext("C1")//ç»ˆç«¯çš„è¾“å‡ºA1B1C1 è¿™é‡Œä½ å¯ä»¥å°†subjectA.onCompleted()æ³¨é‡Šæ‰ï¼Œä½ ä¼šå‘ç°ç»ˆç«¯çš„è¾“å‡ºåªæœ‰A1,è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸²è¡Œé˜Ÿåˆ—ï¼Œåªæœ‰åœ¨subjectAå®Œæˆçš„æ—¶å€™ï¼Œä»–æ‰ä¼šè®¢é˜…ä¸‹ä¸€ä¸ªæ—¶é—´ã€‚ ç³»ç»Ÿè¿˜ç»™Observableå†™äº†ä¸ªextensionï¼Œè¿™æ ·åœ¨æ­£åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œæ›´åŠ æ–¹ä¾¿ã€ç›´è§‚ã€‚çœ‹æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354extension Observable &#123; /** Concatenates all observable sequences in the given sequence, as long as the previous observable sequence terminated successfully. This operator has tail recursive optimizations that will prevent stack overflow. Optimizations will be performed in cases equivalent to following: [1, [2, [3, .....].concat()].concat].concat() - seealso: [concat operator on reactivex.io](http://reactivex.io/documentation/operators/concat.html) - returns: An observable sequence that contains the elements of each given sequence, in sequential order. */ public static func concat&lt;S: Sequence &gt;(_ sequence: S) -&gt; Observable&lt;Element&gt; where S.Iterator.Element == Observable&lt;Element&gt; &#123; return Concat(sources: sequence, count: nil) &#125; /** Concatenates all observable sequences in the given collection, as long as the previous observable sequence terminated successfully. This operator has tail recursive optimizations that will prevent stack overflow. Optimizations will be performed in cases equivalent to following: [1, [2, [3, .....].concat()].concat].concat() - seealso: [concat operator on reactivex.io](http://reactivex.io/documentation/operators/concat.html) - returns: An observable sequence that contains the elements of each given sequence, in sequential order. */ public static func concat&lt;S: Collection &gt;(_ collection: S) -&gt; Observable&lt;Element&gt; where S.Iterator.Element == Observable&lt;Element&gt; &#123; return Concat(sources: collection, count: collection.count.toIntMax()) &#125; /** Concatenates all observable sequences in the given collection, as long as the previous observable sequence terminated successfully. This operator has tail recursive optimizations that will prevent stack overflow. Optimizations will be performed in cases equivalent to following: [1, [2, [3, .....].concat()].concat].concat() - seealso: [concat operator on reactivex.io](http://reactivex.io/documentation/operators/concat.html) - returns: An observable sequence that contains the elements of each given sequence, in sequential order. */ public static func concat(_ sources: Observable&lt;Element&gt; ...) -&gt; Observable&lt;Element&gt; &#123; return Concat(sources: sources, count: sources.count.toIntMax()) &#125;&#125; è¿™é‡Œå¯ä»¥æ¥å—è‡ªå®šä¹‰çš„ã€ç³»ç»Ÿçš„é›†åˆç±»å‹ï¼Œä»¥åŠä¸€ä¸ªå¯å˜çš„ç±»å‹ï¼Œéƒ½æ˜¯å¯ä»¥è¿™æ ·ä½¿ç”¨çš„ã€‚ä¸Šé¢çš„ä»£ç å°±å¯ä»¥æŒ‰ç…§Demoæ‰€å†™çš„é‚£æ ·å®Œæˆ: 12345678Observable.concat([subjectA, subjectB, subjectC]) .subscribe(onNext: &#123; print($0) &#125;).addDisposableTo(bag) Observable.concat(subjectA, subjectB, subjectC) .subscribe(onNext: &#123;print($0)&#125;) .addDisposableTo(bag) å¦‚æœæ˜¯å¹¶è¡Œæ“ä½œæ—¶é—´çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨.merge()çš„æ“ä½œç¬¦: 12345678910111213141516Observable.merge(subjectA, subjectB, subjectC) .subscribe(onNext: &#123;print($0)&#125;) .addDisposableTo(bag) subjectA.onNext("A1")//subjectA.onCompleted()subjectB.onNext("B1")//subjectB.onCompleted()subjectC.onNext("C1")// ç»ˆç«¯è¾“å‡ºA1B1C1 è¿™æ ·å¯ä»¥çœ‹å‡ºæ¥ï¼ŒåŠæ—¶åœ¨ä¹‹å‰çš„æ—¶é—´ä¸å®Œæˆçš„æƒ…å†µä¸‹ï¼Œäº‹ä»¶çš„æ‰“å°ä¾æ—§ã€‚ ä¸ºäº†æ–¹ä¾¿æ§åˆ¶å¹¶è¡Œçš„ä¸ªæ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·ä½¿ç”¨ 1234Observable.of(subjectA, subjectB, subjectC) .merge(maxConcurrent: 2) .subscribe(onNext: &#123;print($0)&#125;) .addDisposableTo(bag) åˆå¹¶å¤šä¸ªäº‹ä»¶çš„æ“ä½œç¬¦æˆ‘ä»¬å¯ä»¥ä½¿ç”¨combineLatest,Demoï¼š 123456789101112131415161718192021let subjectA = PublishSubject&lt;String&gt;()let subjectB = PublishSubject&lt;String&gt;() Observable.combineLatest(subjectA, subjectB) &#123; a, b in a + "," + b &#125;.subscribe(onNext: &#123; dump($0)&#125;).addDisposableTo(bag) subjectA.onNext("A1")subjectB.onNext("B1")subjectA.onNext("A2")subjectB.onNext("B2")//ç»ˆç«¯è¾“å‡º- "A1,B1"- "A2,B1"- "A2,B2" å¦‚æœæ˜¯ä¸ªæ—¶é—´çš„åˆå¹¶ã€‚ç±»ä¼¼ä¸‹é¢ï¼š 1234567891011121314151617181920let subjectA = PublishSubject&lt;String&gt;()let subjectB = PublishSubject&lt;String&gt;()let subjectC = PublishSubject&lt;String&gt;() Observable.combineLatest([subjectA, subjectB, subjectC]) &#123; events in events.joined(separator: "--") &#125;.subscribe(onNext: &#123; dump($0)&#125;).addDisposableTo(bag) subjectA.onNext("A1")subjectB.onNext("B1")subjectA.onNext("A2")subjectB.onNext("B2")subjectC.onNext("C1")//ç»ˆç«¯è¾“å‡º- "A2--B2--C1" combineLateståˆå¹¶çš„æ—¶é—´ä¸­ï¼Œå¿…é¡»è‡³å°‘éƒ½å‘ç”Ÿäº†ä¸€æ¬¡äº‹ä»¶å‘é€ã€‚ ä»»ä¸€ä¸€ä¸ªæ—¶é—´å‘ç”Ÿæ›´æ–°çš„æ—¶å€™ï¼Œéƒ½ä¼šå‘ç”Ÿå›è°ƒã€‚ æ¯æ¬¡è·å–çš„å€¼ï¼Œéƒ½æ˜¯å½“å‰äº‹ä»¶çš„æœ€æ–°çš„å€¼ã€‚ combineLatestæ¥å—çš„åˆå¹¶äº‹ä»¶ä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„å€¼ç±»å‹ ä¾‹å¦‚ä¸‹é¢ï¼š 12345678910111213141516171819202122let bag = DisposeBag() let subjectA = PublishSubject&lt;String&gt;()let subjectB = PublishSubject&lt;Int&gt;() Observable.combineLatest(subjectA, subjectB) &#123; a, b in a + "," + "\(b)" &#125;.subscribe(onNext: &#123; dump($0)&#125;).addDisposableTo(bag) subjectA.onNext("A1")subjectB.onNext(11)subjectA.onNext("A2")subjectB.onNext(22)/ã€ç»ˆç«¯è¾“å‡º- "A1,11"- "A2,11"- "A2,22" æ¯æ¬¡åªä¼šåˆå¹¶å¤šä¸ªæœ€æ–°çš„æ—¶é—´è¯ï¼Œè¿™é‡Œæˆ‘å¯ä»¥ä½¿ç”¨.zip()çš„æ“ä½œç¬¦: 1234567891011121314151617181920212223let bag = DisposeBag() let subjectA = PublishSubject&lt;String&gt;()let subjectB = PublishSubject&lt;Int&gt;()//let subjectC = PublishSubject&lt;String&gt;() Observable.zip(subjectA, subjectB) &#123; a, b in a + "," + "\(b)" &#125;.subscribe(onNext: &#123; dump($0)&#125;).addDisposableTo(bag) subjectA.onNext("A1")subjectB.onNext(11)subjectA.onNext("A2")subjectB.onNext(22)//ç»ˆç«¯çš„è¾“å‡º- "A1,11"- "A2,22" å¦‚æœå­˜åœ¨å¤šä¸ªobservable,å¹¶ä¸”å­˜åœ¨ä¸€å®šçš„ä¾èµ–å…³ç³»ï¼Œåœ¨æŸä»¶äº‹æƒ…å‘é€çš„æ—¶å€™ï¼Œä¼šå»è·å–å¦ä¸€æ—¶é—´çš„æœ€æ–°å€¼: 123456789101112131415161718let bag = DisposeBag() let triggerSubject = PublishSubject&lt;Void&gt;()let contentSubject = BehaviorSubject&lt;String&gt;(value: "Default value") _ = triggerSubject.withLatestFrom(contentSubject).subscribe(onNext: &#123; print($0)&#125;).addDisposableTo(bag) triggerSubject.onNext(())contentSubject.onNext("Input Extra Content")triggerSubject.onNext(())//ç»ˆç«¯è¾“å‡ºDefault valueInput Extra Content åœ¨ä¸åŒçš„observableä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„åˆ‡æ¢ä»»æ„çš„æ—¶é—´ï¼Œä½¿ç”¨æ“ä½œç¬¦.switchLatest(),è¿™æ ·åªèƒ½åœ¨æŒ‡å®šçš„æ¨¡å¼ä¸‹ï¼ŒåšæŒ‡å®šçš„äº‹ä»¶ï¼š 1234567891011121314151617181920212223let bag = DisposeBag() let reading = PublishSubject&lt;String&gt;()let writing = PublishSubject&lt;String&gt;() let work = PublishSubject&lt;Observable&lt;String&gt;&gt;()work.switchLatest() .subscribe(onNext: &#123; print($0) &#125;).addDisposableTo(bag) work.onNext(reading)reading.onNext("Read 1") work.onNext(writing)writing.onNext("Write 1") reading.onNext("Read Extra") work.onNext(reading)reading.onNext("Read 2")]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºRxSwiftä¿¡æ¯é‡çš„ä¸€äº›é—®é¢˜]]></title>
    <url>%2F2017%2F10%2F08%2F20171007%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œä»‹ç»äº†RxSwiftä¸­ï¼Œå°†ä¹‹å‰ä¼ ç»Ÿçš„æ¨¡å¼ä¿®æ”¹ä¸ºæ›´Rxçš„æ¨¡å¼ï¼Œåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå…¶å®RxSwiftåªæ˜¯å°†ä¹‹å‰åˆ†æ•£å¤„ç†çš„æ­å–œï¼Œæ”¶æ‹¢èµ·æ¥ï¼Œä¹‹å‰æˆ‘ä»¬æˆ–è®¸å…³å¿ƒçš„æ˜¯blockçš„å›è°ƒã€ä»£ç†æ–¹æ³•ã€function()è°ƒç”¨ï¼Œè€Œç°åœ¨æˆ‘ä»¬æˆ–è®¸åªéœ€è¦å…³å¿ƒä¸€ä»¶äº‹æƒ…ä¿¡å·é‡ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œä¼´éšç€é¡¹ç›®çš„åºå¤§ã€åŠŸèƒ½çš„å¤æ‚ï¼Œæ•´ä¸ªé¡¹ç›®ä¸­å……æ–¥ç€çš„éƒ½æ˜¯è¿™äº›ä¿¡å·ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±è¦å­¦ä¼šåˆ†æã€è¿‡æ»¤ã€è½¬åŒ–ä¿¡å·ã€‚ å…ˆä¸å»æ·±ç©¶ä¸‹é¢åˆ—ä¸¾çš„æ¯ä¸ªæ“ä½œç¬¦çš„æºä»£ç ï¼Œåœ¨ç¢°åˆ°ä¸€äº›ç‰¹åˆ«éš¾ä»¥ç†è§£çš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å†å»æŸ¥çœ‹ä¸€ä¸‹æºä»£ç  å¿½ç•¥ä¿¡å·çš„æ“ä½œï¼š 1.å…ˆæ¥çœ‹ä¸€ä¸‹æœ€æœ€æ™®é€šçš„è®¢é˜…æ¨¡å¼ï¼š 1234567891011121314151617181920let subject = PublishSubject&lt;Int&gt;()let bag = DisposeBag() _ = subject.subscribe( onNext: &#123; print($0) &#125;, onCompleted: &#123; print("Completed") &#125;).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)subject.onNext(4)subject.onCompleted()// ç»ˆç«¯è¾“å…¥1234Completed å¦‚æœæˆ‘ä»¬éœ€è¦å¿½ç•¥æ‰€æœ‰çš„.onNext()çš„æ—¶é—´è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨.ignoreElements()æ“ä½œç¬¦ 123456789101112131415161718let subject = PublishSubject&lt;Int&gt;()let bag = DisposeBag() _ = subject .ignoreElements() .subscribe( onNext: &#123; print($0) &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)subject.onNext(4)subject.onCompleted()//ç»ˆç«¯è¾“å‡ºCompleted å¦‚æœå¿½ç•¥å‰å‡ ä¸ª.onNext()äº‹ä»¶ä¿¡å·é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨.skip()æ“ä½œç¬¦,ä¾‹å¦‚.skip(2)å¦‚æœä¸è¶³2ä¸ªçš„è¯ï¼Œé‚£å°±éƒ½è·³è¿‡,ç›´æ¥.onCompleted()æˆ–è€….onError(): 1234567891011121314151617_ = subject .skip(2) .subscribe( onNext: &#123; print($0) &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)subject.onNext(4)subject.onCompleted()//ç»ˆç«¯è¾“å‡º34Completed æŒ‡å®šæ¡ä»¶è¿‡æ»¤æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨.skipWhile()ï¼Œè¿™é‡Œ.skipWhile()æ¥å—çš„æ˜¯ä¸€ä¸ªblockï¼Œç†è§£èµ·æ¥å¯èƒ½ä¼šæ¯”è¾ƒç»•ï¼Œä½†æ˜¯çœ‹ä¸€ä¸‹githubä¸Šçš„è§£é‡Šï¼š 123456789/** Bypasses elements in an observable sequence as long as a specified condition is true and then returns the remaining elements. - seealso: [skipWhile operator on reactivex.io](http://reactivex.io/documentation/operators/skipwhile.html) - parameter predicate: A function to test each element for a condition. - returns: An observable sequence that contains the elements from the input sequence starting at the first element in the linear series that does not pass the test specified by predicate. */public func skipWhile(_ predicate: @escaping (E) throws -&gt; Bool) -&gt; Observable&lt;E&gt; &#123; return SkipWhile(source: asObservable(), predicate: predicate)&#125; åªè¦æ¡ä»¶ä¸ºtrueï¼Œæˆ‘ä»¬å°±ä¼šç»•è¿‡å‘å‡ºçš„ä¿¡å·ï¼Œçœ‹ä¸€ä¸‹Demoï¼š 12345678910111213141516171819202122let subject = PublishSubject&lt;Int&gt;()let bag = DisposeBag() _ = subject .skipWhile(&#123; (item) -&gt; Bool in return item != 3 &#125;) .subscribe( onNext: &#123; print($0) &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)subject.onNext(4)subject.onCompleted()//ç»ˆç«¯è¾“å‡º34Completed ä¾èµ–æŸä¸ªä¿¡å·é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨.skipUntil(),è¿™é‡Œçš„å…¥å‚æ˜¯ä¾‹å¤–ä¸€ä¸ªä¿¡å·é‡ï¼š 123456789101112131415161718192021let subject = PublishSubject&lt;Int&gt;()let dependOnSubject = PublishSubject&lt;Void&gt;()let bag = DisposeBag() _ = subject .skipUntil(dependOnSubject) .subscribe( onNext: &#123; print($0) &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)dependOnSubject.onNext(())subject.onNext(4)subject.onCompleted()//ç»ˆç«¯è¾“å‡º4Completed å¿½ç•¥é‡å¤å‡ºç°çš„ç›¸é‚»çš„ä¿¡å·é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨.distinctUntilChanged(), demo: 1234567891011121314151617181920212223242526272829let subject = PublishSubject&lt;Int&gt;()let bag = DisposeBag() _ = subject .distinctUntilChanged() .subscribe( onNext: &#123; print($0) &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(2)subject.onNext(3)subject.onNext(3)subject.onNext(3)subject.onNext(4)subject.onNext(2)subject.onNext(3)subject.onCompleted()//ç»ˆç«¯è¾“å‡º123423Completed é€‰æ‹©ä¿¡å·çš„æ“ä½œ é€‰æ‹©æŒ‡å®šç¬¬å‡ ä¸ªä¿¡å·é‡çš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨.elementAt(),å½“é€‰æ‹©çš„ä¸ªæ•°è¶…è¿‡äº†å­˜åœ¨çš„ä¿¡å·é‡ï¼Œæ­¤æ—¶å°±ä¼šæŠ¥.onError()çš„é”™è¯¯ï¼ŒDemoï¼š 12345678910111213141516171819let subject = PublishSubject&lt;Int&gt;()let bag = DisposeBag() _ = subject .elementAt(2) .subscribe( onNext: &#123; print($0) &#125;, onError: &#123;_ in print("Error") &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)subject.onNext(4)subject.onCompleted()//ç»ˆç«¯çš„è¾“å‡º3Completed æ ¹æ®æŸäº›æ¡ä»¶ï¼Œç­›é€‰è¿‡æ»¤å‡ºè‡ªå·±æƒ³è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨.filter()çš„æ“ä½œç¬¦ï¼š 123456789101112131415161718192021let subject = PublishSubject&lt;Int&gt;()let bag = DisposeBag() _ = subject .filter(&#123; (item) -&gt; Bool in item == 2 &#125;) .subscribe( onNext: &#123; print($0) &#125;, onError: &#123;_ in print("Error") &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)subject.onNext(4)subject.onCompleted()//ç»ˆç«¯è¾“å‡º2Completed è·å–æŒ‡å®šæ•°é‡çš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰ç”¨.take(),å½“å…¥å‚çš„æ•°å­—å¤§äºå·²æœ‰çš„æ•°æ®ï¼Œå°±ä¼šæŠŠæ‰€æœ‰çš„.onNext()äº‹ä»¶éƒ½æ‰“å°å‡ºæ¥: 1234567891011121314151617181920let subject = PublishSubject&lt;Int&gt;()let bag = DisposeBag() _ = subject .take(2) .subscribe( onNext: &#123; print($0) &#125;, onError: &#123;_ in print("Error") &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)subject.onNext(4)subject.onCompleted()//ç»ˆç«¯è¾“å‡º12Completed è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒç»•çš„æ“ä½œç¬¦ï¼Œå«åštakeWhile(),å’ŒskipWhile()ç±»ä¼¼ï¼Œåªè¦blockä¸­è¿”å›çš„æ˜¯trueçš„è¯ï¼Œå°±ä¼šé€‰å–è¿™å„¿å…ƒç´ ï¼Œä¸€æ—¦falseå°±ç»“æŸ 123456789101112131415161718192021let subject = PublishSubject&lt;Int&gt;()let bag = DisposeBag() _ = subject .takeWhile(&#123; (item) -&gt; Bool in item != 2 &#125;) .subscribe( onNext: &#123; print($0) &#125;, onError: &#123;_ in print("Error") &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)subject.onNext(4)subject.onCompleted()//ç»ˆç«¯è¾“å…¥1Completed å‡†å¤‡å®šä½åˆ°ç¬¬å‡ ä¸ªçš„è¯ï¼Œå¯ä»¥é€‰ç”¨ä¸‹é¢çš„æ“ä½œç¬¦takeWhileWithIndex, å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªindex,ä¸€ä¸ªvalue,åŒæ ·ä¸ºtrueï¼Œå°±ä¼šé€‰å–ï¼Œä¸ºfalseï¼Œå°±ç«‹åˆ»ç»“æŸ 123456789101112131415161718192021let subject = PublishSubject&lt;Int&gt;()let bag = DisposeBag() _ = subject .takeWhileWithIndex(&#123; (item, index) -&gt; Bool in item != 2 &amp;&amp; index != 3 &#125;) .subscribe( onNext: &#123; print($0) &#125;, onError: &#123;_ in print("Error") &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)subject.onNext(3)subject.onNext(4)subject.onCompleted()//ç»ˆç«¯è¾“å‡º1Completed ä¾èµ–äºæŸä¸ªä¿¡å·ï¼Œæ¥è·å–ä¿¡å·é‡ï¼Œå¯ä»¥é€‰ç”¨.takeUntil(),Demo 12345678910111213141516171819202122let subject = PublishSubject&lt;Int&gt;()let dependOnSubject = PublishSubject&lt;Void&gt;()let bag = DisposeBag() _ = subject .takeUntil(dependOnSubject) .subscribe( onNext: &#123; print($0) &#125;, onError: &#123;_ in print("Error") &#125;, onCompleted: &#123; print("Completed") &#125; ).addDisposableTo(bag) subject.onNext(1)subject.onNext(2)dependOnSubject.onNext(())subject.onNext(3)subject.onNext(4)subject.onCompleted()//ç»ˆç«¯è¾“å‡º12Completed ä¸ºäº†åŒæ—¶è®¢é˜…åŒä¸ªæ•°æ®çš„ä¸åŒä¿¡å·é‡ï¼ŒèŠ‚çº¦å¼€é”€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª.share() 1234let object = Observable.of(1,2,3,4,5).share()_ = object.subscribe(&#123; print($0 )&#125;)_ = object.subscribe(&#123; print($0 )&#125;)]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®é™…é¡¹ç›®ä¸­ä»ä¼ ç»Ÿæ¨¡å¼åˆ‡æ¢ä¸ºRxSwiftæ¨¡å¼]]></title>
    <url>%2F2017%2F10%2F05%2F20171005%2F</url>
    <content type="text"><![CDATA[ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥å®ç°RxSwiftçš„åŠŸèƒ½ï¼š åˆ—è¡¨Controlleré‡Œé¢çš„ä»£ç : 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051import UIKitclass TestRxSwiftViewController: UIViewController, UITableViewDataSource &#123; var datas = [TestRxSwiftItemObject]() @IBOutlet weak var ItemTableview: UITableView! // MARK: -- Life Cycle override func viewDidLoad() &#123; super.viewDidLoad() loadDatas() ItemTableview.reloadData() &#125; override func prepare(for segue: UIStoryboardSegue, sender: Any?) &#123; if segue.identifier == "testRx" &#123; let detail: TestRxSwiftDetailViewController = segue.destination as! TestRxSwiftDetailViewController if let index = ItemTableview.indexPath(for: sender as! UITableViewCell) &#123; detail.Item = datas[index.row] &#125; &#125; &#125; // MARK: -- Private Methods func loadDatas() &#123; for i in 1..&lt;10 &#123; let itemObject = TestRxSwiftItemObject(name: "Index-\(i)", isClicked: i % 2 == 0 ? true : false) datas.append(itemObject) &#125; &#125; // MARK: -- UITableView DataSource func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int &#123; return datas.count &#125; func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell &#123; let cell = tableView.dequeueReusableCell(withIdentifier: "cell", for: indexPath) let itemObject = datas[indexPath.row] cell.textLabel?.text = itemObject.name cell.accessoryType = itemObject.isClicked ? .checkmark : .none return cell &#125;&#125; è¯¦æƒ…Controlleré‡Œé¢çš„ä»£ç ï¼š 123456789101112131415161718class TestRxSwiftDetailViewController: UIViewController &#123; @IBOutlet weak var content: UITextField! @IBOutlet weak var isOn: UISwitch! var Item: TestRxSwiftItemObject? override func viewDidLoad() &#123; super.viewDidLoad() // Do any additional setup after loading the view. if let Item = Item &#123; content.text = Item.name isOn.isOn = Item.isClicked &#125; &#125;&#125; åˆ‡æ¢ä¸ºRxSwiftçš„æ¨¡å¼ é¦–å…ˆæˆ‘ä»¬å°†æˆ‘ä»¬åœ¨åˆ—è¡¨æ§åˆ¶å™¨é‡Œé¢çš„Array, æ›´æ¢ä¸ºå¯ä»¥è®¢é˜…çš„å˜é‡ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨Variableæ¥ä»£æ›¿: 1234//ä¹‹å‰var datas = [TestRxSwiftItemObject]()//ä¹‹åvar datas = Variable&lt;[TestRxSwiftItemObject]&gt;([]) å¹¶ä¸”å°†æ‰€æœ‰çš„å»æ•°æ®ä¸­çš„å¯¹è±¡çš„æ–¹æ³•åˆ‡æ¢ä¸€ä¸‹ï¼š 1234//ä¹‹å‰let itemObject = datas[indexPath.row]//ä¹‹ålet itemObject = datas.value[indexPath.row] ç„¶åæˆ‘ä»¬åªéœ€è¦æ›´åŠ ã€åˆ é™¤æ•°æ®ï¼Œå…³äºUIçš„åˆ‡æ¢ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€åšå¤„ç†ï¼Œå¦‚ä¸‹ï¼š ä»¥ä¸ºä¹‹å‰æˆ‘ä»¬å·²ç»å°†dataï¼Œåˆ‡æ¢ä¸ºVariableäº†ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨asObservable()å°±å¯ä»¥æ”¹ä¸ºå¯å®šäºçš„è®¢é˜…çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥æ¥å—åˆ°å›è°ƒã€‚ 12345678910111213_ = datas.asObservable().subscribe( onNext: &#123; [weak self] todos in self?.updateUI(todos: todos) &#125;).addDisposableTo(bag)func updateUI(todos: [TestRxSwiftItemObject]) &#123; title = todos.isEmpty ? "Todos" : "\(todos.count) Todos" addBtn.isEnabled = todos.filter &#123; !$0.isClicked &#125;.count &lt; 6 ItemTableview.reloadData()&#125; å…³äºçš„æ•°æ®çš„ä¼ é€’ï¼Œæ¶‰åŠåˆ°ä¸¤ç‚¹ï¼Œç¬¬ä¸€ä¸ªï¼šæˆ‘ä»¬å¦‚ä½•ä»é¦–é¡µæ•°æ®ä¼ é€’ç»™ç¬¬äºŒä¸ªæ§åˆ¶å™¨å‘¢ï¼Ÿé€šè¿‡å…¬å¼€çš„å±æ€§ä¼ é€’ï¼š 123let detail: TestRxSwiftDetailViewController = segue.destination as! TestRxSwiftDetailViewControllerif let index = ItemTableview.indexPath(for: sender as! UITableViewCell) &#123;detail.Item = datas.value[index.row] ç¬¬äºŒç‚¹æˆ‘ä»¬å¦‚ä½•å°†ç¬¬äºŒä¸ªæ§åˆ¶å™¨é‡Œé¢çš„å±æ€§å›ä¼ ç»™é¦–é¡µæ§åˆ¶å™¨å‘¢ï¼Ÿï¼Œæˆ‘ä»¬åœ¨ç¬¬äºŒé¡µæ§åˆ¶å™¨é‡Œå…¬å¼€å‡ºä¸€ä¸ªå¯ä»¥è®¢é˜…çš„å¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬åªè¦åœ¨ç¬¬äºŒä¸ªæ§åˆ¶å‰é‡Œé¢ä¿®æ”¹æ•°æ®å€¼ï¼Œå¹¶ä¸”ä¼ é€’ï¼Œå°±èƒ½å†ç¬¬ä¸€ä¸ªæ§åˆ¶å™¨é‡Œé¢æ¥æ”¶åˆ°å›è°ƒäº†ã€‚è¿™é‡Œæœ‰ä¸ªä¸¤ç‚¹ï¼š 1234fileprivate var itemSubject = PublishSubject&lt;TestRxSwiftItemObject&gt;()var item: Observable&lt;TestRxSwiftItemObject&gt; &#123; return itemSubject.asObservable()&#125; é¦–å…ˆå®šä¹‰çš„fileprivate,é˜»æ­¢äº†å¤–éƒ¨ç»™è¿™ä¸ªå˜é‡å‘é€æ•°æ®ã€‚è€Œä»…ä»…åªæ˜¯ç»™å¤–éƒ¨æš´éœ²äº†ä¸€ä¸ªitemçš„å¯¹åƒã€‚ è€Œåœ¨å¯¹è±¡å†…éƒ¨ï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥é€šè¿‡itemSubjectæ¥å‘é€æ•°æ®ï¼Œå¹¶ä¸”å¤–éƒ¨ä¹Ÿèƒ½å¤Ÿæ¥å—åˆ°å›è°ƒã€‚ ç‚¹å‡»ä¿å­˜ï¼Œç¬¬äºŒä¸ªé¡µé¢dismissä¹‹å‰ï¼Œæˆ‘æ‰§è¡Œå¦‚ä¸‹çš„ä¿å­˜æ“ä½œï¼š 1234567if let item = Item &#123; item.name = content.text! item.isClicked = isOn.isOn itemSubject.onNext(item) itemSubject.onCompleted()&#125; è¿™æ ·åœ¨é¦–é¡µæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·æ¥å—åˆ°å›è°ƒäº†ï¼š 123456789101112let detail: TestRxSwiftDetailViewController = segue.destination as! TestRxSwiftDetailViewControllerif let index = ItemTableview.indexPath(for: sender as! UITableViewCell) &#123; detail.Item = datas.value[index.row] _ = detail.item.subscribe( onNext: &#123; [weak self] newTodo in self?.datas.value[index.row] = newTodo &#125;, onDisposed: &#123; print("Finishing changing item content") &#125; )&#125; å…³äºæœ€åä¸€ç‚¹å¼‚æ­¥çš„å›è°ƒæ“ä½œï¼Œç®€å•çš„æ¥è¯´ï¼Œæˆ‘ä»¬å°†ä¹‹å‰è¿”å›å€¼Void-&gt;Observable&lt;Void&gt;æˆ–è€…URL-&gt;Observable&lt;URL&gt;,Demo: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152enum CustomError: Error &#123; case someOptionErrors case urlIsNullError&#125;func syncToSaveDatas() -&gt; Observable&lt;URL&gt; &#123; return Observable.create &#123; observer in var testURL: URL? var someOptions: Bool testURL = URL(string: "") someOptions = true // Error 1 guard someOptions else &#123; observer.onError(CustomError.someOptionErrors) return Disposables.create() &#125; if let testURL = testURL &#123; // success observer.onNext(testURL) observer.onCompleted() &#125; else &#123; // Error 2 observer.onError(CustomError.urlIsNullError) return Disposables.create() &#125; return Disposables.create() &#125;&#125;@IBAction func saveDatas(_ sender: Any) &#123; _ = syncToSaveDatas().subscribe( onNext: &#123; url in print(url) &#125;, onError: &#123; print("error is \($0)") &#125;, onCompleted: &#123; print("Success") &#125; )&#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ RxSwift]]></title>
    <url>%2F2017%2F10%2F03%2F20171003%2F</url>
    <content type="text"><![CDATA[åˆ›å»ºå¯ä»¥è®¢é˜…çš„å¯¹è±¡ï¼Œåœ¨RxSwiftä¸­ç§°ä¹‹ä¸ºObservable,æˆ‘ä»¬å¯ä»¥é€šè¿‡ç³»ç»Ÿä»‹ç»ç»™æˆ‘çš„æ–¹æ³•æ¥åˆ›å»º(æˆ‘ä»¬ç§°ä¹‹ä¸ºOperators)ã€‚ è¿™é‡Œæˆ‘ä»¬é€šè¿‡Createçš„Operatorsçš„æ–¹æ³•æ¥åˆ›å»ºï¼Œå…ˆçœ‹ä¸€ä¸‹å®˜ç½‘[http://reactivex.io/documentation/operators/create.html] çš„ä»‹ç»: You can create an Observable from scratch by using the Create operator. You pass this operator a function that accepts the observer as its parameter. Write this function so that it behaves as an Observable â€” by calling the observerâ€™s onNext, onError, and onCompleted methods appropriately.A well-formed finite Observable must attempt to call either the observerâ€™s onCompleted method exactly once or its onError method exactly once, and must not thereafter attempt to call any of the observerâ€™s other methods. å†çœ‹ä¸€ä¸‹githubä¸Šæºç ï¼š 123456789101112extension Observable &#123; // MARK: create /** Creates an observable sequence from a specified subscribe method implementation. - seealso: [create operator on reactivex.io](http://reactivex.io/documentation/operators/create.html) - parameter subscribe: Implementation of the resulting observable sequence's `subscribe` method. - returns: The observable sequence with the specified implementation for the `subscribe` method. */ public static func create(_ subscribe: @escaping (AnyObserver&lt;E&gt;) -&gt; Disposable) -&gt; Observable&lt;E&gt; &#123; return AnonymousObservable(subscribe) &#125;&#125; æŒ‰ç…§å®˜ç½‘çš„ä»‹ç»ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Createæ¥åˆ›å»ºä¸€ä¸ªå¯è¢«è®¢é˜…çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„å…¥å‚æ˜¯ä¸€ä¸ªblockï¼Œä»»æ„å¯¹è±¡çš„Observer,ä»–å¯ä»¥å‘é€.onNext()/.onComplete()/.onError() ç¬¬äºŒæ®µçš„æ³¨é‡Šçš„æ„æ€ï¼Œå°±æ˜¯è¿™ä¸ªObserverå¯ä»¥å‘é€.onNext(),ä½†æ˜¯è¿™ä¸ªå¯¹è±¡ä¸€æ—¦å‘é€äº†ä¸€æ¬¡.onComplete()æˆ–è€….onError(),ç„¶åå°±ä¸èƒ½å°è¯•è°ƒç”¨ä»»ä½•è§‚å¯Ÿè€…çš„å…¶ä»–æ–¹æ³•äº†ã€‚çœ‹ä¸€ä¸‹Demoï¼š 12345678910111213141516171819202122232425enum CustomeError: Error &#123; case somethingError&#125; let customOB = Observable&lt;Int&gt;.create &#123; observer in observer.onNext(1) observer.onNext(2) //observer.onError(CustomeError.somethingError) observer.onCompleted() return Disposables.create()&#125;let disposeBag1 = DisposeBag()customOB.subscribe( onNext: &#123; print($0) &#125;, onError: &#123; print($0) &#125;, onCompleted: &#123; print("onCompleted") &#125;, onDisposed: &#123; print("onDisposed") &#125;).addDisposableTo(disposeBag1) è¿™åˆ›å»ºçš„ä¾æ—§æ˜¯ä¸€ä¸ªObserverçš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨å…¶ä»–çš„Operator,è¿™é‡Œä¸ºäº†æ–¹ä¾¿çš„è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨.debug()ã€‚ä½¿ç”¨å¦‚ä¸‹ï¼š 1234567891011121314151617181920let disposeBag1 = DisposeBag()customOB .debug() .subscribe( onNext: &#123; print($0) &#125;, onError: &#123; print($0) &#125;, onCompleted: &#123; print("onCompleted") &#125;, onDisposed: &#123; print("onDisposed") &#125; ).addDisposableTo(disposeBag1) // æ§åˆ¶å°çš„æ‰“å°ä¿¡æ¯å¦‚ä¸‹ï¼š2017-10-03 13:58:23.488: ViewController.swift:35 (viewDidLoad()) -&gt; subscribed2017-10-03 13:58:23.493: ViewController.swift:35 (viewDidLoad()) -&gt; Event next(1)12017-10-03 13:58:23.493: ViewController.swift:35 (viewDidLoad()) -&gt; Event next(2)22017-10-03 13:58:23.493: ViewController.swift:35 (viewDidLoad()) -&gt; Event completedonCompletedonDisposed2017-10-03 13:58:23.493: ViewController.swift:35 (viewDidLoad()) -&gt; isDisposed åœ¨æˆ‘ä»¬çœŸæ˜¯çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè®¢é˜…è€…æˆ–è€…å‘å¸ƒè€…ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªä¸ä»…å¯ä»¥è®¢é˜…ã€ä¹Ÿå¯ä»¥å‘å¸ƒçš„å¯¹è±¡ï¼Œåœ¨RxSwiftä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºSubjects: é¦–é€‰æˆ‘ä»¬è¦è¯´çš„Subjectså¯¹è±¡å«åšPublishSubject,çœ‹ä¸€ä¸‹githubä¸Šçš„æºç ï¼š 1234/// Represents an object that is both an observable sequence as well as an observer.////// Each notification is broadcasted to all subscribed observers.public final class PublishSubject&lt;Element&gt; å†çœ‹å®˜ç½‘ä¸Šå¯¹PublishSubjectå¯¹è±¡çš„ä»‹ç»ï¼š PublishSubject emits to an observer only those items that are emitted by the source Observable(s) subsequent to the time of the subscription. Note that a PublishSubject may begin emitting items immediately upon creation (unless you have taken steps to prevent this), and so there is a risk that one or more items may be lost between the time the Subject is created and the observer subscribes to it. If you need to guarantee delivery of all items from the source Observable, youâ€™ll need either to form that Observable with Create so that you can manually reintroduce â€œcoldâ€ Observable behavior (checking to see that all observers have subscribed before beginning to emit items), or switch to using a ReplaySubject instead. If the source Observable terminates with an error, the PublishSubject will not emit any items to subsequent observers, but will simply pass along the error notification from the source Observable. åªæœ‰å…ˆè®¢é˜…æ¶ˆæ¯ï¼Œå†å‘é€æ¶ˆæ¯ï¼Œæ‰èƒ½æ¥å—åˆ°æ¶ˆæ¯ é¦–å…ˆå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯Cold Sign,è¿™é‡Œæ‰€è°“çš„Coldï¼Œå°±ä»£è¡¨ï¼Œå½“åˆ›å»ºå®Œè¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šç«‹åˆ»å‘é€æ•°æ®ï¼Œè€Œåªæœ‰åœ¨æœ‰è®¢é˜…è€…è®¢é˜…å®ƒçš„æ—¶å€™ï¼Œå®ƒæ‰ä¼šå‘é€æ•°æ®ã€‚ è€Œè¿™é‡Œè¿˜æœ‰ä¸€ç‚¹å¾ˆé‡è¦çš„æ˜¯ï¼ŒPublishSubjectåªèƒ½å¤Ÿè®¢é˜…åœ¨å®ƒä¹‹åå‘é€çš„æ•°æ®ï¼Œè¿™ä¸€ç‚¹ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ä¸ªè®¢é˜…æ¶ˆæ¯ä¹‹å‰ï¼Œä¸ç®¡æˆ‘ä»¬å‘é€äº†å¤šå°‘æ•°æ®ï¼Œåœ¨çœŸæ­£è®¢é˜…ä¹‹åï¼Œè¿™äº›ä¹‹å‰è®¢é˜…çš„æ•°æ®æ˜¯ä¸ä¼šå‘é€çš„ã€‚ å¹¶ä¸”åœ¨çº¦åˆ°å¤±è´¥çš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡å°±å°†è¢«ç»ˆæ­¢ï¼Œé™¤äº†åœ¨å›è°ƒçš„.onError()æ–¹æ³•ä¹‹å¤–ï¼Œä»¥åæ‰€æœ‰çš„æ•°æ®éƒ½å°†æ— æ³•æ¥å—ã€‚çœ‹ä¸€ä¸‹Demoï¼š 12345678910111213141516171819202122232425262728293031let subject = PublishSubject&lt;String&gt;()subject.onNext("Test1")subject.onNext("Test2")let sub1 = subject.subscribe( onNext: &#123; print("1:) \($0)")&#125;)subject.onNext("Test3")subject.onNext("Test4")sub1.dispose()subject.onNext("Test5")let sub2 = subject.subscribe( onNext: &#123; print("2:) \($0)")&#125;)subject.onNext("Test6")subject.onNext("Test7")sub2.dispose()// ç»ˆç«¯è¾“å‡ºä¸º1:) Test31:) Test42:) Test62:) Test7 ç¬¬äºŒç§åŒæ—¶å³å¯ä»¥è®¢é˜…ï¼Œä¹Ÿå¯ä»¥å‘é€æ¶ˆæ¯çš„å¯¹è±¡ï¼Œæˆ‘ä»¬è¿™é‡Œå«åšBehaviorSubjectã€‚è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹githubä¸­ä»£ç : 1234/// Represents a value that changes over time.////// Observers can subscribe to the subject to receive the last (or initial) value and all subsequent notifications.public final class BehaviorSubject&lt;Element&gt; å†çœ‹ä¸€ä¸‹å®˜ç½‘ä¸Šçš„ä»‹ç»ï¼š When an observer subscribes to a BehaviorSubject, it begins by emitting the item most recently emitted by the source Observable (or a seed/default value if none has yet been emitted) and then continues to emit any other items emitted later by the source Observable(s). However, if the source Observable terminates with an error, the BehaviorSubject will not emit any items to subsequent observers, but will simply pass along the error notification from the source Observable. çœ‹åˆ°æ³¨é‡Šä»¥åŠä»£ç çš„æ„æ€ï¼Œè¿™ç§Subjectçš„å¯¹è±¡çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œè®¢é˜…è¿™ç§å¯¹è±¡ï¼Œå®ƒå°±å¯ä»¥æ¥æ”¶åˆ°æœ€è¿‘çš„ä¸€æ¬¡å€¼æˆ–è€…æ˜¯åˆå§‹åŒ–çš„é»˜è®¤å€¼ åŒæ ·ï¼Œè¿™ä¸ªSubjectçš„å¯¹è±¡ï¼Œï¼Œä¸€æ—¦æ¥å—åˆ°.onError()æˆ–è€….onComplete(), è¿™ä¸ªå¯¹è±¡å°†ä¸ä¼šå†å‘é€ä»»ä½•å€¼äº†ã€‚çœ‹ä¸€ä¸‹Demoï¼š 1234567891011121314151617181920212223242526let subject = BehaviorSubject&lt;String&gt;(value: "Default Value")let sub1 = subject.subscribe( onNext: &#123; print("From1:\($0)") &#125;)subject.onNext("Test1")sub1.dispose()let sub2 = subject.subscribe( onNext: &#123;print("From2:\($0)")&#125;)subject.onNext("Test2")subject.onNext("Test3")sub2.dispose()// ç»ˆç«¯è¾“å‡ºFrom1:Default ValueFrom1:Test1---From2:Test1From2:Test2From2:Test3 è¿™é‡Œå¯ä»¥é€šè¿‡BehaviorSubjectå¯ä»¥æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡å‘é€æ•°æ®ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼Œå°±ä¼šæ¥å—åˆ°é»˜è®¤çš„æ•°æ®ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦æ¥å—æŒ‡å®šæ•°ç›®çš„å†å²æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ç§subjectï¼Œæˆ‘ä»¬å«åšï¼šReplaySubject. çœ‹ä¸€ä¸‹githubä¸Šä»£ç çš„ï¼š 12/// Each notification is broadcasted to all subscribed and future observers, subject to buffer trimming policies.public class ReplaySubject&lt;Element&gt; ReplaySubject emits to any observer all of the items that were emitted by the source Observable(s), regardless of when the observer subscribes. There are also versions of ReplaySubject that will throw away old items once the replay buffer threatens to grow beyond a certain size, or when a specified timespan has passed since the items were originally emitted. If you use a ReplaySubject as an observer, take care not to call its onNext method (or its other on methods) from multiple threads, as this could lead to coincident (non-sequential) calls, which violates the Observable contract and creates an ambiguity in the resulting Subject as to which item or notification should be replayed first. ReplaySubjectå¯¹è±¡ä¸èƒ½åˆå§‹åŒ–é»˜è®¤å€¼ã€å¹¶ä¸”æ¯æ¬¡æ‰“å°å†å²æ•°æ®çš„å€¼æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œçœ‹ä¸€ä¸‹Demoï¼š 123456789101112131415161718192021222324252627let subject = ReplaySubject&lt;String&gt;.create(bufferSize: 2)let sub1 = subject.subscribe( onNext: &#123; print("From 1:| \($0)")&#125;)subject.onNext("Test1")subject.onNext("Test2")subject.onNext("Test3")sub1.dispose()let sub2 = subject.subscribe( onNext: &#123; print("From 2:| \($0)")&#125;)subject.onNext("Test4")sub2.dispose()// ç»ˆç«¯è¾“å‡ºFrom 1:| Test1From 1:| Test2From 1:| Test3From 2:| Test2From 2:| Test3From 2:| Test4 ç¬¬ä¸‰ç§Subjects, æˆ‘ä»¬å«åšVariable, çœ‹ä¸€ä¸‹githubä¸Šçš„æ³¨é‡Š: 12345/// Variable is a wrapper for `BehaviorSubject`.////// Unlike `BehaviorSubject` it can't terminate with error, and when variable is deallocated/// it will complete its observable sequence (`asObservable`).public final class Variable&lt;Element&gt; &#123; ç‰¹ç‚¹ï¼š1.è¿™ä¸ªå¯¹è±¡æ˜¯å¯¹BehaviorSubjectçš„ä¸Šå±‚å°è£…ã€‚2.å¯¹è±¡ä¸èƒ½é€šè¿‡å‘é€Errorè€Œç»ˆæ­¢å¯¹è±¡å‘é€æ•°æ®ã€‚3.é€šè¿‡è°ƒç”¨asObservableï¼Œå¯ä»¥è½¬åŒ–ä¸ºObserverå¯¹è±¡ã€‚ Demo: 1234567891011121314let subject = Variable("Test1")let _ = subject.asObservable().subscribe( onNext: &#123;print("1:\($0)")&#125;)subject.value = "Changed"print(subject.value)// ç»ˆç«¯è¾“å‡º1:Test11:ChangedChanged]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ Swift Tips(ä¸‰)]]></title>
    <url>%2F2017%2F09%2F14%2F20170914%2F</url>
    <content type="text"><![CDATA[finalä¿®é¥°çš„class/func/var,è¡¨ç¤ºå†…å®¹ä¸å…è®¸è¿›è¡Œç»§æ‰¿æˆ–è€…é‡å†™ lazyç®€å•èµ‹å€¼ï¼šlazy var str1: String = &quot;Hello&quot; lazyè®¡ç®—èµ‹å€¼ï¼š 1234567lazy var str: String = &#123; let str = "Hello" print("åªæœ‰é¦–æ¬¡è®¿é—®è¾“å‡º") return str &#125;() lazyç”¨åœ¨ä¸€äº›map/filterï¼š 1234567let result = data.lazy.map &#123; (i: Int) -&gt; Int in print("æ­£åœ¨å¤„ç† \(i)") return i * 2&#125; Swift ä¸­çš„é•œåƒä»¥åŠåå°„çš„é—®é¢˜ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡Mirroræ¥å®ç°ï¼š 123456789101112131415161718192021222324252627282930let xiaoming = Person(name: "XiaoMing", age: 16)let r = Mirror(reflecting: xiaoming)if let name = valueFrom(xiaoming, key: "name") as? String &#123; print("é€šè¿‡key å¾—åˆ°å€¼:\(name)")&#125;dump(xiaoming)print("xiaoming æ˜¯\(r.displayStyle!)")print("å±æ€§ä¸ªæ•°:\(r.children.count)")for child in r.children &#123; print("å±æ€§å:\(String(describing: child.label)),å€¼:\(child.value)")&#125;func valueFrom(_ object: Any, key: String) -&gt; Any? &#123; let mirror = Mirror(reflecting: object) for child in mirror.children &#123; let (targetKey, targetMirror) = (child.label, child.value) if key == targetKey &#123; return targetMirror &#125; &#125; return nil&#125; éšå¼è§£åŒ…å¹¶ä¸èƒ½ç¡®ä¿å±æ€§ä¸€å®šæœ‰å€¼ï¼Œæˆ–è€…ä¸€å®šå®‰å…¨ï¼Œè€Œæ˜¯åœ¨è·å–å±æ€§å€¼çš„æ—¶å€™ï¼Œè‡ªåŠ¨å¼ºåˆ¶è§£åŒ…ï¼Œå¦‚æœè¯¥å€¼æ˜¯nilçš„è¯ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä¼šcrashçš„ã€‚ optionalå®šä¹‰å…¶å®å°±æ˜¯ä¸ªæšä¸¾ï¼š 123456789101112let aNil: String? = nillet anotherNil: String?? = aNillet literalNil: String?? = nilif let _ = anotherNil &#123; print("anotherNil")&#125;if let _ = literalNil &#123; print("literalNil")&#125; æ‰“å°optionalå¯ä»¥é€šè¿‡fr v -R xxx mapçš„ä½¿ç”¨ï¼Œæˆ‘è§çš„æœ€å¤šçš„å°±æ˜¯åœ¨æ•°ç»„ç­‰é›†åˆä¸­çš„mapä½¿ç”¨ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹mapçš„å®šä¹‰: 123456789101112131415161718/// Returns an array containing the results of mapping the given closure/// over the sequence's elements.////// In this example, `map` is used first to convert the names in the array/// to lowercase strings and then to count their characters.////// let cast = ["Vivien", "Marlon", "Kim", "Karl"]/// let lowercaseNames = cast.map &#123; $0.lowercaseString &#125;/// // 'lowercaseNames' == ["vivien", "marlon", "kim", "karl"]/// let letterCounts = cast.map &#123; $0.characters.count &#125;/// // 'letterCounts' == [6, 6, 3, 4]////// - Parameter transform: A mapping closure. `transform` accepts an/// element of this sequence as its parameter and returns a transformed/// value of the same or of a different type./// - Returns: An array containing the transformed elements of this/// sequence.public func map&lt;T&gt;(_ transform: (Element) throws -&gt; T) rethrows -&gt; [T] æ¸…æ™°æ˜äº†ï¼Œè¿™é‡Œå®šä¹‰çš„æ³›å‹ä¸ºT, å‡½æ•°å†…éƒ¨çš„blockï¼Œå°†å¦å¤–ä¸€ç§æ³›å‹Elementè½¬åŒ–ä¸ºTï¼Œæœ€åè¿˜æ˜¯ç”Ÿæˆä¸€ä¸ª[T]ç±»å‹çš„æ•°ç»„ã€‚ é™¤äº†æ•°ç»„çš„mapå¤–ï¼Œè¿™é‡Œä½œè€…è¿˜è¯´äº†ä¸€ä¸‹Optionalçš„mapè¡Œæ•°ï¼Œæ•ˆæœä¸€æ ·ï¼š 123456789101112131415161718192021222324252627282930/// Evaluates the given closure when this `Optional` instance is not `nil`,/// passing the unwrapped value as a parameter.////// Use the `map` method with a closure that returns a nonoptional value./// This example performs an arithmetic operation on an/// optional integer.////// let possibleNumber: Int? = Int("42")/// let possibleSquare = possibleNumber.map &#123; $0 * $0 &#125;/// print(possibleSquare)/// // Prints "Optional(1746)"////// let noNumber: Int? = nil/// let noSquare = noNumber.map &#123; $0 * $0 &#125;/// print(noSquare)/// // Prints "nil"////// - Parameter transform: A closure that takes the unwrapped value/// of the instance./// - Returns: The result of the given closure. If this instance is `nil`,/// returns `nil`.public func map&lt;U&gt;(_ transform: (Wrapped) throws -&gt; U) rethrows -&gt; U?// ä¾‹å­å¦‚ä¸‹ï¼šlet num: Int? = 3let result = num.map &#123; $0 * 2&#125;print(result) // Optional(6) protocolçš„extensionçš„åŠŸèƒ½ï¼Œä¸ºåè®®å®Œæˆäº†æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚è¿™ä¹Ÿï¼Œå³ä½¿éµå¾ªäº†åè®®ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨å†™ä»»ä½•å®ç°çš„ä»£ç ã€‚ å¦‚æœç±»å‹æ¨æ–­æ˜¯å®é™…çš„ç±»å‹ï¼š å¦‚æœç±»å‹ä¸­æ²¡æœ‰å®ç°ï¼Œå°±ä¼šè°ƒç”¨æ‹“å±•ä¸­çš„æ–¹æ³•å®ç°ã€‚ å¦‚æœç±»å‹æ¨æ–­çš„æ˜¯åè®®ï¼š1. å¦‚æœåœ¨åè®®ä¸­å®šä¹‰è¿‡ï¼Œå¦‚æœç±»å‹ä¸­æ²¡æœ‰å®ç°ï¼Œé‚£å°±è°ƒç”¨æ‹“å±•ä¸­çš„å®ç°ã€‚ 2.å¦‚æœåœ¨åè®®ä¸­æ²¡ç”¨å®šä¹‰è¿‡çš„è¯ï¼Œæ‹“å±•ä¸­çš„æ–¹æ³•é»˜è®¤ä¼šè¢«è°ƒç”¨ã€‚ whereå­—æ®µçš„ä½¿ç”¨ï¼Œç›®å‰å·²ç»ä¸èƒ½å†if/guardä¸­ä½¿ç”¨where,ä½†æ˜¯åœ¨swich/foreach/forå¾ªç¯ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚ å¯¹äºå¦‚æœéœ€è¦åœ¨enumä¸­å¾ªç¯éœ€è¦åµŒå¥—å®šä¹‰çš„è¯ï¼Œè¿™é‡Œæˆ‘éœ€è¦ç”¨çš„indirect,ä¾‹å¦‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å®šä¹‰ä¸€ä¸ªå•å‘è¿è¾¹çš„ç»“æ„äº†ï¼š 1234567891011121314151617indirect enum LinkedList&lt;Element: Comparable&gt; &#123; case empty case node(Element, LinkedList&lt;Element&gt;) // åˆ é™¤é“¾è¡¨ä¸­æŸä¸ªå…ƒç´ func removing(_ element: Element) -&gt; LinkedList&lt;Element&gt; &#123; guard case let .node(value, next) = self else &#123; return .empty &#125; return value == element ? next : LinkedList.node(value, next.removing(element))&#125; &#125; let linkedList = LinkedList.node(1, .node(2, .node(3, .node(4, .empty)))) let result = linkedList.removing(2) print(result) åœ¨Object-cä¸­ï¼Œè¿”å›SELï¼Œæˆ‘ä»¬ä¼šç›´æ¥è°ƒç”¨@selectorï¼Œä½†æ˜¯åœ¨Swiftä¸­æˆ‘ä»¬å·²ç»ä¸èƒ½è¿™æ ·è°ƒç”¨äº†ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªå­—æ®µ#selector,ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼š 1234567891011121314151617181920212223 func callMe() &#123;&#125; func callMeWithParam(obj: AnyObject!) &#123;&#125; func turn(by angle: Int, speed: Int) &#123;&#125;let someMethod = #selector(callMe)let anotherMethod = #selector(callMeWithParam)let method = #selector(turn)// å¦‚æœåå­—ç›¸åŒï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦å®šä¹‰ç±»å‹ï¼šlet method11 = #selector(comonFunc as () -&gt;())let method22 = #selector(commonFunc(input:) as (Int) -&gt; Int) func comonFunc() &#123;&#125; func commonFunc(input: Int) -&gt; Int &#123; return input &#125; å®ä¾‹åŒ–æ–¹æ³•çš„åŠ¨æ€è°ƒç”¨ï¼š1.é€šè¿‡ç±»è·å–æ–¹æ³•ï¼Œ2.å†ä¼ å…¥å®ä¾‹å¾—åˆ°æ–¹æ³•ï¼Œ3.åœ¨æ ¹æ®æƒ…å†µä¼ å…¥å‚æ•° 123456789101112131415class MyClass &#123; func method(number: Int) -&gt; Int &#123; return number + 1 &#125; class func method(number: Int) -&gt; Int &#123; return number &#125;&#125;let f = MyClass.methodlet object = MyClass()let result = f(object)(1)print(result) å¦‚æœå­˜åœ¨ç›¸åŒåå­—çš„å‡½æ•°ï¼Œå¯ä»¥æ˜¾ç¤ºå®šä¹‰ç±»å‹æ¥åŒºåˆ†: 12345let f1 = MyClass.methodlet f2: (Int) -&gt; Int = MyClass.methodlet f3: (MyClass) -&gt; (Int) -&gt; Int = MyClass.method å•ä¾‹ï¼š 1234class Manager &#123; static let shared = Manager() private init() &#123;&#125;&#125; è‡ªå®šä¹‰ç¼–è¯‘ç¬¦å·ï¼Œåœ¨Build Settingsä¸­ï¼Œæ‰¾åˆ°Swift Compiler - Custom Flag,å¹¶ä¸”åœ¨Other Swift Flagsä¸­åŠ ä¸Š-D FREE_VERSION ç¼–è¯‘ç¬¦å·ï¼š // MARK:ã€// TODO:ã€// FIXME: appå…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œé»˜è®¤åˆ›å»ºappçš„æ—¶å€™ï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºmainçš„æ–‡ä»¶ï¼Œåœ¨swiftä¸­ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ›å»º@UIApplicationMain,ä»£è¡¨ç³»ç»Ÿä¼šè‡ªåŠ¨å°†è¿™ä¸ªç±»æ ‡è®°ä¸ºå¯åŠ¨æ–‡ä»¶ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹æ³•ï¼Œå¯ä»¥å°†å¯åŠ¨çš„æ–‡ä»¶æŒ‡å®šä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ï¼Œä¹Ÿå¯ä»¥å°†äº‹ä»¶çš„æ¥å—è€…æŒ‡å®šä¸ºæˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶ç±»ï¼š 1234567891011121314151617181920// åˆ›å»ºä¸€ä¸ªmain.swift çš„æ–‡ä»¶import UIKitclass MyApplication: UIApplication &#123; override func sendEvent(_ event: UIEvent) &#123; super.sendEvent(event) print("Event sent: \(event)") &#125;&#125;UIApplicationMain( CommandLine.argc, UnsafeMutableRawPointer(CommandLine.unsafeArgv) .bindMemory( to: UnsafeMutablePointer&lt;Int8&gt;.self, capacity: Int(CommandLine.argc)), nil, NSStringFromClass(AppDelegate.self)) åœ¨Swiftä¸­çš„åè®®é»˜è®¤éƒ½æ˜¯å¿…é¡»è¦å®ç°çš„ï¼Œä½†æ˜¯å¦‚æœç”¨åœ¨Object-cä¸­ï¼Œåè®®çš„æ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š 123@objc protocol OptionalProtocol &#123; @objc optional func optionalMethod()&#125; ä½†æ˜¯æœ‰äº†Protocol Extensionï¼Œæˆ‘ä¹Ÿå¯ä»¥ä»¥Swiftçš„æ–¹å¼æ¥å®ç°,å¯¹äºOCä¸­å¯é€‰çš„åè®®æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å†™protocol extension æ¥å®ç°å¯é€‰çš„åŠŸèƒ½ã€‚ Swiftä¸­çš„unownedå’Œä»¥å‰çš„unsafe_unretained: å³ä½¿å®ƒåŸæ¥å¼•ç”¨çš„å†…å®¹å·²ç»è¢«é‡Šæ”¾äº†ï¼Œå®ƒä»ç„¶ä¼šä¿æŒå¯¹è¢«é‡Šæ”¾å¯¹è±¡çš„ä¸€ä¸ªæ— æ•ˆå¼•ç”¨ï¼Œå®ƒä¸æ˜¯optionalå€¼ï¼Œä¹Ÿä¸èƒ½è¢«æŒ‡å‘nil,å¦‚æœè°ƒç”¨å±æ€§æˆ–è€…æ–¹æ³•çš„æ—¶å€™å°±ä¼šcrashã€‚ä½œè€…å»ºè®®: å¦‚æœç¡®å®šåœ¨è®¿é—®çš„æ—¶å€™ï¼Œä¸ä¼šè¢«é‡Šæ”¾çš„è¯ï¼Œå°±ä½¿ç”¨unownedï¼Œå¦‚æœå­˜åœ¨é‡Šæ”¾çš„å¯èƒ½ï¼Œé‚£å°±ç”¨weak åœ¨swiftä¸­ï¼ŒInt/Bool/String/Array/Dictionaryéƒ½æ˜¯å€¼ç±»å‹ã€‚ è¿™äº›ç±»å‹åªæ˜¯åœ¨ç®€å•çš„èµ‹å€¼çš„æ—¶å€™ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸Šéƒ½æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚ è€Œå½“å‘ç”Ÿä¸€ä¸ªæ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œä»–ä»¬çš„å†…å­˜åœ°å€æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚ å€¼ç±»å‹åœ¨èµ‹å€¼çš„æ—¶å€™ï¼Œä¼šå°†å‚¨å­˜å…¶ä¸­çš„å€¼ç±»å‹ä¸€å¹¶è¿›è¡Œå¤åˆ¶ï¼Œè€Œå¯¹å…¶ä¸­çš„å¼•ç”¨ç±»å‹ï¼Œåˆ™åªæ˜¯å¤åˆ¶äº†ä¸€ä»½å¼•ç”¨ã€‚ 12345678910let myObject = MyObject()let a = [myObject]var b = ab.append(myObject)myObject.number = 100print(b[0].number) //100print(b[1].number) //100 å¤„ç†å¤§é‡æ•°æ®å¹¶ä¸”é¢‘ç¹æ“ä½œå…¶ä¸­çš„å…ƒç´ çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨NSMutableArrayã€NSMutableDictionaryä¼šæ›´å¥½ã€‚ å¯¹äºå®¹å™¨å†…æ¡ç›®å°‘ã€å®¹å™¨æœ¬èº«æ•°ç›®å¤šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Arrayã€Dictionary swiftç‰ˆæœ¬é…åˆrangeçš„ä½¿ç”¨ï¼š 12345678910let levels = "ABCDE"let nsRange = NSMakeRange(1, 4)print((levels as NSString).replacingCharacters(in: nsRange, with: "AAAA"))let indexPositionOne = levels.characters.index(levels.startIndex, offsetBy: 1)let swiftRange = indexPositionOne ..&lt; levels.characters.index(levels.startIndex, offsetBy: 5)print(levels.replacingCharacters(in: swiftRange, with: "AAAA"))]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ Swift Tips(äºŒ)]]></title>
    <url>%2F2017%2F09%2F08%2F20170908%2F</url>
    <content type="text"><![CDATA[åœ¨ä»‹ç»ï¼ˆTupleï¼‰çš„æ—¶å€™ï¼Œè¯´äº†äº¤æ¢è¾“å…¥çš„æ–¹æ³•ä¹¦å†™ï¼Œåœ¨Object-Cä¸­ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæˆ‘ä»¬ä¼ å…¥çš„æ˜¯æŒ‡é’ˆï¼Œè¿™ä¸ªé—®é¢˜ä¸»è¦çš„æ¥æºå°±æ˜¯å› ä¸ºå—åˆ¶çº¦Cè¯­è¨€ï¼Œå•ä¸€è¿”å›ï¼Œæœ‰äº†Tupleçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿çš„è°ƒç”¨äº†ã€‚ 12let rect = CGRect(x: 0, y: 0, width: 100, height: 100)let (small, large) = rect.divided(atDistance: 20, from: .minXEdge) åœ¨å†™swiftçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å’ŒOptionalæ‰“äº¤é“ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¸¸å¸¸ç”¨åˆ°è§£åŒ…ï¼Œè¿™é‡Œå°±æåˆ°äº†ä¸€ä¸ªå¿«é€Ÿè§£åŒ…çš„æ–¹å¼??,é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ï¼š 1234var level: Int?var startLevel = 1var currentLevel = level ?? startLevel è¿™é‡Œå¾ˆç®€å•ï¼Œä½†æ˜¯è¿˜æ˜¯è¦è¯´ä¸€ä¸‹ï¼Œè¿™é‡Œçš„??åˆ¤æ–­å·¦è¾¹çš„å€¼ï¼Œå¦‚æœæ˜¯énilçš„optionalçš„å€¼ï¼Œé‚£å°±ç›´æ¥è¿”å›å·¦è¾¹çš„valueå€¼ï¼Œå¦åˆ™å°±è¿”å›å³è¾¹çš„å€¼,ä½†æ˜¯ç»†ç»†å¾€ä¸‹çœ‹ä¸€ä¸‹æºç çš„å®šä¹‰ä¼šå‘ç°ï¼š 12public func ??&lt;T&gt;(optional: T?, defaultValue: @autoclosure () throws -&gt; T) rethrows -&gt; Tpublic func ??&lt;T&gt;(optional: T?, defaultValue: @autoclosure () throws -&gt; T?) rethrows -&gt; T? çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘å°±æœ‰ç‚¹ç–‘æƒ‘äº†ï¼Œè¿™ä¸ª??å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸ºä»€ä¹ˆé‚£ä¹ˆå¦ç±»å‘¢ï¼Ÿ,æŒ‰ç…§æˆ‘ä»¬çš„ç†è§£ï¼Œè¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸åº”è¯¥æ˜¯è¿™æ ·çš„å—ï¼Ÿ??(optional, xxx),ä½†æ˜¯å‘ç°è¿™æ ·å†™ï¼Œä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å°±å†³å®šæŠŠå‡½æ•°çš„å®šä¹‰ç›´æ¥copyä¸‹æ¥ï¼Œç„¶åè‡ªå·±å»å®ç°ï¼Œå¸¦å…¥å¦‚ä¸‹ï¼š 123456789101112func th&lt;T&gt;(_ optional: T?, _ defaultValue: @autoclosure () throws -&gt; T) rethrows -&gt; T &#123; if let optional = optional &#123; return optional &#125; return try defaultValue()&#125;var level: Int?var startLevel = 1var test = th(level, startLevel) çœ‹åˆ°è¿™é‡Œæˆ‘å°±å¼€å§‹çŒœæµ‹äº†ï¼Œè¿™æˆ–è®¸æ˜¯swiftä¸ºäº†æ–¹ä¾¿çš„æˆ‘ä»¬çš„è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒåˆå®šä¹‰äº†ä¸€ä¸ªè¯­æ³•ç³–å§ï¼ @autoclosure ç¬¦å·çš„æ„æ€ï¼Œå°±æ˜¯ç›´æ¥å°†ï¼šå…¥å‚T è½¬åŒ–ä¸º ()-&gt;T @escaping ç¬¦å·çš„æ„æ€å°±æ˜¯è¯´æ˜ï¼Œè¿™ä¸ªå‚æ•°æ˜¯å¼‚æ­¥çš„ï¼Œä¸æ˜¯å±äºè¿™ä¸ªå±€éƒ¨çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åå†æ‰§è¡Œè¿™é‡Œçš„å›è°ƒï¼Œä¸åŠ ä»»ä½•å‚æ•°çš„blocké»˜è®¤å°±æ˜¯åŒæ­¥çš„ï¼Œå‡½æ•°æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œè¿™ä¸ªblockå°±ä¼šè¢«æ”¶å›ã€‚ optional Chaining å¦‚æœæŸä¸ªå±æ€§æ˜¯nilçš„è¯ï¼Œä¼šæå‰è¿”å›å›æ¥ã€‚ é‡è½½ç¬¦å·çš„åšæ³•ï¼Œç”¨çš„æ¯”è¾ƒå°‘ï¼š 12345678910precedencegroup DotProductPrecedence &#123; associativity: none higherThan: MultiplicationPrecedence&#125;infix operator +*: DotProductPrecedencefunc +*(left: Vector2D, right: Vector2D) -&gt; Double &#123; return left.x * right.x + left.y * right.y&#125; å¤–éƒ¨ä¼ å…¥çš„å‚æ•°ï¼Œå¦‚æœéœ€è¦åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹çš„è¯ï¼Œéœ€è¦åœ¨å‚æ•°å‰é¢åŠ ä¸Šinoutï¼Œè¿™æ ·ä¼ å…¥å‚æ•°çš„æ—¶å€™ï¼Œå°±éœ€è¦å°†ä¹‹å‰ä¼ å…¥çš„å€¼æ”¹ä¸ºåœ°å€ï¼Œç±»ä¼¼: 1234func incrementor(variable: inout Int) -&gt; Int &#123; variable += 1 return variable &#125; å­—é¢é‡çš„ä½œç”¨ï¼Œæˆ‘å°±è§‰å¾—å¾ˆé¸¡è‚‹ï¼Œä½†æ˜¯è¿˜æ˜¯çœ‹ä¸€ä¸‹ï¼Œè¯´ç™½äº†ï¼Œå­—é¢é‡çš„æ„æ€å°±æ˜¯è¯´ï¼šå¯åŒç›´æ¥å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œä¼ å…¥ä¸€ä¸ªStringã€Intã€Bool, è€Œè¿”å›çš„ç¡®å®æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š 12345678910111213141516171819202122232425class Person: ExpressibleByStringLiteral &#123; let name: String init(name value: String) &#123; self.name = value &#125; required convenience init(stringLiteral value: String) &#123; self.init(name: value) &#125; required convenience init(extendedGraphemeClusterLiteral value: String) &#123; self.init(name: value) &#125; required convenience init(unicodeScalarLiteral value: String) &#123; self.init(name: value) &#125;&#125; let p: Person = "xiaoming" print(p.name) æ•°ç»„ä¸‹æ ‡è¯´å®è¯ï¼Œè¿˜æ˜¯è›®ä¸é”™çš„å†…å®¹ï¼Œç”¨çš„å¥½çš„è¯ï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šçš„æ—¶é—´ï¼Œé€šè¿‡å¯¹ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•å†™ä¸€ä¸‹æ‹“å±•ï¼Œå°±å¯ä»¥å®ç°è‡ªå®šä¹‰çš„ä¸‹æ ‡åŠŸèƒ½ï¼š 123public subscript(index: Int) -&gt; Elementpublic subscript(bounds: Range&lt;Int&gt;) -&gt; ArraySlice&lt;Element&gt; onvcate çš„ä¾‹å­ä¸­ä¸¾å‡ºäº†ä¸‹é¢çš„ä¾‹å­ï¼Œæ–¹ä¾¿æˆ‘ä»¬é€šè¿‡ä¸‹æ ‡æ¥è·å–æ•°ç»„çš„æ•°æ®ï¼š 12345678910111213141516171819202122232425var arr = [1,2,3,4,5,6]print(arr[[0,2,3]])arr[[0,2,3]] = [-1, -3, -4]print(arr)extension Array &#123; subscript(input: [Int]) -&gt; ArraySlice&lt;Element&gt; &#123; get&#123; var result = ArraySlice&lt;Element&gt;() for i in input &#123; assert(i &lt; self.count, "Index out of range") result.append(self[i]) &#125; return result &#125; set&#123; for(index,i) in input.enumerated() &#123; assert(i &lt; self.count, "Index out of range") self[i] = newValue[index] &#125; &#125; &#125;&#125; ä¸‹é¢ä½œè€…ä¹Ÿè¯´äº†ï¼Œè¿™ä¸ªæ–¹å¼è°ƒç”¨èµ·æ¥ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œç„¶åå°±æœ‰äº†ä¸‹é¢çš„æ‹“å±•ï¼Œæ˜¯æˆ‘è‡ªå·±å†™çš„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142extension Array &#123; subscript(first: Int, second: Int, other: Int...) -&gt; ArraySlice&lt;Element&gt; &#123; get&#123; var result = ArraySlice&lt;Element&gt;() if first &lt; self.count &#123; result.append(self[first]) &#125; if second &lt; self.count &#123; result.append(self[second]) &#125; for i in other &#123; assert(i &lt; self.count, "Index out of range") result.append(self[i]) &#125; return result &#125; set&#123; var tempDatas = other.count &gt; 0 ? other : [Int]() if (first &lt; self.count) &#123; tempDatas.append(first) &#125; if (second &lt; self.count) &#123; tempDatas.append(second) &#125; for(index,i) in tempDatas.enumerated() &#123; assert(i &lt; self.count, "Index out of range") self[i] = newValue[index] &#125; &#125; &#125;&#125;var t = [1,2,3,4,5]print( t[0,2,3,4])t[0,2,3,4] = [99,99,99,99]print(t) å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘ï¼Œå°±æ˜¯ä½ å¯ä»¥æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›å€¼ï¼Œæˆ–è€…å¯ä»¥åœ¨å‡½æ•°ä¸­å®šä¹‰ä»»æ„å¤šä¸ªå‡½æ•°ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ§åˆ¶ä»£ç çš„è®¿é—®æƒé™çš„é—®é¢˜ã€‚ åœ¨ä¸åŒçš„target(ä¸€ä¸ªå«GG,ä¸€ä¸ªå«HH)ä¸­ï¼Œè°ƒç”¨åŒä¸€ä¸ªç±»çš„ï¼ŒåŒä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªMyçš„ç±»ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€ä¸ªhelloçš„ç±»æ–¹æ³•: 123GG.My.hello()HH.My.hello() typealias é™¤äº†ç”¨åœ¨ç»™å˜é‡ã€å®ä¾‹ã€å±æ€§å®šä¹‰åˆ«åå¤–ï¼Œè¿˜å¯ä»¥ç”¨åœ¨åè®®ä¸Šï¼Œæˆ‘è®¤ä¸ºè¿™æ ·çš„ç”¨æˆ·å¾ˆå¤§: 12345protocol Cat &#123;&#125;protocol Dog &#123;&#125;typealias Pat = Cat &amp; Dogclass ViewController: UIViewController, Pat &#123;&#125; å¦‚æœæƒ³å¯¹åè®®æ·»åŠ é™å®šçš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªassociatedtype xx,è¿™æ ·åœ¨éµå¾ªäº†åè®®çš„æ—¶å€™ï¼Œå°±éœ€è¦åˆ¶å®šæˆ‘ä»¬typeçš„ç±»å‹ï¼Œè¿™å°±å’Œä¹‹å‰çœ‹å®˜æ–¹Arrayå®šä¹‰çš„æ•ˆæœåŒ»é™¢ï¼Œéœ€è¦æˆ‘ä»¬åˆ¶å®šç±»å‹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæ›´å¥½çš„é™åˆ¶éµå¾ªåè®®çš„å¯¹è±¡ã€‚ 1234567891011121314protocol Animal &#123; associatedtype F func eat(_ food: F)&#125;struct Meat: Food &#123;&#125;struct Crass: Food &#123;&#125;struct Tiger: Animal &#123; typealias F = Meat func eat(_ food: Meat) &#123; print("eat \(food)") &#125;&#125; ä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬è¿™æ ·é™åˆ¶äº†åè®®ä¹‹åï¼Œåœ¨è¿›è¡Œç‹¬ç«‹åˆ¤æ–­çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¸èƒ½åƒä¹‹å‰é‚£æ ·ç›´æ¥è¿›è¡Œåˆ¤æ–­äº†ï¼Œä¾‹å¦‚ï¼š 1234567func isDangerous(animal: Animal) -&gt; Bool &#123; if animal is Tiger &#123; return true &#125; else &#123; return false &#125;&#125; è¿™é‡Œé”™è¯¯çš„åŸå› ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œé™åˆ¶åè®®ä¸­çš„typeç±»å‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æŒ‰ç…§æ³›å‹çš„ç±»å‹æ¥ä¹¦å†™äº†ï¼š 12345678func isDangerous&lt;T: Animal&gt;(animal: T) -&gt; Bool &#123; if animal is Tiger &#123; return true &#125; else &#123; return false &#125;&#125; å¯å˜å‚æ•°çš„è°ƒç”¨ï¼Œä¸é™åˆ¶åœ¨æŒ‡å®šå“ªä¸ªä½ç½®ï¼Œæ¥å—å¯å˜å‚æ•°çš„å‡½æ•°å†…éƒ¨ï¼ŒæŠŠå¯å˜å‚æ•°çœ‹ä½œæ˜¯å¯¹åº”æ•°æ®çš„æ•°ç»„ï¼Œä½†æ˜¯æ¯ä¸ªå‡½æ•°åªèƒ½æ¥å—ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œå¹¶ä¸”å¯å˜å‚æ•°çš„ç±»å‹å¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚ æ–¹æ³•çš„è°ƒç”¨é¡ºåºé—®é¢˜: 123456789101112131415class Cat &#123; var name: String init() &#123; name = "cat" &#125;&#125;class Tiger: Cat &#123; let power: Int override init() &#123; power = 10 super.init() name = "gh" &#125;&#125; ç±»åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¿…é¡»è¦ä¿è¯è¯¥ç±»çš„æ‰€æœ‰æˆå‘˜éƒ½å®Œæˆäº†åˆå§‹åŒ–ã€‚ å­˜åœ¨ç»§æ‰¿å…³ç³»çš„ç±»ï¼Œå¿…é¡»è¦ç¡®ä¿å½“å‰å­ç±»å®ä¾‹çš„æ‰€æœ‰æˆå‘˜å®Œæˆåˆå§‹åŒ–åæ‰ä¼šè°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚ å¯ä»¥æ˜¾ç¤ºçš„è°ƒç”¨super.init()ï¼Œå¦‚æœä¸æ˜¾ç¤ºçš„è°ƒç”¨çš„super.init()çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬å®Œæˆå­ç±»çš„å®ä¾‹åŒ–æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªå·±è°ƒç”¨super.init(),å½“ç„¶å¦‚æœå­˜åœ¨å¤å†™çš„æƒ…å†µçš„è¯ï¼Œè¿˜æ˜¯éœ€è¦æ˜¾ç¤ºçš„è°ƒç”¨çš„ã€‚ Designatedã€Convenienceã€Required ä½¿ç”¨æ³¨æ„ç‚¹ï¼š Swiftçš„initåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè€Œä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥å¯¹letå±æ€§å˜é‡è¿›è¡Œèµ‹å€¼ã€‚ åœ¨initå‰é¢åŠ äº†convenienceçš„åˆå§‹åŒ–æ–¹æ³•å¿…é¡»è°ƒç”¨åŒä¸€ä¸ªç±»çš„initçš„æ–¹æ³•ã€‚ convenienceçš„å®ä¾‹åŒ–æ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼Œå¹¶ä¸”ä¹Ÿä¸èƒ½å¤Ÿè¢«å­ç±»é€šè¿‡superçš„æ–¹å¼è°ƒç”¨ã€‚ åªè¦å­ç±»é‡å†™äº†convenienceæ–¹æ³•æ‰€éœ€çš„initçš„æ–¹æ³•åï¼Œå­ç±»å°±å¯ä»¥ä½¿ç”¨convenienceçš„åˆå§‹åŒ–æ–¹æ³•ã€‚ å½“å­ç±»å«æœ‰å¼‚äºçˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•æ—¶ï¼ˆåˆå§‹åŒ–æ–¹æ³•å‚æ•°ç±»å‹å’Œæ•°é‡å¼‚äºçˆ¶ç±»ï¼‰ï¼Œå­ç±»å¿…é¡»è¦å®ç°çˆ¶ç±»çš„requiredåˆå§‹åŒ–æ–¹æ³•ï¼Œå¹¶ä¸”ä¹Ÿè¦ä½¿ç”¨requiredä¿®é¥°ç¬¦è€Œä¸æ˜¯overrideã€‚ å½“å­ç±»æ²¡æœ‰åˆå§‹åŒ–æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä¸ç”¨å®ç°çˆ¶ç±»çš„requiredåˆå§‹åŒ–æ–¹æ³•ã€‚ å¯¹äºå¯ä»¥è¿”å›nilçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨init?(xxx)ï¼ŒåŠ å…¥? å¦‚æœæƒ³åœ¨protocol é‡Œå®šä¹‰ä¸€ä¸ªç±»å‹åŸŸä¸Šçš„æ–¹æ³•æˆ–è€…è®¡ç®—å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®šä¹‰çš„æ—¶å€™ç”¨staticè¿›è¡Œå®šä¹‰ã€‚ åœ¨Swiftä¸­çš„é›†åˆç±»å‹ï¼Œåœ¨å®šä¹‰ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å°†åŒä¸€ç§ç±»å‹çš„æ•°æ®å­˜æ”¾åœ¨é›†åˆä¸­ï¼Œä½†æ˜¯å¦‚æœç±»å‹ä¸åŒå‘¢ï¼Ÿæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ 123456789// Any ç±»å‹å¯ä»¥éšå¼è½¬åŒ–let mixed: [CustomStringConvertible] = [1, "two", false]// è½¬åŒ–ä¸º[NSObject]let objectArray = [1 as NSObject, "two" as NSObject, false as NSObject]let any = mixed[2]let nsObject = objectArray[2] è¿™æ ·å­˜å‚¨æ˜¯æ²¡å•¥é—®é¢˜çš„ï¼Œä½†æ˜¯ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¯èƒ½æ•°æ®ä¼šéƒ¨åˆ†ä¸¢å¤±ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸å»ºè®®çš„ï¼Œå› ä¸ºæ—¢ç„¶ä½ èƒ½å­˜æ”¾åœ¨åŒä¸€ä¸ªé›†åˆä¸­ï¼Œé‚£è¿™äº›å…ƒç´ ï¼Œå°±åº”è¯¥å­˜åœ¨ä¸€å®šçš„å…±åŒç‚¹ã€‚ 1234567enum IntOrString &#123; case IntValue(Int) case StringValue(String) case BoolValue(Bool)&#125;let mixed = [IntOrString.IntValue(1), IntOrString.StringValue("two"), IntOrString.BoolValue(false)] é»˜è®¤å‚æ•°å¯ä»¥åœ¨ä»»æ„çš„ä½ç½®: 12345678910func sayHello1(str1: String = "Hello", str2: String, str3: String) &#123; print(str1 + str2 + str3)&#125;func sayHello2(str1: String, str2: String, str3: String = "World") &#123; print(str1 + str2 + str3)&#125;sayHello1(str2: " ", str3: "World")sayHello2(str1: "Hello", str2: " ") swift ä¸­æ²¡æœ‰ä¸“é—¨çš„ç”¨æ¥æ­£åˆ™åŒ¹é…çš„ä¸œè¥¿ï¼Œä½†æ˜¯å›´ç»•NSRegularExpressionä¹Ÿæ˜¯å¯ä»¥åœ¨swiftä¸Šåšä¸€ä¸‹æ‹“å±•: 12345678910111213141516171819202122232425262728293031struct RegexHelper &#123; let regex: NSRegularExpression init(_ pattern: String) throws &#123; try regex = NSRegularExpression(pattern: pattern, options: .caseInsensitive) &#125; func match(_ input: String) -&gt; Bool &#123; let matches = regex.matches(in: input, options: [], range: NSMakeRange(0, input.utf16.count)) return matches.count &gt; 0 &#125;&#125;let mailPattern = "^([a-z0-9\\.-]+)@([\\da-z\\.-]+)\\.([a-z\\.]&#123;2,6&#125;)$"let matcher: RegexHelperdo &#123; matcher = try RegexHelper(mailPattern) let maybeMailAddress = "onev@onevcat.com" if matcher.match(maybeMailAddress) &#123; print("æœ‰æ•ˆçš„é‚®ç®±åœ°å€") &#125;&#125; catch &#123; print(error)&#125; ...(é—­åŒºé—´)å’Œ..&lt;(å¼€åŒºé—´)ï¼Œé™¤äº†å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ•°å­—ç±»å‹çš„èŒƒå›´å¤–ï¼Œè¿˜æ˜¯å¯ä»¥ç”Ÿæˆå­—ç¬¦ä¸²å’ŒASCIIç¼–ç ï¼š 12let interval = "a"..."z"let xx = \0...~ ä»»æ„çš„ç±»å‹æœ‰ï¼šAny/AnyObject/AnyClass, è€Œ typealias AnyClass = AnyObject.Type, .selfç”¨åœ¨ç±»å‹åé¢å–å¾—ç±»å‹æœ¬èº«ï¼Œç”¨åœ¨æŸå®ä¾‹åé¢è¡¨ç¤ºå–å¾—å®ä¾‹æœ¬äº‹ é€šè¿‡AnyObject.Typeè·å–å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå…ƒç±»å‹ï¼Œ ä¹Ÿå°±æ˜¯AnyClass,è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦è°ƒç”¨.selfæ¥è·å–å…ƒç±»ã€‚ åœ¨åè®®ä¸­è¿”å›å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›Self,è¿™ä¸ªç±»å‹çš„æ„æ€æ˜¯ï¼Œéµå¾ªè¿™ä¸ªåè®®çš„ç±»è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªåŒæ ·éµå¾ªè¯¥åè®®å¹¶ä¸”ç›¸åŒçš„ç±»ï¼š 1234567891011121314151617protocol Copyable &#123; func copy() -&gt; Self&#125;class MyClass: Copyable &#123; var num = 1 func copy() -&gt; Self &#123; let result = type(of: self).init() result.num = num return result &#125; required init() &#123; &#125;&#125; è¿™æ ·ä¹¦å†™ä¹‹åï¼Œä¸ç®¡æ˜¯MyClassè¿˜æ˜¯MyClassçš„å­ç±»éƒ½å¯ä»¥åŒæ ·é€‚ç”¨è¯¥åè®®æ–¹æ³•ã€‚ å¹¶ä¸”éœ€è¦ä½¿ç”¨requiredæ¥å®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼Œç¡®ä¿è¯¥ç±»åŠå…¶å­ç±»éƒ½èƒ½å“åº”è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•ã€‚ swift æ˜¯ä¸æ”¯æŒåŠ¨æ€æ´¾å‘çš„ï¼Œæ‰€ä»¥ä»–ä¸ä¼šæ ¹æ®ç»§æ‰¿çš„å…³ç³»ï¼Œåœ¨è¿è¡Œæ—¶æ”¹å˜æ–¹æ³•çš„æ‰§è¡Œï¼š 123456789101112131415161718192021222324class Pet &#123;&#125;class Cat: Pet &#123;&#125;class Dog: Pet &#123;&#125;func printPet(_ pet: Pet) &#123; print("Pet")&#125;func printPet(_ cat: Cat) &#123; print("Meow")&#125;func printPet(_ dog: Dog) &#123; print("Bark")&#125;func printThem(_ pet: Pet, _ cat: Cat) &#123; printPet(pet) // Pet printPet(cat) // Meow&#125;printThem(Dog(), Cat()) è™½ç„¶æˆ‘è¿™é‡Œä¼ å…¥çš„æ˜¯Dog()çš„å®ä¾‹ï¼Œä½†æ˜¯åœ¨å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å®šä¹‰çš„ç¡®å®å®ƒçš„çˆ¶ç±»ï¼Œæ‰€ä»¥åœ¨å®é™…è°ƒç”¨çš„æ—¶å€™ï¼Œä¸ç®¡ä½ ä¼ å…¥çš„æ˜¯ä»€ä¹ˆï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå°±å·²ç»å†³å®šäº†ï¼Œå‡½æ•°è°ƒç”¨çš„å…¥å‚æ˜¯petï¼Œå¦‚æœæƒ³è¦åŒºåˆ†çš„è¯ï¼Œåªèƒ½é€šè¿‡ç±»å‹çš„åˆ¤æ–­å»æ‰§è¡Œï¼š 12345678910func printThem(_ pet: Pet, _ cat: Cat) &#123; if let aCat = pet as? Cat &#123; printPet(aCat) &#125; else if let aDog = pet as? Dog &#123; printPet(aDog) &#125; printPet(cat)&#125; å±æ€§çš„ç›‘å¬åœ¨willSetæ˜¯å°†date-&gt;newValue, è€ŒdidSetæ˜¯ä»oldValue-&gt;dateã€‚ åŸºæœ¬ä¸Šåœ¨åŒä¸€ä¸ªç±»ä¸­å¯¹åŒä¸€ä¸ªå±æ€§å€¼ï¼Œä¸å¯èƒ½å­˜åœ¨set/willSet/didSet, ä½†æ˜¯å¦‚æœå¤å†™çˆ¶ç±»çš„å±æ€§å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶å®ç°ä¸‰ä¸ªå±æ€§å€¼ï¼š 12345678910111213141516171819202122232425262728class A &#123; var number: Int &#123; get &#123; print("get") return 1 &#125; set &#123; print("set") &#125; &#125;&#125;class B: A &#123; override var number: Int &#123; willSet &#123; print("willset") &#125; didSet &#123; print("didSet") &#125; &#125;&#125;let b = B()b.number = 0// è¾“å‡º// get// willSet// set// didSet è¿™é‡Œé¦–å…ˆæ‰“å°get,æ˜¯å› ä¸ºè¿™é‡Œå®ç°äº†didSet,åœ¨didSetä¸­ç”¨åˆ°äº†oldValue, è€Œè¿™ä¸ªå€¼éœ€è¦åœ¨æ•´ä¸ªsetåŠ¨ä½œä¹‹å‰è¿›è¡Œè·å–å¹¶å­˜å‚¨ä»£ç”¨ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ Masonry Autolayoutå¸ƒå±€å®ä¾‹]]></title>
    <url>%2F2017%2F09%2F07%2F20170907%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘çœ‹åˆ°å¾ˆå¤šäººéƒ½åœ¨è½¬ä¸€ç¯‡åšå®¢ï¼Œåšå®¢çš„é“¾æ¥ä¸ºï¼š[http://tutuge.me/2015/05/23/autolayout-example-with-masonry/], å…¶å®æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œé‡ç‚¹å°±æ˜¯è®²å¦‚ä½•è¿ç”¨Masonryæ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ç¯‡æ–‡ç« å¾ˆä½¿ç”¨ï¼Œæˆ‘åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œå¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹ä»–çš„å››ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼š ç¬¬ä¸€éƒ¨åˆ†é‡ç‚¹è®²çš„æ˜¯ä¸¤ä¸ªå±æ€§: Content Compression Resistanceã€Content Hugging,è¿™é‡Œæˆ‘è§‰å¾—ä½œè€…çš„è§£é‡Šè¿˜æ˜¯å½¢è±¡çš„ï¼š 1234567891011121314Content Compression Resistance = ä¸è®¸æŒ¤æˆ‘å€¼è¶Šé«˜ï¼Œå†…å®¹è¶Šä¸å®¹æ˜“è¢«å‹ç¼©å½“å†…å®¹æ”¾ä¸ä¸‹çš„æ—¶å€™ï¼Œä¼˜å…ˆæŒ¤å‹é‚£äº›ä¼˜å…ˆçº§ä½çš„å…ƒç´ Content Hugging = æŠ±ç´§å­å…ƒç´ è®¾ç½®çš„å±æ€§å€¼è¶Šé«˜ï¼Œå­å…ƒç´ è¶Šä¸ä¼šéšç€çˆ¶è§†å›¾çš„å˜åŒ–è€Œå˜åŒ–//è®¾ç½®label1çš„content hugging ä¸º1000[_label1 setContentHuggingPriority:UILayoutPriorityRequired forAxis:UILayoutConstraintAxisHorizontal];//è®¾ç½®label1çš„content compression ä¸º1000[_label1 setContentCompressionResistancePriority:UILayoutPriorityRequired forAxis:UILayoutConstraintAxisHorizontal]; å±…ä¸­æ˜¾ç¤ºå››ä¸ªå…ƒç´ : 12345678910111213141516171819202122232425262728293031UIView __block *lastView = nil; MASConstraint __block *widthConstraint = nil; NSUInteger arrayCount = _imageViews.count; [_imageViews enumerateObjectsUsingBlock:^(UIView *view, NSUInteger idx, BOOL *stop) &#123; [view mas_makeConstraints:^(MASConstraintMaker *make) &#123; //å®½é«˜å›ºå®š widthConstraint = make.width.equalTo(@(imageViewSize.width)); make.height.equalTo(@(imageViewSize.height)); //å·¦è¾¹çº¦æŸ make.left.equalTo(lastView ? lastView.mas_right : view.superview.mas_left); //å‚ç›´ä¸­å¿ƒå¯¹é½ make.centerY.equalTo(view.superview.mas_centerY); //è®¾ç½®æœ€å³è¾¹çš„imageViewçš„å³è¾¹ä¸çˆ¶viewçš„æœ€æœ‰å¯¹é½ if (idx == arrayCount - 1) &#123; make.right.equalTo(view.superview.mas_right); &#125; [_widthConstraints addObject:widthConstraint]; lastView = view; &#125;]; &#125;]; ... // éšè—å…ƒç´ çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥æ¥ä¿®æ”¹çº¦æŸ if (sender.on) &#123; width.equalTo(@(IMAGE_SIZE)); &#125; else &#123; width.equalTo(@0); &#125; aè§†å›¾æ˜¯bè§†å›¾çš„å€æ•°å…³ç³»çš„ï¼š 1make.width.equalTo(_containerView.mas_width).multipliedBy(0.5); UITableViewCellé«˜åº¦çš„é—®é¢˜ï¼š é¦–å…ˆå¦‚æœæ˜¯åœ¨iOS8ä»¥åŠä»¥åçš„ç‰ˆæœ¬çš„è¯ï¼Œé‚£å°±ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜äº†ï¼Œç›´æ¥ä½¿ç”¨æ–°ç‰¹æ€§ 12345678910_tableView.estimatedRowHeight = 80.0f;...- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath &#123;#ifdef IOS_8_NEW_FEATURE_SELF_SIZING // iOS 8 çš„Self-sizingç‰¹æ€§ return UITableViewAutomaticDimension;&#125; å¦‚æœæ˜¯åœ¨æ—§ç‰ˆæœ¬iOS7ä¸Šçš„è¯: 123456789 // æ ¹æ®å½“å‰æ•°æ®ï¼Œè®¡ç®—Cellçš„é«˜åº¦ï¼Œæ³¨æ„+1dataEntity.cellHeight = [_templateCell.contentView systemLayoutSizeFittingSize:UILayoutFittingCompressedSize].height + 0.5f; // è®¡ç®—UILabelçš„preferredMaxLayoutWidthå€¼ï¼Œå¤šè¡Œæ—¶å¿…é¡»è®¾ç½®è¿™ä¸ªå€¼ï¼Œå¦åˆ™ç³»ç»Ÿæ— æ³•å†³å®šLabelçš„å®½åº¦ CGFloat preferredMaxWidth = [UIScreen mainScreen].bounds.size.width - 44 - 4 * 3; // 44 = avatarå®½åº¦ï¼Œ4 * 3ä¸ºpadding // Content - å¤šè¡Œ _contentLabel.preferredMaxLayoutWidth = preferredMaxWidth; // å¤šè¡Œæ—¶å¿…é¡»è®¾ç½® ä¸ºäº†é¿å…åœ¨è½¬å±çš„æ—¶å€™ï¼ŒHeaderã€Bottomå·®ä¸€æˆªçš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å¤´ï¼Œå°¾è§†å›¾ä¸éœ€è¦æ ¹æ®çˆ¶è§†å›¾æ¥è®¾å®šçº¦æŸï¼Œè€Œæ˜¯æ ¹æ®topLayoutGuideã€bottomLayoutGuideæ¥è®¾å®š: 12345678910 [_topView mas_updateConstraints:^(MASConstraintMaker *make) &#123; // ç›´æ¥åˆ©ç”¨å…¶lengthå±æ€§ï¼Œé¿å…iOSã€SDKç‰ˆæœ¬å‡çº§åtopLayoutGuideä¸å†æ˜¯UIView make.top.equalTo(self.view.mas_top).with.offset(self.topLayoutGuide.length);&#125;];// æ ¹æ®æ–°çš„lengthå€¼æ›´æ–°çº¦æŸ[_bottomView mas_updateConstraints:^(MASConstraintMaker *make) &#123; // ç›´æ¥åˆ©ç”¨å…¶lengthå±æ€§ï¼Œé¿å…iOSã€SDKç‰ˆæœ¬å‡çº§åtopLayoutGuideä¸å†æ˜¯UIView make.bottom.equalTo(self.view.mas_bottom).with.offset(-(self.bottomLayoutGuide.length));&#125;]; è‡ªå®šä¹‰baselineçš„å±æ€§å€¼ï¼š 1234 // è¿”å›è‡ªå®šä¹‰çš„baselineçš„view- (UIView *)viewForBaselineLayout &#123; return _baseView;&#125; å¯æ‹‰ä¼¸çš„UITableView 12345678910111213141516171819 _tableView.contentInset = UIEdgeInsetsMake(ParallaxHeaderHeight, 0, 0, 0); ... - (void)initView &#123; _parallaxHeaderView = [UIImageView new]; [self.view insertSubview:_parallaxHeaderView belowSubview:_tableView]; _parallaxHeaderView.contentMode = UIViewContentModeScaleAspectFill; _parallaxHeaderView.image = [UIImage imageNamed:@"parallax_header_back"]; [_parallaxHeaderView mas_makeConstraints:^(MASConstraintMaker *make) &#123; make.left.and.right.equalTo(self.view); make.top.equalTo(self.mas_topLayoutGuideBottom); _parallaxHeaderHeightConstraint = make.height.equalTo(@(ParallaxHeaderHeight)); &#125;]; // Add KVO [_tableView addObserver:self forKeyPath:@"contentOffset" options:NSKeyValueObservingOptionNew context:nil];&#125; KVOçš„å›è°ƒ 1234567891011// æ–¹æ³•2ï¼šåˆ©ç”¨KVO- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSString *,id&gt; *)change context:(void *)context &#123; if ([keyPath isEqualToString:@"contentOffset"]) &#123; CGPoint contentOffset = ((NSValue *)change[NSKeyValueChangeNewKey]).CGPointValue; if (contentOffset.y &lt; -ParallaxHeaderHeight) &#123; _parallaxHeaderHeightConstraint.equalTo(@(-contentOffset.y)); &#125; &#125;&#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Object-C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ Swift Tips]]></title>
    <url>%2F2017%2F09%2F01%2F20170901%2F</url>
    <content type="text"><![CDATA[onvcateçš„ã€ŠSwiftå¼€å‘è€…å¿…å¤‡çš„Tipsã€‹ä¹‹å‰åˆšå‡ºçš„æ—¶å€™ï¼Œæˆ‘å°±ç¿»é˜…è¿‡ï¼Œåæ¥Swiftçš„ç‰ˆæœ¬ä¸€ç›´åœ¨æ”¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—å»çœ‹äº†,ç°åœ¨Swiftçš„ABIåŸºæœ¬éƒ½ç¨³å®šäº†ï¼Œæˆ‘åœ¨å›é¡¾å¤ä¹ ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹è¦ç‚¹ï¼šåè®®ä¸­çš„read-onlyçš„å±æ€§å€¼ï¼š åœ¨protocolä¸­ç»™åœ¨æ–¹æ³•å‰é¢æ·»åŠ mutatingï¼Œå¯ä»¥ä¿®æ”¹Structã€Enumä¸­çš„å±æ€§å€¼, åœ¨Classä¸­æœ¬æ¥å°±å¯ä»¥ä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¿½è§†mutatingã€‚ é¦–å…ˆæˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹ï¼Œæ€ä¹ˆåœ¨protocolä¸­å®šä¹‰ä¸€ä¸ªåªè¯»çš„å±æ€§å€¼: 1234567891011121314protocol Vehicle &#123; var number: Int &#123; get &#125;&#125;struct MyCar: Vehicle &#123; var number: Int&#125;var car = MyCar(number: 3)car.numbercar.number = 10car.number å½“æˆ‘å†™å®Œè¿™æ®µä»£ç çš„æ—¶å€™ï¼Œæˆ‘å‘ç°ï¼Œæˆ‘å®šä¹‰çš„åªè¯»å±æ€§number,ä½†æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆï¼Ÿæˆ‘è¿˜å¯ä»¥è®¾ç½®å‘¢ï¼Ÿæˆ‘googleäº†ä¸€ä¸‹ï¼š[https://stackoverflow.com/questions/31358518/read-only-properties-of-protocols-in-swift] Thereâ€™s no way to specify in a protocol that you must have a read-only property. Your protocol asks for a car.number property, and allows but does not require a setter. è¿™é‡Œæˆ‘çš„ç†è§£å°±æ˜¯ï¼Œå½“ä½ å®ä¾‹åŒ–ä¸€ä¸ªcarçš„å¯¹è±¡ï¼Œå¹¶ä¸”è°ƒç”¨car.xxxæŸä¸ªå±æ€§å€¼çš„æ—¶å€™ï¼Œä½ å¹¶æ²¡æœ‰é™åˆ¶ä»–çš„xxxå±æ€§å€¼æ˜¯åªè¯»çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹carçš„é‚£è¡Œä»£ç ï¼š 1234567var car: Vehicle = MyCar(number: 3)car.numbercar.number = 10 // error: 'number' is a get-only propertycar.number é‚£ä¹ˆæˆ‘ç°åœ¨åœ¨åè®®ä¸­å®šä¹‰ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åšä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯ä¿®æ”¹åè®®é‡Œé¢çš„å˜é‡å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122protocol Vehicle &#123; var number: Int &#123; get &#125; mutating func changeNumber()&#125;struct MyCar: Vehicle &#123; var number: Int mutating func changeNumber() &#123; number = 99 &#125;&#125;var car: Vehicle = MyCar(number: 12)car.numbercar.changeNumber()car.number æƒŠå¥‡çš„å‘ç°ï¼Œå±…ç„¶å¯ä»¥ä¿®æ”¹è¿™ä¸ªåªè¯»çš„å±æ€§å€¼äº†ï¼Ÿï¼Ÿæˆ‘åˆæ‡µé€¼äº†ã€‚æŸ¥çœ‹äº†å®˜æ–¹çš„Demo[https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Protocols.html] è¿™é‡Œçš„å±æ€§å€¼æˆ‘åªæ˜¯ç®€å•çš„å®šä¹‰äº†ä¸‹ï¼Œæ²¡æœ‰é€šè¿‡computed valueæ¥å®šä¹‰å€¼ï¼ŒæŒ‰ç…§å®˜æ–¹çš„demoï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728protocol Vehicle &#123; var number: Int &#123; get &#125; mutating func changeNumber()&#125;struct MyCar: Vehicle &#123; var customInt: Int var number: Int &#123; get &#123; return customInt &#125; &#125; mutating func changeNumber() &#123;// number = 99 &#125;&#125;var car: Vehicle = MyCar(customInt: 12)car.numbercar.changeNumber()car.number è¿™æ ·ä¸€æ—¦æˆ‘è°ƒç”¨ChangeNumberçš„æ–¹æ³•çš„æ—¶å€™ï¼Œä½ å°±ä¼šå‘ç°æŠ¥é”™äº†ã€‚ ä¸‹é¢è¯´äº†for inçš„ä½¿ç”¨ï¼Œå¤§å®¶åº”è¯¥éƒ½çŸ¥é“ï¼Œfor inçš„å¾ªç¯ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨åœ¨é›†åˆç±»å‹çš„ä¸Šé¢ï¼Œä½†æ˜¯åœ¨swiftä¸­æˆ‘å…¶å®æ˜¯å¯ä»¥å°†for inç”¨åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹ä¸Šé¢ã€‚åœ¨Appleçš„å®˜æ–¹æ–‡æ¡£ä¸Šä¹Ÿç»™äº†ä¸€ä¸ªè¯´æ˜ï¼š[https://developer.apple.com/documentation/swift/iteratorprotocol] é¦–å…ˆèƒ½ä½¿ç”¨for inæ¥æšä¸¾çš„å¯¹è±¡ï¼Œå¿…é¡»éµå¾ªSequence,çœ‹é‡Œé¢çš„æºç ä¼šå‘ç°é‡Œé¢é™¤äº†å¾ˆå¤šçš„æ–¹æ³•å°±åªå‰©ä¸¤ä¸ªå±æ€§å€¼çš„è®¾ç½®ï¼š 123456789/// A type that provides the sequence's iteration interface and /// encapsulates its iteration state. associatedtype Iterator : IteratorProtocol /// A type that represents a subsequence of some of the sequence's elements. associatedtype SubSequence /// Returns an iterator over the elements of this sequence. public func makeIterator() -&gt; Self.Iterator æŒ‰ç…§å®˜æ–¹çš„æ„æ€ï¼Œæˆ‘ä»¬è¿™é‡Œå…¶ä»–ä¸éœ€è¦å»å®ç°ï¼Œè¿™é‡Œå°±å®ç°äº†ä¸€ä¸ªpublic func makeIterator() -&gt; Self.Iteratorè¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè€Œè¿™ä¸ªè¿­ä»£å™¨å¿…é¡»è¦å®ç°IteratorProtocolçš„åè®®ï¼š 12345678910111213141516171819202122232425262728293031323334public protocol IteratorProtocol &#123; /// The type of element traversed by the iterator. associatedtype Element /// Advances to the next element and returns it, or `nil` if no next element /// exists. /// /// Repeatedly calling this method returns, in order, all the elements of the /// underlying sequence. As soon as the sequence has run out of elements, all /// subsequent calls return `nil`. /// /// You must not call this method if any other copy of this iterator has been /// advanced with a call to its `next()` method. /// /// The following example shows how an iterator can be used explicitly to /// emulate a `for`-`in` loop. First, retrieve a sequence's iterator, and /// then call the iterator's `next()` method until it returns `nil`. /// /// let numbers = [2, 3, 5, 7] /// var numbersIterator = numbers.makeIterator() /// /// while let num = numbersIterator.next() &#123; /// print(num) /// &#125; /// // Prints "2" /// // Prints "3" /// // Prints "5" /// // Prints "7" /// /// - Returns: The next element in the underlying sequence, if a next element /// exists; otherwise, `nil`. public mutating func next() -&gt; Self.Element?&#125; ä¸Šé¢çš„æ³¨é‡Šä¹Ÿè¯´æ˜äº†ä¸€äº›ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨æ¨¡å¼ï¼Œä¸æ–­çš„è°ƒç”¨next()çš„æ–¹æ³•ï¼ŒçŸ¥é“è¿”å›nilï¼Œå®˜æ–¹çš„ä¾‹å­ä¸Šé¢æ²¡æœ‰ç”¨åˆ°Element,å°±åªæ˜¯å°†è¿”å›çš„ç±»å‹å®šä¹‰ä¸ºInt?,åªæ˜¯ç”¨äº†nextçš„æ–¹æ³•ï¼š å¹¶ä¸”ä¹‹å‰æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†CountdownIteratorçš„å®ä¾‹åŒ–æ–¹æ³•ï¼Œå°†è‡ªå·±è¿™ä¸ªç»“æ„ä½“ä¼ å…¥äº†è¿›å»,æ‰€ä»¥è¿™é‡Œå°±å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨å˜é‡countdown: 1234567891011121314151617181920212223242526272829303132333435struct Coundown: Sequence &#123; let start: Int func makeIterator() -&gt; CoundownIterator &#123; return CoundownIterator(self) &#125;&#125;struct CoundownIterator: IteratorProtocol &#123; let countdown: Coundown var times = 0 init(_ countdown: Coundown) &#123; self.countdown = countdown &#125; mutating func next() -&gt; Int? &#123; let nextNumber = countdown.start - times guard nextNumber &gt; 0 else &#123; return nil &#125; times += 1 return nextNumber &#125;&#125;let threeTwoOne = Coundown(start: 3)for count in threeTwoOne &#123; print("\(count)...")&#125; ä¸Šé¢çš„ä¾‹å­è¿˜æ˜¯é€šä¿—æ˜“æ‡‚çš„ï¼Œä½†æ˜¯å”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯æœ‰äº›å±æ€§æ²¡ç”¨ï¼Œå¯èƒ½ä»–è§‰å¾—æ²¡å¿…è¦å§ï¼Œçœ‹ä¸€ä¸‹onevcateçš„ä¾‹å­ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import UIKitstruct ReverseSequence&lt;T&gt;: Sequence &#123; var array: [T] init(array: [T]) &#123; self.array = array &#125; typealias Iterator = ReverseItrator&lt;T&gt; func makeIterator() -&gt; ReverseItrator&lt;T&gt; &#123; return ReverseItrator(array: self.array) &#125;&#125;struct ReverseItrator&lt;T&gt;: IteratorProtocol &#123; typealias Element = T var array: [Element] var currentIndex = 0 init(array: [T]) &#123; self.array = array currentIndex = array.count - 1 &#125; mutating func next() -&gt; T? &#123; if currentIndex &lt; 0 &#123; return nil &#125; else &#123; let element = self.array[currentIndex] currentIndex -= 1 return element &#125; &#125;&#125;let arr = [0,1,2,3,4]for i in ReverseSequence(array: arr) &#123; print("Index: \(i) is \(arr[i])")&#125; å…¶å®è¿™é‡Œä¼šå‘ç°typealias Iterator = ReverseItrator&lt;T&gt;, typealias Element = Tå†™äº†è¿™äº›ä¹‹åï¼Œç›¸åº”åè®®ä¸­çš„è¿”å›å€¼å°±æ˜¯è‡ªåŠ¨ç”Ÿæˆï¼Œä½†æ˜¯å¦‚æœä½ æƒ³ä»£ç ç®€æ´ï¼Œå…¶å®å¯ä»¥å¿½ç•¥è¿™äº›å±æ€§å€¼ï¼Œç›´æ¥è®¾ç½®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ YYText(ä¸€)]]></title>
    <url>%2F2017%2F08%2F30%2F20170830%2F</url>
    <content type="text"><![CDATA[YYç³»åˆ—çš„å¾ˆå¤šä»£ç éƒ½å†™çš„å¾ˆæ£’ï¼Œæœ€è¿‘å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥å†³å®šç”¨YYText,ç”¨ä¹‹å‰çœ‹äº†ä¸€ä¸‹é‡Œé¢çš„ä»£ç ï¼Œè§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹è¦å­¦ä¹ çš„ã€‚ä»£ç é‡éå¸¸å¤§ï¼Œæ‰€ä»¥å¯èƒ½è¦åˆ†å‡ ç¯‡åšå®¢åˆ†åˆ«å»å†™ï¼Œç®€å•çš„é€»è¾‘å°±ä¸å†™äº†ã€‚ çœ‹demoé‡Œé¢ï¼Œç¬¬ä¸€è¡Œçš„ä»£ç ï¼Œå…³äºçš„æµ‹è¯•éƒ¨åˆ†å°±å†™çš„å¾ˆç®€å•ï¼Œä½†æ˜¯æ·±ç©¶ä¸‹å»ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹çš„ï¼š 12// è¿™é‡Œçš„selfåªæ˜¯ä¸€ä¸ªä¼ å…¥çš„ViewControllerçš„å®ä¾‹[YYTextExampleHelper addDebugOptionToViewController:self]; è¿™é‡Œä¼ å…¥çš„vcåªæ˜¯ç”¨æ¥è®¾ç½®navigationItemçš„ï¼Œè¿™é‡Œæ˜¯è®¾ç½®çš„ä¸€ä¸ªUISwicherçš„UIæ§ä»¶ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ–¹æ³•ï¼š 123[switcher addBlockForControlEvents:UIControlEventValueChanged block:^(UISwitch *sender) &#123; [self setDebug:sender.isOn]; &#125;]; ä»”ç»†ä¸€çœ‹å°±ä¼šå‘ç°é—®é¢˜ï¼ŒUISwichçš„å®ä¾‹å˜é‡å¯ä»¥ç›´æ¥è°ƒç”¨addBlockForControlEventsçš„æ–¹æ³•ï¼Œä¼ å…¥äº†Eventå’Œblock: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758@implementation UIControl (YYAdd)...- (void)addBlockForControlEvents:(UIControlEvents)controlEvents block:(void (^)(id sender))block &#123; _YYUIControlBlockTarget *target = [[_YYUIControlBlockTarget alloc] initWithBlock:block events:controlEvents]; [self addTarget:target action:@selector(invoke:) forControlEvents:controlEvents]; NSMutableArray *targets = [self _yy_allUIControlBlockTargets]; [targets addObject:target];&#125;...- (NSMutableArray *)_yy_allUIControlBlockTargets &#123; NSMutableArray *targets = objc_getAssociatedObject(self, &amp;block_key); if (!targets) &#123; targets = [NSMutableArray array]; objc_setAssociatedObject(self, &amp;block_key, targets, OBJC_ASSOCIATION_RETAIN_NONATOMIC); &#125; return targets;&#125;...@interface _YYUIControlBlockTarget : NSObject@property (nonatomic, copy) void (^block)(id sender);@property (nonatomic, assign) UIControlEvents events;- (id)initWithBlock:(void (^)(id sender))block events:(UIControlEvents)events;- (void)invoke:(id)sender;@end@implementation _YYUIControlBlockTarget- (id)initWithBlock:(void (^)(id sender))block events:(UIControlEvents)events &#123; self = [super init]; if (self) &#123; _block = [block copy]; _events = events; &#125; return self;&#125;- (void)invoke:(id)sender &#123; if (_block) _block(sender);&#125;@end...@end è¿™é‡Œç‚¹åˆ°æºç é‡Œé¢å¯ä»¥çœ‹åˆ°ï¼ŒYYä½œè€…å†™äº†ä¸€ä¸ªUIControlçš„categoryï¼Œæ¥ä½œäº†æ‹“å±•ï¼Œæä¾›äº†addBlockForControlEventsè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸Šé¢å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ å‘ç°ä½œè€…æ‹¿åˆ°UIControlEventså’Œblockï¼Œç›´æ¥ç”Ÿæˆäº†ä¸€ä¸ª_YYUIControlBlockTargetå®ä¾‹ã€‚å‘ç°ç”Ÿæˆçš„è¿™ä¸ªå®ä¾‹ï¼Œä¹Ÿåšä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…ï¼Œå°±æ˜¯æŠŠblock copyä¿å­˜ä¸‹æ¥ï¼Œeventsä¹Ÿä¿å­˜ä¸‹æ¥ã€‚ ç„¶åå®ƒè¿˜æ˜¯è°ƒç”¨äº†ç³»ç»Ÿçš„addTarget:action:forControlEventsï¼Œç›´æ¥è°ƒç”¨invoke:çš„æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨äº†æˆ‘ä¼ å…¥è¿›æ¥çš„blockã€‚ ä¸‹é¢å¯ä»¥çœ‹åˆ°ä½œè€…é€šè¿‡runtimeç»™è¿™ä¸ªcategoryç”Ÿæˆäº†ä¸€ä¸ªNSMutableArryçš„å±æ€§å€¼ï¼Œå¹¶ä¸”æŠŠæˆ‘çš„targetå¯¹è±¡ä¿å­˜èµ·æ¥ã€‚ å…¶å®é€šè¿‡çœ‹æºç å°±å¯ä»¥å‘ç°ä½œè€…è¿™ä¹ˆå†™è¿™ä¸ªcategoryï¼Œå°±åšäº†ä¸¤ä»¶äº‹æƒ…ï¼Œç¬¬ä¸€å¯ä»¥ç”¨block, ç¬¬äºŒå¯ä»¥æ–¹ä¾¿ç›´æ¥removeæ‰ç›¸å…³å¯¹è±¡ä¸Šäº‹ä»¶ã€‚ åœ¨äº‹ä»¶æˆåŠŸè§¦å‘çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930+ (void)setDebug:(BOOL)debug &#123; YYTextDebugOption *debugOptions = [YYTextDebugOption new]; if (debug) &#123; debugOptions.baselineColor = [UIColor redColor]; debugOptions.CTFrameBorderColor = [UIColor redColor]; debugOptions.CTLineFillColor = [UIColor colorWithRed:0.000 green:0.463 blue:1.000 alpha:0.180]; debugOptions.CGGlyphBorderColor = [UIColor colorWithRed:1.000 green:0.524 blue:0.000 alpha:0.200]; &#125; else &#123; [debugOptions clear]; &#125; [YYTextDebugOption setSharedDebugOption:debugOptions]; DebugEnabled = debug;&#125;...@interface YYTextDebugOption : NSObject &lt;NSCopying&gt;/** Set a debug option as shared debug option. This method must be called on main thread. @discussion When call this method, the new option will set to all debug target which is added by `addDebugTarget:`. @param option A new debug option (nil is valid). */+ (void)setSharedDebugOption:(nullable YYTextDebugOption *)option;... åœ¨è¿™ä¸ªç±»æ–¹æ³•ä¸­ä¸»è¦æ¶‰åŠåˆ°çš„ä¸€ä¸ªå¯¹è±¡ä¸ºYYTextDebugOption,è¿™ä¸ªå¯¹è±¡åªæ˜¯ä¸€ä¸ªç»§æ‰¿è‡ªNSObjectçš„å¯¹è±¡ï¼Œè¿™é‡Œæ²¡æ¯›ç—…ã€‚ ç”Ÿæˆå®ä¾‹å¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸åŒçš„å€¼ï¼Œç„¶åè¿˜æ˜¯é€šè¿‡è‡ªå·±çš„ç±»æ–¹æ³•ï¼Œå°†ä¸Šé¢çš„ç”Ÿæˆçš„è¿™ä¸ªå¯¹è±¡é€šè¿‡å‚æ•°å‡ºå…¥è¿›å»ã€‚ åœ¨YYTextDebugOptioné‡Œé¢ï¼š 123456789101112131415161718192021222324252627...+ (void)setSharedDebugOption:(YYTextDebugOption *)option &#123; NSAssert([NSThread isMainThread], @"This method must be called on the main thread"); _setSharedDebugOption(option);&#125;...static void _setSharedDebugOption(YYTextDebugOption *option) &#123; _initSharedDebug(); pthread_mutex_lock(&amp;_sharedDebugLock); _sharedDebugOption = option.copy; CFSetApplyFunction(_sharedDebugTargets, _sharedDebugSetFunction, NULL); pthread_mutex_unlock(&amp;_sharedDebugLock);&#125;....static void _initSharedDebug() &#123; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; pthread_mutex_init(&amp;_sharedDebugLock, NULL); CFSetCallBacks callbacks = kCFTypeSetCallBacks; callbacks.retain = _sharedDebugSetRetain; callbacks.release = _sharedDebugSetRelease; _sharedDebugTargets = CFSetCreateMutable(CFAllocatorGetDefault(), 0, &amp;callbacks); &#125;);&#125; è¿™é‡Œé¦–é¡µç¡®ä¿äº†è®¾ç½®çš„çš„æ—¶å€™ï¼Œå¿…é¡»æ˜¯è¦ä¸»çº¿ç¨‹å»è°ƒç”¨ï¼Œå…¶å®è¿™é‡Œè¿™æ ·å†™ï¼Œå’Œåé¢é€šè¿‡é”æ¥å­˜å‚¨å¯¹è±¡æ•ˆæœæ˜¯ä¸€è‡´çš„ã€‚ è¿™é‡Œå‘ç°ä½œè€…éƒ½æ˜¯äº›çš„cå‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä¸å¤ªç¡®å®šï¼Œä¸ºä»€ä¹ˆä¸ç”¨ocå‘¢ï¼Ÿ è¿™é‡Œä½œè€…å†™äº†ä¸€ä¸ªå•ä¾‹ï¼Œå¹¶ä¸”åˆå§‹åŒ–äº†pthread_mutex_init(&amp;_sharedDebugLock, NULL);é”çš„å€¼ 12345678910111213//1ï¼špthread_mutex_init(pthread_mutex_t * mutex,const pthread_mutexattr_t *attr);åˆå§‹åŒ–é”å˜é‡mutexã€‚atträ¸ºé”å±æ€§ï¼ŒNULLå€¼ä¸ºé»˜è®¤å±æ€§ã€‚//2ï¼špthread_mutex_lock(pthread_mutex_t *mutex);åŠ é”//3ï¼špthread_mutex_tylock(pthread_mutex_t *mutex);åŠ é”ï¼Œä½†æ˜¯ä¸2ä¸ä¸€æ ·çš„æ˜¯å½“é”å·²ç»åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿”å›ä¸ºEBUSYï¼Œè€Œä¸æ˜¯æŒ‚èµ·ç­‰å¾…ã€‚//4ï¼špthread_mutex_unlock(pthread_mutex_t *mutex);é‡Šæ”¾é”//5ï¼špthread_mutex_destroy(pthread_mutex_t *mutex);ä½¿ç”¨å®Œåé‡Šæ”¾...__OSX_AVAILABLE_STARTING(__MAC_10_4, __IPHONE_2_0)int pthread_mutex_init(pthread_mutex_t * __restrict, const pthread_mutexattr_t * _Nullable __restrict);... çœ‹ä»£ç å¯ä»¥å‘ç°ï¼Œè¿™é‡Œéœ€è¦ä¼ å…¥ä¸¤ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªå€¼æ˜¯ç”¨æ¥è¡¨ç¤ºè¿™ä¸ªé”çš„æ ‡è®°ï¼ŒåŒæ ·ç¬¬äºŒåªé»˜è®¤ä¸ºNull 1234CFSetCallBacks callbacks = kCFTypeSetCallBacks; callbacks.retain = _sharedDebugSetRetain; callbacks.release = _sharedDebugSetRelease; _sharedDebugTargets = CFSetCreateMutable(CFAllocatorGetDefault(), 0, &amp;callbacks); è¿™é‡Œçš„å‡ è¡Œä»£ç ï¼Œå…¶å®æ˜¯é€šè¿‡cçš„æ–¹æ³•æ˜¯ï¼Œæ¥ç”Ÿæˆä¸€ä¸ªå®¹å™¨å±æ€§ï¼Œç±»ä¼¼NSArray,NSDictionary,NSSet,é€šè¿‡æºç å°±å¯ä»¥å‘ç°å…¶å®å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç»“æ„ä½“é‡Œé¢å®šä¹‰çš„å±æ€§å€¼ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦å®šä¹‰è¿™ä¸ªå®¹å™¨å˜é‡çš„å€¼ï¼Œå¯ä»¥çŒœå‡ºæ¥ï¼Œrelease/retainæ˜¯è®¾ç½®å¯¹è±¡çš„å†…å­˜ç®¡ç†çš„ï¼Œequal/hashæ˜¯å¯¹è±¡å­˜å‚¨çš„æ–¹å¼ï¼Œå½“ç„¶å•¦ï¼Œé€šè¿‡cç”Ÿæˆçš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è½¬åŒ–ä¸ºFoundationçš„å±æ€§å€¼,å¯ä»¥é€šè¿‡ç±»ä¼¼è¿™æ ·çš„æ–¹å¼æ¥ç”Ÿæˆreturn (NSMutableSet *)CFBridgingRelease(CFSetCreateMutable(0, 0, &amp;callbacks)); 12345678typedef struct &#123; CFIndex version; CFSetRetainCallBack retain; CFSetReleaseCallBack release; CFSetCopyDescriptionCallBack copyDescription; CFSetEqualCallBack equal; CFSetHashCallBack hash;&#125; CFSetCallBacks; é€šè¿‡ä»£ç å¯ä»¥çœ‹å‡ºæ¥ï¼Œå…¶å®ä½œè€…å°±æ˜¯æƒ³ä¿è¯ï¼Œå§‹ç»ˆåªæœ‰ä¸€ä¸ªYYTextDebugOption *optionçš„å­˜åœ¨ã€‚é€šè¿‡è·å–è¿™ä¸ªoptionçš„å€¼ï¼Œå°±çŸ¥é“ä½ çš„è®¾ç½®äº†ã€‚ å…³é”®è®¾ç½®Textçš„ç›¸å…³ä»£ç ï¼š 1234567891011121314NSMutableAttributedString *text = [NSMutableAttributedString new]; &#123; NSMutableAttributedString *one = [[NSMutableAttributedString alloc] initWithString:@"Shadow"]; one.yy_font = [UIFont boldSystemFontOfSize:30]; one.yy_color = [UIColor whiteColor]; YYTextShadow *shadow = [YYTextShadow new]; shadow.color = [UIColor colorWithWhite:0.000 alpha:0.490]; shadow.offset = CGSizeMake(0, 1); shadow.radius = 5; one.yy_textShadow = shadow; [text appendAttributedString:one]; [text appendAttributedString:[self padding]]; &#125; è¿™é‡Œè®¾ç½®yy_fontã€yy_colorçš„æ—¶å€™ï¼Œç”¨æ³•å’Œæˆ‘ä»¬ä¹‹å‰è®¾ç½®labelçš„å±æ€§è®¾ç½®ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œç‚¹è¿›å»å¯ä»¥å‘ç°ï¼Œè¿™é‡Œæ˜¯å› ä¸ºä½œè€…å†™äº†ä¸€ä¸ªNSMutableAttributedStringçš„ä¸€ä¸ªcategoryï¼Œå’Œä¹‹å‰çš„åšæ³•ä¸€æ ·,åœ¨setterå€¼çš„æ—¶å€™ï¼Œä½œè€…è¦†å†™äº†setterçš„å€¼æ–¹æ³•ï¼Œç»Ÿä¸€éƒ½è°ƒç”¨äº†ä¸€ä¸ªåŒä¸€ä¸ªçš„æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031...- (void)yy_setFont:(UIFont *)font range:(NSRange)range &#123; /* In iOS7 and later, UIFont is toll-free bridged to CTFontRef, although Apple does not mention it in documentation. In iOS6, UIFont is a wrapper for CTFontRef, so CoreText can alse use UIfont, but UILabel/UITextView cannot use CTFontRef. We use UIFont for both CoreText and UIKit. */ [self yy_setAttribute:NSFontAttributeName value:font range:range];&#125;...- (void)yy_setColor:(UIColor *)color range:(NSRange)range &#123; [self yy_setAttribute:(id)kCTForegroundColorAttributeName value:(id)color.CGColor range:range]; [self yy_setAttribute:NSForegroundColorAttributeName value:color range:range];&#125;...- (void)yy_setAttribute:(NSString *)name value:(id)value range:(NSRange)range &#123; if (!name || [NSNull isEqual:name]) return; if (value &amp;&amp; ![NSNull isEqual:value]) [self addAttribute:name value:value range:range]; else [self removeAttribute:name range:range];&#125;... è¿™é‡Œå…¶å®å·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œæ‰€æœ‰çš„è®¾ç½®å±æ€§çš„æ—¶å€™ï¼Œéƒ½æ˜¯è°ƒç”¨çš„è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨è¿™ä¸ªå€¼ï¼Œå°±è®¾ç½®ä¸Šå»ï¼Œæ²¡æœ‰ï¼Œå°±å»é™¤æ‰ã€‚ è¿™é‡Œåœ¨è®¾ç½®é¢œè‰²çš„æ—¶å€™ï¼Œè¿ç€è®¾ç½®äº†ä¸¤ä¸ªå±æ€§ï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹ï¼Œä½†æ˜¯ç½‘ä¸Šéƒ½æ²¡æœ‰è¯´çš„å¾ˆæ¸…æ¥šï¼Œåº”è¯¥æ˜¯å°±æ˜¯ä¸ºäº†æŸäº›ç‰ˆæœ¬çš„å…¼å®¹é—®é¢˜çš„å§ï¼Œçœ‹ä¸€ä¸‹mattå¤§ç¥çš„è§£é‡Šå§ï¼š [https://github.com/TTTAttributedLabel/TTTAttributedLabel/pull/416] Unfortunately, this patch appears to actually degrade support for iOS 8, as NS text attributes do not seem to apply in Core Text rendering for whatever reason. As inconvenient as they are, everything works in iOS 4 â€“ 8 if kCT. Am I missing something? This feels like more of a â€œif it ainâ€™t broke, donâ€™t fix itâ€ type of situationâ€¦ å…³é”®è¿™é‡Œçš„shadowè®©äººçœ‹çš„å¾ˆæ‡µé€¼ï¼Œå› ä¸ºçœ‹ä»£ç å°±å¯ä»¥çŸ¥é“ï¼Œä½œè€…è¿™é‡Œè‡ªå®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿äº†NSObjectçš„Shadowå¯¹è±¡YYTextShadow *shadow = [YYTextShadow new];,åŒæ ·å®ƒå’Œè®¾ç½®fontï¼Œcolorä¸€æ ·ï¼Œéƒ½æ˜¯æœ€ç»ˆè°ƒç”¨åˆ°äº†- (void)yy_setAttribute:(NSString *)name value:(id)value range:(NSRange)range {},å‰é¢æˆ‘å¥½ç†è§£ï¼Œä»–éƒ½æ˜¯è®¾ç½®çš„ç³»ç»Ÿçš„è®¾ç½®ï¼Œæ‰€ä»¥ä½ ä¸ç®¡è®¾ç½®fontï¼Œcolorå…¶å®æœ€ç»ˆéƒ½æ˜¯èµ°åˆ°ç³»ç»Ÿçš„è®¾ç½®ä¸Šå»äº†ï¼Œä½†æ˜¯è¿™é‡Œè®¾ç½®çš„å¯¹è±¡ï¼Œkeyéƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼Œè¿™é‡Œç³»ç»Ÿæ˜¯æ€ä¹ˆè®¤è¯†çš„å‘¢ï¼Ÿå¼€å§‹çœ‹åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæˆ‘å°±æœ‰ç‚¹ä¸æ˜¯å¾ˆç†è§£äº†ï¼Œä½†æ˜¯å½“æˆ‘çœ‹åˆ°ä¸‹é¢çš„æ—¶å€™æˆ‘å°±æ˜ç™½äº†ã€‚ 12345678910YYLabel *label = [YYLabel new]; label.attributedText = text; label.width = self.view.width; label.height = self.view.height - (kiOS7Later ? 64 : 44); label.top = (kiOS7Later ? 64 : 0); label.textAlignment = NSTextAlignmentCenter; label.textVerticalAlignment = YYTextVerticalAlignmentCenter; label.numberOfLines = 0; label.backgroundColor = [UIColor colorWithWhite:0.933 alpha:1.000]; [self.view addSubview:label]; é¦–å…ˆè¿™é‡Œå®šä¹‰ä¸€ä¸ªæ–°çš„å±æ€§å€¼ï¼Œå«åšYYLabel,ç‚¹è¿›å»å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªYYLabelçš„å¯¹è±¡ç»§æ‰¿çš„æ˜¯UIViewçš„,è¿™é‡Œä½œè€…è¦åšçš„åº”è¯¥å°±æ˜¯å†™ä¸€ä¸ªå˜åŒ–çš„UILabel: 12345678910111213141516/** The YYLabel class implements a read-only text view. @discussion The API and behavior is similar to UILabel, but provides more features: * It supports asynchronous layout and rendering (to avoid blocking UI thread). * It extends the CoreText attributes to support more text effects. * It allows to add UIImage, UIView and CALayer as text attachments. * It allows to add 'highlight' link to some range of text to allow user interact with. * It allows to add container path and exclusion paths to control text container's shape. * It supports vertical form layout to display CJK text. See NSAttributedString+YYText.h for more convenience methods to set the attributes. See YYTextAttribute.h and YYTextLayout.h for more information. */@interface YYLabel : UIView &lt;NSCoding&gt; å¯ä»¥çœ‹åˆ°YYLabelé™¤äº†UILabelæä¾›çš„é‚£äº›ä¸œè¥¿å¤–ï¼Œæˆ‘ä»¬è¿˜æä¾›å¾ˆå¤šç‰›é€¼çš„åŠŸèƒ½ï¼Œè¿™äº›åŠ¨èƒ½çš„å®ç°ï¼Œæˆ‘è¿˜æ²¡æœ‰çœ‹ï¼Œå…ˆæ¥çœ‹çœ‹ä¹‹å‰æˆ‘ä»¬è®¾ç½®çš„NSMutableAttributedStringæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„ï¼Ÿ åœ¨ç¬¬äºŒè¡Œä»£ç ï¼Œæˆ‘ä»¬ç›´æ¥å°†æˆ‘ä»¬å‰é¢è®¾ç½®çš„textå±æ€§å€¼è¿›è¡Œè®¾å®šlabel.attributedText = text;: 123456789101112131415161718192021222324252627282930- (void)setAttributedText:(NSAttributedString *)attributedText &#123; if (attributedText.length &gt; 0) &#123; _innerText = attributedText.mutableCopy; switch (_lineBreakMode) &#123; case NSLineBreakByWordWrapping: case NSLineBreakByCharWrapping: case NSLineBreakByClipping: &#123; _innerText.yy_lineBreakMode = _lineBreakMode; &#125; break; case NSLineBreakByTruncatingHead: case NSLineBreakByTruncatingTail: case NSLineBreakByTruncatingMiddle: &#123; _innerText.yy_lineBreakMode = NSLineBreakByWordWrapping; &#125; break; default: break; &#125; &#125; else &#123; _innerText = [NSMutableAttributedString new]; &#125; [_textParser parseText:_innerText selectedRange:NULL]; if (!_ignoreCommonProperties) &#123; if (_displaysAsynchronously &amp;&amp; _clearContentsBeforeAsynchronouslyDisplay) &#123; [self _clearContents]; &#125; [self _updateOuterTextProperties]; [self _setLayoutNeedUpdate]; [self _endTouch]; [self invalidateIntrinsicContentSize]; &#125;&#125; è¿™é‡Œçš„ä»£ç åº”è¯¥å°±æ˜¯è§£ææˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„NSAttributedStringå±æ€§ã€‚ æŒ‰ç…§ä»£ç ï¼Œå…ˆåˆ¤æ–­_lineBreakModeï¼Œç„¶åç»™NSAttributedStringè®¾ç½®yy_lineBreakModeçš„å€¼ã€‚ [_textParser parseText:_innerText selectedRange:NULL];è¿™ä¸ªæ˜¯ä¸€ä¸ªä»£ç†æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ç°åœ¨æˆ‘è¿™é‡Œçš„_textParseræ˜¯nil,é‚£ä¹Ÿå°±ä¸ä¼šè°ƒç”¨è¿™ä¸ªä»£ç†æ–¹æ³•ï¼Œä»å‡½æ•°åå­—ä¸Šå¯ä»¥çŸ¥é“ï¼Œè¿™é‡Œçš„å‡½æ•°ä¸»è¦åšçš„ä¸Šå°±æ˜¯å»è§£ææŸä¸ªTextã€‚ è°ƒç”¨[self _updateOuterTextProperties]; 1234567891011121314151617181920- (void)_updateOuterTextProperties &#123; _text = [_innerText yy_plainTextForRange:NSMakeRange(0, _innerText.length)]; _font = _innerText.yy_font; if (!_font) _font = [self _defaultFont]; _textColor = _innerText.yy_color; if (!_textColor) _textColor = [UIColor blackColor]; _textAlignment = _innerText.yy_alignment; _lineBreakMode = _innerText.yy_lineBreakMode; NSShadow *shadow = _innerText.yy_shadow; _shadowColor = shadow.shadowColor;#if !TARGET_INTERFACE_BUILDER _shadowOffset = shadow.shadowOffset;#else _shadowOffset = CGPointMake(shadow.shadowOffset.width, shadow.shadowOffset.height);#endif _shadowBlurRadius = shadow.shadowBlurRadius; _attributedText = _innerText; [self _updateOuterLineBreakMode];&#125; ä»ä¸Šé¢çš„ä»£ç çš„é€»è¾‘ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯è®²æˆ‘ä»¬å‰é¢ä¼ å…¥è¿›æ¥çš„NSAttributedStringä¸€ä¸ªä¸ªå–å‡ºæ¥ - (NSString *)yy_plainTextForRange:(NSRange)range {}è¿™ä¸ªå‡½æ•°çš„ä¸»è¦æ˜¯ä»NSAttributedStringä¸­å–å‡ºTextçš„å€¼ï¼Œå¤åˆ¶ç»™ä¸€ä¸ªå…¨å±€çš„textçš„å€¼ï¼Œçœ‹ä¸€ä¸‹è¿™é‡Œçš„å®ç°ï¼š 123456789101112131415- (NSString *)yy_plainTextForRange:(NSRange)range &#123; if (range.location == NSNotFound ||range.length == NSNotFound) return nil; NSMutableString *result = [NSMutableString string]; if (range.length == 0) return result; NSString *string = self.string; [self enumerateAttribute:YYTextBackedStringAttributeName inRange:range options:kNilOptions usingBlock:^(id value, NSRange range, BOOL *stop) &#123; YYTextBackedString *backed = value; if (backed &amp;&amp; backed.string) &#123; [result appendString:backed.string]; &#125; else &#123; [result appendString:[string substringWithRange:range]]; &#125; &#125;]; return result;&#125; è¿™é‡Œä»–æšä¸¾äº†NSAttributedStringçš„å±æ€§å€¼ï¼Œå¦‚æœå‰é¢è®¾ç½®è¿‡YYTextBackedStringAttributeName,è¿™é‡Œå®ƒä¼šè¿›è¡Œæ‹¼æ¥ï¼Œä½†æ˜¯æˆ‘ä»¬å‰é¢æ²¡æœ‰è®¾ç½®è¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæšä¸¾å‡ºçš„value = nilã€‚å¯ä»¥é€šè¿‡è¿™é‡Œçš„æšä¸¾æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æšä¸¾å‡ºæˆ‘ä»¬æƒ³è¦attributeå€¼ï¼Œå¹¶è¿›è¡Œä¿®æ”¹ï¼š 123456789101112131415161718NSMutableAttributedString *res = [self.richTextEditor.attributedText mutableCopy];[res beginEditing];__block BOOL found = NO;[res enumerateAttribute:NSFontAttributeName inRange:NSMakeRange(0, res.length) options:0 usingBlock:^(id value, NSRange range, BOOL *stop) &#123; if (value) &#123; UIFont *oldFont = (UIFont *)value; UIFont *newFont = [oldFont fontWithSize:oldFont.pointSize * 2]; [res removeAttribute:NSFontAttributeName range:range]; [res addAttribute:NSFontAttributeName value:newFont range:range]; found = YES; &#125;&#125;];if (!found) &#123; // No font was found - do something else?&#125;[res endEditing];self.richTextEditor.attributedText = res; ä¸‹é¢å°±æ˜¯ç®€å•çš„å¯¹å…¨å±€çš„å€¼è¿›è¡Œèµ‹å€¼,çœ‹åˆ°è¿™é‡Œï¼Œå°±å¯ä»¥ç¨å¾®æ˜ç™½äº†ä¹‹å‰çš„è‡ªå®šä¹‰è®¾ç½®Shadowçš„é—®é¢˜äº†ï¼šNSShadow *shadow = _innerText.yy_shadow;,ç„¶åå°†shadowçš„å€¼è¿›è¡Œèµ‹å€¼ï¼š 12345678 _shadowColor = shadow.shadowColor;#if !TARGET_INTERFACE_BUILDER _shadowOffset = shadow.shadowOffset;#else _shadowOffset = CGPointMake(shadow.shadowOffset.width, shadow.shadowOffset.height);#endif _shadowBlurRadius = shadow.shadowBlurRadius; æœ€ååˆè®¾ç½®äº†ä¸€ä¸‹- (void)_updateOuterLineBreakMode {}ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718- (void)_updateOuterLineBreakMode &#123; if (_innerContainer.truncationType) &#123; switch (_innerContainer.truncationType) &#123; case YYTextTruncationTypeStart: &#123; _lineBreakMode = NSLineBreakByTruncatingHead; &#125; break; case YYTextTruncationTypeEnd: &#123; _lineBreakMode = NSLineBreakByTruncatingTail; &#125; break; case YYTextTruncationTypeMiddle: &#123; _lineBreakMode = NSLineBreakByTruncatingMiddle; &#125; break; default:break; &#125; &#125; else &#123; _lineBreakMode = _innerText.yy_lineBreakMode; &#125;&#125; è¿™é‡Œåˆè®¾è®¡åˆ°äº†ä¸€ä¸‹æ–°çš„å¯¹è±¡YYTextContainer *_innerContainer;,è¿™é‡Œæˆ‘ç›®å‰æ²¡ç”¨åˆ°è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥æš‚ä¸”å…ˆå¿½ç•¥å®ƒã€‚ ä¸‹é¢è°ƒç”¨äº†æ–°çš„æ–¹æ³•- (void)_setLayoutNeedUpdate {},è¿™ä¸ªæ–¹æ³•è®¾ç½®äº†ä¸€ä¸ªå±æ€§å€¼ï¼Œç„¶åè°ƒç”¨- (void)_clearInnerLayout {}ç”±äºè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰è®¾ç½®å€¼ï¼Œæ‰€ä»¥ç›´æ¥returnæ‰äº†ï¼Œæœ€åè°ƒç”¨äº†ä¸€ä¸‹[self.layer setNeedsDisplay]; åœ¨æœ€åçš„æœ€åè°ƒç”¨äº†[self invalidateIntrinsicContentSize];,è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æˆ‘ä¹‹å‰ä¹Ÿæ²¡æœ‰ç”¨è¿‡ï¼Œä½†æ˜¯çœ‹è§£é‡Šåº”è¯¥å¯ä»¥çŒœå‡ºä¸€éƒ¨åˆ†ï¼š call this when something changes that affects the intrinsicContentSize. Otherwise UIKit wonâ€™t notice that it changed.æˆ‘çš„çŒœæµ‹æ˜¯å½“çˆ¶è§†å›¾çš„å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥é€šçŸ¥å­è§†å›¾ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚ åˆ°ç›®å‰ä¸ºæ­¢å¤–é¢åªäº†è§£å®Œäº†æœ€æœ€åŸºç¡€çš„é‚£ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè®¾ç½®shadowï¼Œtextcolorï¼Œfontï¼Œè¶³ä»¥çœ‹å‡ºè¿™ä¸ªyyTextçš„å¼ºå¤§äº†ã€‚ ç½‘ä¸Šæ‰¾äº†äº›èµ„æ–™ï¼Œå¤§éƒ¨åˆ†éƒ½æ²¡æœ‰è¯´æ¸…æ¥šï¼Œèƒ½è¯´æ¸…æ¥šä¸‹é¢ä¸¤ç¯‡æ–‡ç« ï¼šå¯ä»¥çœ‹çœ‹ : [http://www.jianshu.com/p/f0c33d6c39bb, http://blog.csdn.net/wypblog/article/details/7264315]]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Core Dataçš„è¿ç§»å’Œåˆå¹¶(äº”)]]></title>
    <url>%2F2017%2F08%2F22%2F20170822%2F</url>
    <content type="text"><![CDATA[è®°å¾—åœ¨ä¸¤å¹´å‰æˆ‘å»é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å…³äºCore dataçš„é—®é¢˜ï¼Œä»–ä»¬å¤§éƒ½åªä¼šé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½å¤Ÿç­”å‡ºæ¥ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä½¿ç”¨è¿‡Core Dataï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼šâ€œå¦‚ä½•è¿ç§»Core Dataçš„æ•°æ®åº“â€ï¼Ÿå› ä¸ºè°éƒ½æ— æ³•é¢„æ–™ä¸šåŠ¡çš„å‘å±•ï¼Œä»¥åŠæ•°æ®åº“çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ã€‚è¿™é‡Œé‡ç‚¹åˆ—ä¸¾å‡ ä¸ªCore Dataæ•°æ®åº“è¿ç§»çš„é—®é¢˜ï¼š é¦–å…ˆè¦è¯´ä¸€ä¸‹ï¼Œå¦‚æœä½ çš„Appï¼Œåªæ˜¯ç¼“å­˜ä¸€äº›ç¦»çº¿æ•°æ®çš„è¯ï¼Œå°±æ²¡å¿…è¦è€ƒè™‘ä»€ä¹ˆæ•°æ®åº“è¿ç§»äº†ï¼Œå› ä¸ºä½ åªéœ€è¦åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œåˆ é™¤ä¹‹å‰çš„core dataæ•°æ®ï¼Œæ–°å»ºä¸€ä¸ªå°±å¯ä»¥äº† åªæ˜¯åœ¨åŸæœ‰çš„Entityä¸­æ·»åŠ å‡ ä¸ªå­—æ®µ,æ­¥éª¤å¦‚ä¸‹ï¼š ç‚¹å‡»Editor-&gt;Add Model Version. å‘½åæ–°ç‰ˆæœ¬çš„æ–‡å­—å°±å•¥ï¼šxxx v2. å¦‚æœä½ æœ‰å¤šä¸ªCore Dataçš„é¡¹ç›®ï¼Œéœ€è¦å‹¾é€‰ä½ æƒ³è¦ä¿®æ”¹çš„Core Dataé¡¹ç›®çš„åå­—. ç‚¹å‡»åˆ›å»ºå®Œæˆ. ç‚¹å‡»File Inspector,åœ¨Model Versionä¸­å‹¾é€‰ä½ åˆšæ‰åˆ›å»ºçš„æ–°çš„Model. æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥å‹¾é€‰è¿›æˆ‘ä»¬æ–°å»ºçš„Core Data Entityçš„å­—æ®µåˆ›å»ºè¡¨ä¸­å»ï¼Œåˆ›å»ºä½ æƒ³è¦ä¿®æ”¹çš„å­—æ®µ. æ­¤æ—¶ä½ å°±å¯ä»¥å»æƒ³è¦çš„xxx.swiftçš„Model Template çš„æ–‡ä»¶ä¸­å»æ·»åŠ å­—æ®µäº†ï¼Œä¾‹å¦‚ï¼š@NSManaged var image: UIImage? æ­¤æ—¶ä½ å°±å¯ä»¥åƒä½¿ç”¨å…¶ä»–å­—æ®µä¸€æ ·ä½¿ç”¨ä½ æ–°å»ºçš„å­—æ®µäº†ï¼Œä¾‹å¦‚ä¸Šé¢çš„imagexxx.image = xxx åœ¨åŸæœ‰çš„Entityä¸­åˆ é™¤å­—æ®µï¼Œå¹¶ä¸”åˆ›å»ºæ–°çš„RelationShipå…³è”åˆ°æ–°çš„Entityå¯¹è±¡ï¼š å‰é¢çš„1-5çš„æ“ä½œéƒ½æ˜¯ä¸€æ ·çš„. ç‚¹å‡»Core Dataæ¥åˆ›å»ºæ–°å»ºçš„ä¸€ä¸ªEntity,å¹¶ä¸”è®¾ç½®ç›¸åº”çš„å­—æ®µ(è¿™é‡Œè®¾ç½®Module ä¸ºé¡¹ç›®çš„åå­—). ç„¶åä»æˆ‘ä»¬æ–°å»ºçš„Entityä¸­å»ºç«‹æ–°çš„è”ç³»å»å…³è”åˆ°æˆ‘ä»¬ä¹‹å‰çš„Entity(é€šè¿‡è®¾ç½®destinationæ¥è®¾ç½®å…³è”). å¹¶ä¸”å›åˆ°ä¹‹å‰çš„Entityä¸­ï¼Œåˆ é™¤æˆ–è€…ä¿®æ”¹æˆ‘ä»¬æƒ³è¦çš„ä¿®æ”¹çš„å­—æ®µ. å¹¶ä¸”åœ¨ä¹‹å‰çš„Entityä¸­ï¼Œå»ºç«‹è”ç³»ï¼Œå…³è”åˆ°ä¹‹å‰æ–°å»ºçš„Entity(è¿™é‡Œéœ€è¦è®¾ç½®destinationä¸ºæ–°å»ºçš„Entityï¼Œå¹¶ä¸”è®¾ç½®inverse). æ­¤æ—¶å·²ç»å¯ä»¥å¼€å§‹å‡†å¤‡åˆå¹¶äº†ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦åšäº›ä¿®æ”¹ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œç±»åå’Œæˆ‘ä»¬æ–°å»ºçš„Entityçš„åå­—ä¸€æ ·ï¼Œå¹¶ä¸”åœ¨é‡Œé¢åˆ›å»ºæˆ‘ä»¬æ–°å»ºçš„å­—æ®µ. ä¿®æ”¹ä¹‹å‰Entityå¯¹åº”çš„Swiftç±»ä¸­ï¼Œå¢åˆ ä¿®æ”¹å­—æ®µ. ä¸‹é¢æ˜¯æœ€æœ€é‡è¦çš„ä¸€æ­¥ï¼šå»ºç«‹model æ˜ å°„ï¼š åœ¨New/Fileä¸­é€‰æ‹©Mapping Model,é€‰æ‹©ä½ ä¿®æ”¹çš„åŸºå‡†çš„Entityä¸ºSource, é€‰æ‹©æœ€æ–°çš„Entityä¸ºTarger Modelï¼Œåå­—ç±»ä¼¼ä¸ºï¼šUnCloudNotesMappingModel_v2_to_v3 åœ¨è¿™ä¸ªæ–°å»ºçš„æ˜ å°„çš„æ–‡ä»¶ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¦‚æœæ˜¯ä¹‹å‰å°±å­˜åœ¨Entityçš„è¯ï¼Œé‚£ä¹ˆçš„å®ƒçš„å€¼Value Expression= $source.xxxï¼Œå¯ä»¥çœ‹å‡ºæ¥è¿™æ ·çš„æ•°æ®æ˜¯æ²¡æœ‰å‘ç”Ÿæ”¹å˜çš„.(è¿™é‡Œçš„sourceå°±æ˜¯æˆ‘ä»¬å¼€å§‹åˆ›å»ºè¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™é€‰æ‹©çš„sourceæ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼šv3é‡Œé¢xxå­—æ®µçš„å€¼ï¼Œç›´æ¥å°±æ˜¯å–è‡ªv2å­—æ®µçš„åŒæ ·çš„å€¼). åˆšä¸‹å·²ç»è¯´äº†éœ€è¦æ–°å»ºçš„ä¸€ä¸ªEntityå»ºç«‹å…³è”ï¼Œé‚£ä¹ˆå¿…ç„¶åœ¨è¿™ä¸ªRelationShipä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰æ–°å»ºå¥½çš„Relationshipçš„å­—æ®µï¼Œä½†æ˜¯åœ¨Value Expressionä¸­å‘ç°xcodeå¹¶æ²¡æœ‰ç»™æˆ‘ä»¬å¡«å…¥ä»€ä¹ˆå€¼ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œä¸ºè¿™ä¸ªå€¼ï¼Œå…³è”çš„æ˜¯æˆ‘ä»¬æ–°å»ºEntityå€¼ï¼Œå½“ç„¶ä¹‹å‰çš„Sourceä¸çŸ¥é“å•¦ï¼ï¼æ‰€ä»¥ä½ ç°åœ¨è¦åšçš„å°±æ˜¯åˆ é™¤è¿™æ®µå…³è”ï¼Œå› ä¸ºæ—¢ç„¶æ˜¯å…³è”ï¼Œæˆ‘å¯ä»¥ä»aå¯¹è±¡å…³è”bå¯¹è±¡ï¼Œé‚£æˆ‘åŒæ ·å¯ä»¥ä»bå¯¹è±¡å…³è”åˆ°aå¯¹è±¡ å‹¾é€‰æ–°å»ºçš„Entityå¯¹è±¡ï¼Œå‘ç°æ­¤æ—¶çš„xodeæ²¡æœ‰ç»™æˆ‘ä»¬å‹¾é€‰Sourceï¼Œè¿™é‡Œçš„ç†è§£ä¸ºï¼šé»˜è®¤è¿™ä¸ªæ–°å»ºçš„Entityçš„å€¼ï¼Œæ‰€æœ‰çš„å€¼ï¼Œéƒ½æ˜¯æˆ‘ä»¬è‡ªå·±æ–°å»ºï¼Œä¸éœ€è¦ä»ä¹‹å‰çš„Entityä¸­è·å–å€¼,ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸€æ—¦å‹¾é€‰äº†sourceï¼Œä¸ºæŸä¸ªå¯¹è±¡çš„è¯ï¼Œxocdeä¼šè‡ªåŠ¨å»æ›´åŠ å­—ç¬¦åˆ›å»åŒ¹é…ï¼Œè·å–ç›¸åº”çš„å€¼ï¼Œé€‰æ‹©äº†sourceä¹‹åï¼Œå¯¹åº”çš„åå­—ä¹Ÿä»xxxæ”¹ä¸ºyyyToxxx. é€šè¿‡ä¹‹å‰çš„ç†è§£æˆ‘ä»¬å…¶å®å¯ä»¥ç†è§£ä¸ºï¼Œæ¯ä¸€ä¸ªnoteéƒ½ä¼šå…³è”attachment,ä½†æ˜¯è¿™é‡Œæˆ‘ä¹Ÿå¯ä»¥åšä¸€ä¸‹è¿‡æ»¤ï¼Œå¦‚æœattachmenté‡Œçš„image != nil,æ‰å°†æ•°æ®è¿›è¡Œå…³è”. ä¹‹å‰xcodeä¸ºæˆ‘ä»¬åˆ›å»ºçš„Relationshipï¼Œç”±äºé‡Œé¢çš„value expressionæ˜¯æˆ‘ä»¬æ–°å»ºçš„Entity,æ‰€ä»¥æˆ‘ä»¬å°†ä¹‹å‰çš„RelationShipåˆ é™¤æ‰ï¼Œç„¶åä¸ºæ–°å»ºçš„Entityæ–°å»ºä¸€ä¸ªrelationshipå…³è”åˆ°ä¹‹å‰çš„æ—§Entity,å¹¶ä¸”è®¾ç½®Mapping Name,è¿™é‡Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°†value expressionå€¼å¡«ä¸Šruntimeçš„å‡½æ•° æœ€åè®¾ç½®ä¸¤ä¸ªå±æ€§ï¼š 12description.shouldMigrateStoreAutomatically = truedescription.shouldInferMappingModelAutomatically = false åˆ é™¤å¯¹è±¡çš„å­—æ®µï¼Œå¹¶ä¸”å»ºç«‹ä¸€ä¸ªæ–°çš„Entity,é‡Œé¢åŒ…å«äº†å…¶ä»–æ–°å»ºçš„å­—æ®µ,æ˜¯å¹¶ä¸”è¿™ä¸ªEntityæ˜¯ä¹‹å‰æŸä¸ªEntityçš„å­ç±». å‰é¢çš„1-5çš„æ“ä½œéƒ½æ˜¯ä¸€æ ·çš„. ç‚¹å‡»Core Dataæ¥åˆ›å»ºæ–°å»ºçš„ä¸€ä¸ªEntity,å¹¶ä¸”è®¾ç½®ç›¸åº”çš„å­—æ®µ(è¿™é‡Œè®¾ç½®Module ä¸ºé¡¹ç›®çš„åå­—). è®¾ç½®æ–°å»ºEntityçš„Parent Entity,å¹¶ä¸”ä¹Ÿå¯ä»¥è®¾ç½®ç›¸åº”çš„è‡ªå®šä¹‰å­—æ®µ. ä¹‹åæ–°å»ºæˆ‘ä»¬æ–°å»º(EntityName).swiftï¼Œæ ¹æ®æ–°å»ºçš„å­—æ®µç±»å‹ï¼Œå®šä¹‰å­—æ®µï¼Œæ­¤æ—¶å¯ä»¥åŒæ ·è¡¨æ˜ç»§æ‰¿å…³ç³»class ImageAttachment:Attachment {} è™½ç„¶è¿™é‡Œåˆ›å»ºäº†æˆ‘ä»¬æƒ³è¦çš„Entityä»¥åŠå­—æ®µï¼Œä½†æ˜¯ä¹‹å‰çš„æ—§modelå¦‚ä½•ä½œè½¬åŒ–å‘¢ï¼Ÿè¿™é‡Œå°±åŒæ ·éœ€è¦æ˜ å°„ï¼Œå› æ­¤è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Mapping Model:UnCloudNotesMappingModel_v3_to_v4. è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ›´åŠ éœ€è¦ï¼Œå¦‚æœæ–°å»ºçš„Entityçš„å­—æ®µç›´æ¥æ¥è‡ªäºä¹‹å‰çš„æŸä¸ªModelçš„è¯ï¼Œæˆ‘å°±å¯ä»¥å°†è¿™ä¸ªModelè®¾ç½®ä¸ºSourceï¼Œä½†æ˜¯å¦‚æœæœ‰äº›å­—æ®µæ²¡æœ‰ï¼Œæˆ–è€…ä¸æ˜¯ç›´æ¥å¯ä»¥è·å–åˆ°çš„è¯ï¼Œæˆ–è€…éœ€è¦ä»ä¸åŒçš„å­—æ®µä¸­è¿›è¡Œä¸€å®šçš„é€»è¾‘æ‰èƒ½å¤Ÿèµ‹å€¼çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œå°±éœ€è¦è‡ªå®šä¹‰NSEntityMigrationPolicy,è¿™é‡Œæˆ‘ä»¬æ–°å»ºçš„å­ç±»å¯¹è±¡ï¼Œå¹¶ä¸”å°†Modelçš„Custom Policyè®¾ç½®ä¸ºæˆ‘ä»¬æ–°å»ºçš„å­ç±»çš„è¯ï¼Œç³»ç»Ÿåœ¨è½½å…¥çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œæ¯”è¾ƒï¼Œå‡å¦‚ä½ ç°åœ¨çš„Core Dataçš„ç‰ˆæœ¬ç¡®å®éœ€è¦æ›´æ–°çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªç±». 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475class AttachmentToImageAttachmentMigrationPolicyV3toV4: NSEntityMigrationPolicy &#123; override func createDestinationInstances(forSource sInstance: NSManagedObject, in mapping: NSEntityMapping, manager: NSMigrationManager) throws &#123; //1.è¿™é‡Œä¼šå­˜åœ¨ä¸¤ä¸ªcontextï¼Œä¸€ä¸ªè¯»å…¥çš„source contextï¼Œä¸€ä¸ªå†™å…¥destinationContext.è¿™é‡Œå½“ç„¶éœ€è¦è¯»å…¥çš„æœ€ç»ˆçš„è¿™ä¸ªcontext let description = NSEntityDescription.entity(forEntityName: "ImageAttachment", in: manager.destinationContext) let newAttachment = ImageAttachment(entity: description!, insertInto: manager.destinationContext) //2. å°†å±æ€§è¿›è¡Œè¿­ä»£ func traversePropertyMappings(block: (NSPropertyMapping, String) -&gt; ()) throws &#123; if let attributeMappings = mapping.attributeMappings &#123; for propertyMapping in attributeMappings &#123; if let destinationName = propertyMapping.name &#123; block(propertyMapping, destinationName) &#125; else &#123; //3.å¦‚æœè¿™ä¸ªå¯¹è±¡ï¼Œè¿ç›¸åº”çš„å±æ€§å€¼éƒ½ä¸èƒ½åæ‚”çš„è¯ï¼Œé‚£å°±ä»£è¡¨è‚¯å®šæœ‰é—®é¢˜çš„ï¼Œéœ€è¦æŠ›å‡ºé—®é¢˜. let message = "Attribute destination not configured properly" let userInfo = [NSLocalizedFailureReasonErrorKey: message] throw NSError(domain: errorDomain, code: 0, userInfo: userInfo) &#125; &#125; &#125; else &#123; let message = "No Attribute Mappings found" let userInfo = [NSLocalizedFailureReasonErrorKey: message] throw NSError(domain: errorDomain, code: 0, userInfo: userInfo) &#125; &#125; // 4. è¿™ä¸€æ­¥æŒ‰ç…§æ˜ å°„å…³ç³»ï¼Œåº”è¯¥æ˜¯ä¸€ä¸€å¯¹è±¡è¿›è¡Œèµ‹å€¼çš„ try traversePropertyMappings &#123; propertyMapping, destinationName in guard let valueExpression = propertyMapping.valueExpression else &#123; return &#125; let context: NSMutableDictionary = ["source": sInstance] guard let desinationValue = valueExpression.expressionValue(with: sInstance, context: context) else &#123; return &#125; newAttachment.setValue(desinationValue, forKey: destinationName) &#125; // 5. æ¥ä¸‹æ¥çš„æ•°æ®ï¼Œä½ å¯ä»¥è¿›è¡Œè®¡ç®—ï¼Œæˆ–è€…ä»å…¶ä»–Entityä¸­è·å–å€¼ if let image = sInstance.value(forKey: "image") as? UIImage &#123; newAttachment.setValue(image.size.width, forKey: "width") newAttachment.setValue(image.size.height, forKey: "height") &#125; // 6. let body = sInstance.value(forKeyPath: "note.body") as? NSString ?? "" newAttachment.setValue(body.substring(to: 80), forKey: "caption") // 7. ä¸‹é¢éœ€è¦å°†æ–°å»ºçš„Entityä¸source objectã€mapping ä¹‹é—´å»ºç«‹è”ç³»ï¼Œå¦‚æœåœ¨è¿ç§»æ•°æ®æ¥å—çš„æ—¶å€™ï¼Œæ­¤å‡½æ•°è°ƒç”¨å¤±è´¥çš„è¯ï¼Œæ•°æ®ä¼šä¸¢å¤±. manager.associate(sourceInstance: sInstance, withDestinationInstance: newAttachment, for: mapping) &#125;&#125; ä¹‹å‰æ‰€è®²çš„éƒ½æ˜¯ä»v1-&gt;v2,ä»v2-&gt;v3,ä»v3-&gt;v4ï¼Œä½†æ˜¯è¿™å…¶å®æ˜¯æœ€æœ€ç®€å•çš„æƒ…å†µï¼Œä½†äº‹å®æƒ…å†µä¼šæ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºä½ æ°¸è¿œä¸çŸ¥é“ç”¨æˆ·æ­¤æ—¶æ˜¯ä»€ä¹ˆç‰ˆæœ¬å·ï¼Ÿä»–ä»¬å¯ä»¥ä»v1-&gt;v4,ä¹Ÿå¯ä»¥ä»v2-&gt;v4ï¼Œé‚£ä¹ˆè¿™æ ·ä¸€æ¥å°±ä¼šæ¯”è¾ƒå¤æ‚äº†.æ­¤æ—¶æˆ‘ä»¬è¿™é‡Œå°±éœ€è¦è¿›è¡Œè‡ªå®šä¹‰æ•°æ®åˆå¹¶äº†. æˆ‘ä»¬è¦åšçš„äº‹æƒ…ï¼Œæ˜¯è¿›è¡Œæ¯”è¾ƒï¼Œè¦å…ˆä»bundleä¸­è¯»å–æ–‡ä»¶åï¼Œç„¶åæˆ‘ä»¬ä»æ–‡ä»¶åä¸­è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªbundleæ˜¯æ•°æ®v2ã€v3è¿˜æ˜¯v1. 123456789101112131415161718192021extension NSManagedObjectModel &#123; private class func modelURLs( in modelFolder: String) -&gt; [URL] &#123; return Bundle.main .urls(forResourcesWithExtension: "mom", subdirectory: "\(modelFolder).momd") ?? [] &#125; class func modelVersionsFor( modelNamed modelName: String) -&gt; [NSManagedObjectModel] &#123; return modelURLs(in: modelName) .flatMap(NSManagedObjectModel.init) &#125; class func uncloudNotesModel( named modelName: String) -&gt; NSManagedObjectModel &#123; let model = modelURLs(in: "UnCloudNotesDataModel") .filter &#123; $0.lastPathComponent == "\(modelName).mom" &#125; .first .flatMap(NSManagedObjectModel.init) return model ?? NSManagedObjectModel() &#125;&#125; ç‰ˆæœ¬å·ä¹‹å‰çš„åˆ¤æ–­ï¼š 1234567891011121314151617181920212223242526272829class var version1: NSManagedObjectModel &#123; return uncloudNotesModel(named: "UnCloudNotesDataModel") &#125; var isVersion1: Bool &#123; return self == type(of: self).version1 &#125; class var version2: NSManagedObjectModel &#123; return uncloudNotesModel(named: "UnCloudNotesDataModel v2") &#125; var isVersion2: Bool &#123; return self == type(of: self).version2 &#125; class var version3: NSManagedObjectModel &#123; return uncloudNotesModel(named: "UnCloudNotesDataModel v3") &#125; var isVersion3: Bool &#123; return self == type(of: self).version3 &#125; class var version4: NSManagedObjectModel &#123; return uncloudNotesModel(named: "UnCloudNotesDataModel v4") &#125; var isVersion4: Bool &#123; return self == type(of: self).version4 &#125; å•¥æ—¶å€™è¿›è¡Œæ•°æ®è¿ç§»å‘¢ï¼Ÿ 123456789101112131415161718192021222324252627282930var stack: CoreDataStack &#123; guard enableMigrations, !store(at: storeURL, isCompatibleWithModel: currentModel) else &#123; return CoreDataStack(modelName: modelName) &#125; performMigration() return CoreDataStack(modelName: modelName)&#125;// é€šè¿‡è·å–å…ƒæ•°æ®ï¼Œå¹¶ä¸”è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœéœ€è¦æ›´æ–°çš„è¯ï¼Œå°±ä¼šå°†æ•°æ®è¿”å› private func store(at storeURL: URL, isCompatibleWithModel model: NSManagedObjectModel) -&gt; Bool &#123; let storeMetadata = metadataForStoreAtURL(storeURL: storeURL) return model.isConfiguration(withName: nil, compatibleWithStoreMetadata:storeMetadata) &#125; private func metadataForStoreAtURL(storeURL: URL) -&gt; [String: Any] &#123; let metadata: [String: Any] do &#123; metadata = try NSPersistentStoreCoordinator .metadataForPersistentStore(ofType: NSSQLiteStoreType, at: storeURL, options: nil) &#125; catch &#123; metadata = [:] print("Error retrieving metadata for store at URL:\(storeURL): \(error)") &#125; return metadata &#125; æ•°æ®å¦‚ä½•è¿›è¡Œåˆå¹¶å‘¢ï¼Ÿ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960private func migrateStoreAt(URL storeURL: URL, fromModel from:NSManagedObjectModel, toModel to:NSManagedObjectModel, mappingModel:NSMappingModel? = nil) &#123; // 1.åˆ›å»ºmigration managerçš„å®ä¾‹å¯¹è±¡ let migrationManager = NSMigrationManager(sourceModel: from, destinationModel: to) // 2.å¦‚æœåœ¨æ–¹æ³•ä¸­ä¼ é€’mapping modelçš„å¯¹è±¡çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒï¼Œå¦åˆ™æˆ‘ä»¬å°±åˆ›å»ºå®ƒ. var migrationMappingModel: NSMappingModel if let mappingModel = mappingModel &#123; migrationMappingModel = mappingModel &#125; else &#123; migrationMappingModel = try! NSMappingModel .inferredMappingModel( forSourceModel: from, destinationModel: to) &#125; // 3 let targetURL = storeURL.deletingLastPathComponent() let destinationName = storeURL.lastPathComponent + "~1" let destinationURL = targetURL .appendingPathComponent(destinationName) print("From Model: \(from.entityVersionHashesByName)") print("To Model: \(to.entityVersionHashesByName)") print("Migrating store \(storeURL) to \(destinationURL)") print("Mapping model: \(String(describing: mappingModel))") // 4 let success: Bool do &#123; try migrationManager.migrateStore(from: storeURL, sourceType:NSSQLiteStoreType, options:nil, with:migrationMappingModel, toDestinationURL:destinationURL, destinationType:NSSQLiteStoreType, destinationOptions:nil) success = true &#125; catch &#123; success = false print("Migration failed: \(error)") &#125; // 5 if success &#123; print("Migration Completed Successfully") let fileManager = FileManager.default do &#123; try fileManager.removeItem(at: storeURL) try fileManager.moveItem(at: destinationURL, to: storeURL) &#125; catch &#123; print("Error migrating \(error)") &#125; &#125; &#125; å¦‚ä½•ä¸€æ­¥æ­¥çš„åˆå¹¶æ•°æ®ï¼Œè¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œä»è€Œæ—¶é—´ä¸€æ­¥æ­¥çš„åˆå¹¶æ•°æ®ï¼š 1234567891011121314151617181920212223242526272829303132333435363738func performMigration() &#123; if !currentModel.isVersion4 &#123; fatalError("Can only handle migrations to version 4!") &#125; if let storeModel = self.storeModel &#123; if storeModel.isVersion1 &#123; let destinationModel = NSManagedObjectModel.version2 migrateStoreAt(URL: storeURL, fromModel: storeModel, toModel: destinationModel) performMigration() &#125; else if storeModel.isVersion2 &#123; let destinationModel = NSManagedObjectModel.version3 let mappingModel = NSMappingModel(from: nil, forSourceModel: storeModel, destinationModel: destinationModel) migrateStoreAt(URL: storeURL, fromModel: storeModel, toModel: destinationModel, mappingModel: mappingModel) performMigration() &#125; else if storeModel.isVersion3 &#123; let destinationModel = NSManagedObjectModel.version4 let mappingModel = NSMappingModel(from: nil, forSourceModel: storeModel, destinationModel: destinationModel) migrateStoreAt(URL: storeURL, fromModel: storeModel, toModel: destinationModel, mappingModel: mappingModel) &#125; &#125; &#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Core Data, Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ NSFetchedResultsController, è·å–æ•°æ®éƒ¨åˆ†(äº”)]]></title>
    <url>%2F2017%2F08%2F21%2F20170821%2F</url>
    <content type="text"><![CDATA[ä¸Šä¸€å‘¨ä¸€ç›´åœ¨å¿™ç€å†™é¡¹ç›®ï¼Œä¹¦è™½ç„¶çœ‹å®Œäº†ï¼Œä½†æ˜¯è¿˜æ˜¯æƒ³å†™å†™ç¬”è®°ï¼ŒåŠ æ·±ä¸€ä¸‹è®°å¿†ï¼Œåœ¨ç¬¬å››ç« çš„æ—¶å€™ï¼Œå…¶å®é€šè¿‡NSFetchRequesä¸€äº›å€¼çš„ä¿®æ”¹ï¼Œå…¶å®æˆ‘ä»¬å·²ç»å¯ä»¥å¼€å§‹æ­£å¸¸çš„ä½¿ç”¨core data, å¹¶ä¸”å¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„æ„æ„¿æ¥è¿‡æ»¤æ•°æ®ï¼Œå¹¶ä¸”è¿›è¡Œæ’åºã€‚è¿™ä¸€ç« é‡ç‚¹è®²çš„æ˜¯NSFetchedResultsControllerã€‚ ä»€ä¹ˆæ˜¯NSFetchedResultsController? å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ å…¶å®æ“ä½œCore Data,æˆ‘ä»¬åšçš„æœ€å¤šçš„æ“ä½œå…¶å®å°±æ˜¯ï¼Œä»Core Dataä¸­è·å–æ•°æ®ï¼Œç„¶åæ”¾å…¥åˆ°Arrayä¸­ï¼Œç„¶åè®¾ç½®DataSourceï¼Œç„¶ååˆ·æ–°TableView, Appleå°±æ˜¯ä¸ºäº†è§£å†³è¿™ç§éº»çƒ¦ï¼Œæ‰€ä»¥æ‰äº§ç”Ÿäº†NSFetchedResultsControllerï¼Œä½†æ˜¯NSFetchedResultsControllerä¸åŒäºå…¶ä»–çš„ViewController,å› ä¸ºå®ƒæ˜¯æ²¡æœ‰ç•Œé¢çš„ï¼Œä»–ä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†å¼‚æ­¥è·å–çš„æ•°æ®ç”¨çš„ã€‚è¯´ç™½äº†ï¼ŒNSFetchedResultsControllerå…¶å®å°±æ˜¯NSFetchRequest Resultæ•°æ®çš„å°è£…ã€‚ä»ç»§æ‰¿å…³ç³»ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼š 123open class NSFetchedResultsController&lt;ResultType&gt; : NSObject where ResultType : NSFetchRequestResult &#123;&#125;class ViewController: UIViewController &#123;&#125; å’ŒNSFetchRequestå¾ˆç”¨æ³•å¾ˆç±»ä¼¼çš„ï¼š 123456789101112131415161718// 1let fetchRequest: NSFetchRequest&lt;Team&gt; = Team.fetchRequest()let sort = NSSortDescriptor(key: #keyPath(Team.teamName), ascending: true)fetchRequest.sortDescriptors = [sort]// 2fetchedResultsController = NSFetchedResultsController( fetchRequest: fetchRequest, managedObjectContext: coreDataStack.managedContext, sectionNameKeyPath: nil, cacheName: nil)// 3do &#123; try fetchedResultsController.performFetch()&#125; catch let error as NSError &#123; print("Fetching error: \(error), \(error.userInfo)")&#125; NSFetchedResultsControllerä¸»è¦æ˜¯ä¸ºäº†åè°ƒCore Dataå’ŒTableView,ä½†æ˜¯ä»ç„¶éœ€è¦ä¼ é€’NSFetchRequest, è®°ä½NSFetchRequestæ˜¯å¯ä»¥é«˜åº¦è‡ªå®šä¹‰çš„ï¼Œå¯ä»¥ä¼ é€’descriptiors/ predicate å®ä¾‹åŒ–NSFetchedResultsControlleréœ€è¦å››ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯NSManagedObjectContextï¼Œéœ€è¦è¿™ä¸ªmanagedContextæ¥è¿›è¡Œæœç´¢ ,å‰©ä¸‹çš„sectionNameKeyPath,cacheName NSFetchedResultsControlleré‡Œé¢å¿…é¡»è‡³å°‘è¦æœ‰ä¸€ä¸ªsort descriptorå¦åˆ™ä¼šç›´æ¥crash å¦‚ä½•è·å–æ•°æ®12345678910111213func numberOfSections(in tableView: UITableView) -&gt; Int &#123; guard let sections = fetchedResultsController.sections else &#123;return 0 &#125; return sections.count&#125;func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int)-&gt; Int &#123; guard let sectionInfo = fetchedResultsController.sections?[section] else &#123;return 0 &#125; return sectionInfo.numberOfObjects&#125; é€šè¿‡è°ƒç”¨sectionsçš„å±æ€§ï¼Œè¿”å›çš„æ•°ç»„ä¸­ï¼ŒåŒ…å«çš„Objectä¸­ï¼Œéƒ½éµå¾ªäº†NSFetchedResultsSectionInfoçš„åè®®ï¼Œè¿™ä¸ªè½»é‡çº§çš„åè®®ï¼Œèƒ½å¤Ÿè°ƒç”¨title/number å¦‚æœè·å–ç›¸åº”çš„å¯¹è±¡å‘¢ï¼Ÿ 1let team = fetchedResultsController.object(at: indexPath) å¦‚ä½•æ›´æ”¹æ•°æ®123let team = fetchedResultsController.object(at: indexPath) team.wins = team.wins + 1 coreDataStack.saveContext() å¦‚ä½•å°†æ•°æ®åˆ†ç»„ å¯ä»¥æ ¹æ®æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„Entityå¯¹è±¡ä¸­çš„å­—æ®µï¼Œä»»æ„è¿›è¡Œåˆ†ç»„ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„Entityä¸­å­˜åœ¨ä¸€ä¸ªåä¸ºqualifyingZoneçš„Stringçš„å­—æ®µ,æ¥è¿›è¡Œåˆ†ç»„ï¼Œåªéœ€è¦å¦‚ä¸‹çš„ä¿®æ”¹ï¼š 12345fetchedResultsController = NSFetchedResultsController( fetchRequest: fetchRequest, managedObjectContext: coreDataStack.managedContext, sectionNameKeyPath: #keyPath(Team.qualifyingZone), cacheName: nil) è¿™é‡Œæˆ‘ä»¬åªæ˜¯ä¼ å…¥äº†ä¸€ä¸ª#keyPath(),æ ¹æ®ä¹‹å‰çš„çŸ¥è¯†ï¼Œè¿™ä¸ªå­—æ®µçš„æ„æ€ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå»å¯»æ‰¾Teamä¸‹é¢çš„qualifyingZoneã€‚ è¿™ä¸ªå­—æ®µåˆæ˜¯å¦‚ä½•åˆ†ç»„çš„å‘¢ï¼Ÿé¦–å…ˆå®ƒæ˜¯å…ˆè®²è¿™äº›æœ€ä¸ºKeyçš„å­—æ®µæ”¾åœ¨ä¸€ä¸ªSectionä¸­ï¼ˆæ•°ç»„ä¸­ï¼‰ï¼Œç„¶ååœ¨å›æ›´åŠ æ¯ä¸ªä¸åŒçš„å­—æ®µå»ç”Ÿæˆä¸åŒçš„æ•°æ®ã€‚ é€šè¿‡#keyPath,å¯ä»¥æ·±å…¥åˆ°Core Dataä¸­çš„relationshipæ¥æŸ¥è¯¢å±æ€§å€¼ è™½ç„¶å½“æ—¶sectionNameKeyPathä½†æ˜¯å‘ç°ï¼Œæ•°æ®çš„æ’åºè¿˜æ˜¯æ›´åŠ é¦–å­—æ¯çš„ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘æ²¡æœ‰è®¾ç½®NSSortDescriptorï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š 1234567let zoneSort = NSSortDescriptor( key: #keyPath(Team.qualifyingZone), ascending: true)let scoreSort = NSSortDescriptor( key: #keyPath(Team.wins), ascending: false)let nameSort = NSSortDescriptor( key: #keyPath(Team.teamName), ascending: true)fetchRequest.sortDescriptors = [zoneSort, scoreSort, nameSort] æ ¹æ®æ•°ç»„çš„æ’åºï¼Œå…ˆæ ¹æ®Team.qualifyingZoneæ’åºï¼Œç„¶åæ ¹æ®Team.winsæ’åºï¼Œæœ€åæ ¹æ®Team.teamNameæ¥æ’åºã€‚ ç¼“å­˜æ•°æ®12345fetchedResultsController = NSFetchedResultsController( fetchRequest: fetchRequest, managedObjectContext: coreDataStack.managedContext, sectionNameKeyPath: #keyPath(Team.qualifyingZone), cacheName: "worldCup") æ•°æ®åˆ†ç±»æ˜¯å¾ˆè€—æ€§èƒ½ï¼Œé¿å…æ¯æ¬¡éƒ½å»åˆ†ç±»æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ç¼“å­˜ï¼Œå¦‚ä½•é€šè¿‡ç¼“å­˜å‘¢ï¼Ÿ ç›´æ¥æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²çš„keyï¼Œè¿™æ ·å°±å¯ä»¥å°†æ•°æ®ç¼“å­˜åˆ°ç£ç›˜ä¸­å»äº†ã€‚ ç›‘å¬æ•°æ®å˜åŒ– NSFetchedResultsControllerå¯ä»¥ç›‘å¬æ•°æ®é›†çš„å˜åŒ–ï¼Œå¹¶ä¸”é€šçŸ¥ä»–çš„ä»£ç†ï¼Œé€šè¿‡å®ç°ä»£ç†æ–¹æ³•ï¼Œå¯ä»¥åšå“åº”çš„æ“ä½œã€‚ è¿™é‡Œä»£ç†çš„è§¦å‘è¿˜æ˜¯éœ€è¦é€šè¿‡è®¾ç½®NSManagedObjectContext,å¦‚æœåœ¨é¡¹ç›®ä¸­å­˜åœ¨å¤šä¸ªManaged Object Contextçš„è¯ï¼Œé‚£ä¹ˆä»£ç†çš„æ–¹æ³•æ˜¯ä¸ä¼šè§¦å‘çš„ï¼Œé™¤éæˆ‘ä»¬ä¿å­˜æ•°æ®ï¼Œå¹¶ä¸”åˆå¹¶context 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// MARK: - NSFetchedResultsControllerDelegateextension ViewController: NSFetchedResultsControllerDelegate &#123; func controllerWillChangeContent(_ controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;) &#123; tableView.beginUpdates() &#125; func controller(_ controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;, didChange anObject: Any, at indexPath: IndexPath?, for type: NSFetchedResultsChangeType, newIndexPath: IndexPath?) &#123; switch type &#123; case .insert: tableView.insertRows(at: [newIndexPath!], with: .automatic) case .delete: tableView.deleteRows(at: [indexPath!], with: .automatic) case .update: let cell = tableView.cellForRow(at: indexPath!) as! TeamCell configure(cell: cell, for: indexPath!) case .move: tableView.deleteRows(at: [indexPath!], with: .automatic) tableView.insertRows(at: [newIndexPath!], with: .automatic) &#125; &#125; func controller(_ controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;, didChange sectionInfo: NSFetchedResultsSectionInfo, atSectionIndex sectionIndex: Int, for type: NSFetchedResultsChangeType) &#123; let indexSet = IndexSet(integer: sectionIndex) switch type &#123; case .insert: tableView.insertSections(indexSet, with: .automatic) case .delete: tableView.deleteSections(indexSet, with: .automatic) default: break &#125; &#125; func controllerDidChangeContent(_ controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;) &#123; tableView.endUpdates() &#125;&#125; æ·»åŠ Entity123456let team = Team( context: self.coreDataStack.managedContext) team.teamName = nameTextField.text team.qualifyingZone = zoneTextField.text team.imageName = "wenderland-flag" self.coreDataStack.saveContext()]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Core Data, Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ CoreData, è·å–æ•°æ®éƒ¨åˆ†(å››)]]></title>
    <url>%2F2017%2F08%2F10%2F20170810%2F</url>
    <content type="text"><![CDATA[å‰é¢ä¸‰ç« éƒ½æ˜¯ä¸€äº›å¾ˆåŸºç¡€çš„æ“ä½œä»¥åŠæ¦‚å¿µï¼Œä¹‹å‰æˆ‘ä»¬å–æ•°æ®ï¼Œç”¨çš„æœ€å¤šçš„ä¹Ÿå°±æ˜¯ä½¿ç”¨NSFetchRequestä¸­çš„NSPredicate,æˆ‘ä»¬é€šè¿‡ä¿®æ”¹ç›¸åº”çš„NSPredicateå€¼æ¥è·å–åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚æ‰€æœ‰è¿™ä¸€ç« ä¸»è¦è®²è§£çš„æ˜¯è·å–æ•°æ®çš„ç›¸å…³æ“ä½œä»¥åŠæŠ€å·§ã€‚ ä¹‹å‰ç”¨åˆ°çš„æ“ä½œæ˜¯ï¼šåˆ›å»ºä¸€ä¸ªNSFetchRequestçš„å®ä¾‹ï¼Œç„¶åé€šè¿‡NSManagedObjectContextè¿™ä¸ªå¯¹è±¡æ¥ç›´æ¥ä¿®æ”¹NSFetchRequestå°±å¯ä»¥å®ç°äº†ã€‚ ä»…ä»…è·å–NSFetchRequestçš„æ–¹æ³•å°±æœ‰5ç§: 12345678910111213141516171819202122232425262728293031// 1:é€šè¿‡æœ€æ™®é€šçš„NSFetchRequest&lt;Venue&gt;()çš„æ–¹æ³•æ¥å®ä¾‹åŒ–NSFetchRequestçš„å¯¹è±¡ï¼Œç´§æ¥ç€å¿…é¡»ä½¿ç”¨NSEntityDescriptionæ¥è·å–ç›¸åº”çš„Entityå¯¹è±¡ï¼Œç„¶åç›´æ¥é€šè¿‡set entityçš„å€¼ã€‚let fetchRequest1 = NSFetchRequest&lt;Venue&gt;()let entity = NSEntityDescription.entity(forEntityName: "Venue", in: managedContext)!fetchRequest1.entity = entity// 2:è¿™é‡Œç›´æ¥é€šè¿‡NSFetchRequestçš„å®ä¾‹åŒ–æ–¹æ³•ä¼ å…¥entityNameå€¼ï¼Œç›´æ¥å°†ä¸Šé¢çš„æ­¥éª¤çœç•¥äº†ï¼Œé¿å…ä½¿ç”¨NSEntityDescriptionçš„å¯¹è±¡ã€‚let fetchRequest2 = NSFetchRequest&lt;Venue&gt;(entityName: "Venue")// 3: è¿™ä¸ªåˆåœ¨ç¬¬äºŒéƒ¨çš„ä¸Šé¢åšå‡ºäº†ç›¸åº”çš„çœç•¥ï¼Œå½“ä½ ç”ŸæˆNSManagedObject subclass çš„å¯¹è±¡ï¼ŒåŒæ—¶ä½ è¿™ä¸ªå¯¹è±¡ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªç±»æ–¹æ³•ï¼Œç›´æ¥è¿”å›NSFetchRequestï¼Œé€šè¿‡è¿™æ ·èƒ½å¤Ÿç›´æ¥ä¸ç›¸åº”çš„Entityäº§ç”Ÿè”ç³»ã€‚let fetchRequest3: NSFetchRequest&lt;Venue&gt; = Venue.fetchRequest()// 4: åœ¨ä¸‰ç« é‡Œåˆ†æmanagedObjectModelå°±è¯´è¿‡ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥é€šè¿‡managedObjectModelæ¥è·å–NSFetchRequestã€‚è¿™é‡Œåœ¨xCodeå›æœ‰ä¸ªå¯è§†åŒ–çš„æ“ä½œï¼Œå°±æ˜¯å¯ä»¥æ·»åŠ Requestçš„æ“ä½œã€‚let fetchRequest4 = managedObjectModel.fetchRequestTemplate(forName: "venueFR")// 5: è¿™é‡Œç¬¬äº”ä¸ªæ–¹æ³•å…¶å®ä¸ç¬¬å››ä¸ªå¾ˆç›¸è¿‘çš„ï¼Œéƒ½æ˜¯é€šè¿‡managedObjectModelæ¥è·å–NSFetchRequestï¼Œä¸åŒçš„æ˜¯è¿™é‡Œå¤šç©¿äº†ä¸€ä¸ªsubstitutionVariablesï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨åœ¨predicateä¸­çš„ï¼Œä»è€Œè¿›ä¸€æ­¥æ¥è·å–ä½ æƒ³è¦çš„å€¼ã€‚let fetchRequest5 = managedObjectModel.fetchRequestFromTemplate( withName: "venueFR", substitutionVariables: ["NAME" : "Vivi Bubble Tea"]) å…¶å®NSFetchRequestæ˜¯ä¸€ä¸ªå¾ˆæ™®é€šçš„ç±»ï¼Œä½†æ˜¯å¦‚æœä½ ä»”ç»†ç ”ç©¶ä¸€ä¸‹NSFetchRequestçš„å®ä¾‹åŒ–ï¼Œä½ å°±ä¼šå‘ç°&lt;ResultType : NSFetchRequestResult&gt;è¿™ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨å°±æ˜¯å‡†å¤‡å…·ä½“è¯´æ˜äº†ä½ æƒ³è¦è·å–æ•°æ®çš„æ ¼å¼:ä¾‹å¦‚ä¹‹å‰ä½ è·å–çš„æ˜¯[Venue]è€Œä¸æ˜¯[AnyObject]ã€‚ ç‚¹å‡»xxx.xcdatamodeld,å¹¶ä¸”é•¿æŒ‰Add Entity,é€‰æ‹©Add Fetch Requestï¼Œè¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªNSFetchRequestçš„å¯¹è±¡ã€‚ä½†æ˜¯é€šè¿‡è¿™æ ·åˆ›å»ºçš„NSFetchRequestçš„å¯¹è±¡æ˜¯æ— æ³•ä¿®æ”¹çš„ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå¹¶ä¸”é€šè¿‡ä¿®æ”¹è¿™é‡ŒFetch allé€‰æ‹©ç›¸åº”çš„modelï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ å¦å¤–çš„predicateçš„å€¼ï¼Œæ¥å¯¹æˆ‘ä»¬éœ€è¦çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚ é‚£ä¹ˆå¦‚ä½•æ¥è·å–æˆ‘ä»¬ä¹‹å‰åœ¨æ¨¡æ¿ä¸­åˆ›å»ºçš„NSFetchRequestå¯¹è±¡å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°æ˜¯é€šè¿‡managedObjectModelæ¥è·å–ç›¸åº”çš„Request: 12345678guard let model = coreDataStack.managedContext .persistentStoreCoordinator?.managedObjectModel, let fetchRequest = model .fetchRequestTemplate(forName: "FetchRequest") as? NSFetchRequest&lt;Venue&gt; else &#123;return&#125; NSFetchRequestæœ‰ä¸€ä¸ªresultTypeçš„å±æ€§å€¼ï¼Œä¹‹å‰æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯å®ƒçš„é»˜è®¤å€¼NSManagedObjectResultType,å…¶å®å®ƒæ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼Œä¸€å…±å¯ä»¥è·å–å››ä¸­ä¸åŒçš„ç±»å‹ï¼š 1234.managedObjectResultType: è¿”å›çš„å“åº”çš„æ•°æ®(é»˜è®¤çš„å€¼).countResultType: è¿”å›çš„åŒ¹é…æ•°æ®çš„ä¸ªæ•°.dictionaryResultType: ä»¥å­—å…¸çš„å½¢å¼æ¥è¿”å›ç›¸åº”çš„æ•°æ®ï¼ŒåŒ…æ‹¬countï¼ŒåŒ¹é…çš„æ•°æ®ã€‚.managedObjectIDResultType: è¿”å›åŒ¹é…æ•°æ®çš„å”¯ä¸€æ ‡ç¤ºç¬¦ è¿™é‡Œåˆ›å»ºPredicateçš„æ–¹å¼ä¹‹å‰æˆ‘ä»¬ä¹Ÿå·²ç»çœ‹åˆ°äº†,è¿™é‡Œçš„#keyPath, è¿™ä¸ªåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å°±ä¼šä¸€çº§çº§çš„æ‰¾ç›¸åº”çš„å±æ€§å€¼ï¼Œæ˜¯å¦å­˜åœ¨å†™é”™çš„æƒ…å†µï¼š 1234lazy var cheapVenuePredicate: NSPredicate = &#123; return NSPredicate(format: "%K == %@", #keyPath(Venue.priceInfo.priceCategory), "$")&#125;() è·å–countï¼š 12345678910111213141516171819202122232425262728 func populateCheapVenueCountLabel() &#123; let fetchRequest = NSFetchRequest&lt;NSNumber&gt;(entityName: "Venue") fetchRequest.resultType = .countResultType fetchRequest.predicate = cheapVenuePredicate do &#123; let countResult = try coreDataStack.managedContext.fetch(fetchRequest) let count = countResult.first!.intValue firstPriceCategoryLabel.text = "\(count) bubble tea places" &#125; catch let error as NSError &#123; print("Count not fetch \(error), \(error.userInfo)") &#125; ----------------- let fetchRequest: NSFetchRequest&lt;Venue&gt; = Venue.fetchRequest() fetchRequest.predicate = expensiveVenuePredicate do &#123; let count = try coreDataStack.managedContext.count(for: fetchRequest) thirdPriceCategoryLabel.text = "\(count) bubble tea places" &#125; catch let error as NSError &#123; print("Count not fetch \(error), \(error.userInfo)") &#125;&#125; ä¸Šé¢æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯éœ€è¦æŠŠæ‰€æœ‰çš„ç›¸å…³æ•°æ®è½½å…¥åˆ°å†…å­˜ä¸­å»ï¼Œç„¶åå†å»è®¡ç®—ä¸ªæ•°ï¼Œcore data èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°æ•°æ®çš„â€œæ€»å’Œã€å¹³å‡å€¼ã€æœ€å¤§ã€æœ€å°â€ï¼š 1234567891011121314151617181920212223242526272829303132333435363738func populateDealsCountLabel() &#123;// 1 let fetchRequest = NSFetchRequest&lt;NSDictionary&gt;(entityName: "Venue") fetchRequest.resultType = .dictionaryResultType // 2: è¿™è¾¹ä½ ä¸ºäº†è·å–æ€»å’Œç”Ÿæˆäº†ä¸€ä¸ªNSExpressionDescriptionçš„å¯¹è±¡ï¼Œå¹¶ä¸”setäº†ä¸€ä¸ªnameçš„å€¼ï¼Œä¾¿äºè‡ªå·±èƒ½å¤Ÿä»å­—å…¸ä¸­æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„é‚£ä¸ªå€¼ï¼š let sumExpressionDesc = NSExpressionDescription() sumExpressionDesc.name = "sumDeals"// 3: é¦–å…ˆä½ ç”Ÿæˆäº†ä¸€ä¸ªNSExpressionçš„å˜é‡æ¥ç¡®å®šä½ éœ€è¦å“ªä¸ªå­—æ®µæ¥è®¡ç®—æ€»å’Œï¼Œå…¶æ¬¡ç”Ÿæˆäº†ä¸€ä¸ªNSExpressionæ¥å˜é‡æ¥ç¡®å®šä½ è¦è¿è¡Œçš„å‡½æ•°ï¼Œæœ€åå®šä¹‰äº†è¿”å›æ•°æ®çš„ç±»å‹æ˜¯int32ä½ï¼š let specialCountExp = NSExpression(forKeyPath: #keyPath(Venue.specialCount)) sumExpressionDesc.expression = NSExpression(forFunction: "sum:", arguments: [specialCountExp]) sumExpressionDesc.expressionResultType = .integer32AttributeType// 4ï¼šå°†è‡ªå·±è®¾ç½®çš„ä¸œè¥¿éƒ½å‘Šè¯‰ç»™FetchRequest fetchRequest.propertiesToFetch = [sumExpressionDesc]// 5:æ ¹æ®ä¸Šé¢çš„å®šä¹‰ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨çš„æ˜¯sumå‡½æ•°ï¼Œå°†æˆ‘ä»¬Venue.specialCountæ‰€æœ‰çš„å­—æ®µéƒ½åŠ èµ·æ¥ï¼Œä¸¢åœ¨ä¸€ä¸ªå­—å…¸ä¸­ï¼Œå­—å…¸çš„keyä¸ºsumDeals: do &#123; let results = try coreDataStack.managedContext.fetch(fetchRequest) let resultDict = results.first! let numDeals = resultDict["sumDeals"]! numDealsLabel.text = "\(numDeals) total deals" &#125; catch let error as NSError &#123; print("Count not fetch \(error), \(error.userInfo)") &#125;&#125; è¿™é‡Œé™¤äº†æ”¯æŒsumï¼Œè¿˜æœ‰å…¶ä»–å‡½æ•°æ”¯æŒå—ï¼Ÿcount,min,max,median,mode,absolute è¿™é‡Œæˆ‘ä»¬è¿ç”¨çš„éƒ½æ˜¯äº›ä¸€ä¸ªå•ç‹¬çš„NSPredicateï¼Œæ¥è¿›è¡Œè¿‡æ»¤æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å…¶å®è¿˜å¯ä»¥è¿ç”¨å¤šä¸ªPredicateæ¥å®ç°ç±»ä¼¼AND,OR,NOTï¼Œå¯ä»¥é€šè¿‡NSCompoundPredicateå°†ä¸¤ä¸ªå•ç‹¬NSPredicateç»„åˆæˆä¸€ä¸ªã€‚ æ’åº å¦ä¸€ä¸ªå¾ˆç‰›é€¼çš„åœ°æ–¹ï¼Œå°±æ˜¯å¯ä»¥å¯¹è·å–çš„æ•°æ®è¿›è¡Œæ’åºï¼Œè¿™é‡Œè¿ç”¨çš„å‡½æ•°æ˜¯NSSortDescriptor,å…¶å®è¿™ä¸ªå‡½æ•°åœ¨æˆ‘ä»¬ç‰ˆæœ¬å·æ¯”è¾ƒçš„æ—¶å€™å°±å¯ä»¥è¿ç”¨ï¼Œä½†æ˜¯Core Dataä¸­çš„æ’åºï¼Œå®ƒæ˜¯å‘ç”Ÿåœ¨SQLiteå±‚é¢çš„ï¼Œè€Œä¸æ˜¯å†…å­˜å±‚é¢çš„ã€‚ 1234567891011121314151617lazy var nameSortDescriptor: NSSortDescriptor = &#123; let compareSelector = #selector(NSString.localizedStandardCompare(_:)) return NSSortDescriptor(key: #keyPath(Venue.name),&#125;()ascending: true,selector: compareSelector)lazy var distanceSortDescriptor: NSSortDescriptor = &#123; return NSSortDescriptor( key: #keyPath(Venue.location.distance), ascending: true)&#125;()lazy var priceSortDescriptor: NSSortDescriptor = &#123; return NSSortDescriptor( key: #keyPath(Venue.priceInfo.priceCategory), ascending: true)&#125;() ä¸Šé¢éœ€è¦è§£é‡Šä¸€ä¸‹çš„æ˜¯Venue.name çš„æ’åºï¼Œéœ€è¦ä¸‰ä¸ªå­—æ®µï¼š1:å±æ€§çš„å­—æ®µåã€‚2ï¼šå‡åºè¿˜æ˜¯é™åºï¼Œ3: æ‰§è¡Œæ¯”è¾ƒçš„å‡½æ•°ã€‚è¿™é‡Œéœ€è¦é‡ç‚¹è¯´ä¸€ä¸‹ï¼Œæˆ‘ä¹‹å‰æ¯”è¾ƒçš„éƒ½æ˜¯ç”¨çš„compareçš„å‡½æ•°ï¼Œä½†æ˜¯appleè¿™é‡Œå»ºè®®ä½¿ç”¨çš„æ˜¯NSString.localizedStandardCompareï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°å¯¹ä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦ä¹Ÿåšäº†ç›¸åº”çš„æ“ä½œã€‚ å¼‚æ­¥æ“ä½œï¼š ç°åœ¨æˆ‘ä»¬æ‰€æœ‰è·å–æ•°æ®çš„æ“ä½œå…¶å®éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹æ“ä½œçš„ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬æ“ä½œå¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šç”Ÿå¡é¡¿ï¼Œåœ¨iOS8çš„æ—¶å€™ï¼ŒCoreDataå¯ä»¥åœ¨åå°é•¿æœŸé«˜æ•ˆçš„è¿è¡Œã€‚ 1var asyncFetchRequest: NSAsynchronousFetchRequest&lt;Venue&gt;! 1234567891011121314151617181920212223override func viewDidLoad() &#123; super.viewDidLoad()// 1 fetchRequest = Venue.fetchRequest()// 2 asyncFetchRequest = NSAsynchronousFetchRequest&lt;Venue&gt;( fetchRequest: fetchRequest) &#123; [unowned self] (result: NSAsynchronousFetchResult) in guard let venues = result.finalResult else &#123;return&#125; self.venues = venues self.tableView.reloadData() &#125;// 3 do &#123; try coreDataStack.managedContext.execute(asyncFetchRequest) // Returns immediately, cancel here if you want &#125; catch let error as NSError &#123; print("Could not fetch \(error), \(error.userInfo)") &#125;&#125; è¿™é‡Œå¯ä»¥çœ‹åˆ°NSAsyncchronousFetchRequestå¹¶æ²¡æœ‰å–ä»£NSFetchRequest,è¿™é‡Œå¯ä»¥æŠŠå¼‚æ­¥æ“ä½œæ˜¯æ™®é€šæ“ä½œçš„ä¸€ä¸ªå°è£…ã€‚ å¹¶ä¸”è¿™é‡ŒNSManagedObjectContextæ‰§è¡Œçš„æ˜¯execute(_:)è€Œä¸æ˜¯fetch(_:) å½“ç„¶è¿™é‡Œä½ å¯ä»¥å¯ä»¥é€šè¿‡è°ƒç”¨cancel()æ¥å–æ¶ˆæŸ¥è¯¢ã€‚ æ‰¹é‡æ“ä½œï¼Œæ— éœ€è·å–æ•°æ®ã€‚ åœ¨iOS8çš„æ—¶å€™ï¼Œæä¾›äº†ä¸€ä¸ªæ–°çš„æ¥å£å¯ä»¥æ‰¹é‡æ“ä½œï¼Œå¹¶ä¸”ä¹Ÿä¸éœ€è¦å°†æ•°æ®è½½å…¥åˆ°å†…å­˜ä¸­å»NSBatchUpdateRequestï¼Œ 123456789101112131415161718192021222324// 1. é€šè¿‡ä¼ å…¥EntityName å®ä¾‹åŒ–äº†ä¸€ä¸ªNSBatchUpdateRequestå¯¹è±¡let batchUpdate = NSBatchUpdateRequest(entityName: "Venue")// 2. è®¾ç½®äº†éœ€è¦ä¿®æ”¹çš„å­—æ®µï¼Œä»¥åŠå€¼batchUpdate.propertiesToUpdate = [#keyPath(Venue.favorite) : true]// 3. è¿™ä¸ªæ‰¹é‡æ“ä½œéœ€è¦å½±å“å“ªäº›æ•°æ®batchUpdate.affectedStores = coreDataStack.managedContext .persistentStoreCoordinator?.persistentStores// 4. è®¾ç½®äº†è¿”å›ç»“æœçš„ç±»å‹ï¼Œæˆ‘ä»¬è¿™é‡Œå®šä¹‰ä¸ºè¿”å›æ‰¹é‡æ›´æ–°çš„countå€¼batchUpdate.resultType = .updatedObjectsCountResultTypedo &#123; let batchResult = try coreDataStack.managedContext.execute(batchUpdate) as! NSBatchUpdateResult print("Records updated \(batchResult.result!)")&#125; catch let error as NSError &#123; print("Could not update \(error), \(error.userInfo)")&#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Core Data, Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ CoreData(ä¸‰)]]></title>
    <url>%2F2017%2F08%2F09%2F20170809%2F</url>
    <content type="text"><![CDATA[è¿™ä¸€ç« ä¸»è¦ä»‹ç»çš„äº†å››ä¸ªç»„æˆçš„ç±» 1`NSManagedObjectModel`,`NSPersistentStore`,`NSPersistentStoreCoordinator`,`NSManagedObjectContext` NSManagedObjectModel: å®ƒå°±ç›¸å½“äºæ•°æ®åº“çš„ä¸€ä¸ªè¡¨ï¼Œæˆ‘çš„ç†è§£å°±æ˜¯ä»£è¡¨æˆ‘ä»¬åˆ›å»ºçš„ä¸€ä¸ªEntity,é‡Œé¢åŒ…å«å¾ˆå¤šæˆ‘ä»¬åˆ›å»ºçš„å­—æ®µå€¼ï¼Œå½“ç„¶ä¹ŸåŒ…å«ä¸å…¶ä»–Entityä¹‹å‰çš„å…³ç³»ï¼ˆrelationshipï¼‰ã€‚å…·ä½“NSManagedObjectModelæ˜¯å¦‚ä½•ä¸æˆ‘ä»¬åˆ›å»ºçš„data modeläº§ç”Ÿè”ç³»çš„å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼šruntime,é€šè¿‡runtimeçš„æœºåˆ¶ï¼Œèƒ½å¤Ÿåœ¨ç¼–è¯‘æœŸé«˜æ•ˆçš„å°†æˆ‘ä»¬æ‰€åˆ›å»ºmodel dataï¼Œä¹Ÿå°±æ˜¯å°†xcdatamodelæ–‡ä»¶çš„å†…å®¹ç¼–è¯‘è¿›momdæ–‡ä»¶å¤¹ä¸­ï¼Œå†å°†momdæ–‡ä»¶å¤¹ä¸­çš„å†…å®¹å®ä¾‹åŒ–NSManagedObjectModel NSPersistentStore: ä»–å°±æ˜¯è´Ÿè´£è¯»å†™æ•°æ®ï¼Œè¿™é‡Œè¿˜æåˆ°äº†ç§æœ‰NSPersistentStoreç±»å‹ï¼Œä¸‰ç§æ˜¯åŸå­æ€§çš„ï¼Œä¸€ç§æ˜¯éåŸå­æ€§çš„ï¼ˆæ‰€è°“çš„åŸå­æ€§å’Œå®šä¹‰å±æ€§å€¼ç”¨çš„åŸå­æ€§ä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼Œè¿™é‡ŒæŒ‡çš„åŸå­æ€§ï¼šåœ¨ä½ åšè¯»å†™çš„æ—¶å€™ï¼Œéœ€è¦å°†æ‰€æœ‰çš„ç›¸å…³æ•°æ®éƒ½è½½å…¥åˆ°å†…å­˜ä¸­å»ï¼Œè€ŒéåŸå­æ€§å¯ä»¥æ ¹æ®æ•°æ®çš„éœ€æ±‚è€Œè½½å…¥ï¼‰,å››ç§Typeä¾æ¬¡ä¸º:NSQLiteStoreType,NSXMLStoreType,NSBinaryStoreType,NSInMemoryStoreTypeã€‚ NSPersistentStoreCoordinator: æ˜¯NSManagedObjectModelå’ŒNSPersistentStoreçš„æ¡¥æ¥ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼Œå®ƒå°±æ˜¯NSManagedObjectModelå’ŒNSPersistentStoreä¸Šå±‚çš„å®ç°ï¼Œcore data ä¸»è¦ä¹Ÿæ˜¯é€šè¿‡å®ƒæ¥å®ç°åŠŸèƒ½ï¼ŒNSPersistentStoreCoordinatoréšè—äº†å®ƒå†…éƒ¨çš„å®ç°ï¼Œå› ä¸ºNSManagedObjectContextå¹¶ä¸çŸ¥é“ä½ è¦å­˜å‚¨çš„æ˜¯sqlite xmlè¿˜æ˜¯å…¶ä»–çš„æ ¼å¼ï¼Œå¦‚æœä½ æœ‰å¤šä¸ªæŒä¹…åŒ–å­˜å‚¨ï¼Œè€Œå¯¹NSManagedObjectContextä¹Ÿæ˜¯ç»Ÿä¸€çš„æ¥å£ã€‚ NSManagedObjectContextï¼Œæ˜¯managed objectçš„æš‚å­˜å™¨ï¼Œå®ƒä¹Ÿæ˜¯æœ€æœ€ä¸Šå±‚çš„å°è£…ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½å¯ä»¥é€šè¿‡å®ƒæ¥å®Œæˆï¼Œå¦‚æœä¸è°ƒç”¨save()çš„æ–¹æ³•çš„è¯ï¼Œæ‰€æœ‰çš„NSManagedObjectContextå˜åŒ–å‡ä¸ä¼šç”Ÿæ•ˆçš„ã€‚NSManagedObjectContextç®¡ç†ç€æ‰€æœ‰æœŸé—´åˆ›å»ºã€è·å–å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹ŸæŠ¥é”™é”™è¯¯ä¿¡æ¯ï¼Œä»¥åŠmodelçš„å…³ç³»ï¼Œæ¯ä¸ªmanagedobjecéƒ½å¿…é¡»æŒæœ‰å¯¹NSManagedObjectContextçš„å¼•ç”¨ï¼Œä¸€æ—¦æŒæœ‰äº†NSManagedObjectContext,åœ¨managedobjecçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä¼šæŒæœ‰ï¼Œä¹Ÿä¸€ä¸ªapplicationä¸­ï¼Œä¹Ÿå¯ä»¥å­˜åœ¨å¤šä¸ªNSManagedObjectContextï¼Œå¹¶ä¸”NSManagedObjectContextä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ iOS10 å‡ºç°äº†ä¸€ä¸ªæ–°çš„ç±»NSPersistentContainerï¼Œä½ åªéœ€è¦å®ä¾‹åŒ–NSPersistentContainerå°±å¯ä»¥è·å¾—ä¸Šé¢æ‰€æåˆ°çš„å››ä¸ªé‡è¦çš„ç±»äº†ã€‚ é€šè¿‡æ‡’åŠ è½½çš„æ–¹å¼ï¼Œç›´æ¥ç”ŸæˆNSPersistentContainer: 12345678910111213141516private lazy var storeContainer: NSPersistentContainer = &#123; let container = NSPersistentContainer(name: self.modelName) container.loadPersistentStores &#123; (storeDescription, error) in if let error = error as NSError? &#123; print("Unresolved error \(error), \(error.userInfo)") &#125; &#125; return container&#125;() é‚£ä¹ˆè‡ªç„¶è·å–NSManagedObjectContextå°±å¯ä»¥ç›´æ¥é€šè¿‡NSPersistentContaineræ¥è·å–äº†ï¼š è™½ç„¶è¿™é‡Œçš„NSManagedObjectContextå¯ä»¥ç›´æ¥è·å–ï¼Œä½†æ˜¯managed model,store coordinator ä»¥åŠpersistent storeå°±éœ€è¦é€šè¿‡NSPersistentStoreDescription 123lazy var managedContext: NSManagedObjectContext = &#123; return self.storeContainer.viewContext&#125;() è¿™é‡Œåœ¨ä¿å­˜æ•°æ®ä¹‹å‰å¯ä»¥å…ˆè¿›è¡Œåˆ¤æ–­æ•°æ®æ˜¯å¤Ÿå‘ç”Ÿå˜åŒ–ï¼Œè¿™è¾¹å˜åŒ–çš„ä¸œè¥¿ï¼ŒNSManagedObjectContextæ˜¯è‚¯å®šçŸ¥é“çš„ï¼š 12345678func saveContext () &#123; guard managedContext.hasChanges else &#123; return &#125; do &#123; try managedContext.save() &#125; catch let error as NSError &#123; print("Unresolved error \(error), \(error.userInfo)") &#125;&#125; åˆ›å»ºå®ŒEntityä¹‹åï¼Œå¯ä»¥ä¸ºè¿™ä¸ªEntityæ¥åˆ›å»ºå…³ç³»ï¼Œç‚¹å‡»å…³ç³»ï¼Œå¯ä»¥å…³è”å…¶ä»–çš„Entity,å¹¶ä¸”ä¹Ÿå¯ä»¥ç¼–è¾‘RelationShipçš„Data ModelInspector: To Manyï¼ˆä¸€å¯¹å¤šï¼‰ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥è®¾ç½®Orderedé¡ºåº,è¿™é‡Œä¸€æ—¦ç”Ÿæˆå¯¹å¤šæœ‰åºçš„å¯¹è±¡ï¼Œé‚£å¯¹è±¡å°±æ˜¯NSOrderedSetç±»å‹ã€‚ å¯ä»¥çœ‹åˆ°å®ä¾‹åŒ–modelï¼Œå¯¹è±¡å¾ˆç®€å•ï¼Œåªéœ€è¦ä¼ å…¥contextå°±å¯ä»¥äº†ï¼š 1let walk = Walk(context: managedContext) ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡NSManagedObjectContextç›´æ¥åˆ é™¤æŸä¸ªå¯¹è±¡ï¼š 12//2 managedContext.delete(walkToRemove)]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Core Data, Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ CoreData, å­ç±»åŒ–NSManagerObject(äºŒ)]]></title>
    <url>%2F2017%2F08%2F08%2F20170808%2F</url>
    <content type="text"><![CDATA[æ‰“å¼€xxx.xcdatamodeldæ–‡ä»¶,æ·»åŠ Entity,ä¾‹å¦‚è¿™é‡Œåå«â€œPersonâ€çš„ç±»,å¹¶ä¸”é€šè¿‡ç±»ä¼¼ç¬¬ä¸€éƒ¨åˆ†çš„æ“ä½œå°±å¯ä»¥ç¼–è¾‘äº†Attributesäº†ã€‚ è¿™é‡Œåœ¨ç»™Attributeæ·»åŠ å­—æ®µçš„æ—¶å€™éœ€è¦æ³¨æ„çš„: å­—æ®µç±»å‹æœ‰Boolean å¸ƒå°”ç±»å‹, Date æ—¶é—´æˆ³, Double æµ®ç‚¹ç±»å‹,String å­—ç¬¦ä¸²ç±»å‹, Integer Integer 32 Integer 64 æ•´å‹ã€‚ å¦‚æœEntityä¸­æœ‰å…³è”çš„imageæˆ–è€…PDF(ä»»ä½•å¯ä»¥è¢«åºåˆ—åŒ–ä¸º0æˆ–è€…ä»»ä½•çš„ä¸œè¥¿)ç±»å‹çš„è¯ï¼Œéƒ½å¯ä»¥å°†å®ƒå®šä¹‰ä¸ºBinary Data äºŒè¿›åˆ¶ç±»å‹, ä½†æ˜¯è¿™ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šâ€œå¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶å¤ªå¤§,å½“ä½ æ¯æ¬¡éœ€è¦è·å–è¿™ä¸ªEntityçš„æ—¶å€™ï¼Œå°±ä¼šæ¶ˆè€—å·¨å¤§çš„å†…å­˜ï¼Œä»è€Œå½±å“æ€§èƒ½â€ï¼Œè¿™é‡Œä½ å¯ä»¥é€šè¿‡å‹¾é€‰Allows External Storage,è¿™æ ·â€œCore Dataä¼šæ ¹æ®ä½ å­˜å…¥æ•°æ®çš„å¤§å°ï¼Œæ¥å†³å®šæ˜¯ç›´æ¥å­˜å‚¨è¿™ä¸ªå€¼è¿˜æ˜¯ä»…ä»…åªæ˜¯å­˜å‚¨ä¸€ä¸ªURIçš„å€¼ï¼Œè¿™ä¸ªå€¼æŒ‡å‘çš„æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æ•°æ®â€,å¹¶ä¸”å¦‚æœæ‰“å¼€äº†è¿™ä¸ªå±æ€§å€¼ï¼Œä½ å°†æ— æ³•é€šè¿‡æŸ¥è¯¢çš„æ–¹å¼æ¥è·å–è¿™ä¸ªå€¼ã€‚ è¿™é‡Œçš„UIColor,NSArray,NSDictionaryä»»ä½•åªè¦éµå¾ªäº†NSCodingåè®®çš„éƒ½å¯ä»¥å®šä¹‰ä¸º: Transformableã€‚ ä¹‹å‰ä¸ç®¡æ˜¯å–å€¼è¿˜æ˜¯èµ‹å€¼éƒ½æ˜¯é€šè¿‡KVCçš„æ–¹å¼æ¥å®ç°çš„ï¼Œä¾‹å¦‚ï¼š 1234// Set the nameperson.setValue(aName, forKey: "name")// Get the namelet name = person.value(forKey: "name") æˆ‘ä»¬å‹¾é€‰Codegenå€¼ä¸ºï¼šManual/None,ç„¶åç‚¹å‡»Editor\Create NSManagedObject Subclass....ï¼Œè¿™æ ·Xcodeå°±å¯ä»¥ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªæ–‡ä»¶ã€‚å¦‚æœä¿®æ”¹äº†å“åº”çš„Entityçš„æ–‡ä»¶çš„å±æ€§ï¼Œå¯ä»¥é‡æ–°ç‚¹å‡»Editor\Create NSManagedObject Subclass.... ç”Ÿæˆçš„æ–‡ä»¶ä¸­ï¼Œå±æ€§å€¼å‰é¢éƒ½å†™ç€@NSManaged,è¿™ä¸ªå­—æ®µçš„æ„æ€æ˜¯å‘Šè¯‰Swiftç¼–è¯‘å™¨ï¼Œè¿™ä¸ªå±æ€§çš„å­˜å‚¨å’Œå®ç°éƒ½æ˜¯åœ¨è¿è¡Œæ—¶äº§ç”Ÿçš„ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™äº§ç”Ÿã€‚å› ä¸ºè¿™äº›å±æ€§çš„å­˜å‚¨æ˜¯éœ€è¦managed object context,è€Œè¿™ä¸ªä¸œè¥¿åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰ç”Ÿæˆã€‚ æµ‹è¯•æ’å…¥çš„ä¸€ä¸ªæ–°çš„æ•°æ®ï¼š 123456789101112131415161718 // Save test bow tie let bowtie = NSEntityDescription.insertNewObject( forEntityName: "Bowtie", into: self.persistentContainer.viewContext) as! Bowtie bowtie.name = "My bow tie" bowtie.lastWorn = NSDate() // Retrieve test bow tie do &#123; let request = NSFetchRequest&lt;Bowtie&gt;(entityName: "Bowtie") let ties = try self.persistentContainer.viewContext.fetch(request) let sample = ties.first print("Name :\(sample?.name), Worn: \(sample?.lastWorn)") &#125; catch let error as NSError &#123; print("Fetching error: \(error), \(error.userInfo)") &#125;return true&#125; imageå’ŒUIColorçš„å­˜å– 12345678... let colorDict = btDict["tintColor"] as! [String: AnyObject] bowtie.tintColor = UIColor.color(dict: colorDict) let image = UIImage(named: imageName!) let photoData = UIImagePNGRepresentation(image!)! bowtie.photoData = NSData(data: photoData)... å¦‚ä½•æ ¹æ®æ¡ä»¶æŸ¥è¯¢ï¼Ÿè¿ç”¨NSPredicate: 123456789101112//2 let request = NSFetchRequest&lt;Bowtie&gt;(entityName: "Bowtie") let firstTitle = segmentedControl.titleForSegment(at: 0)! request.predicate = NSPredicate( format: "searchKey == %@", firstTitle)do &#123; //3 let results = try managedContext.fetch(request)//4 populate(bowtie: results.first!) &#125; catch let error as NSError &#123; print("Could not fetch \(error), \(error.userInfo)") &#125; CoreData å¦‚ä½•å¯¹å­—æ®µå€¼è¿›è¡ŒéªŒè¯ï¼Ÿ å‹¾é€‰éœ€è¦éªŒè¯å­—æ®µï¼Œæ‰“å¼€data model inspector,ç„¶åå‹¾é€‰Validationï¼Œå¯ä»¥å‹¾é€‰é»˜è®¤å€¼,æœ€å¤§å€¼,æœ€å°å€¼ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨catchä¸­æ•è·ä½Errorï¼š 12345 if error.domain == NSCocoaErrorDomain &amp;&amp; (error.code == NSValidationNumberTooLargeError || error.code == NSValidationNumberTooSmallError) &#123; rate(currentBowtie)&#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Core Data, Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ CoreData(ä¸€)]]></title>
    <url>%2F2017%2F08%2F07%2F20170807%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨çœ‹Core Dataè¿™æœ¬ä¹¦ï¼Œå¾ˆå¤šäººéƒ½è¯´è¿™ä¸ªä¸œè¥¿å¤šéš¾ç”¨ï¼Œä½†æ˜¯å¾ˆå¤šç»†èŠ‚å¦‚æœä¸è¿›å»ç»†ç»†çœ‹çš„è¯ï¼Œä¹Ÿä¼šå­˜åœ¨å¾ˆå¤šæ‡µé€¼çš„åœ°æ–¹ã€‚ä¸å¾—ä¸æ‰¿è®¤ï¼Œè¿™ä¸ªä¸œè¥¿è¿˜æ˜¯æŒºç‰›é€¼çš„ã€‚ å¦‚ä½•å­˜å…¥ç›¸åº”çš„Entityå¯¹è±¡? åœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰è¦å…ˆçŸ¥é“ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ä»€ä¹ˆå¯¹è±¡æ¥å­˜å…¥æ•°æ®çš„å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šNSManagedObjectContext é‚£ä»€ä¹ˆæ˜¯NSManagedObjectContext? ä¹¦ä¸Šçš„ç»™çš„è§£é‡Šæˆ‘è®¤ä¸ºå¾ˆè´´åˆ‡ï¼šYou can consider a managed object context as an in-memory â€œscratchpadâ€ for working with managed objectsï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼šå®ƒå…¶å®å°±ç›¸å½“äºå†…å­˜ä¸­çš„æš‚å­˜å™¨,é‚£ä¹ˆå®Œæˆæ’å…¥æ•°æ®å°±åˆ†ä¸ºä¸¤æ­¥ï¼š1. å°†æ•°æ®æ’å…¥åˆ°NSManagedObjectContextï¼Œ2. ç„¶åå°†managed object contextçš„å˜åŒ–ä¿å­˜åˆ°ç£ç›˜ä¸­ é‚£ç°åœ¨æ€ä¹ˆè·å–è¿™ä¸ªæ‰€è°“çš„æš‚å­˜å™¨NSManagedObjectContext? å¦‚æœä½ çš„é¡¹ç›®åˆ›å»ºæ˜¯é€šè¿‡xcodeï¼Œå‹¾é€‰åˆ›å»ºUse Core Dataçš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥è·å–ï¼š 12let managedContext = appDelegate.persistentContainer.viewContext å¦‚ä½•é€šè¿‡NSManagedObjectContextæ¥è·å–Entityï¼Ÿ æˆ‘ä»¬é€šè¿‡æ¨¡æ¿æ¥åˆ›å»ºçš„Entityå¯¹è±¡ï¼Œåœ¨CoreDataä¸­å°±å¥½æ¯”Class,è¿™äº›Entityéƒ½æ˜¯ç»§æ‰¿NSManagedObjectç±»æˆ–è€…ä¸ºå…¶å­ç±»ï¼Œé‚£è¿™ä¸ªé—®é¢˜å°±è½¬åŒ–ä¸ºå¦‚ä½•å–å¾—æˆ‘ä»¬ä¹‹å‰æ—©èµ·å®šä¹‰çš„Entityï¼Œä¹Ÿå°±æ˜¯NSManagedObjectå¯¹è±¡å‘¢ï¼Ÿ 123let entity = NSEntityDescription.entity(forEntityName: "Person", in: managedContext)! è¿™é‡Œæ˜¯é€šè¿‡NSEntityDescriptionå¯¹è±¡ä¸€ä¸ªç±»æ–¹æ³•entity,ä¼ å…¥ç›¸åº”çš„Entityå­—ç¬¦ä¸²ï¼Œä½†æ˜¯è¿™é‡Œè¿”å›å¹¶ä¸æ˜¯æˆ‘ä»¬ä¹‹å‰é¢„æ–™çš„NSManagedObject,è€Œæ˜¯NSEntityDescriptionè‡ªå·±ã€‚ è¿™é‡Œæ˜¯å› ä¸ºNSEntityDescription= æ•°æ®æ¨¡å‹å®ä½“å®šä¹‰ ä¸ NSManagedObject çš„é“¾æ¥éƒ¨åˆ† æ‹¿åˆ°äº†Entity,å¦‚ä½•æ¥è®¾ç½®å€¼å‘¢ï¼Ÿ å› ä¸ºNSManagedObjectæ˜¯ç”¨OCæ¥å†™çš„ï¼Œå¯ä»¥é€šè¿‡KVCçš„æ–¹å¼æ¥è®¾ç½®ï¼Œè¿™é‡Œä¸€å®šè¦æ³¨å®šå­—ç¬¦ä¸²çš„ä¹¦å†™æ­£ç¡®ï¼Œå¦åˆ™å°±ä¼šå‘ç”Ÿcrash ä¹‹å‰è¯´äº†æœ€åè¿˜éœ€è¦commit,é‚£å¦‚ä½•commitçš„ï¼Ÿ ç›´æ¥è°ƒç”¨managedContext.save(),è¿™é‡Œå¯èƒ½ä¼šæäº¤ä¸æˆåŠŸï¼Œé‚£å°±éœ€è¦catchä½ç›¸åº”çš„é”™è¯¯ã€‚ èµ‹å€¼çš„ä»£ç ï¼š123456789101112131415161718192021222324func save(name: String) &#123; guard let appDelegate = UIApplication.shared.delegate as? AppDelegate else &#123; return &#125; //1. let managedContext = appDelegate.persistentContainer.viewContext //2. let entity = NSEntityDescription.entity(forEntityName: "Person", in: managedContext)! let person = NSManagedObject(entity: entity, insertInto: managedContext) //3. person.setValue(name, forKeyPath: "name") //4. do &#123; try managedContext.save() people.append(person) &#125; catch let error as NSError &#123; print("Could not save. \(error), \(error.userInfo)") &#125; &#125; å–å€¼çš„ä»£ç ï¼š12345678910111213141516//1 guard let appDelegate = UIApplication.shared.delegate as? AppDelegate else &#123;return&#125; let managedContext = appDelegate.persistentContainer.viewContext//2 let fetchRequest = NSFetchRequest&lt;NSManagedObject&gt;(entityName: "Person")//3 do &#123; people = try managedContext.fetch(fetchRequest) &#125; catch let error as NSError &#123; print("Could not fetch. \(error), \(error.userInfo)") &#125; å…¶ä»–éƒ½å’Œèµ‹å€¼çš„æ“ä½œæ˜¯ä¸€æ ·çš„ï¼Œé‚£ç¬¬äºŒéƒ¨æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ å°±å¦‚è¿™ä¸ªNSFetchRequestç±»åå­—ä¸€æ ·ï¼ŒNSFetchRequestä»–å°±æ˜¯èµ‹å€¼ä»Core Dataä¸­è·å–æ•°æ®çš„ä¸œè¥¿ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¼ å…¥EntityNameæ¥å‡†ç¡®å‘Šè¯‰contextæˆ‘ä»¬éœ€è¦è·å–çš„æ˜¯ä»€ä¹ˆå¯¹è±¡ã€‚è¿™é‡Œæ˜¯è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å¯¹è±¡ã€‚ æœ€åè°ƒç”¨fetchä¼šç›´æ¥è¿”å›æ‰€æœ‰æ•°æ®ï¼ŒåŒæ ·è¿™é‡Œä¹Ÿå¯èƒ½ä¼šå¤±è´¥ï¼Œè®°ä½catchä½é”™è¯¯ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Core Data, Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React-Native 0.46 æœ€æ–°ç¯å¢ƒé…ç½®]]></title>
    <url>%2F2017%2F07%2F31%2F20170731%2F</url>
    <content type="text"><![CDATA[éš”äº†å¥½ä¹…ï¼Œé—²æ¥æ— äº‹ï¼Œçœ‹åˆ°è‡ªå·±githubä¸ŠReact-Nativeçš„é¡¹ç›®å¥½ä¹…æ²¡æœ‰æ›´æ–°äº†ï¼Œæ‰€ä»¥æƒ³ç»§ç»­ææå®ƒï¼Œä½†æ˜¯å‘ç°å¥½å¤šå‘ã€‚ æ‰“å¼€å®˜ç½‘ https://facebook.github.io/react-native/ï¼Œæˆ‘æ‰€ç”¨çš„éƒ½æ˜¯æœ€æ–°çš„ç‰ˆæœ¬0.46, ç‚¹å‡»é“¾æ¥åˆ°https://facebook.github.io/react-native/docs/getting-started.html,ç‚¹å‡»Build Projects with Native Codeï¼Œä¼šæœ‰ä¸€ä¸ªDemoï¼ŒæŒ‰ç…§è¿™ä¸ªDemoä¸€æ­¥æ­¥æ“ä½œï¼Œä¼šé‡åˆ°å¾ˆå¤šçš„å‘ï¼Œè¿™é‡Œæˆ‘è®°å½•ä¸€ä¸‹ï¼š 1.å…ˆè¿è¡ŒAndroidçš„æœºå™¨ï¼Œå‘ç°ä¼šæŠ¥æœªæ‰¾åˆ°SDKçš„é—®é¢˜ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 12345FAILURE: Build failed with an exception.* What went wrong:A problem occurred configuring project ':app'.&gt; SDK location not found. Define location with sdk.dir in the local.properties file or with an ANDROID_HOME environment variable. è§£å†³ï¼šä»¥macä¸ºä¾‹å­ï¼Œæ‰¾åˆ°~/.bashrcçš„æ–‡ä»¶ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯~/.zshrcçš„æ–‡ä»¶ 123451. vim ~/.bashrc2. export ANDROID_HOME=~/Library/Android/sdk export PATH=$&#123;PATH&#125;:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools 2.å†æ¬¡è¿è¡Œreact-native run-android æƒ³æ‰§è¡ŒçœŸæœºçš„è¯, æŠ¥è¿™å¦‚ä¸‹é”™è¯¯ï¼š 1Could not run adb reverse: Command failed: /Users/gonghuan/Library/Android/sdk/platform-tools/adb -s K21GAMN590201150 reverse tcp:8081 tcp:8081 è¿™é‡Œå‡å¦‚ä½ çš„ç³»ç»Ÿæ˜¯Android 5.0ä»¥ä¸Šçš„è¯ï¼Œåº”è¯¥å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜äº†ï¼Œä½†æ˜¯å¦‚æœä½ çš„å®‰å“æœºå™¨å’Œæˆ‘çš„ä¸€æ ·ï¼Œéƒ½æ˜¯ä½äºAndroid 5.0çš„è¯ï¼š, ä»¥æˆ‘çš„æ‰‹æœºä¸ºä¾‹[å®‰å“4.4.4]ï¼Œè§£å†³ï¼š 1234567891. (Android 5.0ä»¥ä¸‹)é€šè¿‡Wi-Fiè¿æ¥ä½ çš„æœ¬åœ°å¼€å‘æœåŠ¡å™¨é¦–å…ˆç¡®ä¿ä½ çš„ç”µè„‘å’Œæ‰‹æœºè®¾å¤‡åœ¨åŒä¸€ä¸ªWi-Fiç¯å¢ƒä¸‹ã€‚2. åœ¨è®¾å¤‡ä¸Šè¿è¡Œä½ çš„React Nativeåº”ç”¨ã€‚å’Œæ‰“å¼€å…¶å®ƒAppä¸€æ ·æ“ä½œã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªâ€œçº¢å±â€é”™è¯¯æç¤ºã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œä¸‹é¢çš„æ­¥éª¤ä¼šè§£å†³è¿™ä¸ªæŠ¥é”™ã€‚3. æ‘‡æ™ƒè®¾å¤‡ï¼Œæˆ–è€…è¿è¡Œadb shell input keyevent 82ï¼Œå¯ä»¥æ‰“å¼€å¼€å‘è€…èœå•ã€‚4. ç‚¹å‡»è¿›å…¥Dev Settingsã€‚5. ç‚¹å‡»Debug server host for deviceã€‚6. è¾“å…¥ä½ ç”µè„‘çš„IPåœ°å€å’Œç«¯å£å·ï¼ˆè­¬å¦‚10.0.1.1:8081ï¼‰ã€‚åœ¨Macä¸Šï¼Œä½ å¯ä»¥åœ¨ç³»ç»Ÿè®¾ç½®/ç½‘ç»œé‡Œæ‰¾æŸ¥è¯¢ä½ çš„IPåœ°å€ã€‚åœ¨Windowsä¸Šï¼Œæ‰“å¼€å‘½ä»¤æç¤ºç¬¦å¹¶è¾“å…¥ipconfigæ¥æŸ¥è¯¢ä½ çš„IPåœ°å€ã€‚åœ¨Linuxä¸Šä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥ifconfigæ¥æŸ¥è¯¢ä½ çš„IPåœ°å€ã€‚7. å›åˆ°å¼€å‘è€…èœå•ç„¶åé€‰æ‹©Reload JSã€‚` 3.è¿è¡Œreact-native run-androidçš„æ—¶å€™ï¼Œå¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼Œæˆ‘è¿™è¾¹æŠ¥è¿™ä¸ªé”™è¯¯ï¼š 1Error: No available formula with the name "android-sdk" è§£å†³é€”å¾„ï¼š1. å¦‚æœä½ å·²ç»æŒ‰ç…§å®˜ç½‘ [https://facebook.github.io/react-native/docs/getting-started.html] çš„æ•™ç¨‹ï¼Œèµ°å®Œï¼Œä½†æ˜¯è¿˜æ˜¯æŠ¥é”™çš„è¯å°±æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1234567brew tap caskroom/caskbrew cask install android-sdkbrew cask install android-platform-tools]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>React-Native</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ è®¾è®¡æ¨¡å¼-è¿­ä»£å™¨æ¨¡å¼]]></title>
    <url>%2F2017%2F07%2F13%2F20170713%2F</url>
    <content type="text"><![CDATA[ä»£ç å†™å¤šäº†ï¼Œå°±æƒ³æŠŠä»£ç å†™å¥½ï¼Œå°†ä»£ç å†™å¥½ï¼Œå°±å¿…ç„¶è¦å­¦ä¹ è®¾è®¡æ¨¡å¼ï¼Œä»Šå¤©é‡ç‚¹å­¦ä¹ ä¸€ä¸‹è¿­ä»£å™¨æ¨¡å¼å’Œç»„åˆæ¨¡å¼ã€‚è¿™é‡Œæˆ‘å‚ç…§çš„å­¦ä¹ æ˜¯ä»¥JAVAä¸ºå‚ç…§çš„ã€ŠHeader Firstã€‹è®¾è®¡æ¨¡å¼ï¼Œæˆ‘è¿™é‡Œä¼šä»¥Object-cçš„æ ¼å¼æ¥é‡å†™ï¼Œæœ€åä»¥ä¸€ä¸ªæˆ‘é¡¹ç›®ä¸­çš„å®ä¾‹æ¥è¯´æ˜ä¸€ä¸‹ã€‚1.1 è¿­ä»£å™¨è®¾è®¡æ¨¡å¼ï¼š é—®é¢˜ï¼šè¿™é‡Œæœ‰ä¸¤ä¸ªç±»ï¼šä¸€ä¸ªæ˜¯ç…é¥¼é¤å…èœç±»PancakeHouseMenu(è¿™é‡Œå‡è®¾ä»£ç ä¸­æ˜¯ä»¥æ•°ç»„çš„å½¢å¼æ¥å­˜å‚¨),ä¸€ä¸ªæ˜¯æ™®é€šé¤å…ç±»DinerMenu(è¿™é‡Œå‡è®¾æ˜¯ä»¥å­—å…¸çš„å½¢å¼æ¥å­˜å‚¨),ä»–ä»¬éƒ½æœ‰è‡ªå·±åŸæœ‰çš„ä»£ç ï¼Œä»¥åŠé€»è¾‘ï¼Œç°åœ¨å¦‚ä½•å°†è¿™ä¸¤ä¸ªèœå•ç±»åˆå¹¶æˆä¸€ä¸ªç±»æ›´å¥½ç»™ç”¨æˆ·è°ƒç”¨ã€‚ è¿™ä¸ªæ˜¯PancakeHouseMenuçš„ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839#import "PancakeHouseMenu.h"#import "Pancak.h"@interface PancakeHouseMenu ()@property (nonatomic, strong) NSMutableArray *items;@end@implementation PancakeHouseMenu- (instancetype)init &#123; if (self = [super init]) &#123; [self addItem:@"cake_A" isVege:YES price:0.23]; [self addItem:@"cake_B" isVege:NO price:0.53]; [self addItem:@"cake_C" isVege:YES price:1.2]; &#125; return self;&#125;- (void)addItem:(NSString *)itemName isVege:(BOOL)isVege price:(CGFloat)price &#123; Pancak *cake = [Pancak pancakName:itemName isVege:isVege price:price]; if (cake != nil) [self.items addObject:cake];&#125;- (NSArray &lt;Pancak *&gt;*) menuItems; &#123; return [self.items copy];&#125;#pragma mark - Getter Methods- (NSMutableArray *)items &#123; if (_items == nil) _items = [NSMutableArray new]; return _items;&#125;@end è¿™ä¸ªæ˜¯DinerMenuçš„ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142#import "DinerMenu.h"#import "Diner.h"@interface DinerMenu ()@property (nonatomic, strong) NSMutableDictionary *items;@property (nonatomic, assign) NSInteger numberOfItems;@end@implementation DinerMenu- (instancetype)init &#123; if (self = [super init]) &#123; self.numberOfItems = 0; [self addItem:@"Diner_A" isVege:YES price:2.32]; [self addItem:@"Diner_B" isVege:NO price:5.33]; [self addItem:@"Diner_C" isVege:YES price:1.27]; &#125; return self;&#125;- (NSDictionary *) menuItems &#123; return [self.items copy];&#125;- (void)addItem:(NSString *)itemName isVege:(BOOL)isVege price:(CGFloat)price &#123; Diner *diner = [Diner DinerName:itemName isVege:isVege price:price]; if (diner != nil &amp;&amp; itemName != nil) &#123; [self.items setObject:diner forKey:@(self.numberOfItems)]; self.numberOfItems ++; &#125;&#125;- (NSMutableDictionary *)items &#123; if (_items == nil) _items = [NSMutableDictionary new]; return _items;&#125;@end é€šè¿‡æ¯”è¾ƒå°±å¯ä»¥çœ‹å‡ºè¿™ä¸¤ä¸ªçš„åŒºåˆ«ã€‚å­˜å‚¨æ•°æ®åˆ†åˆ«ç”¨çš„æ˜¯NSMutableArrayå’ŒNSMutableDictionary å¦‚æœæ­¤æ—¶æˆ‘éœ€è¦åˆ†åˆ«æ‰“å°å“åº”çš„æ•°æ®çš„æ—¶å€™çš„ï¼Œå°±éœ€è¦è¿™æ ·ï¼š 123456789101112131415161718192021- (void)printMenu &#123; self.pancakeMenu = [PancakeHouseMenu new]; NSArray *pancakeItems = self.pancakeMenu.menuItems; self.dinerMenu = [DinerMenu new]; NSDictionary *dinerItems = self.dinerMenu.menuItems; for (int i = 0 ; i &lt; pancakeItems.count ; i++) &#123; Pancak *pancake = pancakeItems[i]; NSLog(@"%@", pancake); &#125; NSLog(@"--------------------"); for (int i = 0 ; i &lt; dinerItems.count; i ++ ) &#123; Diner *diner = dinerItems[@(i)]; NSLog(@"%@", diner); &#125; &#125; ç»“æœå¦‚ä¸‹ï¼š 12345672017-07-12 16:54:00.992 Learn_Iterator_Composite_Pattern[6245:186657] pancake:[name:cake_A--isvege:1--price:0.23]2017-07-12 16:54:00.992 Learn_Iterator_Composite_Pattern[6245:186657] pancake:[name:cake_B--isvege:0--price:0.53]2017-07-12 16:54:00.992 Learn_Iterator_Composite_Pattern[6245:186657] pancake:[name:cake_C--isvege:1--price:1.20]2017-07-12 16:54:00.992 Learn_Iterator_Composite_Pattern[6245:186657] --------------------2017-07-12 16:54:00.993 Learn_Iterator_Composite_Pattern[6245:186657] diner:[name:Diner_A--isvege:1--price:2.32]2017-07-12 16:54:00.993 Learn_Iterator_Composite_Pattern[6245:186657] diner:[name:Diner_B--isvege:0--price:5.33]2017-07-12 16:54:00.993 Learn_Iterator_Composite_Pattern[6245:186657] diner:[name:Diner_C--isvege:1--price:1.27] è¿™æ ·ç¬¬ä¸€ä¸ªé—®é¢˜å°±å‡ºç°äº†ï¼Œè¿™é‡Œä¸¤å®¶é¤å…çš„èœå•å­˜å‚¨çš„æ•°æ®ç»“æ„æ²¡æ³•æ§åˆ¶ï¼Œè¿™é‡Œéœ€è¦æ‰“å°èœå•çš„æ—¶å€™ï¼Œå°±éœ€è¦åˆ†åˆ«éå†ä¸¤ä¸ªæ•°æ® è§£å†³ç‰ˆæœ¬ï¼šå°è£…å˜åŒ–çš„éƒ¨åˆ†ï¼ˆè¿™é‡Œå˜åŒ–çš„éƒ¨åˆ†å°±æ˜¯å¾ªç¯éå†çš„åœ°æ–¹ï¼‰ è¿™é‡Œåˆ›å»ºä¸€ä¸ªprotocol,ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617@protocol Iterator &lt;NSObject&gt;/** æ˜¯å¦è¿™ä¸ªèšåˆä¸­å­˜åœ¨æ›´å¤šçš„å…ƒç´  @return è¿”å›boolå€¼ */- (BOOL)hasNext;/** è¿”å›ä¸‹ä¸€ä¸ªå¯¹è±¡ @return ä¸‹ä¸€ä¸ªå¯¹è±¡ */- (id)next;@end åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»DinerMenuIterator,è¿™ä¸ªç±»æ˜¯Iteratorå…·ä½“å®ç°çš„ç±»ï¼Œå…·ä½“å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334#import "DinerMenuIterator.h"@interface DinerMenuIterator ()@property (nonatomic, strong) NSDictionary *items;@property (nonatomic, assign) NSInteger position;@end@implementation DinerMenuIterator- (instancetype)initWithItems:(NSDictionary *)items &#123; if (self = [super init]) &#123; self.position = 0; self.items = items; &#125; return self;&#125;- (BOOL)hasNext &#123; if (self.position &gt;= self.items.count) return NO; return YES;&#125;- (id)next &#123; if ([self hasNext]) &#123; id item = self.items[@(self.position)]; self.position ++; return item; &#125; return nil;&#125;@end ä¿®æ”¹DinerMenuçš„ç±»ï¼š 12345678910111213/** è¿”å›èœå•é¡¹ @return èœå•æ€»æ•°æ® *///- (NSDictionary *) menuItems;/** è¿­ä»£å™¨çš„æ¥å£ @return è¿­ä»£å™¨å¯¹è±¡ */- (id&lt;Iterator&gt;)iterator; .m æ–‡ä»¶çš„å…·ä½“å®ç°ï¼š 1234567- (id&lt;Iterator&gt;)iterator &#123; return [[DinerMenuIterator alloc] initWithItems:[self.items copy]];&#125;//- (NSDictionary *) menuItems &#123;// return [self.items copy];//&#125; è¿™æ ·æ‰“å°ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122- (void)printMenu &#123; self.pancakeMenu = [PancakeHouseMenu new]; id &lt;Iterator&gt;pancakIterator = [self.pancakeMenu iterator]; self.dinerMenu = [DinerMenu new]; id &lt;Iterator&gt;dinerIterator = [self.dinerMenu iterator]; [self iterate_print_menu:pancakIterator]; NSLog(@"--------------------"); [self iterate_print_menu:dinerIterator]; &#125;- (void)iterate_print_menu:(id&lt;Iterator&gt;)it &#123; while (it.hasNext) &#123; NSLog(@"%@", it.next); &#125;&#125; è¿™æ ·å°±è§£å†³äº†æ¸¸èµ°äºæ¯ä¸€ä¸ªå…ƒç´ å†…éƒ¨ä¹‹é—´ï¼Œè€Œä¸éœ€è¦æš´éœ²å†…éƒ¨çš„å®ç°ã€‚ è¿­ä»£å™¨æ¨¡å¼ï¼šæä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²å…¶å†…éƒ¨çš„å®ç°ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>OC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ ã€ŠiOS Animationsã€‹]]></title>
    <url>%2F2017%2F07%2F04%2F20170704%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘ä¸€ç›´åœ¨å­¦ä¹ ã€ŠiOS Animationsã€‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹å­¦ä¹ åˆ°çŸ¥è¯†ç‚¹ï¼š è¿™æœ¬éƒ½å¿«çœ‹å®Œäº†ï¼Œä¸€ç›´è§‰å¾—æ²¡å•¥å¯åšç¬”è®°çš„ï¼Œä»¥ä¸ºUIåŠ¨ç”»çš„ä¸€äº›ç”¨æ³•ï¼Œä½ çŸ¥é“å°±æ˜¯çŸ¥é“ï¼Œä¸çŸ¥é“å°±æ˜¯ä¸çŸ¥é“ï¼ŒçŸ¥é“äº† å°±è§‰å¾—å¾ˆå®¹æ˜“ï¼Œæ‰€ä»¥è§‰å¾—è¿™æ˜¯ä¸€ä¸ªç†Ÿèƒ½ç”Ÿå·§çš„æŠ€èƒ½ï¼Œä½†æ˜¯æƒ³æƒ³ï¼Œè¿™æœ¬ä¹¦éƒ½å¿«çœ‹å®Œäº†ï¼Œè¿˜æ˜¯è¦ç•™ä¸‹ä¸€äº›ä»€ä¹ˆï¼Œæ‰€ä»¥è§‰å¾—è®°äº›ä¸œè¥¿ã€‚ Animating Constraints å¦‚ä½•åœ¨åŠ¨ç”»ä¸­ä¿®æ”¹çº¦æŸ æœ€ç®€å•çš„å°±æ˜¯è·å–NSLayoutConstraint!çš„å±æ€§å€¼ï¼Œç›´æ¥ä¿®æ”¹å¯¹è±¡çš„constantå¯ä»¥ç›´æ¥å®ç°çº¦æŸå€¼çš„æ”¹å˜ã€‚å®˜æ–¹çš„apiè§£é‡Šå¦‚ä¸‹ï¼š Unlike the other properties, the constant may be modified after constraint creation. Setting the constant on an existing constraint performs much better than removing the constraint and adding a new one thatâ€™s just like the old but for having a new constant. 12@IBOutlet weak var menuHeightConstraint: NSLayoutConstraint!menuHeightConstraint.constant = isMenuOpen ? 200.0 : 60.0 1.1 æ·»åŠ åŠ¨ç”» è¿ç”¨ç±»ä¼¼è¿™äº›apianimate(withDuration:animations:)å°±å¯ä»¥å®ç°åŠ¨ç”»ã€‚ å¯ä»¥åœ¨animationsçš„closureé‡Œé¢æ·»åŠ åŠ¨ç”»çš„ä»£ç ï¼Œä¹Ÿå¯ä»¥åœ¨å¤–é¢ä¿®æ”¹å®Œå“åº”çš„çº¦æŸä»£ç ï¼Œç„¶åç›´æ¥åœ¨closureä¸­è°ƒç”¨self.view.layoutIfNeeded() 123UIView.animate(withDuration: 1.0, delay: 0.0, usingSpringWithDamping: 0.4, initialSpringVelocity: 10.0, options: .curveEaseIn, animations: &#123; self.view.layoutIfNeeded() &#125;, completion: nil) 1.2 éå†ä¿®æ”¹çº¦æŸ1234567titleLabel.superview?.constraints.forEach &#123; constraint in if constraint.firstItem === titleLabel &amp;&amp; constraint.firstAttribute == .centerX &#123; constraint.constant = isMenuOpen ? -100.0 : 0.0 return &#125;&#125; è¿™é‡Œçš„ä½œç”¨å°±æ˜¯éå†titleLabelçš„çˆ¶è§†å›¾çš„çº¦æŸ. è¡¨è¾¾å¼firstItem.firstAttribute = secondItem.secondAttribute + constant åˆ é™¤æŸä¸ªçº¦æŸï¼Œæ˜¯é€šè¿‡ isActiveçš„å±æ€§æ¥è®¾ç½®çš„ï¼ŒisActiveçš„å±æ€§ä¸ºfalseçš„æ—¶å€™ï¼Œå°±ä»£è¡¨å»é™¤çº¦æŸ, å½“è®¾ç½®isActiveçš„å±æ€§å€¼ä¸ºfalse,è§†å›¾çš„å±‚çº§ä¼šåˆ é™¤çº¦æŸï¼Œå¹¶ä¸”å¦‚æœæ²¡æœ‰å¯¹è±¡å¼•ç”¨å®ƒï¼Œå®ƒå°±ä¼šä»å†…å­˜ä¸­å»é™¤æ‰ã€‚ 1.3 æ·»åŠ æ–°çš„çº¦æŸ 1.åœ¨åˆšæ‰æšä¸¾ä¸­ï¼Œå¯ä»¥é€šè¿‡å¾ªç¯ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªæ–°çš„çº¦æŸï¼Œå¹¶ä¸”æ›¿æ¢æ‰ï¼š 12345678910let newConstraint = NSLayoutConstraint( item: titleLabel, attribute: .centerY, relatedBy: .equal, toItem: titleLabel.superview!, attribute: .centerY, multiplier: isMenuOpen ? 0.67 : 1.0, constant: 5.0)newConstraint.identifier = "TitleCenterY"newConstraint.isActive = true é€šè¿‡è®¾ç½®identifierçš„å±æ€§å€¼ï¼Œæ¥æ‰¾åˆ°è§†å›¾å±‚çº§çš„å…ƒç´ ï¼Œé€šè¿‡è®¾ç½®isActiveæ¥å‘Šè¯‰Autolayoutå°†å…¶åº”ç”¨åˆ°å½“å‰çš„å¸ƒå±€ä¸­å»ã€‚ å¦‚æœæ˜¯æ‰‹åŠ¨ç¼–å†™autolayoutçš„ä»£ç ï¼Œåˆ›å»ºå®Œæ–°çš„çº¦æŸåï¼Œéœ€è¦é€šè¿‡addConstraint,å°†æ–°çš„çº¦æŸæ·»åŠ åˆ°è§†å›¾ä¸Šå»ã€‚ ä½†æ˜¯ç³»ç»Ÿæ›´åå‘äºä½¿ç”¨NSLayoutConstraint.activate(_:)çš„ç±»æ–¹æ³•,æ¥å—ä¸€ä¸ª constraintçš„æ•°ç»„ï¼Œæ€§èƒ½æ›´ä¼˜ï¼Œå®˜æ–¹apiçš„è§£é‡Šå¦‚ä¸‹: Convenience method that activates each constraint in the contained array, in the same manner as setting active=YES. This is often more efficient than activating each constraint individually. 2. 12345let conX = imageView.centerXAnchor.constraint(equalTo: view.centerXAnchor)let conBottom = imageView.bottomAnchor.constraint(equalTo: view.bottomAnchor, constant: imageView.frame.height)let conWidth = imageView.widthAnchor.constraint(equalTo: view.widthAnchor, multiplier: 0.33, constant: -50)let conHeight = imageView.heightAnchor.constraint(equalTo: imageView.widthAnchor)NSLayoutConstraint.activate([conX, conBottom, conWidth, conHeight])]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ ç®—æ³•]]></title>
    <url>%2F2017%2F06%2F20%2F20170620%2F</url>
    <content type="text"><![CDATA[å‰ä¸¤å¤©é—²æ¥æ— äº‹æœ‰é‡æ–°æ¸©ä¹ äº†ä¸€ä¸‹ç®—æ³•ï¼Œç”¨Swift3é‡å†™äº†ä¸€ä¸‹ç®—æ³•ï¼šä»Šå¤©å…ˆå†™ä¸€ä¸‹O(n^2)çš„ä¸¤ç§ç®—æ³•ï¼šé€‰æ‹©æ’åºã€æ’å…¥æ’åºï¼Œä»¥åŠç®—æ³•å¤æ‚åº¦ä¸ºO(nlogn)çš„ï¼šé€’å½’æ’åº é¡¹ç›®æˆ‘å·²ç»ä¸¢åˆ°githubä¸Šäº†ï¼Œå¯ä»¥è‡ªå·±å»ä¸‹è½½ï¼š [https://github.com/Ghstart/play_with_algorithm] 1.1 å‡†å¤‡å·¥ä½œ é¦–å…ˆå†™ç®—æ³•ï¼Œæˆ‘éœ€è¦æœ‰å‡†å¤‡ä¸ºæˆ‘äº§ç”Ÿæµ‹è¯•ç”¨ä¾‹çš„æ–¹æ³•ï¼Œå› æ­¤æˆ‘å®šä¹‰äº†äº†ä¸€ä¸ªç±»Helper,å¹¶ä¸”å†™é™æ€æ–¹æ³•ï¼š 12345678static func generateSources(count: Int) -&gt; [Int] &#123; var sources: [Int] = [Int]() for _ in 1...count &#123; let randomNum: UInt32 = arc4random_uniform(1_000_000) sources.append(Int(randomNum)) &#125; return sources &#125; å­¦ä¹ ç®—æ³•å¿…ä¸å¯å°‘çš„ï¼Œå°±æ˜¯éœ€è¦å»éªŒè¯æˆ‘çš„ç®—æ³•ï¼Œæ˜¯å¦æ­£ç¡®ï¼Œè¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªé™æ€æ–¹æ³•å»éªŒè¯æˆ‘çš„ç®—æ³•æ˜¯å¦æ’åºæ­£ç¡®ï¼š 12345678910111213141516static func isSorted(testSources: [Int]) -&gt; Bool &#123; if testSources.count &lt; 3 &#123; assert(true, "ä½ é€—æˆ‘å‘¢ï¼Ÿï¼Ÿå°±å‡ ä¸ªè‡ªå·±æ•°") return false &#125; for i in 0...testSources.count - 2 &#123; if testSources[i] &gt; testSources[i + 1] &#123; return false &#125; &#125; return true &#125; å†™ç®—æ³•ï¼Œæˆ‘å¿…é¡»è¦å»è®¡ç®—æ¯ä¸ªç®—æ³•æ‰€æ‰§è¡Œçš„æ—¶é—´ï¼Œé€šè¿‡Unit Testçš„measureå¯ä»¥æ¥çœ‹å‡ºæ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ—¶é—´ï¼Œè¿™é‡Œæˆ‘ä¹Ÿå†™äº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼š 12345678static func executeTime(whichFunctionName: String, testSources: [Int], operation: ([Int]) -&gt; ([Int])) &#123; let methodStart = Date() let tt = operation(testSources) let methodFinished = Date() let executionTime = methodFinished.timeIntervalSince(methodStart) print(String(format:"æ‰§è¡Œ%@èŠ±è´¹%.9fs", whichFunctionName, executionTime)) assert(Helper.isSorted(testSources: tt), "æ’åºåè¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼ï¼") &#125; 1.2 å¼€å§‹coding é€‰æ‹©æ’åºï¼Œå…¶å®è¯´ç™½äº†ï¼Œå°±æ‰¾ç´¢å¼•, ä»å½“å‰ä½ç½®ä¸€ç›´å¾€åæ‰¾ï¼Œå¹¶ä¸”åˆ¤æ–­ï¼Œå¦‚æœå°ï¼Œå°±æ‰¾å‡ºä»–çš„ç´¢å¼•ï¼Œå†ç»§ç»­å¾€åæ‰¾ï¼Œç›´åˆ°åˆ°æœ€åä¸€ä½, è¿™é‡Œæ³¨æ„ï¼Œå®ƒæ˜¯ä¸èƒ½æå‰ç»“æŸçš„ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¯´ä»–ä¼šæ¯”æ’å…¥æ’åºæ…¢äº†ï¼š 123456789101112131415161718192021222324252627/** * é€‰æ‹©æ’åº */ func selectionSort(sources: [Int]) -&gt; [Int] &#123; var sources = sources for i in 0..&lt;sources.count &#123; var minIndex = i for j in i+1..&lt;sources.count &#123; if sources[j] &lt; sources[minIndex] &#123; minIndex = j &#125; &#125; if minIndex != i &#123; swap(&amp;sources[minIndex], &amp;sources[i]) &#125; &#125; return sources &#125; æ’å…¥æ’åºï¼Œæ˜¯ä»ç¬¬äºŒä¸ªä½ç½®å¼€å§‹å¾€å‰æ‰¾ï¼Œåˆ¤æ–­å‰é¢çš„æ˜¯å¦æ¯”ä»–å¤§ï¼Œæ¯”ä»–å¤§çš„è¯ï¼Œå°±å°†å‰é¢çš„æ•°å­—å¾€åæŒªï¼Œå› æ­¤ç±»æ¨ï¼š 12345678910111213141516171819202122232425/** * æ’å…¥æ’åº */ func insertionSort(sources: [Int]) -&gt; [Int] &#123; var sources = sources for i in 1..&lt;sources.count &#123; let e = sources[i] var j = i - 1 while ( j &gt;= 0 &amp;&amp; sources[j] &gt; e) &#123; sources[j + 1] = sources[j] j = j - 1 &#125; sources[j+1] = e &#125; return sources &#125; é€’å½’æ’åº 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061/** * å½’å¹¶æ’åº */ func mergeSort(sources: [Int]) -&gt; [Int] &#123; var sources = sources __mergeSort(sources: &amp;sources, l: 0, r: sources.count - 1) return sources &#125; func __mergeSort( sources: inout [Int], l: Int, r: Int) &#123; if l &gt;= r &#123; return &#125; let mid: Int = (l + r) / 2 __mergeSort(sources: &amp;sources, l: l, r: mid) __mergeSort(sources: &amp;sources, l: mid+1, r: r) __merge(sources: &amp;sources, l: l, mid: mid, r: r) &#125; // [l...mid] [mid+1...r] func __merge(sources: inout [Int], l: Int, mid: Int, r: Int) &#123; var aux = [Int]() for i in l...r &#123; aux.insert(sources[i], at: i-l) &#125; var i: Int = l var j: Int = mid + 1 for k in l...r &#123; if i &gt; mid &#123; sources[k] = aux[j-l] j = j + 1 &#125; else if j &gt; r &#123; sources[k] = aux[i-l] i = i + 1 &#125; else if aux[i-l] &lt; aux[j-l] &#123; sources[k] = aux[i-l] i = i + 1 &#125; else &#123; sources[k] = aux[j-l] j = j + 1 &#125; &#125; &#125; 1.3 æµ‹è¯•ï¼š å¦‚ä½•è°ƒç”¨ï¼š 12345678910override func viewDidLoad() &#123; super.viewDidLoad() let arr = Helper.generateSources(count: 1_000) let arr1 = arr Helper.executeTime(whichFunctionName: "æ’å…¥æ’åº", testSources: arr, operation: insertionSort) Helper.executeTime(whichFunctionName: "é€‰æ‹©æ’åº", testSources: arr1, operation: selectionSort) &#125; æ§åˆ¶å°çš„æ‰“å°ï¼š 12æ‰§è¡Œæ’å…¥æ’åºèŠ±è´¹0.016882956sæ‰§è¡Œé€‰æ‹©æ’åºèŠ±è´¹0.023320019s]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ Androidå¼€å‘åŸºç¡€ç¬”è®°Tips]]></title>
    <url>%2F2017%2F05%2F31%2F20170531%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ Android, æœ€è¿‘æ­£å¥½æœ‰æ—¶é—´ï¼Œå¯ä»¥ç³»ç»Ÿçš„çœ‹çœ‹Androidçš„ç³»ç»Ÿå¼€å‘ï¼Œè®°å½•ä¸‹å­¦ä¹ çš„ç¬”è®°ï¼Œä¾›ä»Šåå‚è€ƒã€‚1.1 åŸºç¡€ç¯å¢ƒï¼š ä½¿ç”¨çš„IDEä¸ºï¼šAndroid Studio. SDK æœ€ä½çš„ç‰ˆæœ¬ä¸ºï¼šAndroid 4.1. LinearLayoutæ˜¯å¸ƒå±€ç»„ä»¶ï¼Œå¯ä»¥ä»ç»§æ‰¿å…³ç³»ä¸Šçœ‹å‡ºå…³ç³», ç»§æ‰¿è‡ªViewçš„å­ç±»ViewGroupï¼Œå¹¶ä¸”FrameLayout,TableLayout,RelativeLayoutä»–ä»¬éƒ½æ˜¯ç»§æ‰¿è‡ªViewGroup 1234// ç»§æ‰¿å…³ç³»public class LinearLayout extends ViewGrouppublic abstract class ViewGroup extends View implements ViewParent, ViewManager 1.2 UIå±æ€§:123match_parent: è§†å›¾ä¸å…¶çˆ¶è§†å›¾å¤§å°ç›¸åŒwrap_content: è§†å›¾å°†æ ¹æ®å±•ç¤ºçš„å†…å®¹è‡ªåŠ¨è°ƒæ•´å¤§å°android:orientation: LinearLayout å…·æœ‰çš„å±æ€§ï¼Œå†³å®šå­ç»„ä»¶æ˜¯â€œæ°´å¹³â€è¿˜æ˜¯â€œå‚ç›´â€æ’åˆ— å­—ç¬¦ä¸²ï¼Œå¯¹æŸä¸ªç»„ä»¶setStringçš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°æ˜¯è¿™æ ·å†™çš„ï¼š@string/xxxx, è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼šandroid:textå±æ€§å€¼ä¸æ˜¯å­—ç¬¦ä¸²å€¼ï¼Œè€Œæ˜¯å¯¹å­—ç¬¦ä¸²èµ„æºçš„åº”ç”¨ï¼Œå…¶å®è¿™æ—¶å€™ä½ setStringçš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯å»app/res/valuesçš„æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾strings.xmlã€‚ 1&lt;string name="xxxx"&gt;YYYYYY&lt;/string&gt; éšæ„åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç³»ç»Ÿä¼šé»˜è®¤ç»™æˆ‘ä»¬åˆ›å»ºä¸€äº›ä»£ç ï¼š è¿™é‡Œçš„R.javaæ–‡ä»¶æ˜¯åœ¨ä»£ç ç¼–è¯‘çš„æ—¶å€™åˆ›å»ºçš„: 1234567public class QuizActivity extends AppCompatActivity &#123; @Overrideprotected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_quiz);&#125; AppCompatActivityæ˜¯Activityçš„å­ç±» activityåˆ›å»ºå®Œåï¼Œéœ€è¦è·å–è‡ªå·±çš„ç•Œé¢ï¼š 123public void setContentView(@LayoutRes int layoutResID) &#123;&#125; è¿™é‡Œçš„layoutResIDå°±æ˜¯è¦åœ¨èµ„æºä¸­æ¥å¯»æ‰¾ç›¸åº”çš„èµ„æºã€‚èµ„æºæ–‡ä»¶éœ€è¦ä»app/resç›®å½•ä¸‹å¯»æ‰¾ï¼Œå’ŒTextViewä¸­è·å–å­—ç¬¦ä¸²çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œéœ€è¦å»app/res/valuesä¸­çš„strings.xmlä¸­å»å¯»æ‰¾ï¼š 123public final void setText(@StringRes int resid) &#123;&#125; 1.3 æŒ‰é’®çš„ç‚¹å‡»ï¼š1234567mNextButton = (Button) findViewById(R.id.next_button); mNextButton.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; &#125; &#125;); 1.4 Toastçš„æç¤ºä¿¡æ¯ï¼š1Toast.makeText(CurrentActivity.this, R.string.xxx, Toast.LENGTH_SHORT).show(); 1.5 ç”Ÿå‘½å‘¨æœŸ ä¸å­˜åœ¨ -&gt;(onCreate)-&gt; åœæ­¢ï¼ˆä¸å¯è§ï¼‰-&gt;(onStart)-&gt;æš‚åœï¼ˆå¯è§ï¼‰-&gt; (onResume) è¿è¡Œï¼ˆå¯è§ &amp; åœ¨å‰å°ï¼‰ è¿è¡Œï¼ˆå¯è§ &amp; åœ¨å‰å°ï¼‰-&gt;(onPause)-&gt; æš‚åœï¼ˆå¯è§ -&gt;(onStop)-&gt; åœæ­¢ï¼ˆä¸å¯è§ -&gt;(onDestory)-&gt; ä¸å­˜åœ¨ åœ¨åˆ›å»ºäº†Activityä¹‹åï¼Œå¹¶ä¸”æ­¤å®ä¾‹å‡ºç°åœ¨å±å¹•ä¹‹å‰ä¼šè°ƒç”¨onCreateçš„æ–¹æ³• è½¬å±å¹•çš„æ—¶å€™ï¼Œç”Ÿå‘½å‘¨æœŸçš„æ”¹å˜ï¼š å½“å±å¹•å‘ç”Ÿè½¬åŠ¨çš„æ—¶å€™ï¼ŒActivityçš„ç”Ÿå‘½å‘¨æœŸä¼šä»æ–°å†èµ°ä¸€éï¼Œä¹Ÿå°±æ˜¯ ä¸Šé¢çš„ä¼šå…ˆæŒ‰ç…§ 2 -&gt; 1,æ¯æ¬¡è½¬å±éƒ½ä¼šè¿™æ ·ã€‚ æƒ³è¦åœ¨è½¬å±çš„æ—¶å€™ï¼Œä¿å­˜æ•°æ®ï¼Œå¯ä»¥è°ƒç”¨ä¸‹é¢onSaveInstanceStateçš„æ–¹æ³•æ¥ä¿å­˜æ•°æ®ï¼Œä¸‹æ¬¡åœ¨éœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥è·å–æ•°æ®ï¼š 1234567891011121314@Overrideprotected void onSaveInstanceState(Bundle outState) &#123; super.onSaveInstanceState(outState); outState.putInt(KEY_INDEX, mCurrentIndex);&#125; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); if (savedInstanceState != null) &#123; mCurrentIndex = savedInstanceState.getInt(KEY_INDEX); &#125; &#125; ä½†æ˜¯è½¬å±å¹¶ä¸”ä¿å­˜æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„è°ƒç”¨é¡ºåºä¸ºï¼š onPause() -&gt; onSaveInstanceState() -&gt; onStop() -&gt; onDestory()]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ çˆ¬è™«Scrapy[å®˜ç½‘æ•™ç¨‹]]]></title>
    <url>%2F2017%2F05%2F25%2F20170525%2F</url>
    <content type="text"><![CDATA[1.å­¦ä¹ çˆ¬è™«æ¡†æ¶ Scrapy å‰å‡ å¤©ä¸€ç›´åœ¨æ­£Djangoçš„æ¡†æ¶ï¼Œç°åœ¨åŸºæœ¬ä¸Šå·²ç»okäº†ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå·±åˆ›å»ºå±äºè‡ªå·±çš„ç½‘ç«™ã€éœ€è¦å‰å°å±•ç¤ºæ•°æ®ï¼Œåå°å¯ä»¥ç¼–è¾‘æ•°æ®ï¼Œå¯ä»¥æ’å…¥åˆ°æ•°æ®åº“ï¼Œå¯ä»¥å»ºç«‹è‡ªå·±çš„æ•°æ®ç±»å‹ï¼Œä½¿ç”¨Djangoå·²ç»å¤Ÿäº†ï¼Œé‚£ä¹ˆç°åœ¨æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„éš¾é¢˜ï¼šæ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿæ€ä¹ˆè·å–ï¼Ÿå¦‚ä½•å­˜å–ï¼Ÿ-&gt; Scrapyèƒ½å¤Ÿå¾ˆå¥½æ»¡è¶³æˆ‘ä»¬è¿™äº›éœ€æ±‚ã€‚ ç›®å‰æ–‡æ¡£æ˜¯çº¿ä¸Šæœ€æ–°çš„ç‰ˆæœ¬:Scrapy 1.3[https://docs.scrapy.org/en/latest/] 1.1 ä»€ä¹ˆæ˜¯Scrapy scrapyæ˜¯ä¸€ä¸ªwebç«¯æŠ“å–ç½‘ç«™æ•°æ®çš„æ¡†æ¶ï¼Œå¯ä»¥ç”¨æ¥æ•°æ®æŒ–æ˜ï¼Œä¿¡æ¯å¤„ç†ç­‰ç­‰ 1.2 å®‰è£…Scrapy å®‰è£…scrapyå®˜ç½‘å»ºè®®ä¸¤ç§é€”å¾„ï¼š 1.ä½¿ç”¨conda:12conda install -c conda-forge scrapy 2.ä½¿ç”¨pip: 12pip install Scrapy å®˜æ–¹å»ºè®®ï¼Œæˆ‘ä»¬åœ¨å®‰è£…Scrapyçš„æ—¶å€™ï¼Œæœ€å¥½å®‰è£…è‡ªå·±åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒä¸­a dedicated virtualenvï¼Œè¿™æ ·è‡³å°‘ä¸ä¼šä¸ç³»ç»Ÿçš„åŒ…äº§ç”Ÿå†²çªã€‚ virtualenvçš„å®‰è£…ç½‘å€ä¸ºï¼š[http://sourabhbajaj.com/mac-setup/Python/virtualenv.html] 12345678910//1.cd myproject///2.virtualenv venv // å¦‚æœä½ çš„ç³»ç»Ÿå·²ç»å®‰è£…äº†python2å·²ç»python3ï¼Œä½†æ˜¯ä½ ç°åœ¨æƒ³å»ºç«‹ä¸€ä¸ªpython3çš„ç¯å¢ƒ// virtualenv -p python3 envname//3.source venv/bin/activate//4.pip install Scrapy æ‰§è¡Œå®Œä¸Šé¢çš„4è¡Œå‘½ä»¤ï¼Œæ­¤æ—¶åº”è¯¥å°±å¯ä»¥å®‰è£…å¥½äº†Scrapyäº†ã€‚ æ‰§è¡Œä¸€ä¸‹pip listï¼Œçœ‹ä¸€ä¸‹å®‰è£…scrapyç³»ç»Ÿé»˜è®¤ç»™æˆ‘ä»¬å®‰è£…äº†ä»€ä¹ˆï¼š 1234567891011121314151617181920212223242526272829303132333435(venv) âœ venv pip listPackage Version---------------- -------appdirs 1.4.3asn1crypto 0.22.0attrs 17.1.0Automat 0.6.0cffi 1.10.0constantly 15.1.0cryptography 1.8.1cssselect 1.0.1enum34 1.1.6idna 2.5incremental 16.10.1ipaddress 1.0.18lxml 3.7.3packaging 16.8parsel 1.2.0pip 9.0.1pyasn1 0.2.3pyasn1-modules 0.0.8pycparser 2.17PyDispatcher 2.0.5pyOpenSSL 17.0.0pyparsing 2.2.0queuelib 1.4.2Scrapy 1.3.3service-identity 16.0.0setuptools 35.0.2six 1.10.0Twisted 17.1.0w3lib 1.17.0wheel 0.29.0zope.interface 4.4.1 lxml[http://lxml.de/], é«˜æ•ˆçš„xmlå’Œhtmlçš„è§£ææ¡†æ¶ï¼Œæœ€ä½ç‰ˆæœ¬ä¸º3.4 parsel[https://pypi.python.org/pypi/parsel] ,åœ¨lxmlçš„å°è£…ï¼Œè§£æhtml/xmlçš„æ•°æ® w3lib[https://pypi.python.org/pypi/w3lib], å¤„ç†é¡µé¢çš„urlä»¥åŠencodings twisted[https://twistedmatrix.com/trac/], å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ã€‚æœ€ä½ç‰ˆæœ¬ä¸ºï¼š14.0 cryptographyå’ŒpyOpenSSL(æœ€ä½ç‰ˆæœ¬ä¸º0.14) å¤šé‡ç½‘ç»œå®‰å…¨ 1.3 å¼€å§‹æŠ“å–æ•°æ®ï¼š ç°åœ¨æˆ‘ä»¬å¼€å§‹çˆ¬å–é¡µé¢ï¼Œè¿™é‡Œå°±çˆ¬å–ä¸€ä¸‹è¿™ä¸ªé¡µé¢ï¼šhttp://quotes.toscrape.com/ï¼Œè¿™ä¸ªç½‘ç«™åˆ—ä¸¾äº†å¾ˆå¤šè‘—åçš„å¯¼æ¼”ï¼Œè¿™ä¸ªæŠ“å–çš„ç›®çš„æœ‰ä¸‹é¢å‡ ä¸ªï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„Scrapyå¯¹è±¡. å†™ä¸€ä¸ªspiderå¯¹è±¡æŠ“å–ç½‘ç«™ï¼Œå¹¶ä¸”è§£ææ•°æ® ç”¨å‘½ä»¤è¡Œå¯¼å‡ºæŠ“å–çš„æ•°æ® æ”¹å˜è§„åˆ™ï¼Œé€’å½’çš„æŠ“å–æ•°æ® è¿ç”¨spiderçš„å‚æ•° 1.3.1 æ–°å»ºscrapyé¡¹ç›®12345678910//1.scrapy startproject tutorial//2.New Scrapy project 'tutorial', using template directory '/Users/gonghuan/Desktop/myproject/venv/lib/python2.7/site-packages/scrapy/templates/project', created in: /Users/gonghuan/Desktop/myproject/venv/tutorialYou can start your first spider with: cd tutorial scrapy genspider example example.com 1.3.2 åˆ›å»ºæˆ‘ä»¬ç¬¬ä¸€ä¸ªspider1234567891011121314151617181920import scrapyclass QuotesSpider(scrapy.Spider): name = "quotes" def start_requests(self): urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] for url in urls: yield scrapy.Request(url=url, callback=self.parse) def parse(self, response): page = response.url.split("/")[-2] filename = 'quotes-%s.html' % page with open(filename, 'wb') as f: f.write(response.body) self.log('Saved file %s' % filename) spideræ˜¯Scrapyç”¨æ¥æŠ“å–æ•°æ®çš„ç±» å¿…é¡»è¦ç»§æ‰¿scrapy.Spiderï¼Œå¹¶ä¸”è¦åˆå§‹åŒ–è¯·æ±‚ï¼ŒæŠ“å–è§„åˆ™ï¼Œè§£ææ•°æ®çš„è§„åˆ™ç­‰ç­‰ nameè¢«èµ‹å€¼ä¸ºquotes,è¿™æ˜¯ä½œä¸ºé¡¹ç›®çš„å”¯ä¸€æ ‡ç¤ºç¬¦ï¼Œå¿…é¡»å”¯ä¸€çš„ã€‚ start_requestsçš„æ–¹æ³•ï¼Œå¿…é¡»è¦è¿”å›ä¸€ä¸ªå¯ä»¥é€’å½’çš„requestè¯·æ±‚ã€‚ parseçš„æ–¹æ³•ï¼Œç”¨æ¥å¤„ç†ä¸‹è½½ä¸‹æ¥çš„responseï¼Œresponseçš„å‚æ•°ä¿å­˜åœ¨TextResponseçš„å®ä¾‹ä¸­ã€‚ parseçš„ä½œç”¨ï¼š1: è§£æresponse,å¹¶å°†çˆ¬å»ä¸‹æ¥çš„dicsè§£ææˆæˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œ2: å¹¶ä¸”æ‰¾åˆ°æ–°çš„urlæ•°æ®ï¼Œå¹¶ä¸”åˆ›å»ºæ–°çš„request æœ€åæ‰§è¡Œscrapy crawl quotes,è¿™ä¸ªå‘½ä»¤quoteså°±æ˜¯æˆ‘ä»¬åˆšæ‰å®šä¹‰çš„name,ç„¶åä»–ä»¬å°†ä¼šå‘quotes.toscrape.comè¿™ä¸ªåŸŸåå‘èµ·è¯·æ±‚,ç»ˆç«¯ä¹Ÿä¼šå‡ºç°ä¸‹é¢çš„è¿”å›ï¼š 1234567891011... (omitted for brevity)2016-12-16 21:24:05 [scrapy.core.engine] INFO: Spider opened2016-12-16 21:24:05 [scrapy.extensions.logstats] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min)2016-12-16 21:24:05 [scrapy.extensions.telnet] DEBUG: Telnet console listening on 127.0.0.1:60232016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (404) &lt;GET http://quotes.toscrape.com/robots.txt&gt; (referer: None)2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://quotes.toscrape.com/page/1/&gt; (referer: None)2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://quotes.toscrape.com/page/2/&gt; (referer: None)2016-12-16 21:24:05 [quotes] DEBUG: Saved file quotes-1.html2016-12-16 21:24:05 [quotes] DEBUG: Saved file quotes-2.html2016-12-16 21:24:05 [scrapy.core.engine] INFO: Closing spider (finished)... æ­¤æ—¶æ£€æŸ¥é¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼Œä¼šå‡ºç°quotes-1.htmlã€quotes-2.htmlè¿™æ ·çš„ä¸¤ä¸ªæ–‡ä»¶ï¼Œå°±ä»£è¡¨å·²ç»æˆåŠŸæŠ“å–ä¸‹æ¥äº†ã€‚ åˆšæ‰åœ¨start_requestsçš„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¿”å›äº†scrapy.Requestçš„å¯¹è±¡ï¼Œå½“è¿™äº›è¯·æ±‚ä¸€æ—¦æ¥å—åˆ°æœåŠ¡å™¨è¿”å›çš„responseçš„æ—¶å€™ï¼Œå°±ä¼šç«‹åˆ»è°ƒç”¨callbackçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯parseçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåŒ…å«åˆšæ‰æˆ‘ä»¬çš„è¯·æ±‚çš„urlä»¥åŠç›¸åº”çš„å‚æ•°ã€‚ 1.3.3 ç®€å†™ä»£ç  å…¶å®æˆ‘ä»¬å‘ç°start_requestså…¶å®å°±æ˜¯é€šè¿‡å¯¹äºçš„urlç”Ÿæˆç›¸åº”çš„scrapy.Requestçš„å¯¹è±¡ï¼Œä½†å…¶å®æˆ‘ä»¬å¯ä»¥ä¸ç”¨å®ç°start_requestsçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®šä¹‰ä¸€ä¸ªstart_urlsçš„åˆ—è¡¨ï¼Œé‡Œé¢çš„å…ƒç´ å°±æ˜¯ç›¸åº”çš„è¯·æ±‚url,ä¸€æ—¦ä½ å®šä¹‰äº†è¿™ä¸ªå¯¹è±¡ï¼Œstart_requestsä¼šé»˜è®¤ä»start_urlsæ¥è·å–url å³ä½¿åœ¨ä½ çš„ä»£ç ä¸­æ²¡æœ‰æŒ‡å®šçš„callbackå‡½æ•°ï¼Œparseçš„å‡½æ•°ä¹Ÿä¼šé»˜è®¤æ¥å¤„ç†æ¯ä¸ªurlå‘èµ·çš„è¯·æ±‚ï¼Œä¸»è¦ä¹Ÿæ˜¯å› ä¸ºparseæ˜¯ç³»ç»Ÿé»˜è®¤çš„æ–¹æ³•ï¼ˆå½“ä½ æ²¡æœ‰å‡†ç¡®çš„æŒ‡å®šcallbackï¼‰ ä¿®æ”¹ä¸ºå¦‚ä¸‹çš„ä»£ç ï¼š 123456789101112131415import scrapyclass QuotesSpider(scrapy.Spider): name = "quotes" start_urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] def parse(self, response): page = response.url.split("/")[-2] filename = 'quotes-%s.html' % page with open(filename, 'wb') as f: f.write(response.body) 1.3.4 è§£ææ•°æ® å®˜æ–¹çš„å»ºè®®ï¼Œæœ€å¥½çš„è§£ææ˜¯åœ¨shell [https://docs.scrapy.org/en/latest/topics/shell.html#topics-shell] çš„æ“ä½œä¸‹ï¼Œåœ¨æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒä¸‹æ‰§è¡Œå¦‚ä¸‹çš„è„šæœ¬scrapy shell &quot;http://quotes.toscrape.com/page/1/&quot; çœ‹åˆ°å¦‚ä¸‹çš„ç»ˆç«¯è¿”å›ï¼š 123456789101112131415[ ... Scrapy log here ... ]2016-09-19 12:09:27 [scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://quotes.toscrape.com/page/1/&gt; (referer: None)[s] Available Scrapy objects:[s] scrapy scrapy module (contains scrapy.Request, scrapy.Selector, etc)[s] crawler &lt;scrapy.crawler.Crawler object at 0x7fa91d888c90&gt;[s] item &#123;&#125;[s] request &lt;GET http://quotes.toscrape.com/page/1/&gt;[s] response &lt;200 http://quotes.toscrape.com/page/1/&gt;[s] settings &lt;scrapy.settings.Settings object at 0x7fa91d888c10&gt;[s] spider &lt;DefaultSpider 'default' at 0x7fa91c8af990&gt;[s] Useful shortcuts:[s] shelp() Shell help (print this help)[s] fetch(req_or_url) Fetch request (or URL) and update local objects[s] view(response) View response in a browser&gt;&gt;&gt; æˆ‘ä»¬å¦‚ä½•è·å–responseé‡Œé¢çš„å…ƒç´ å‘¢ï¼Ÿå¯ä»¥é€šè¿‡css [https://www.w3.org/TR/selectors/] æ‰§è¡Œresponse.css(&#39;title&#39;),å°±å¯ä»¥åœ¨ç»ˆç«¯çœ‹åˆ°å¦‚ä¸‹çš„è¿”å›ï¼š 1[&lt;Selector xpath='descendant-or-self::title' data='&lt;title&gt;Quotes to Scrape&lt;/title&gt;'&gt;] æ‰§è¡Œresponse.css(&#39;title&#39;)è¿”å›çš„æ˜¯ä¸€ä¸ªç±»ä¼¼åˆ—è¡¨çš„ä¸€ä¸ªä¸œè¥¿ï¼Œè¿™ä¸ªä¸œè¥¿å«åšSelectorList,è¿™ä¸ªåˆ—è¡¨é‡Œé¢å°±æ˜¯æœç´¢çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æ˜¯Selector,è¿™äº›Selectorå°±æ˜¯åŒ…è£…è¿™äº›XML/HTMLçš„å¤–å£³ã€‚ä½ å¯ä»¥ç›´æ¥é€šè¿‡Selectorç›´æ¥è·å¾—é‡Œé¢çš„å€¼ï¼š 12&gt;&gt;&gt; response.css('title').extract()['&lt;title&gt;Quotes to Scrape&lt;/title&gt;'] ä½ ä¼šå‘ç°è¿˜æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦å¯¹cssè¿›è¡Œè¿‡æ»¤ï¼Œæ·»åŠ ::textï¼Œå°±è¡¨ç¤ºæˆ‘ä»¬æƒ³è¦çš„åªæ˜¯&lt;title&gt;æ ‡ç­¾ä¸­å¯¹åº”çš„å€¼ 12&gt;&gt;&gt; response.css('title::text').extract()['Quotes to Scrape'] è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä½†æ˜¯ä½ ç¡®å®šä½ éœ€è¦çš„æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ çš„è¯ï¼Œå¯ä»¥è¿™æ ·ç›´æ¥ä½¿ç”¨extract_firstå–å¾—åˆ—è¡¨ä¸­çš„å…ƒç´ ,è¿™æ ·ä¸ºäº†é¿å…äº§ç”ŸIndexErrorï¼š 12&gt;&gt;&gt; response.css('title::text').extract_first()'Quotes to Scrape' é™¤äº†ä½¿ç”¨extract()ä»¥åŠextract_first(),è¿˜æ˜¯å¯ä»¥ä½¿ç”¨re()ï¼Œå°±æ˜¯é€šè¿‡æ­£åˆ™æ¥ç­›é€‰è§£æçš„æ•°æ® 123456&gt;&gt;&gt; response.css('title::text').re(r'Quotes.*')['Quotes to Scrape']&gt;&gt;&gt; response.css('title::text').re(r'Q\w+')['Quotes']&gt;&gt;&gt; response.css('title::text').re(r'(\w+) to (\w+)')['Quotes', 'Scrape'] 1.3.4 é™¤äº†ä½¿ç”¨CSSï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨XPathæ¥æŸ¥æ‰¾å…ƒç´  ä¾‹å¦‚ï¼š 1234&gt;&gt;&gt; response.xpath('//title')[&lt;Selector xpath='//title' data='&lt;title&gt;Quotes to Scrape&lt;/title&gt;'&gt;]&gt;&gt;&gt; response.xpath('//title/text()').extract_first()'Quotes to Scrape' XPathæ˜¯éå¸¸å½¢è±¡å…·ä½“ï¼Œå¹¶ä¸”åŠŸèƒ½å¼ºå¤§çš„ï¼ŒCSSçš„é€‰æ‹©å™¨ä¹Ÿæ˜¯é€šè¿‡ä¸€äº›æ¥å£æ¥è½¬åŒ–ä¸ºXPathçš„ï¼Œè™½ç„¶XPathæ²¡æœ‰CSSé‚£ä¹ˆå‡ºåï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œå®˜æ–¹ä¹Ÿæ˜¯å»ºè®®å­¦ä¹ ä½¿ç”¨XPathï¼Œç»™å‡ºç›¸å…³çš„é“¾æ¥ï¼š [https://docs.scrapy.org/en/latest/topics/selectors.html#topics-selectors] [http://zvon.org/comp/r/tut-XPath_1.html] [http://plasmasturm.org/log/xpath101/] 1.3.5 è§£ææ•°æ® ç°åœ¨ä½ å·²ç»çŸ¥é“äº†ä¸€äº›å…³äºé€‰æ‹©å™¨ï¼Œè·å–æ•°æ®çš„æ–¹æ³•ï¼Œç°åœ¨å°±å¯ä»¥å®Œå–„æˆ‘ä»¬ä¹‹å‰çš„çˆ¬è™«äº† åˆšæ‰æˆ‘ä»¬çˆ¬å»çš„çš„é¡µé¢ä¸­ï¼Œä½ ä¼šå‘ç°æ¯ä¸ªhttp://quotes.toscrape.coméƒ½å«æœ‰ä¸€ä¸‹çš„htmlï¼š 123456789101112131415&lt;div class="quote"&gt; &lt;span class="text"&gt;â€œThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.â€&lt;/span&gt; &lt;span&gt; by &lt;small class="author"&gt;Albert Einstein&lt;/small&gt; &lt;a href="/author/Albert-Einstein"&gt;(about)&lt;/a&gt; &lt;/span&gt; &lt;div class="tags"&gt; Tags: &lt;a class="tag" href="/tag/change/page/1/"&gt;change&lt;/a&gt; &lt;a class="tag" href="/tag/deep-thoughts/page/1/"&gt;deep-thoughts&lt;/a&gt; &lt;a class="tag" href="/tag/thinking/page/1/"&gt;thinking&lt;/a&gt; &lt;a class="tag" href="/tag/world/page/1/"&gt;world&lt;/a&gt; &lt;/div&gt;&lt;/div&gt; è¿˜æ˜¯é€šè¿‡shellçš„æ–¹æ³•æ¥æµ‹è¯•ï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç : 1234//1.scrapy shell 'http://quotes.toscrape.com//2.response.css("div.quote") å½“ç„¶ä¹Ÿå¯ä»¥æŠŠç­›é€‰åçš„æ•°æ®ï¼Œå¤åˆ¶ç»™æ¯ä¸ªå˜é‡ï¼š 1quote = response.css("div.quote")[0] ç°åœ¨ä¹Ÿå¯ä»¥é€šè¿‡è§£æquoteæ¥è·å¾—ä¸‹é¢çš„å€¼ï¼štitle/author/tag 123456789&gt;&gt;&gt; title = quote.css("span.text::text").extract_first()&gt;&gt;&gt; title'â€œThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.â€'&gt;&gt;&gt; author = quote.css("small.author::text").extract_first()&gt;&gt;&gt; author'Albert Einstein'&gt;&gt;&gt; tags = quote.css("div.tags a.tag::text").extract()&gt;&gt;&gt; tags['change', 'deep-thoughts', 'thinking', 'world'] å·²ç»å¯ä»¥çŸ¥é“æˆ‘ä»¬æ˜¯å¦‚ä½•æ¥è·å–æ•°æ®çš„äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥éå†å¾ªç¯ï¼Œå¹¶ä¸”å°†çˆ¬å»ä¸‹æ¥çš„æ•°æ®æ’å…¥åˆ°æˆ‘ä»¬çš„Pythonçš„å­—å…¸æ•°æ®ç»“æ„ä¸­ï¼š 123456789&gt;&gt;&gt; for quote in response.css("div.quote"):... text = quote.css("span.text::text").extract_first()... author = quote.css("small.author::text").extract_first()... tags = quote.css("div.tags a.tag::text").extract()... print(dict(text=text, author=author, tags=tags))&#123;'tags': ['change', 'deep-thoughts', 'thinking', 'world'], 'author': 'Albert Einstein', 'text': 'â€œThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.â€'&#125;&#123;'tags': ['abilities', 'choices'], 'author': 'J.K. Rowling', 'text': 'â€œIt is our choices, Harry, that show what we truly are, far more than our abilities.â€'&#125; ... a few more of these, omitted for brevity&gt;&gt;&gt; 1.3.5 æ›´æ–°æˆ‘ä»¬çš„spideä»£ç ï¼š ç°åœ¨å›åˆ°æˆ‘ä»¬ä¹‹å‰æ–°å»ºçš„spiderçš„é¡¹ç›®ä¸­å»ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜çœŸæ­£å»è·å–ä»»ä½•çš„æ•°æ®ï¼Œæˆ‘ä»¬åªæ˜¯åšäº†ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯è®²é¡µé¢çš„htmlçš„ä»£ç ä¿å­˜åœ¨æœ¬åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªé¡µé¢çš„æ•°æ®ï¼Œçˆ¬å»ä¸‹æ¥ï¼Œå¹¶ä¸”å°†è¿™äº›æ•°æ®æ”¾ä¸‹Pythonçš„å­—å…¸çš„æ•°æ®ç»“æ„ä¸­ï¼Œå¹¶ä¸”è¿”å›å›å»ã€‚ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617import scrapyclass QuotesSpider(scrapy.Spider): name = "quotes" start_urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] def parse(self, response): for quote in response.css('div.quote'): yield &#123; 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('small.author::text').extract_first(), 'tags': quote.css('div.tags a.tag::text').extract(), &#125; è¿è¡Œä¹‹åçœ‹åˆ°å¦‚ä¸‹çš„è¿”å›ï¼š 12342016-09-19 18:57:19 [scrapy.core.scraper] DEBUG: Scraped from &lt;200 http://quotes.toscrape.com/page/1/&gt;&#123;'tags': ['life', 'love'], 'author': 'AndrÃ© Gide', 'text': 'â€œIt is better to be hated for what you are than to be loved for what you are not.â€'&#125;2016-09-19 18:57:19 [scrapy.core.scraper] DEBUG: Scraped from &lt;200 http://quotes.toscrape.com/page/1/&gt;&#123;'tags': ['edison', 'failure', 'inspirational', 'paraphrased'], 'author': 'Thomas A. Edison', 'text': "â€œI have not failed. I've just found 10,000 ways that won't work.â€"&#125; 1.3.6 ä¿å­˜æ•°æ® æœ€ç®€å•çš„ä¿å­˜å½¢å¼å°±æ˜¯é€šè¿‡Feed exports [https://docs.scrapy.org/en/latest/topics/feed-exports.html#topics-feed-exports] è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„ä»£ç ä¿å­˜ä¸ºjsonçš„æ ¼å¼ï¼š 1scrapy crawl quotes -o quotes.json æ­¤æ—¶åœ¨æ–‡ä»¶ä¸­å°±ä¼šå‡ºç°ä¸€ä¸ªåå«quotes.jsonçš„æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬åˆšæ‰çˆ¬å»ä¸‹æ¥çš„æ•°æ®ã€‚ å…¶å®åœ¨ä¸€äº›ç®€å•çš„çˆ¬è™«é¡¹ç›®ä¸­ï¼Œè¿™æ ·å†™ï¼Œå…¶å®å·²ç»è¶³å¤Ÿäº†ï¼Œä½†æ˜¯åœ¨ä¸€äº›å¤æ‚çš„å¤§å‹é¡¹ç›®ä¸­ï¼Œå¯ä»¥å†™Item Pipeline[https://docs.scrapy.org/en/latest/topics/item-pipeline.html#topics-item-pipeline], å…¶å®è¿™ä¸ªåŠŸèƒ½å°±æ˜¯å¯¹åº”çš„é¡¹ç›®çš„ä¸­tutorial/pipelines.py, scrapyé¡¹ç›®é»˜è®¤ä¼šå¸®ä½ åˆ›å»ºçš„ã€‚ 1.3.7 è·å–æ›´å¤šçš„url å…¶å®åˆšæ‰åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯çˆ¬å»äº†ä¸¤ä¸ªurlï¼Œå¹¶ä¸”ä¹ŸçŸ¥é“å¦‚ä½•å»è§£æä»–ä»¬ï¼Œä½†æ˜¯å¯èƒ½æˆ‘ä»¬éœ€è¦çš„æ˜¯çˆ¬å»æ•´ä¸ªç½‘ç«™çš„urlï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨çˆ¬å»ä¸€ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œé‡åˆ°è¿™æ ·çš„html,æˆ‘ä»¬å°±éœ€è¦è®¡ç®—å¹¶ä¸”è·å–å¯¹åº”çš„url: 12345&lt;ul class="pager"&gt; &lt;li class="next"&gt; &lt;a href="/page/2/"&gt;Next &lt;span aria-hidden="true"&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt; æ­¤æ—¶ä½ å¯èƒ½éœ€è¦è·å–çš„æ˜¯aé‡Œé¢å¯¹åº”çš„hrefçš„å€¼ï¼š 12&gt;&gt;&gt; response.css('li.next a::attr(href)').extract_first()'/page/2/' ç°åœ¨æˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆ‘ä»¬çš„spiderçš„ä»£ç äº†ï¼Œå¹¶ä¸”ä¸éœ€è¦æŒ‡å®šå‡ ä¸ªurläº†ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›é€»è¾‘éƒ½æ”¾åˆ°parseçš„å‡½æ•°ä¸­å»ï¼š 123456789101112131415161718192021import scrapyclass QuotesSpider(scrapy.Spider): name = "quotes" start_urls = [ 'http://quotes.toscrape.com/page/1/', ] def parse(self, response): for quote in response.css('div.quote'): yield &#123; 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('small.author::text').extract_first(), 'tags': quote.css('div.tags a.tag::text').extract(), &#125; next_page = response.css('li.next a::attr(href)').extract_first() if next_page is not None: next_page = response.urljoin(next_page) yield scrapy.Request(next_page, callback=self.parse) ä¸Šé¢çš„ä»£ç å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œå½“è§£æå®Œæ•°æ®ä¹‹åï¼Œæˆ‘ä»¬å°±ä¼šå¯»æ‰¾ä¸‹ä¸€é¡µçš„url,å¹¶ä¸”å‘ç°è¿™é‡Œå†™çš„æ˜¯ä¸€ä¸ªç›¸å¯¹çš„urlï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡urljoin()è¿™ä¸ªå‡½æ•°æ¥æ‹¼æ¥urlï¼Œå¹¶ä¸”yieldså›å»ä¸€ä¸ªæ–°çš„requestï¼Œå½“æ‹¿åˆ°çš„respsonseåˆä¼šå›åˆ°parseçš„å‡½æ•°ä¸­æ¥è§£æ scrapyçš„ä¸‹è½½æœºåˆ¶ï¼šå½“ä½ yieldsä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œscrapyä¼šå‘é€æ”¹è¯·æ±‚ï¼Œå¹¶æ³¨å†Œä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å®Œæˆçš„æ—¶å€™èƒ½å¤Ÿè§£æä»–ã€‚ 1.3.8 ç®€åŒ–å‘é€çš„è¯·æ±‚ ä¸ºäº†ç®€åŒ–å‘é€çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨response.follow, è€Œä¸æ˜¯æ–°å»ºä¸€ä¸ªæ–°çš„Request 1234567891011121314151617181920import scrapyclass QuotesSpider(scrapy.Spider): name = "quotes" start_urls = [ 'http://quotes.toscrape.com/page/1/', ] def parse(self, response): for quote in response.css('div.quote'): yield &#123; 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('span small::text').extract_first(), 'tags': quote.css('div.tags a.tag::text').extract(), &#125; next_page = response.css('li.next a::attr(href)').extract_first() if next_page is not None: yield response.follow(next_page, callback=self.parse) ä¸scrapy.Requestä¸åŒï¼Œresponse.followæ˜¯æ”¯æŒç›¸å¯¹è·¯å¾„ï¼Œå…¶å®å°±æ˜¯è¿™ä¸ªfollowå®ƒä¼šæ›¿æˆ‘ä»¬åšresponse.urljoin,å¹¶ä¸”response.followè¿”å›æ˜¯ä¸€ä¸ªRequestçš„å®ä¾‹ã€‚ ä¹‹å‰çš„ä»£ç ï¼Œå–çš„æ˜¯åˆ—è¡¨ä¸­çš„ç¬¬ä¸€é¡¹å…ƒç´ ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥æšä¸¾è¿™ä¸ªåˆ—è¡¨ï¼Œæ¥è°ƒç”¨response.follow 123456for href in response.css('li.next a::attr(href)'): yield response.follow(href, callback=self.parse) // ä¹Ÿå¯ä»¥è¿›è¡Œç®€å†™for a in response.css('li.next a'): yield response.follow(a, callback=self.parse) å¯¹äºæŠ“å–ä½œè€…ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„å›è°ƒå‡½æ•° 1234567891011121314151617181920212223242526import scrapyclass AuthorSpider(scrapy.Spider): name = 'author' start_urls = ['http://quotes.toscrape.com/'] def parse(self, response): # follow links to author pages for href in response.css('.author + a::attr(href)'): yield response.follow(href, self.parse_author) # follow pagination links for href in response.css('li.next a::attr(href)'): yield response.follow(href, self.parse) def parse_author(self, response): def extract_with_css(query): return response.css(query).extract_first().strip() yield &#123; 'name': extract_with_css('h3.author-title::text'), 'birthdate': extract_with_css('.author-born-date::text'), 'bio': extract_with_css('.author-description::text'), &#125; è¿™é‡Œå½“æ‰¾åˆ°authorç›¸å…³çš„é“¾æ¥ï¼Œæˆ‘ä»¬ä¼šå›è°ƒæˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°parse_author,åœ¨è¿™ä¸ªå‡½æ•°é‡Œï¼Œæˆ‘ä»¬é¡¶ä¸€ä¸ªå¸®åŠ©å‡½æ•°ï¼Œå¸®åŠ©æˆ‘ä»¬å…·ä½“è¿˜è·å–é‡Œé¢çš„å€¼ï¼Œåœ¨parseå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼šæ‰¾åˆ°ä¸‹ä¸€é¡µçš„è¯·æ±‚ï¼Œç„¶åç»§ç»­å‘é€è¯·æ±‚ï¼Œå›è°ƒå‡½æ•°è¿˜æ˜¯æˆ‘ä»¬çš„parseçš„å‡½æ•°. è¿™é‡Œæœ‰ä¸ªå…³é”®çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒåŒä¸€ä¸ªurlå‘é€å¤šæ¬¡ï¼Œæ˜“å¯¼è‡´è¿›å…¥æ­»å¾ªç¯ï¼ŒScrapyé»˜è®¤æ˜¯èƒ½å¤Ÿè¿‡æ»¤å·²ç»è¯·æ±‚è¿‡çš„urlï¼Œå¹¶ä¸”ä½ è¿˜å¯ä»¥é€šè¿‡åœ¨settings.pyçš„æ–‡ä»¶ä¸­è®¾ç½®DUPEFILTER_CLASS [https://docs.scrapy.org/en/latest/topics/settings.html#std:setting-DUPEFILTER_CLASS]ã€‚ 1.3.9 åœ¨spiderä¸­ä¼ é€’å‚æ•° æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„-aæ¥ä¼ é€’å‚æ•°ï¼Œè¿™äº›å‚æ•°é»˜è®¤æ˜¯ä¼ é€’åˆ°Spiderä¸­çš„__init__å‡½æ•°ä¸­å»ï¼Œå¹¶ä¸”èƒ½å¤Ÿæˆä¸ºspiderçš„å±æ€§å€¼ 1scrapy crawl quotes -o quotes-humor.json -a tag=humor ä¾‹å¦‚ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä¼ é€’äº†tagçš„å€¼ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åœ¨æˆ‘çš„spideré¡¹ç›®ä¸­èƒ½å¤Ÿé€šè¿‡self.tagæ¥è·å–ä¼ è¿›æ¥çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™æ ·çš„å€¼æ¥è¯·æ±‚å‡†ç¡®url,å…¶å®å°±æ˜¯è¯·æ±‚çš„æ˜¯è¿™æ ·çš„url: http://quotes.toscrape.com/tag/humor 12345678910111213141516171819202122import scrapyclass QuotesSpider(scrapy.Spider): name = "quotes" def start_requests(self): url = 'http://quotes.toscrape.com/' tag = getattr(self, 'tag', None) if tag is not None: url = url + 'tag/' + tag yield scrapy.Request(url, self.parse) def parse(self, response): for quote in response.css('div.quote'): yield &#123; 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('small.author::text').extract_first(), &#125; next_page = response.css('li.next a::attr(href)').extract_first() if next_page is not None:]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Pythonã€Scrapy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ Djangoç¬¬äº”/å…­éƒ¨åˆ†ï¼ŒåŸºæœ¬çš„æµ‹è¯•ç”¨ä¾‹[å®˜ç½‘æ•™ç¨‹]]]></title>
    <url>%2F2017%2F05%2F17%2F20170517%2F</url>
    <content type="text"><![CDATA[ç»è¿‡å‰å››éƒ¨åˆ†çš„å­¦ä¹ ï¼Œæ­¤æ—¶æˆ‘ä»¬å·²ç»åˆ›å»ºäº†æˆ‘ä»¬ç¬¬ä¸€ä¸ªappï¼špolls, å¹¶ä¸”æ ¹æ®æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚ï¼Œä¿®æ”¹äº†urlï¼Œä¿®æ”¹äº†å¯¹åº”çš„viewå‡½æ•°ï¼Œè¿æ¥æ•°æ®åº“ï¼Œæ’å…¥æ•°æ®åº“ç›¸åº”çš„æ•°æ®ï¼Œå¹¶å°†æ•°æ®åº“é‡Œçš„æ•°æ®æå‡ºæ¥ï¼Œæ˜¾ç¤ºåœ¨æ¨¡æ¿ä¸Šï¼Œè¿™ä¼¼ä¹å°±æ˜¯æˆ‘ä»¬åœ¨å‰å››éƒ¨åˆ†åšçš„äº‹æƒ…ï¼Œè¯´èµ·æ¥ç®€å•ï¼Œä½†æ˜¯åšå¥½ã€åšç²¾ç»†å´ä¸å®¹æ˜“ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šä¸ºæˆ‘ä»¬çš„appæä¾›æµ‹è¯•çš„åŠŸèƒ½ã€‚1.1 ä»€ä¹ˆæ˜¯è‡ªåŠ¨æµ‹è¯• æµ‹è¯•æ˜¯å¯¹ä»£ç å¯¹å¥½æ£€æµ‹ï¼Œæµ‹è¯•èƒ½å¤Ÿé’ˆå¯¹ä¸åŒå±‚é¢è¿›è¡Œæµ‹è¯•(1.å¯¹æŸä¸ªç‰¹å®šçš„æ–¹æ³•æ˜¯å¦æŒ‰ç…§é¢„æœŸè¿”å›éƒ½èƒ½å¤Ÿè¿›è¡Œæµ‹è¯•ã€‚2.æœ‰çš„äººä¼šå¯¹æ•´ä¸ªé¡¹ç›®çš„æ•´ä½“æ“ä½œåšç›¸åº”çš„æµ‹è¯•ç”¨æˆ·è¾“å…¥å…·ä½“çš„æŸäº›å€¼ï¼Œå¾—åˆ°é¢„æœŸçš„ä¸€äº›å€¼)ï¼Œå…¶å®è¿™é‡Œçš„æµ‹è¯•ä¸ç¬¬äºŒéƒ¨åˆ†è¿ç”¨shellçš„æ“ä½œæ˜¯å·®ä¸å¤šçš„ã€‚ è€Œè‡ªåŠ¨åŒ–æµ‹è¯•åŒºåˆ«åœ¨äºï¼Œä¸€æ—¦ä½ çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”Ÿæˆäº†ä¹‹åï¼Œå½“ä½ ä¿®æ”¹äº†ä»£ç ä¹‹åï¼Œä½ ä¸éœ€è¦å†èŠ±æ—¶é—´äººå·¥å»æµ‹è¯•ï¼Œè‡ªåŠ¨å¯ä»¥æµ‹è¯•ä½ çš„ä»£ç ã€‚ 1.2 å†™ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ pollsçš„åº”ç”¨å­˜åœ¨ä¸€äº›å°bugï¼Œåœ¨Questionçš„Modelä¸­å®šä¹‰äº†è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½å¤Ÿåˆ¤æ–­æˆ‘ä»¬å‘å¸ƒçš„æ—¶é—´æ˜¯ä¸æ˜¯åœ¨ä¸€å¤©ä¹‹å†…çš„ï¼Œå¦‚æœåœ¨ä¸€å¤©ä¹‹å†…å°±ä¼šè¿”å›Trueï¼Œå¦åˆ™å°±æ˜¯Falseï¼š 12def was_published_recently(self): return self.pub_date &gt;= timezone.now() - datetime.timedelta(days=1) è¿ç”¨shell,åœ¨ç»ˆç«¯è¾“å…¥python manager.py shellï¼Œç„¶åå†è¾“å…¥ä¸‹é¢çš„ä»£ç ï¼š 12345678&gt;&gt;&gt; import datetime&gt;&gt;&gt; from django.utils import timezone&gt;&gt;&gt; from polls.models import Question&gt;&gt;&gt; # create a Question instance with pub_date 30 days in the future&gt;&gt;&gt; future_question = Question(pub_date=timezone.now() + datetime.timedelta(days=30))&gt;&gt;&gt; # was it published recently?&gt;&gt;&gt; future_question.was_published_recently()True è¿™ä¸ªæ˜¾ç„¶æ˜¯é”™è¯¯çš„ï¼Œè·ç¦»æˆ‘å‘å¸ƒçš„æ—¶é—´30å¤©ï¼Œåº”è¯¥è¿”å›false å¼€å§‹å†™è‡ªåŠ¨åŒ–æµ‹è¯•æ¥å‘ç°æš´éœ²è¿™ä¸ªbugï¼Œè‡³å°‘åœ¨ä»Šåï¼Œä¸ä¼šå†å‡ºç°ç±»ä¼¼çš„é—®é¢˜äº†ã€‚ æ‰“å¼€polls/tests.pyçš„æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 123456789101112131415161718import datetimefrom django.utils import timezonefrom django.test import TestCasefrom .models import Questionclass QuestionMethodTests(TestCase): def test_was_published_recently_with_future_question(self): """ was_published_recently() should return False for questions whose pub_date is in the future. """ time = timezone.now() + datetime.timedelta(days=30) future_question = Question(pub_date=time) self.assertIs(future_question.was_published_recently(), False) è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªdjango.test.TestCaseçš„å­ç±»ï¼Œå®ä¾‹åŒ–äº†ä¸€ä¸ªQuestionçš„å¯¹è±¡ï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ªtimeçš„å‚æ•°ï¼Œç„¶åæ–­è¨€questionçš„was_published_recently()è¿”å›çš„ä¸ºfalse æ‰§è¡Œpython manage.py test polls 12345678910111213141516Creating test database for alias 'default'...System check identified no issues (0 silenced).F======================================================================FAIL: test_was_published_recently_with_future_question (polls.tests.QuestionMethodTests)----------------------------------------------------------------------Traceback (most recent call last): File "/path/to/mysite/polls/tests.py", line 16, in test_was_published_recently_with_future_question self.assertIs(future_question.was_published_recently(), False)AssertionError: True is not False----------------------------------------------------------------------Ran 1 test in 0.001sFAILED (failures=1)Destroying test database for alias 'default'... æ‰§è¡Œpython manage.py test pollsæ˜¯è®©Djangoå»åœ¨pollsè¿™ä¸ªapp åº”ç”¨ä¸­æŸ¥æ‰¾ä½ å†™çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå½“DjangoæŸ¥æ‰¾åˆ°django.test.TestCaseçš„å­ç±»ï¼ŒDjangoå°†ä¼šä¸ºè¿™ä¸ªæµ‹è¯•åˆ›å»ºä¸€äº›æ•°æ®ï¼ŒDjangoæ¥ç€å»å¯»æ‰¾ä»¥testå¼€å¤´çš„æµ‹è¯•æ–¹æ³•,åœ¨åˆšæ‰æˆ‘ä»¬åˆ›å»ºçš„test_was_published_recently_with_future_questionè¿™ä¸ªå‡½æ•°ï¼Œç¬¬äºŒè¡Œä¸­ï¼Œä¼ å…¥äº†ä¸€ä¸ªpub_dateåˆ›å»ºäº†ä¸€ä¸ªQuestionçš„å®ä¾‹å¯¹è±¡ï¼Œæ¥ç€å°±æ–­è¨€questionçš„was_published_recently()è¿”å›ä¸ºFalse, ä½†æ˜¯å®é™…ä¸Šè¿”å›çš„æ˜¯True,è¿™ä¹Ÿå°±æ˜¯å¯¼è‡´æˆ‘ä»¬æ–­è¨€å¤±è´¥çš„åŸå› æ‰€åœ¨ã€‚ 1.3 ä¿®æ”¹bug æ­¤æ—¶æˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚æœæˆ‘ä»¬è®¾ç½®çš„pub_dateæ˜¯å°†æ¥çš„æ—¶é—´çš„è¯ï¼ŒQuestion.was_published_recently()å°±åº”è¯¥è¿”å›çš„æ˜¯False,æ‰€ä»¥æ‰“å¼€polls/models.pyä¿®æ”¹ä¸ºï¼š 123def was_published_recently(self): now = timezone.now() return now - datetime.timedelta(days=1) &lt;= self.pub_date &lt;= now å†æ¬¡æ‰§è¡Œpython manage.py test pollså°±ä¼šå¾—åˆ°ä¸‹é¢çš„æ­£ç¡®åé¦ˆï¼š 123456789GhCoder_Site python manage.py test pollsCreating test database for alias 'default'...System check identified no issues (0 silenced)..----------------------------------------------------------------------Ran 1 test in 0.002sOKDestroying test database for alias 'default'... 1.4 æ›´å…¨é¢çš„æµ‹è¯• ä¾æ—§æµ‹è¯•was_published_recently()è¿™ä¸ªå‡½æ•°ï¼Œè®©æˆ‘ä»¬çš„æµ‹è¯•æ›´åŠ å…¨é¢ï¼Œæ·»åŠ å¦‚ä¸‹çš„ä¸¤ä¸ªæ–¹æ³•ï¼š 1234567891011121314151617def test_was_published_recently_with_old_question(self): """ was_published_recently() should return False for questions whose pub_date is older than 1 day. """ time = timezone.now() - datetime.timedelta(days=30) old_question = Question(pub_date=time) self.assertIs(old_question.was_published_recently(), False)def test_was_published_recently_with_recent_question(self): """ was_published_recently() should return True for questions whose pub_date is within the last day. """ time = timezone.now() - datetime.timedelta(hours=1) recent_question = Question(pub_date=time) self.assertIs(recent_question.was_published_recently(), True) è¿™é‡Œæˆ‘ä»¬æ·»åŠ äº†è¶…è¿‡ä¸€å¤©çš„æ•°æ®ï¼Œä»¥åŠä¸€å¤©ä¹‹å†…çš„æ•°æ®ï¼Œæµ‹è¯•è¿”å›å›æ¥éƒ½å’Œæˆ‘ä»¬çš„æ–­è¨€æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·æˆ‘å°±èƒ½æ›´åŠ ä¿è¯æˆ‘ä»¬çš„ä»£ç æ²¡æœ‰é—®é¢˜äº†ã€‚ 1.5 æµ‹è¯•View ä¹‹å‰æˆ‘ä»¬çš„æµ‹è¯•éƒ½æ˜¯æµ‹è¯•é©±åŠ¨çš„æ ‡å‡†æ¥å†™æµ‹è¯•çš„ï¼Œä½†æ˜¯è¿™ä¹Ÿå¹¶ä¸èƒ½æ¶µç›–æˆ‘ä»¬æ‰€æœ‰çš„ä»£ç ï¼Œæµ‹è¯•é©±åŠ¨æˆ‘ä»¬é‡ç‚¹å»å…³å¿ƒå…·ä½“çš„ä»£ç å®ç°ï¼Œä½†æ˜¯æµ‹è¯•viewçš„è¯ï¼Œæˆ‘ä»¬é‡ç‚¹æ˜¯é€šè¿‡æµè§ˆå™¨æ¥æ¨¡æ‹Ÿç”¨æˆ·è¿›è¡Œæµ‹è¯•ã€‚ 1.5.1 Djangoæµ‹è¯•å®¢æˆ·ç«¯ Djangoæ˜¯æä¾›æµ‹è¯•å®¢æˆ·ç«¯æ¥æ¨¡æ‹Ÿç”¨æˆ·æ¥å…·ä½“ä¸viewè¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨tests.pyæ–‡ä»¶ä¸­å†™ä»£ç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡shellæ¥å®Œæˆã€‚ å…¶å®è¯´ç™½äº†å°±æ˜¯çœ‹ä¸åˆ°ç•Œé¢ï¼Œå®Œå…¨æ˜¯é€šè¿‡shellè„šæœ¬æ¥æ¨¡æ‹Ÿè¯·æ±‚ï¼Œèƒ½å¤Ÿæ­£å¸¸è§£æåˆ°responseã€response_codeã€response.contentã€response.contextç­‰ç­‰ æˆ‘ä»¬å…ˆé€šè¿‡shellæ¥å®Œæˆæµ‹è¯•ç¯å¢ƒçš„è®¾ç½®: 1234567891011121314151617181920212223242526272829//1.python manager.py shell//2.&gt;&gt;&gt; from django.test.utils import setup_test_environment&gt;&gt;&gt; setup_test_environment()&gt;&gt;&gt; from django.test import Client&gt;&gt;&gt; # create an instance of the client for our use&gt;&gt;&gt; client = Client()&gt;&gt;&gt; # get a response from '/'&gt;&gt;&gt; response = client.get('/')&gt;&gt;&gt; # we should expect a 404 from that address; if you instead see an&gt;&gt;&gt; # "Invalid HTTP_HOST header" error and a 400 response, you probably&gt;&gt;&gt; # omitted the setup_test_environment() call described earlier.&gt;&gt;&gt; response.status_code404&gt;&gt;&gt; # on the other hand we should expect to find something at '/polls/'&gt;&gt;&gt; # we'll use 'reverse()' rather than a hardcoded URL&gt;&gt;&gt; from django.urls import reverse&gt;&gt;&gt; response = client.get(reverse('polls:index'))&gt;&gt;&gt; response.status_code200&gt;&gt;&gt; response.contentb'\n &lt;ul&gt;\n \n &lt;li&gt;&lt;a href="/polls/1/"&gt;What&amp;#39;s up?&lt;/a&gt;&lt;/li&gt;\n \n &lt;/ul&gt;\n\n'&gt;&gt;&gt; response.context['latest_question_list']&lt;QuerySet [&lt;Question: What's up?&gt;]&gt; 1.5.2 æ”¹å–„æˆ‘ä»¬çš„View åœ¨ç¬¬å››éƒ¨åˆ†çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¾æ®ç±»çš„å½¢å¼æ¥åˆ›å»ºäº†view,åœ¨polls/views.pyçš„æ–‡ä»¶ä¸­ï¼š 1234567class IndexView(generic.ListView): template_name = 'polls/index.html' context_object_name = 'latest_question_list' def get_queryset(self): """Return the last five published questions.""" return Question.objects.order_by('-pub_date')[:5] è¿™æ˜¯ä¹‹å‰çš„ä»£ç ï¼Œæˆ‘ä»¬ç°åœ¨æƒ³ä¿®æ”¹get_querysetè¿™ä¸ªæ–¹æ³•ï¼Œä¹‹å‰æ˜¯è¿”å›æœ€åçš„5æ¡æ•°æ®ï¼Œç°åœ¨æˆ‘ä»¬å¸Œæœ›é€šè¿‡æ—¶é—´æ¥è¿‡æ»¤ï¼š 1234567891011//1.from django.utils import timezonedef get_queryset(self): """ Return the last five published questions (not including those set to be published in the future). """ return Question.objects.filter( pub_date__lte=timezone.now() ).order_by('-pub_date')[:5] Question.objects.filter(pub_date__lte=timezone.now())æ„æ€æ˜¯ï¼šæŸ¥æ‰¾Question,å¹¶ä¸”ä»–ä»¬çš„pub_date&lt;=ç°åœ¨çš„æ—¶å€™ã€‚ 1.5.3 æµ‹è¯•æˆ‘ä»¬æ–°çš„é¡µé¢ åœ¨polls/tests.pyçš„æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869//1.from django.urls import reversedef create_question(question_text, days): """ Creates a question with the given `question_text` and published the given number of `days` offset to now (negative for questions published in the past, positive for questions that have yet to be published). """ time = timezone.now() + datetime.timedelta(days=days) return Question.objects.create(question_text=question_text, pub_date=time)class QuestionViewTests(TestCase): def test_index_view_with_no_questions(self): """ If no questions exist, an appropriate message should be displayed. """ response = self.client.get(reverse('polls:index')) self.assertEqual(response.status_code, 200) self.assertContains(response, "No polls are available.") self.assertQuerysetEqual(response.context['latest_question_list'], []) def test_index_view_with_a_past_question(self): """ Questions with a pub_date in the past should be displayed on the index page. """ create_question(question_text="Past question.", days=-30) response = self.client.get(reverse('polls:index')) self.assertQuerysetEqual( response.context['latest_question_list'], ['&lt;Question: Past question.&gt;'] ) def test_index_view_with_a_future_question(self): """ Questions with a pub_date in the future should not be displayed on the index page. """ create_question(question_text="Future question.", days=30) response = self.client.get(reverse('polls:index')) self.assertContains(response, "No polls are available.") self.assertQuerysetEqual(response.context['latest_question_list'], []) def test_index_view_with_future_question_and_past_question(self): """ Even if both past and future questions exist, only past questions should be displayed. """ create_question(question_text="Past question.", days=-30) create_question(question_text="Future question.", days=30) response = self.client.get(reverse('polls:index')) self.assertQuerysetEqual( response.context['latest_question_list'], ['&lt;Question: Past question.&gt;'] ) def test_index_view_with_two_past_questions(self): """ The questions index page may display multiple questions. """ create_question(question_text="Past question 1.", days=-30) create_question(question_text="Past question 2.", days=-5) response = self.client.get(reverse('polls:index')) self.assertQuerysetEqual( response.context['latest_question_list'], ['&lt;Question: Past question 2.&gt;', '&lt;Question: Past question 1.&gt;'] ) ä»”ç»†çœ‹ä¸€ä¸‹ä½ å°±ä¼šå‘ç°ï¼š è¿™é‡Œcreate_questionæ˜¯ä¸€ä¸ªå¿«ç”Ÿäº§questionçš„å‡½æ•°ã€‚ test_index_view_with_a_past_questionæˆ‘ä»¬ä¸åˆ›å»ºä»»ä½•çš„questionå¯¹è±¡ï¼Œæˆ‘ä»¬çš„çš„ä¸€äº›æ–­è¨€ï¼Œè¿™ä¸ªæµ‹è¯•å°±ç´ åœ¨æµ‹è¯•å¦‚æœæ•°æ®åº“é‡Œé¢æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†ï¼Œæ£€æµ‹äº†responseä»¥åŠresponse.contextã€‚è¿™é‡Œç”¨åˆ°äº†assertContains() and assertQuerysetEqual() åœ¨ä¸‹é¢çš„æµ‹è¯•åŒæ ·ã€‚ 1.5.4 æµ‹è¯•è¯¦æƒ…é¡µé¢ æ‰“å¼€polls/views.pyä¿®æ”¹ä¸º,è¯¦æƒ…é¡µé¢ä¹Ÿè¦è¿‡æ»¤æ‰å°†æ¥çš„æ—¶é—´ç‚¹çš„æ•°æ®ï¼š 1234567class DetailView(generic.DetailView): ... def get_queryset(self): """ Excludes any questions that aren't published yet. """ return Question.objects.filter(pub_date__lte=timezone.now()) æ­¤æ—¶å†æ·»åŠ ä¸€ä¸‹æµ‹è¯•æ•°æ®ï¼Œæ‰“å¼€polls/tests.pyï¼š 1234567891011121314151617181920class QuestionIndexDetailTests(TestCase): def test_detail_view_with_a_future_question(self): """ The detail view of a question with a pub_date in the future should return a 404 not found. """ future_question = create_question(question_text='Future question.', days=5) url = reverse('polls:detail', args=(future_question.id,)) response = self.client.get(url) self.assertEqual(response.status_code, 404) def test_detail_view_with_a_past_question(self): """ The detail view of a question with a pub_date in the past should display the question's text. """ past_question = create_question(question_text='Past Question.', days=-5) url = reverse('polls:detail', args=(past_question.id,)) response = self.client.get(url) self.assertContains(response, past_question.question_text) 123456789GhCoder_Site python manage.py test pollsCreating test database for alias 'default'...System check identified no issues (0 silenced)...........----------------------------------------------------------------------Ran 10 tests in 0.058sOKDestroying test database for alias 'default'... è¿˜æœ‰ä¸€äº›è¿›é˜¶çš„æµ‹è¯•å·¥å…·ï¼š Selenium[http://seleniumhq.org/] LiveServerTestCase [https://docs.djangoproject.com/en/1.11/topics/testing/tools/#django.test.LiveServerTestCase] 1.5.5 è‡ªå®šä¹‰é¡¹ç›®app1.æ·»åŠ cssæ ·å¼ï¼š åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œé¡¹ç›®ä¸­çš„HTML/JavaScript/CSSéƒ½æ˜¯ç”¨æ¥å‘ˆç°é¡µé¢ä»¥åŠå¸ƒå±€çš„æ—¶å€™éœ€è¦ç”¨åˆ°ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠè¿™äº›æ–‡ä»¶ç»Ÿä¸€æ”¾åˆ°static filesçš„æ–‡ä»¶é‡Œé¢å»ã€‚è¿™é‡Œdjango.contrib.staticfilesæ›¿æˆ‘ä»¬éƒ½åšå¥½äº†ã€‚ é¦–å…ˆåœ¨pollsçš„ç›®å½•ä¸­æ·»åŠ staticçš„æ–‡ä»¶å¤¹ï¼ŒDjangoå°†ä¼šè‡ªåŠ¨å»æ‰¾staticæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚ åœ¨staticä¸‹é¢åœ¨æ·»åŠ pollsæ–‡ä»¶å¤¹ï¼Œå†åœ¨pollsæ–‡ä»¶å¤¹é‡Œé¢å†æ·»åŠ style.css,é‡Œé¢æ·»åŠ å¦‚ä¸‹çš„æ“ä½œï¼š 123li a &#123; color: green;&#125; ç„¶ååœ¨polls/templates/polls/index.htmlæ–‡ä»¶é‡Œé¢æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 123&#123; % load static % &#125;&lt;link rel="stylesheet" type="text/css" href="&#123; % static 'polls/style.css' % &#125;" /&gt; { % static % }tagèƒ½å¤Ÿç”Ÿæˆstaticæ–‡ä»¶å¤¹çš„ç»å¯¹urlã€‚ 2.æ·»åŠ å›¾ç‰‡çš„æ ·å¼ åˆ›å»ºä¸€ä¸ªimagesæ–‡ä»¶å¤¹ï¼Œè·¯å¾„ä¸ºpolls/static/polls/images/xxx.png,ç„¶åå°±å¯ä»¥åœ¨cssçš„æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹çš„ä»£ç  123body &#123; background: white url("images/xxx.png") no-repeat right bottom;&#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Pythonã€Django</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ Djangoç¬¬å››éƒ¨åˆ†ï¼Œç»†åŒ–ç³»ç»Ÿæ¨¡æ¿[å®˜ç½‘æ•™ç¨‹]]]></title>
    <url>%2F2017%2F05%2F16%2F20170516%2F</url>
    <content type="text"><![CDATA[1.8ï¼šç»†åŒ–viewsé¡µé¢çš„åŠŸèƒ½ æ‰“å¼€polls/detail.htmlçš„æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„ä»£ç ä¿®æ”¹ä¸€ä¸‹ï¼š 123456789101112&lt;h1&gt;&#123; &#123; question.question_text &#125; &#125;&lt;/h1&gt;&#123; % if error_message % &#125;&lt;p&gt;&lt;strong&gt;&#123; &#123; error_message &#125; &#125;&lt;/strong&gt;&lt;/p&gt;&#123; % endif % &#125;&lt;form action="&#123; % url 'polls:vote' question.id % &#125;" method="post"&gt;&#123; % csrf_token % &#125;&#123; % for choice in question.choice_set.all % &#125; &lt;input type="radio" name="choice" id="choice&#123; &#123; forloop.counter &#125; &#125;" value="&#123; &#123; choice.id &#125; &#125;" /&gt; &lt;label for="choice&#123; &#123; forloop.counter &#125; &#125;"&gt;&#123; &#123; choice.choice_text &#125; &#125;&lt;/label&gt;&lt;br /&gt;&#123; % endfor % &#125;&lt;input type="submit" value="Vote" /&gt;&lt;/form&gt; è¿™é‡Œçš„æ”¹åŠ¨æ¯”è¾ƒå¤§,åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºäº†å‹¾é€‰æŒ‰é’®ï¼Œvalueä¸question.idç±»å‹å…³è”èµ·æ¥äº†ï¼Œnameçš„å€¼å†™æ­»ä¸ºchoice,å½“æŸäººå‹¾é€‰äº†ä¸€ä¸ªï¼Œå¹¶ä¸”ç‚¹å‡»çš„æäº¤çš„æŒ‰é’®ï¼Œé‚£ä¹ˆå°±ä¼špostçš„æ•°æ®ä¸ºï¼šchoice=#ã€‚ å®šä¹‰äº†ä¸€ä¸ªform, å¹¶ä¸”method=post forloop.counterå°±æŒ‡æ˜äº†å¤šå°‘æ¬¡å¾ªç¯ å› ä¸ºæˆ‘ä»¬è¿ç”¨äº†postçš„è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é˜²æ­¢ä»–ä»¬è·¨åŸŸè¯·æ±‚ï¼Œå¹¶ä¸”ç¯¡æ”¹æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ„Ÿè°¢Django,ä»–ç»™æˆ‘ä»¬å®šä¹‰äº†{ % csrf_token % }è¿™ä¸ªæ ‡è®°ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢è¢«ç¯¡æ”¹æ•°æ® ç°åœ¨æ¥å¤„ç†postè¿‡æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸”åšå‡ºç›¸åº”çš„å¤„ç†ã€‚æ‰“å¼€polls/urls.py 1234567891011121314151617181920212223from django.shortcuts import get_object_or_404, renderfrom django.http import HttpResponseRedirect, HttpResponsefrom django.urls import reversefrom .models import Choice, Question# ...def vote(request, question_id): question = get_object_or_404(Question, pk=question_id) try: selected_choice = question.choice_set.get(pk=request.POST['choice']) except (KeyError, Choice.DoesNotExist): # Redisplay the question voting form. return render(request, 'polls/detail.html', &#123; 'question': question, 'error_message': "You didn't select a choice.", &#125;) else: selected_choice.votes += 1 selected_choice.save() # Always return an HttpResponseRedirect after successfully dealing # with POST data. This prevents data from being posted twice if a # user hits the Back button. return HttpResponseRedirect(reverse('polls:results', args=(question.id,))) è¿™é‡Œçš„request.POSTå°±æ˜¯ä¸ªå­—å…¸ç±»å‹çš„æ•°æ®ï¼Œé€šè¿‡å–request.POST[&#39;choice&#39;]å¾—åˆ°çš„æ˜¯é€‰ä¸­çš„idï¼Œå¹¶ä¸”ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ã€‚ åœ¨request.POSTä¸­ï¼Œæä¾›äº†KeyErrorçš„é”™è¯¯ï¼Œå½“ä½ è¦å»çš„keyä¸åœ¨postçš„å­—æ®µé‡Œé¢ï¼Œå°±ä¼šæ‹¿åˆ°è¿™æ ·çš„é”™è¯¯ã€‚ æ³¨æ„åˆ°å½“æˆåŠŸä¹‹åï¼Œç›¸åº”çš„votesåŠ 1ä¹‹åï¼Œæˆ‘ä»¬è¿”å›çš„ä¸æ˜¯HttpResponse,è€Œæ˜¯HttpResponseRedirect,æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯æˆåŠŸä¹‹åè°ƒæ•™çš„urlã€‚å¹¶ä¸”å®˜ç½‘æå‡ºäº†ï¼Œå½“æˆåŠŸå®Œæˆpostä¹‹åï¼Œå°±æ˜¯åº”è¯¥è·³è½¬é¡µé¢ï¼Œè¿™ä¸ä»…ä»…æ˜¯Djangoè¦æ±‚çš„ï¼Œè€Œæ˜¯ä½œä¸ºwebå¼€å‘æ‰€å¿…é¡»è¦å…»æˆçš„å¥½ä¹ æƒ¯ã€‚ æœ€åæ³¨æ„åˆ°æˆ‘ä»¬åœ¨HttpResponseRedirecté‡Œé¢ç”¨åˆ°äº†reverse()ï¼Œå…¶å®ä»–çš„ä½œç”¨å°±æ˜¯ä¸ºäº†è§£å†³ç¡¬ç¼–ç çš„é—®é¢˜ï¼Œå…¶å®reverse(&#39;polls:results&#39;, args=(question.id,) = /polls/3/results/ çœ‹åˆ°æˆåŠŸè¿”å›çš„é¡µé¢ä¸ºresultsçš„å‡½æ•°ï¼š 12345from django.shortcuts import get_object_or_404, renderdef results(request, question_id): question = get_object_or_404(Question, pk=question_id) return render(request, 'polls/results.html', &#123;'question': question&#125;) åœ¨è¿™é‡Œéœ€è¦åˆ›å»ºpolls/results.htmlçš„æ¨¡æ¿é¡µé¢ 123456789&lt;h1&gt;&#123; &#123; question.question_text &#125; &#125;&lt;/h1&gt;&lt;ul&gt;&#123; % for choice in question.choice_set.all % &#125; &lt;li&gt;&#123; &#123; choice.choice_text &#125; &#125; -- &#123; &#123; choice.votes &#125; &#125; vote&#123; &#123; choice.votes|pluralize &#125; &#125;&lt;/li&gt;&#123; % endfor % &#125;&lt;/ul&gt;&lt;a href="&#123; % url 'polls:detail' question.id % &#125;"&gt;Vote again?&lt;/a&gt; æ­¤æ—¶é€‰ä¸­ä¹‹åçš„ç»“æœé¡µé¢å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤ºçš„äº†ï¼š 123456What's up? Not much -- 4 vote s The sky -- 1 vote Just hacking again -- 0 vote s Just kidding -- 0 vote s è¿™é‡Œå®˜ç½‘æäº†ä¸€ä¸ªæ„è§ï¼Œå°±æ˜¯selected_choice = question.choice_set.get(pk=request.POST[&#39;choice&#39;]),è¿™ä¸ªæ•°æ®æ˜¯ä»æ•°æ®åº“ä¸­å–å‡ºæ¥çš„ï¼Œä½†æ˜¯å¦‚æœä¸¤ä¸ªç”¨æˆ·åŒä¸€æ—¶é—´åšæ¬¡æ“ä½œï¼Œå¹¶ä¸”è¿›è¡ŒæŠ•ç¥¨çš„è¯ï¼Œè¿™é‡Œä¼šå­˜åœ¨ä¸€ä¸ªç«äº‰çš„å…³ç³»ï¼Œè¿™é‡Œå®˜ç½‘ç»™å‡ºçš„æ„è§æ˜¯ç”¨å‡½æ•°F()æ¥é¿å…è¿™ç§æƒ…å†µ [https://docs.djangoproject.com/en/1.11/ref/models/expressions/#avoiding-race-conditions-using-f] 1.9ï¼šä½¿ç”¨é€šç”¨è§†å›¾è®©ä»£ç å°‘ç‚¹ å¯èƒ½ä½ å·²ç»å‘ç°äº†ï¼Œdetailå’Œresultsçš„é¡µé¢éå¸¸çš„ç›¸è¿‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šåšå‡ºæ”¹å˜ è¿™äº›viewsé¡µé¢éƒ½åšäº†ä¸€äº›ç±»ä¼¼çš„äº‹æƒ…ï¼Œæ ¹æ®URLä»æ•°æ®åº“ä¸­å¾—åˆ°æ•°æ®,åŠ è½½æ¨¡æ¿ï¼Œå¹¶ä¸”æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯é›·åŒçš„ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡é€šç”¨è§†å›¾æ¥å‡å°‘æˆ‘ä»¬çš„ä»£ç é‡ 1.9.1 ä¿®æ”¹URLconf æ‰“å¼€polls/urls.pyæ–‡ä»¶ä¿®æ”¹ä¸ºï¼š 1234567891011from django.conf.urls import urlfrom . import viewsapp_name = 'polls'urlpatterns = [ url(r'^$', views.IndexView.as_view(), name='index'), url(r'^(?P&lt;pk&gt;[0-9]+)/$', views.DetailView.as_view(), name='detail'), url(r'^(?P&lt;pk&gt;[0-9]+)/results/$', views.ResultsView.as_view(), name='results'), url(r'^(?P&lt;question_id&gt;[0-9]+)/vote/$', views.vote, name='vote'),] è¿™é‡Œåšäº†ä¸¤ä¸ªæ”¹å˜1ï¼šä¸€ä¸ªæ˜¯è®²å‚æ•°çš„åå­—ä¸¢è¯¥ä¸ºäº†pk, 2:å°†viewsåªæƒ³çš„å‡½æ•°æ–¹å¼ä¿®æ”¹äº†ï¼Œåªæ˜¯æ˜¯åœ¨åŒä¸€ä¸ªç±»ä¸­è°ƒç”¨ä¸åŒçš„å±æ€§æ˜¯ä½¿ç”¨æ–¹æ³•ï¼Œç°åœ¨æ˜¯è°ƒç”¨ä¸åŒç±»çš„æ–¹å¼ï¼Œæˆ–è®¸æ˜¯ç±»æ˜¯æ›´å¥½çš„æ¡ä»¶ç»§æ‰¿ã€é‡ç”¨ä»£ç çš„å§ã€‚ 1.9.2 ä¿®æ”¹views æ‰“å¼€polls/views.pyæ–‡ä»¶ä¿®æ”¹ä¸ºï¼š 1234567891011121314151617181920212223242526272829from django.shortcuts import get_object_or_404, renderfrom django.http import HttpResponseRedirectfrom django.urls import reversefrom django.views import genericfrom .models import Choice, Questionclass IndexView(generic.ListView): template_name = 'polls/index.html' context_object_name = 'latest_question_list' def get_queryset(self): """Return the last five published questions.""" return Question.objects.order_by('-pub_date')[:5]class DetailView(generic.DetailView): model = Question template_name = 'polls/detail.html'class ResultsView(generic.DetailView): model = Question template_name = 'polls/results.html'def vote(request, question_id): ... # same as above, no changes needed. è¿™é‡Œç”¨åˆ°äº†ListViewå’ŒDetailViewï¼Œåˆ†åˆ«éœ€è¦å»å»ç»§æ‰¿ä»–ä»¬ï¼Œä»–ä»¬å…¶å®éƒ½æ˜¯ä¸€äº›æŠ½è±¡çš„æ¦‚å¿µã€‚ æ¯ä¸ªé€šç”¨è§†å›¾éƒ½éœ€è¦ä¸€ä¸ªmodelçš„å­—æ®µï¼Œå› æ­¤ä½ éœ€è¦ä¸¢ä¸€ä¸ªModelå­—æ®µã€‚ DetailViewæ˜¾ç¤ºéœ€è¦ä»URLä¸­è·å–pkçš„å­—æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™urlçš„æ—¶å€™ï¼Œå°†quesiton_idçš„å‚æ•°åå­—ä¿®æ”¹ä¸ºäº†pkã€‚ DetailViewéœ€è¦ä½¿ç”¨çš„æ¨¡æ¿åå­—ä¸ºï¼š&lt;app name&gt;/&lt;module name&gt;_detail.nameï¼Œåœ¨æˆ‘ä»¬ç°åœ¨çš„é¡¹ç›®ä¸­ï¼Œæ¨¡æ¿çš„åå­—ä¸ºï¼špolls/question_detail.html,è¿™é‡Œæ¨¡æ¿åå­—çš„å­˜åœ¨æ˜¯ä¸ºå‘Šè¯‰Djangoéœ€è¦ä½¿ç”¨ç‰¹å®šåç§°çš„æ¨¡æ¿ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤ç”Ÿæˆçš„æ¨¡æ¿ï¼Œè¿™é‡Œä½ å°±ä¼šå‘ç°detailå’Œresultè™½ç„¶ç»§æ‰¿çš„éƒ½æ˜¯DetailView,ä½†æ˜¯ä»–ä»¬æŒ‡å®šäº†ä¸åŒæ¨¡æ¿åå­—ï¼Œè¿™å°±è®©æ˜¾ç¤ºä¸åŒçš„æ¨¡æ¿åå­—ã€‚ ç±»ä¼¼çš„ListViewä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œé»˜è®¤Djangoä¼šå»æ‰¾&lt;app name&gt;/&lt;model name&gt;_list.htmlï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬å®šä¹‰äº†template_name,å› æ­¤ä»–åªä¼šæ‰¾polls/index.html åœ¨ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ä¸¢ä¸€ä¸ªåå«questionä»¥åŠlatest_question_listçš„å€¼ç»™æ¨¡æ¿çš„ï¼Œå¯¹DetailViewè€Œè¨€ï¼šquestionçš„å€¼æ˜¯é»˜è®¤ä¼šè¢«ç”Ÿæˆçš„ï¼Œå› ä¸ºæˆ‘ä»¬è¿ç”¨äº†Django model(Question),Django æ˜¯èƒ½å¤Ÿé€šè¿‡åå­—è‡ªåŠ¨æ£€æµ‹çš„ã€‚ è€Œåœ¨ListViewä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†latest_question_list,Djangoé»˜è®¤ä¼šç”Ÿæˆquestion_list,ä½†æ˜¯æˆ‘ä»¬éœ€è¦çš„æ˜¯latest_question_list,å› æ­¤æˆ‘ä»¬éœ€è¦è¦†å†™è¿™ä¸ªå±æ€§context_object_nameï¼Œå°†å®ƒå‡†ç¡®å®šä¹‰ä¸ºæˆ‘ä»¬éœ€è¦çš„åå­—latest_question_list æ¨¡æ¿è¿™éƒ¨åˆ† ç¡®å®è¿˜æ˜¯æŒºå¤æ‚çš„ï¼Œä¸»è¦æ˜¯æˆ‘ä»¬ä¸å¤ªç†Ÿæ‚‰ä¸€äº›å­—æ®µçš„ç”¨æ³•ã€å«ä¹‰ï¼Œå¯ä»¥è‡ªè¡Œå‚è€ƒ [https://docs.djangoproject.com/en/1.11/topics/class-based-views/]]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Pythonã€Django</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ Djangoç¬¬ä¸‰éƒ¨åˆ†ï¼Œé‡ç‚¹å…³æ³¨å¦‚ä½•è¿ç”¨ç³»ç»Ÿæ¨¡æ¿,å¹¶ä¸”è‡ªå®šä¹‰URL[å®˜ç½‘æ•™ç¨‹]]]></title>
    <url>%2F2017%2F05%2F15%2F20170515%2F</url>
    <content type="text"><![CDATA[1.å¼€å§‹å†™æ–°çš„Views æ‰“å¼€polls/views.pyæ–‡ä»¶ï¼Œå†™viewsçš„å‡½æ•°å’Œå†™å…¶ä»–çš„å‡½æ•°ç•¥æœ‰ä¸åŒï¼Œå› ä¸ºä»–ä»¬å¯ä»¥æ¥å—å‚æ•°ï¼Œå†™å…¥ä¸‹é¢çš„ä»£ç ï¼š 123456789def detail(request, question_id): return HttpResponse("You're looking at question %s." % question_id)def results(request, question_id): response = "You're looking at the results of question %s." return HttpResponse(response % question_id)def vote(request, question_id): return HttpResponse("You're voting on question %s." % question_id) å†™å®Œäº†viewsçš„è¿™äº›å‡½æ•°ï¼Œå…¶å®è¿™äº›å‡½æ•°åªæ˜¯ç®€å•çš„è¿”å›ä¸€äº›å­—ç¬¦ä¸²ï¼Œä¸‹é¢æ¥å‡ºæ¥ä¸€äº›å…³äºurlçš„å‡½æ•°å¤„ç†polls/urls.pyï¼š 1234567891011121314from django.conf.urls import urlfrom . import viewsurlpatterns = [ # ex: /polls/ url(r'^$', views.index, name='index'), # ex: /polls/5/ url(r'^(?P&lt;question_id&gt;[0-9]+)/$', views.detail, name='detail'), # ex: /polls/5/results/ url(r'^(?P&lt;question_id&gt;[0-9]+)/results/$', views.results, name='results'), # ex: /polls/5/vote/ url(r'^(?P&lt;question_id&gt;[0-9]+)/vote/$', views.vote, name='vote'),] ç°åœ¨å½“ä½ å†å»è®¿é—®/polls/34ã€/polls/34/results/ã€/polls/34/vote/ä½ å°±å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›èƒ½å¤Ÿå¯¹åº”åˆ°åˆšæ‰ä½ å†™çš„å‡ ä¸ªå‡½æ•°äº†ã€‚ å½“ä½ è®¿é—®çš„urlä¸º/polls/34/çš„æ—¶å€™ï¼Œæ­¤æ—¶Djangoå°†å…ˆæ‰¾åˆ°é¡¹ç›®ä¸­çš„urlsæ¨¡å—ï¼Œï¼ˆå…¶å®å°±æ˜¯åŠ è½½é¡¹ç›®ä¸­çš„urls.pyçš„æ–‡ä»¶ï¼‰ï¼Œå®ƒå°†ä¼šæ‰¾åˆ°åä¸ºurlpatternsè¿™ä¸ªåˆ—è¡¨ï¼Œçœ‹çœ‹åœ¨ä½ çš„åˆ—è¡¨çš„é¡¹ç›®ä¸­ï¼Œæœ‰æ²¡æœ‰å‡ºç°ä½ è®¿é—®çš„urlçš„æ¡ç›®ï¼Œå½“ç³»ç»Ÿæ‰¾åˆ°^polls/ä¹‹åï¼Œå°±ä¼šå»æ‰^polls/,ç„¶åå°†å‰©ä¸‹çš„34/å‘é€ç»™polls.urlsè¿›è¡Œæ›´æ·±çš„è§£æï¼Œç»ˆäºåœ¨polls/urls.pyçš„urlpatternsåˆ—è¡¨ä¸­æ‰¾åˆ°äº†è¿™è¡Œä»£ç url(r&#39;^(?P&lt;question_id&gt;[0-9]+)/$&#39;, views.detail, name=&#39;detail&#39;),å› ä¸ºè¿™è¡Œä»£ç çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡å‘çš„views.detailå‡½æ•°å¥æŸ„ï¼Œè¿™é‡Œå…¶å®æ‰§è¡Œçš„æ˜¯ä¸‹é¢çš„ä»£ç ï¼š 1detail(request=&lt;HttpRequest object&gt;, question_id='34') è€Œè¿™é‡Œçš„question_id=&#39;34&#39;,éƒ¨åˆ†æ˜¯å› ä¸ºæˆ‘ä»¬å†™çš„è¿™éƒ¨åˆ†æ­£åˆ™:(?P&lt;question_id&gt;[0-9]+),æ‹¬å·æ‰€åŒ…å«çš„å†…å®¹å°†ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ ç»™å¯¹åº”çš„å‡½æ•°, ?P&lt;question_id&gt;å®šä¹‰äº†ä¼ ç»™å‡½æ•°çš„å½¢å‚å 1.1:å…·ä½“å¤„ç†ä¸€äº›é¡µé¢çš„è¯·æ±‚ æ¯ä¸ªé¡µé¢åº”è¯¥å¯ä»¥åš1-2ä»¶äº‹æƒ…ï¼Œè¿”å›httpçš„è¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡HttpResponse[https://docs.djangoproject.com/en/1.11/ref/request-response/#django.http.HttpResponse], è¿˜æœ‰äº›æœªæ‰¾åˆ°é¡µé¢Djangoä¹Ÿç»™äº†å“åº”çš„ä¾¿åˆ©è¿”å›Http404[https://docs.djangoproject.com/en/1.11/topics/http/views/#django.http.Http404], å…¶å®è¯´ç™½äº†æ¯ä¸ªé¡µé¢å®ƒå¸Œæœ›å¾—åˆ°çš„æ˜¯HttpResponseèƒ½å¤Ÿå¤„ç†æ­£å¸¸çš„é€»è¾‘ï¼Œè¦ä¸ç„¶å°±æ˜¯exceptionï¼Œæ‰“å¼€polls/views.py 1234567from django.http import HttpResponsefrom .models import Questiondef index(request): latest_question_list = Question.objects.order_by('-pub_date')[:5] output = ', '.join([q.question_text for q in latest_question_list]) return HttpResponse(output) è¿™é‡Œå½“ä½ å†æ¬¡è®¿é—®/polls/çš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°åœ¨ç¬¬äºŒéƒ¨åˆ†æ•°æ®åº“æ“ä½œæ’å…¥çš„æ•°æ®äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•è®©æˆ‘ä»¬çš„ç•Œé¢æ˜¾ç¤ºçš„å¥½çœ‹ä¸€ç‚¹å‘¢ï¼Œè¿™é‡Œå°±éœ€è¦å¼•å…¥templateæ¨¡æ¿ï¼Œç°åœ¨æˆ‘ä»¬pollsçš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºtemplatesæ–‡ä»¶å¤¹ï¼ŒDjangoå°†ä¼šè‡ªåŠ¨å»è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å»å¯»æ‰¾æ¨¡æ¿ã€‚ è¿™é‡Œè¿˜è¦è¯´ä¸€ä¸‹ï¼Œå¦‚æœåœ¨settings.pyæ–‡ä»¶ä¸­APP_DIRSè®¾ç½®çš„æ˜¯TRUEçš„è¯ï¼ŒDjangoçš„æ¨¡æ¿é»˜è®¤å°±ä¼šå»INSTALL_APPSå»å¯»æ‰¾å¯¹åº”çš„templatesçš„æ–‡ä»¶å¤¹ã€‚ ç³»ç»Ÿç»™æˆ‘ä»¬çš„æ„è§æ˜¯ï¼Œè®©æˆ‘ä»¬åœ¨templatesæ–‡ä»¶å¤¹ä¸‹é¢å†åˆ›å»ºä¸€ä¸ªpollsçš„æ–‡ä»¶å¤¹ï¼Œåœ¨pollsçš„æ–‡ä»¶å¤¹å†…å†åˆ›å»ºindex.html,æ€»çš„è·¯å¾„åº”è¯¥æ˜¯è¿™æ ·çš„ï¼špolls/templates/polls/index.htmlï¼Œè¿™æ ·åˆ›å»ºçš„æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬åœ¨è°ƒç”¨æ¨¡æ¿çš„æ—¶å€™æ–¹ä¾¿ã€æ˜“è¯»polls/index.html ä¸‹é¢å†åˆšåˆ›å»ºçš„index.htmlä¸­æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š 123456789&#123; % if latest_question_list % &#125; &lt;ul&gt; &#123; % for question in latest_question_list % &#125; &lt;li&gt;&lt;a href="/polls/&#123; &#123; question.id &#125; &#125;/"&gt;&#123; &#123; question.question_text &#125; &#125;&lt;/a&gt;&lt;/li&gt; &#123; % endfor % &#125; &lt;/ul&gt;&#123; % else % &#125; &lt;p&gt;No polls are available.&lt;/p&gt;&#123; % endif % &#125; æ˜¾ç¤ºçš„æ¨¡æ¿å·²ç»å†™å®Œäº†ï¼Œä¸‹é¢å†å°†ä¹‹å‰çš„views.pyçš„å‡½æ•°ä¿®æ”¹ä¸€ä¸‹ï¼š 12345678910111213from django.http import HttpResponsefrom django.template import loaderfrom .models import Questiondef index(request): latest_question_list = Question.objects.order_by('-pub_date')[:5] template = loader.get_template('polls/index.html') context = &#123; 'latest_question_list': latest_question_list, &#125; return HttpResponse(template.render(context, request)) 1.2ï¼šrender()å‡½æ•° è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡render()å‡½æ•°æ¥ç®€å†™æˆ‘ä»¬çš„æ¨¡æ¿ï¼Œç›´æ¥å¯ä»¥é€šè¿‡renderå‡½æ•°,å¹¶ä¸”ä¹Ÿä¸éœ€è¦æ”¾å›HttpResponse,ä¹Ÿä¸éœ€è¦loaderå‡½æ•°æ¥è½½å…¥æˆ‘ä»¬çš„æ¨¡æ¿äº† render()å‡½æ•°å°†requestä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¨¡æ¿çš„åå­—ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå¯é€‰å‚æ•°ï¼Œè¿”å›çš„æ˜¯HttpResponseçš„å¯¹è±¡ã€‚ ç”¨renderä¹‹åï¼Œä»£ç æ”¹å˜ä¸ºï¼š 123456789from django.shortcuts import renderfrom .models import Questiondef index(request): latest_question_list = Question.objects.order_by('-pub_date')[:5] context = &#123;'latest_question_list': latest_question_list&#125; return render(request, 'polls/index.html', context) 1.3ï¼šä¸‹é¢æ¥å¤„ç†ä¸€ä¸‹404çš„é”™è¯¯é¡µé¢1234567891011from django.http import Http404from django.shortcuts import renderfrom .models import Question# ...def detail(request, question_id): try: question = Question.objects.get(pk=question_id) except Question.DoesNotExist: raise Http404("Question does not exist") return render(request, 'polls/detail.html', &#123;'question': question&#125;) è¿™é‡Œçš„åœ¨è¯¦æƒ…é¡µé¢çš„æ—¶å€™ï¼Œå¦‚æœè®¿é—®ä¸»é”®ä¸å­˜åœ¨çš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥æŠ›å‡º404çš„é”™è¯¯ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿæ•æ‰åˆ°é”™è¯¯ã€‚ åŒæ—¶åœ¨polls/detail.htmlçš„æ–‡ä»¶ä¸­æ·»åŠ å¦‚åœ¨ä¸‹ä»£ç ï¼š 1&#123; &#123; question &#125; &#125; 1.4ï¼š404å‡½æ•°çš„ç¼©å†™get_object_or_404()1234567from django.shortcuts import get_object_or_404, renderfrom .models import Question# ...def detail(request, question_id): question = get_object_or_404(Question, pk=question_id) return render(request, 'polls/detail.html', &#123;'question': question&#125;) get_object_or_404()å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºï¼šDjangoçš„Model, ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ˜¯ä»»æ„æ•°é‡å‚æ•°çš„åˆ—è¡¨,å½“getä¸åˆ°ä»»ä½•ä¸œè¥¿çš„æ—¶å€™ï¼Œå°±ä¼šè¿”å›Http404çš„å¯¹è±¡ã€‚ 1.5:ä½¿ç”¨ç³»ç»Ÿæ¨¡æ¿ å›åˆ°æˆ‘ä»¬ä¹‹å‰å†™çš„polls/detail.htmlï¼Œæ”¹ä¸ºè¿™æ ·ï¼š 123456&lt;h1&gt;&#123; &#123; question.question_text &#125; &#125;&lt;/h1&gt;&lt;ul&gt;&#123; % for choice in question.choice_set.all % &#125; &lt;li&gt;&#123; &#123; choice.choice_text &#125; &#125;&lt;/li&gt;&#123; % endfor % &#125;&lt;/ul&gt; å½“æˆ‘ä»¬è¿ç”¨ç³»ç»Ÿçš„æ¨¡æ¿çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°ç³»ç»Ÿæ˜¯ç”¨çš„ç‚¹è¯­æ³•,ä¾‹å¦‚{ { question.question_text } }ï¼ŒDjango å…ˆå»å¯»æ‰¾questionè¿™ä¸ªå¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œç„¶åå†å»å¯»æ‰¾questionæ˜¯å¦å­˜åœ¨question_textçš„è¿™ä¸ªå±æ€§å€¼ã€‚ { % for % }è¿™æ˜¯ä¸€ä¸ªforå¾ªç¯ï¼Œquestion.choice_set.all=question.choice_set.all()è¿™ä¸ªè¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…å«Choiceï¼Œå¯è¿­ä»£çš„é›†åˆã€‚ ç³»ç»Ÿæ¨¡æ¿æ›´å¤šä¿¡æ¯[https://docs.djangoproject.com/en/1.11/topics/templates/] 1.6ï¼šå»é™¤ç³»ç»Ÿæ¨¡æ¿ä¸­çš„ç¡¬ç¼–ç  æˆ‘ä»¬åœ¨å†™index.htmlæ¨¡æ¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†™åˆ°è¿™æ ·ä¸€æ®µä»£ç &lt;li&gt;&lt;a href=&quot;/polls/{ { question.id } }/&quot;&gt;{ { question.question_text } }&lt;/a&gt;&lt;/li&gt;ï¼Œé€šè¿‡æˆ‘ä»¬åœ¨views.pyçš„å‡½æ•°ä¸­å°†questionçš„æ•°æ®ä¸­ä¼ é€’åˆ°æ¨¡æ¿ä¸Šï¼Œå¹¶ä¸”åœ¨æ¨¡æ¿ä¸Šè¿™æ ·ä½¿ç”¨ï¼Œé“ç†ä¸Šæ¥è¯´æ˜¯æ²¡æ¯›ç—…çš„ã€‚ è¿™æ ·å†™çš„é—®é¢˜ï¼Œåœ¨äºæ¨¡æ¿å’Œæ•°æ®ï¼Œç´§å¯†è€¦åˆåœ¨ä¸€èµ·ï¼Œåœ¨å¾ˆå¤šæ¨¡æ¿ä¸­ï¼Œå‡å¦‚æˆ‘ä¸€æ—¦ä¿®æ”¹äº†URLï¼Œæˆ‘ä»¬å°±å¾—å»ä¸€å †çš„æ¨¡æ¿ä¸­ä¿®æ”¹è¿™ä¸ªå†™æ­»çš„urlã€‚ å› ä¸ºæˆ‘ä»¬åœ¨polls/urls.pyä¸­å·²ç»ç”¨åˆ°äº†urlçš„æ¨¡å—,é‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤Ÿé€šè¿‡ä¹‹å‰å®šä¹‰çš„url,å¹¶ä¸”çŸ¥é“ä¸‹é¢å°†è¦è·³è½¬urlã€‚ 123urlpatterns = [ url(r'^(?P&lt;question_id&gt;[0-9]+)/$', views.detail, name='detail'), ] å› æ­¤å¯ä»¥ä¿®æ”¹ä¸ºï¼š 1234//ä¿®æ”¹å‰&lt;li&gt;&lt;a href="/polls/&#123; &#123; question.id &#125; &#125;/"&gt;&#123; &#123; question.question_text &#125; &#125;&lt;/a&gt;&lt;/li&gt;//ä¿®æ”¹å&lt;li&gt;&lt;a href="&#123; % url 'detail' question.id % &#125;"&gt;&#123; &#123; question.question_text &#125; &#125;&lt;/a&gt;&lt;/li&gt; å¦‚æœä½ æƒ³è¦ä¿®æ”¹è¯¦æƒ…é¡µé¢çš„urlï¼Œå‡å¦‚ç°åœ¨çš„urlä¸æ˜¯ä¹‹å‰çš„polls/12,è€Œæ˜¯æœ€æ–°çš„urlï¼špolls/specifics/12,æ­¤æ—¶ä½ åªéœ€è¦åœ¨ä½ çš„urlä¸­åŠ ä¸€ä¸ªä¸€ä¸ªurlï¼Œä¾‹å¦‚ï¼š 123...url(r'^specifics/(?P&lt;question_id&gt;[0-9]+)/$', views.detail, name='detail'),... 1.7:URLçš„å‘½åç©ºé—´ åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä»…ä»…åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªappï¼Œå«åšpolls,ä½†æ˜¯åœ¨å®é™…çš„Djangoçš„é¡¹ç›®ä¸­ï¼Œå…¶å®ä¼šæœ‰10ã€20å‡ ä¸ªapp, é‚£ä¹ˆæˆ‘ä»¬åœ¨ä½¿ç”¨ä¹‹å‰æåˆ°çš„{ % url % },Djangoå¦‚ä½•åŒºåˆ†urlå‘¢ï¼Ÿæ¯”å¦‚æˆ‘pollsä¸‹é¢æœ‰ä¸€ä¸ªdetailï¼Œå‡å¦‚æˆ‘è¿˜æœ‰ä¸ªæ–°çš„appï¼Œä¸‹é¢ä¹Ÿæœ‰ä¸€ä¸ªdetail,æˆ‘æ”¹æ€ä¹ˆåŒºåˆ†å‘¢ï¼Ÿ å®˜æ–¹çš„æ„æ€æ˜¯å»å®šä¹‰app_name,æ‰“å¼€polls/url.py 1234567891011from django.conf.urls import urlfrom . import viewsapp_name = 'polls'urlpatterns = [ url(r'^$', views.index, name='index'), url(r'^(?P&lt;question_id&gt;[0-9]+)/$', views.detail, name='detail'), url(r'^(?P&lt;question_id&gt;[0-9]+)/results/$', views.results, name='results'), url(r'^(?P&lt;question_id&gt;[0-9]+)/vote/$', views.vote, name='vote'),] å¹¶ä¸”å®¶æ¨¡æ¿é‡Œé¢çš„ä»£ç ä¹Ÿåšä¸€ä¸‹ä¿®æ”¹ï¼š 12345//æœªä½¿ç”¨app_name&lt;li&gt;&lt;a href="&#123; % url 'detail' question.id % &#125;"&gt;&#123; &#123; question.question_text &#125; &#125;&lt;/a&gt;&lt;/li&gt;//ä½¿ç”¨app_name = 'polls'&lt;li&gt;&lt;a href="&#123; % url 'polls:detail' question.id % &#125;"&gt;&#123; &#123; question.question_text &#125; &#125;&lt;/a&gt;&lt;/li&gt; ps: æœ€åè¯´ä¸€ä¸‹ï¼Œhexoå¥½å‘å‘ï¼åœ¨markdownæ ¼å¼ä¸­ä¸èƒ½å‡ºç°â€{ {â€œ ä»¥åŠ â€œ{ %â€,å¿…é¡»è¦åœ¨ä¸­é—´æ·»åŠ ä¸ªç©ºæ ¼ã€‚å“ï¼æ— è¯­ã€‚ã€‚ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Pythonã€Django</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ Djangoç¬¬äºŒéƒ¨åˆ†[å®˜ç½‘æ•™ç¨‹]]]></title>
    <url>%2F2017%2F05%2F14%2F20170514%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ Djangoçš„ç¬¬äºŒéƒ¨åˆ†[å¯¹å®˜ç½‘Demoæ•™ç¨‹çš„ç¿»è¯‘ï¼Œä»¥åŠè‡ªå·±çš„ä¸€äº›è®¤è¯†]ç¬¬ä¸€éƒ¨åˆ†ï¼Œå·²ç»ä½¿ç”¨äº†Djangoå†™äº†ä¸€ä¸ªç®€å•Viewï¼Œå¹¶ä¸”é…ç½®äº†æˆ‘ä»¬çš„urlï¼Œæ˜¯çš„æˆ‘ä»¬èƒ½å¤Ÿæ­£å¸¸è®¿é—®åˆ°æˆ‘ä»¬æ–°å»ºçš„Viewé¡µé¢ã€‚ä»Šå¤©å¼€å§‹ç¬¬äºŒéƒ¨åˆ†ï¼š æˆ‘ä»¬éœ€è¦åˆ°xxxProject/settings.pyæ–‡ä»¶å»ä¿®æ”¹é…ç½®ï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦è®²çš„æ˜¯æ•°æ®åº“çš„é…ç½®ã€‚ Djangoé»˜è®¤æ˜¯å®‰è£…äº†SQLiteï¼Œè¿™é‡Œä¸éœ€è¦é¢å¤–ä¸‹è½½ä»€ä¹ˆã€‚ å¦‚æœéœ€è¦ç”¨åˆ°åˆ«çš„æ•°æ®åº“ï¼Œå¯ä»¥å»settingsæ–‡ä»¶å»ä¿®æ”¹ã€‚é»˜è®¤æ˜¯è¿™æ ·çš„ï¼š 123456DATABASES = &#123; 'default': &#123; 'ENGINE': 'django.db.backends.sqlite3', 'NAME': os.path.join(BASE_DIR, 'db.sqlite3'), &#125; &#125; è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼š ENGINEå­—æ®µæ ¹æ®é€‰ç”¨æ•°æ®åº“çš„ä¸åŒï¼ŒDjangoå·²ç»ç»™æˆ‘ä»¬åšå¥½äº†æ•°æ®çš„æšä¸¾ï¼šdjango.db.backends.sqlite3,django.db.backends.postgresql,django.db.backends.mysql,django.db.backends.oracle NAMEæ•°æ®åº“çš„åå­— å¦‚æœä½ å’Œæˆ‘ä¸€æ ·ï¼Œä¸æ˜¯é€‰ç”¨çš„Djangoé»˜è®¤çš„ä½¿ç”¨çš„sqliteçš„è¯ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦é…ç½®USER,PASSWORD,HOST,æˆ‘ç”¨çš„mysql,è¿™é‡Œå¦‚æœéœ€è¦æ­£å¸¸ä½¿ç”¨mysqlçš„è¯ï¼Œå¯èƒ½è¿˜éœ€è¦å®‰è£…å…¶ä»–çš„ä¸€äº›ä¾èµ–åº“ï¼Œè¿™é‡Œå¯ä»¥å‚è€ƒ [https://docs.djangoproject.com/en/1.11/topics/install/#database-installation] å®˜æ–¹ç»™å‡ºäº†demoï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹ 12345678910 DATABASES = &#123; 'default': &#123; 'ENGINE': 'django.db.backends.postgresql', 'NAME': 'mydatabase', 'USER': 'mydatabaseuser', 'PASSWORD': 'mypassword', 'HOST': '127.0.0.1', 'PORT': '5432', &#125;&#125; æ•°æ®åº“é…ç½®å¥½ä¹‹åï¼Œç„¶åæˆ‘ä»¬å¼€å§‹é…ç½®TIME_ZONE,é»˜è®¤å€¼ä¸ºAmerica/Chicago,å¦‚æœåœ¨ä¸­å›½çš„è¯ï¼Œåº”è¯¥æ˜¯Asia/ShanghaiåŒ—äº¬æ—¶é—´å§ï¼Œè‡³äºæ—¶åŒºçš„åˆ—è¡¨ï¼š [https://en.wikipedia.org/wiki/List_of_tz_database_time_zones]ã€‚è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹INSTALLED_APPSçš„é…ç½®ï¼Œæ”¾åœ¨è¿™ä¸ªé€‰é¡¹ä¸­çš„åˆ—è¡¨çš„å­—ç¬¦ä¸²ï¼Œä»£è¡¨è¿è¡ŒDjangoåŒäº‹éœ€è¦æ¿€æ´»è¿™äº›å¯¹åº”çš„Djangoåº”ç”¨ï¼Œappèƒ½å¤Ÿåœ¨ä¸åŒçš„projectä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”ä½ ä¹Ÿèƒ½å¤Ÿæ‰“åŒ…ã€åˆ†å‘ç»™åˆ«äººæ¥ä½¿ç”¨ã€‚12345678910# Application definition INSTALLED_APPS = [ 'django.contrib.admin',//Django çš„é»˜è®¤åå°ç³»ç»Ÿ 'django.contrib.auth', //Django çš„è®¤è¯ç³»ç»Ÿ 'django.contrib.contenttypes', // ç®¡ç†å†…å®¹ç±»å‹ 'django.contrib.sessions', // ç®¡ç†sessions 'django.contrib.messages', // ç®¡ç†æ¶ˆæ¯ 'django.contrib.staticfiles', // ç®¡ç†é™æ€æ–‡ä»¶ ] è¿™äº›å·²ç»å®‰è£…çš„ï¼Œé»˜è®¤çš„appï¼Œè‡³å°‘ä¼šåœ¨åå°å»ºç«‹1çš„è¡¨ï¼ˆç°åœ¨è¿˜æ²¡æœ‰å»ºç«‹è¡¨å‘¢ï¼‰ï¼Œåœ¨æ‰§è¡Œäº†python manage.py migrateæ‰ä¼šåœ¨æˆ‘ä»¬çš„æ•°æ®åº“é‡Œå»ºç«‹è¿™é‡Œappçš„è¡¨ã€‚ è¿™é‡Œæˆ‘åœ¨linuxç¯å¢ƒä¸‹å®‰è£…çš„æ—¶å€™ï¼Œé‡åˆ°ç‚¹é—®é¢˜ï¼šåŒ…äº†å¾ˆå¤šå¥‡è‘©çš„é”™è¯¯ï¼Œè¿™é‡Œæˆ‘å°±è¯´å‡ ä¸ªï¼Œæˆ‘é‡åˆ°çš„ï¼Œå…¶ä»–æˆ‘æ²¡æœ‰åˆ—å‡ºæ¥çš„ï¼Œå¯èƒ½ä½ ç›´æ¥googleå°±èƒ½æ‰¾åˆ°äº†ï¼š é€šè¿‡sudo pip install MySQL-pythonæ¥å®‰è£…mysqlçš„æ—¶å€™åŒ…è¿™ä¸ªé”™ 1Command "python setup.py egg_info" failed with error code 1 in /tmp/pip-build-7696Ic/MySQL-python/ ç›´æ¥åœ¨å‘½ä»¤è¡Œè¿è¡Œ:12sudo apt install libmysqlclient-devpip install mysql è¿˜æœ‰å…¶ä»–çš„ä¸€äº›å°é—®é¢˜ï¼š [http://stackoverflow.com/questions/35991403/python-pip-install-gives-command-python-setup-py-egg-info-failed-with-error-c]æ‰§è¡Œå®Œ python manage.py migrate å°±ä¼šçœ‹åˆ°ç»ˆç«¯å‡ºç°è¿™äº›å­—æ ·ï¼Œå°±ä»£è¡¨ä½ çš„è¡¨å·²ç»æˆåŠŸç”Ÿæˆäº†, å¦‚æœä¸ä¿¡ï¼Œä½ ä¹Ÿå¯ä»¥æ‰“å¼€è‡ªå·±mysqlæ•°æ®åº“ï¼Œå°±ä¼šå‘ç°Djangoå·²ç»ä¸ºæˆ‘ç”Ÿæˆå¥½äº†è¡¨äº†ã€‚12345678910111213141516Operations to perform: Apply all migrations: admin, auth, contenttypes, sessionsRunning migrations: Applying contenttypes.0001_initial... OK Applying auth.0001_initial... OK Applying admin.0001_initial... OK Applying admin.0002_logentry_remove_auto_add... OK Applying contenttypes.0002_remove_content_type_name... OK Applying auth.0002_alter_permission_name_max_length... OK Applying auth.0003_alter_user_email_max_length... OK Applying auth.0004_alter_user_username_opts... OK Applying auth.0005_alter_user_last_login_null... OK Applying auth.0006_require_contenttypes_0002... OK Applying auth.0007_alter_validators_add_error_messages... OK Applying auth.0008_alter_user_username_max_length... OK Applying sessions.0001_initial... OK å®˜æ–¹ç»™å‡ºäº†å…³äºmigrateå‘½ä»¤çš„ä½œç”¨ï¼ŒDjangoä¼šå»projectä¸­æ‰¾æˆ‘çš„settings.pyæ–‡ä»¶ï¼Œå¹¶ä¸”æ‰¾åˆ°INSTALL_APPSï¼Œä¸ºè¿™äº›å®‰è£…çš„appåˆ›å»ºå¿…è¦çš„è¡¨, å¹¶ä¸”å®˜æ–¹ä¹Ÿè¯´äº†ï¼Œè¿™äº›é»˜è®¤çš„INSTALL_APPSå¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½éœ€è¦ä»–ï¼Œå½“ä¸éœ€è¦çš„æ—¶å€™ï¼Œåˆ é™¤æ‰xxxProject/settings.pyæ–‡ä»¶ä¸­å¯¹åº”çš„appï¼Œç„¶åæ‰§è¡Œmigrateå°±å¯ä»¥äº†ã€‚åˆ›å»ºModelå¥½äº†ï¼Œç°åœ¨å¼€å§‹æˆ‘ä»¬éœ€è¦åˆ›å»ºModeläº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¸ºä»€ä¹ˆå–œæ¬¢Djangoçš„æœ€æœ€æ ¹æœ¬çš„åŸå› ï¼ŒDjangoä¸­çš„Modelä¸åŒäºå…¶ä»–è¯­è¨€ä¸­çš„Modelå¯¹è±¡ï¼Œè€Œæ˜¯å®è´¨æ€§çš„æ¶‰åŠåˆ°æ•°æ®åº“çš„æ•°æ®ã€‚ ä¹‹å‰åœ¨ç¬¬ä¸€ç« çš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå±äºæˆ‘ä»¬è‡ªå·±çš„appï¼Œåå­—å«åšpollsçš„app,æˆ‘ä»¬ç°åœ¨å›´ç»•è¿™ä¸ªappåˆ›å»ºå±äºè¿™ä¸ªappçš„Modelï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªModelï¼Œä¸€ä¸ªå«åšQuestion,ä¸€ä¸ªå«Choice,Questionå«æœ‰ä¸€ä¸ªé—®é¢˜å­—æ®µå’Œå‘å¸ƒæ—¶é—´çš„å­—æ®µï¼ŒChoiceå«æœ‰ä¸¤ä¸ªå­—æ®µä¸€ä¸ªchoiceçš„Textçš„å­—æ®µã€ä¸€ä¸ªvoteçš„å­—æ®µï¼Œå¹¶ä¸”ä¸€ä¸ªchoiceä¼šå…³è”ä¸€ä¸ªquestionå­—æ®µï¼Œç°åœ¨å¼€å§‹ç¼–è¾‘polls/models.pyæ–‡ä»¶ï¼š 123456789101112from django.db import modelsclass Question(models.Model): question_text = models.CharField(max_length=200) pub_date = models.DateTimeField('date published')class Choice(models.Model): question = models.ForeignKey(Question, on_delete=models.CASCADE) choice_text = models.CharField(max_length=200) votes = models.IntegerField(default=0) è¿™äº›modelçš„ç±»éƒ½æ˜¯django.db.models.Modelçš„å­ç±»ã€‚ è¿™é‡Œçš„æ¯ä¸ªå­—æ®µå¯¹åº”çš„å°±æ˜¯æ•°æ®åº“ä¸­çš„æ¯ä¸ªå­—æ®µã€‚ ä¸€äº›å­—æ®µæ˜¯éœ€è¦å¿…é¡»çš„å‚æ•°çš„ï¼Œæ¯”å¦‚CharFieldå¿…é¡»æœ‰å‚æ•°max_lengthçš„å­˜åœ¨ã€‚ ä¸€äº›å­—æ®µä¹Ÿå¯ä»¥ä¼ å…¥ä¸€äº›å¯é€‰çš„å‚æ•°: æ¯”å¦‚ï¼šIntegerFieldçš„defaultçš„å­—æ®µã€‚ ForeignKeyå¯ä»¥é€šè¿‡å¤–é”®çš„å½¢å¼ï¼Œå°†choiceçš„ç±»å‹å…³è”åˆ°Questionçš„ç±»å‹ä¸Šå»ï¼Œåœ¨Djangoçš„modelæ•°æ®ä¸­ï¼Œæ˜¯æ”¯æŒä¸€å¯¹å¤šï¼Œä¸€å¯¹ä¸€ï¼Œå¤šå¯¹å¤šçš„ã€‚ æ¿€æ´»Modelä¸Šé¢è™½ç„¶å¤–é¢å·²ç»åˆ›å»ºäº†è¿™ä¸¤ä¸ªModelï¼Œä½†æ˜¯ç›®å‰ä¸ºæ­¢ï¼Œè¿˜æ²¡æœ‰å’Œæˆ‘ç°åœ¨æœ‰Djangoé¡¹ç›®å…³è”ä¸Šï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦å…ˆæ¿€æ´»Model,å¹¶ä¸”æ ¹æ®æˆ‘ä»¬çš„modelä»£ç åˆ›å»ºå‡ºå¯¹åº”çš„æ•°æ®åº“è¡¨çš„ä¿¡æ¯ã€‚ é¦–å…ˆæˆ‘ä»¬å…ˆè¦å°†æˆ‘ä»¬çš„pollsçš„appå®‰è£…ä¸Šã€‚å»settings.pyçš„INSTALL_APPSçš„åˆ—è¡¨ä¸­ï¼Œå°†æˆ‘ä»¬çš„pollsappæ·»åŠ è¿›å»ã€‚ 1234567891011 INSTALLED_APPS = [ 'polls.apps.PollsConfig', 'django.contrib.admin', 'django.contrib.auth', 'django.contrib.contenttypes', 'django.contrib.sessions', 'django.contrib.messages', 'django.contrib.staticfiles',] ç°åœ¨æ‰§è¡Œpython manage.py makemigrations pollså¾—åˆ°ä¸‹é¢çš„ä¿¡æ¯ï¼š 1234polls/migrations/0001_initial.py - Create model Choice - Create model Question - Add field question to choice æ‰§è¡Œmakemigrationsçš„ç›®çš„æ˜¯å‘Šè¯‰Djangoï¼Œä½ å·²ç»å¯¹ä½ Modelå¯¹äº†ä¸€äº›æ”¹å˜ï¼Œä½ å¸Œæœ›Djangoèƒ½å¤Ÿä¿å­˜ä½ çš„è¿™äº›æ”¹å˜ã€‚ Migrationså¯¹ä½ Modelçš„å˜åŒ–ä»…ä»…åªæ˜¯å°†è¿™äº›å˜åŒ–ä»¥æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œè¿™äº›æ–‡ä»¶ï¼Œä½ éƒ½æ˜¯å¯ä»¥çœ‹åˆ°çš„polls/migrations/0001_initial.py ä¸‹é¢è¦æ‰§è¡Œmigrate,å°†ä½ ä¹‹å‰Modelçš„æ”¹å˜åŒæ­¥åˆ°æ•°æ®åº“è¡¨ä¸­å»ã€‚æˆ‘ä»¬ä¸ºäº†èƒ½å¤Ÿçœ‹åˆ°å…·ä½“åšäº†é‚£äº›SQLä¸Šçš„æ”¹å˜ï¼Œå¯ä»¥è¿è¡Œsqlmigrate,è¿™ä¸ªå‘½ä»¤ä¼šè¿”å›å¯¹åº”SQLè¯­å¥ã€‚æ‰§è¡Œä¹‹åï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„è¿”å›ï¼š 12345678910111213141516GhCoder_Site python manage.py sqlmigrate polls 0001BEGIN;---- Create model Choice--CREATE TABLE `polls_choice` (`id` integer AUTO_INCREMENT NOT NULL PRIMARY KEY, `choice_text` varchar(200) NOT NULL, `votes` integer NOT NULL);---- Create model Question--CREATE TABLE `polls_question` (`id` integer AUTO_INCREMENT NOT NULL PRIMARY KEY, `question_text` varchar(200) NOT NULL, `pub_date` datetime(6) NOT NULL);---- Add field question to choice--ALTER TABLE `polls_choice` ADD COLUMN `question_id` integer NOT NULL;ALTER TABLE `polls_choice` ADD CONSTRAINT `polls_choice_question_id_c5b4b260_fk_polls_question_id` FOREIGN KEY (`question_id`) REFERENCES `polls_question` (`id`);COMMIT; æ³¨æ„åˆ°ä¸‹é¢ä¸€äº›å…³é”®çš„ç‚¹ï¼š é¦–å…ˆè¡¨çš„åå­—æ˜¯ AppName_ModelNameã€‚ æ¯ä¸ªè¡¨ä¸­ä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºäº†ä¸»é”®ï¼šidç±»å‹ï¼Œå¹¶ä¸”é»˜è®¤ä¸ä¸ºç©ºï¼Œä¸”è‡ªå¢ã€‚ å¤–é”®çš„æ·»åŠ æ˜¯ModelName_idã€‚ sqlmigrateå…¶å®å¹¶æ²¡æœ‰å¯¹æ•°æ®åº“åšå‡ºç›¸åº”çš„æ“ä½œï¼Œä»–åªæ˜¯å‘Šè¯‰ä½ è¿™æ˜¯ä»–å°†è¦å¯¹æ•°æ®åº“æ‰€åšå‡ºçš„æ“ä½œï¼Œå¹¶ä¸”èƒ½å¤Ÿè®©ä½ æ£€æŸ¥æ˜¯å¦æ­£ç¡®ã€‚ 123456789//æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤python manage.py migrate//å¾—åˆ°ä¸‹é¢çš„ä¿¡æ¯GhCoder_Site python manage.py migrate Operations to perform: Apply all migrations: admin, auth, contenttypes, polls, sessionsRunning migrations: Applying polls.0001_initial... OK ç°åœ¨ä½ ä¹Ÿå¯ä»¥é€šè¿‡phpmyadminï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®åº“ä¸­çš„è¡¨éƒ½å·²ç»å¦‚æˆ‘ä»¬ä¹‹å‰modelå®šä¹‰çš„é‚£æ ·ï¼Œåˆ›å»ºå¥½äº†ï¼Œè¿™å°±æ˜¯migragteçš„é­…åŠ›æ‰€åœ¨ï¼Œå¯èƒ½ä½ åœ¨ä»¥åçš„å¼€å‘ä¸­ï¼Œä½ æ ¹æœ¬ä¸éœ€è¦æ—¶ä¸æ—¶çš„å»ä¿®æ”¹æ•°æ®åº“ï¼Œå¢åŠ ä¿®æ”¹æŸä¸ªå­—æ®µï¼Œé€šè¿‡migrateå°±èƒ½å¤Ÿå®ç°ï¼Œåªè¦ä¸‰ä¸ªæ­¥éª¤ï¼Œä½ å°±å¯ä»¥æ˜¾ç¤ºäº†äº†ã€‚ æ”¹å˜Modelï¼Œå¢åŠ ä¿®æ”¹å­—æ®µéƒ½å¯ä»¥ã€‚ æ‰§è¡Œpython manage.py makemigrationsæ¥ä¸ºè¿™äº›å˜åŒ–åˆ›å»ºmigrationsã€‚ æ‰§è¡Œpython manage.py migrateæ¥ä¿®æ”¹æ•°æ®åº“è¡¨ã€‚ è¿ç”¨APIæ¥æ“ä½œModelDjangoéå¸¸è´´å¿ƒåœ°ä¸ºæˆ‘ä»¬æä¾›shellçš„å‘½ä»¤æ¥æ“ä½œæ•°æ®ã€‚ åœ¨æ“ä½œshellä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦è¿è¡Œpython manage.py shellã€‚ ç„¶åæˆ‘ä»¬å°±è¿›å…¥åˆ°äº†pythonçš„è¿è¡Œç¯å¢ƒã€‚ä¸‹é¢è¿™æ®µä»£ç æ˜¯å®˜ç½‘ç»™æˆ‘çš„ï¼Œæˆ‘è§‰å¾—å¾ˆè¯¦ç»†ï¼Œä¹Ÿå¾ˆå…·ä½“ï¼Œæˆ‘åªæ˜¯ç¿»è¯‘äº†ä¸€ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445// ä»polls.modelsæ–‡ä»¶ä¸­å¯¼å…¥Questionã€Choice&gt;&gt;&gt; from polls.models import Question, Choice # Import the model classes we just wrote.// åœ¨ç³»ç»Ÿçš„å†…å­˜ä¸­æ˜¯å¦å­˜åœ¨Questionç±»å‹çš„æ•°æ®# No questions are in the system yet.&gt;&gt;&gt; Question.objects.all()&lt;QuerySet []&gt;# Create a new Question.# Support for time zones is enabled in the default settings file, so# Django expects a datetime with tzinfo for pub_date. Use timezone.now()# instead of datetime.datetime.now() and it will do the right thing.// è¿™é‡Œåˆ›å»ºäº†Questionçš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„éœ€è¦ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªdateçš„æ•°æ®ç±»å‹ï¼Œdateçš„æ•°æ®ç±»å‹ï¼Œæˆ‘è¿™é‡Œç”¨timezoneæ¥åˆ›å»ºï¼Œå› æ­¤è¿™é‡Œå¯¼å…¥äº†timezoneçš„æ¨¡å—&gt;&gt;&gt; from django.utils import timezone&gt;&gt;&gt; q = Question(question_text="What's new?", pub_date=timezone.now())// qçš„å®ä¾‹æ‰§è¡Œä¿å­˜çš„æ–¹æ³•# Save the object into the database. You have to call save() explicitly.&gt;&gt;&gt; q.save()// ç›´æ¥è¿”å›é‡Œqçš„idï¼Œè¿™é‡Œè¿”å›çš„æ˜¯intï¼Œè¿˜æ˜¯longï¼Œæ˜¯æ ¹æ®ä½ é€‰æ‹©çš„æ•°æ®åº“æ¥å®šçš„ã€‚# Now it has an ID. Note that this might say "1L" instead of "1", depending# on which database you're using. That's no biggie; it just means your# database backend prefers to return integers as Python long integer# objects.&gt;&gt;&gt; q.id1// è¿”å›questionçš„å®ä¾‹çš„å±æ€§å€¼# Access model field values via Python attributes.&gt;&gt;&gt; q.question_text"What's new?"&gt;&gt;&gt; q.pub_datedatetime.datetime(2012, 2, 26, 13, 0, 0, 775217, tzinfo=&lt;UTC&gt;)// åŒæ—¶ä¹Ÿå¯ä»¥ä¿®æ”¹questionå®ä¾‹çš„å±æ€§å€¼ï¼Œä½†æ˜¯è¦è®°ä½ä¿å­˜# Change values by changing the attributes, then calling save().&gt;&gt;&gt; q.question_text = "What's up?"&gt;&gt;&gt; q.save()// è¿”å›å†…å­˜ä¸­æ‰€æœ‰çš„Questionç±»å‹çš„æ•°æ®# objects.all() displays all the questions in the database.&gt;&gt;&gt; Question.objects.all()&lt;QuerySet [&lt;Question: Question object&gt;]&gt; è¿™é‡Œåœ¨æ‰§è¡ŒQuestion.objects.all()ï¼Œè¿”å›æ˜¯&lt;QuerySet [&lt;Question: Question object&gt;]&gt;ï¼Œè¿™æ ·å¯è¯»æ€§ä¸æ˜¯å¾ˆå¥½ï¼Œå®˜æ–¹çš„æ„æ€è¯´ï¼šåªè¦åˆ†åˆ«åœ¨modelæ–‡ä»¶ä¸­è¦†å†™def __str__(self):æ–¹æ³•å°±å¯ä»¥äº†ã€‚1234567891011121314from django.db import modelsfrom django.utils.encoding import python_2_unicode_compatible@python_2_unicode_compatible # only if you need to support Python 2class Question(models.Model): # ... def __str__(self): return self.question_text@python_2_unicode_compatible # only if you need to support Python 2class Choice(models.Model): # ... def __str__(self): return self.choice_text 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788&gt;&gt;&gt; from polls.models import Question, Choice# Make sure our __str__() addition worked.// ä»è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšæ‰è¦†å†™â€œdef __str__(self):â€çš„ä½œç”¨äº†&gt;&gt;&gt; Question.objects.all()&lt;QuerySet [&lt;Question: What's up?&gt;]&gt;# Django provides a rich database lookup API that's entirely driven by# keyword arguments.// Django å¯ä»¥é€šè¿‡filterå­—æ®µæ¥è¿‡æ»¤// ä¹Ÿå¯ä»¥é€šè¿‡åŒä¸‹åˆ’çº¿æ¥è‡ªå®šä¹‰è¿‡æ»¤æ¡ä»¶&gt;&gt;&gt; Question.objects.filter(id=1)&lt;QuerySet [&lt;Question: What's up?&gt;]&gt;&gt;&gt;&gt; Question.objects.filter(question_text__startswith='What')&lt;QuerySet [&lt;Question: What's up?&gt;]&gt;# Get the question that was published this year.// å¯¼å…¥ä¸€äº›è‡ªå®šä¹‰çš„æ¨¡å—// ç”Ÿæˆå“åº”çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶ä¸”ç”¨æ¥è¿‡æ»¤&gt;&gt;&gt; from django.utils import timezone&gt;&gt;&gt; current_year = timezone.now().year&gt;&gt;&gt; Question.objects.get(pub_date__year=current_year)&lt;Question: What's up?&gt;# Request an ID that doesn't exist, this will raise an exception.// å¦‚æœç›´æ¥é€šè¿‡getçš„æ–¹å¼æ¥è·å–æŸäº›å¯¹è±¡çš„è¯ï¼Œå¦‚æœå¯¹è±¡ä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸&gt;&gt;&gt; Question.objects.get(id=2)Traceback (most recent call last): ...DoesNotExist: Question matching query does not exist.# Lookup by a primary key is the most common case, so Django provides a# shortcut for primary-key exact lookups.# The following is identical to Question.objects.get(id=1).// æŸ¥è¯¢ä¸»é”®&gt;&gt;&gt; Question.objects.get(pk=1)&lt;Question: What's up?&gt;# Make sure our custom method worked.&gt;&gt;&gt; q = Question.objects.get(pk=1)// è°ƒç”¨è‡ªå®šä¹‰çš„æ–¹æ³•&gt;&gt;&gt; q.was_published_recently()True# Give the Question a couple of Choices. The create call constructs a new# Choice object, does the INSERT statement, adds the choice to the set# of available choices and returns the new Choice object. Django creates# a set to hold the "other side" of a ForeignKey relation# (e.g. a question's choice) which can be accessed via the API.&gt;&gt;&gt; q = Question.objects.get(pk=1)# Display any choices from the related object set -- none so far.// é€šè¿‡setèƒ½è¿‡æ‰¾åˆ°æœ‰æ²¡æœ‰å¯¹åº”çš„å¤–é”®å¯¹è±¡å­˜åœ¨&gt;&gt;&gt; q.choice_set.all()&lt;QuerySet []&gt;# Create three choices.// é€šè¿‡createèƒ½å¤Ÿåˆ›å»ºå…³è”çš„å¯¹è±¡ï¼Œåˆ›å»ºçš„æ–¹æ³•å…¶å®å°±æ˜¯å°±å¯ä»¥æŠŠå®ƒçœ‹åšæ˜¯ç®€å•çš„å®ä¾‹åŒ–æ–¹æ³•ï¼Œä¼ å…¥å¯¹åº”çš„å­—æ®µå°±å¯ä»¥äº†ã€‚&gt;&gt;&gt; q.choice_set.create(choice_text='Not much', votes=0)&lt;Choice: Not much&gt;&gt;&gt;&gt; q.choice_set.create(choice_text='The sky', votes=0)&lt;Choice: The sky&gt;&gt;&gt;&gt; c = q.choice_set.create(choice_text='Just hacking again', votes=0)# Choice objects have API access to their related Question objects.&gt;&gt;&gt; c.question&lt;Question: What's up?&gt;# And vice versa: Question objects get access to Choice objects.// å–å¾—æ‰€æœ‰åŒºè¿™ä¸ªQuestion å…³è”çš„ Choiceçš„å¯¹è±¡&gt;&gt;&gt; q.choice_set.all()&lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;&gt;&gt;&gt; q.choice_set.count()3# The API automatically follows relationships as far as you need.# Use double underscores to separate relationships.# This works as many levels deep as you want; there's no limit.# Find all Choices for any question whose pub_date is in this year# (reusing the 'current_year' variable we created above).// å¯ä»¥é€šè¿‡åŒä¸‹åˆ’çº¿ï¼Œåœ¨æ•°æ®ç»“æ„ä¸­æ‰¾åˆ°å…³ç³»&gt;&gt;&gt; Choice.objects.filter(question__pub_date__year=current_year)&lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;// åˆ é™¤æ•°æ®# Let's delete one of the choices. Use delete() for that.&gt;&gt;&gt; c = q.choice_set.filter(choice_text__startswith='Just hacking')&gt;&gt;&gt; c.delete() è¿™äº›shellçš„æ“ä½œï¼Œä½ ä»¥ä¸ºéƒ½åªæ˜¯åœ¨å†…å­˜é‡Œæ“ä½œçš„è¯ï¼Œä½ å°±é”™äº†ã€‚æ‰“å¼€ä½ çš„æ•°æ®åº“ï¼Œä½ ä¼šå‘ç°ä½ çš„è¿™äº›shellçš„æ“ä½œä¼šå®é™…æ“ä½œåˆ°æ•°æ®åº“çš„ ç³»ç»Ÿæ›´å¤šå…³äºshellçš„æ“ä½œåœ¨è¿™é‡Œï¼Œä½ å¯ä»¥è‡ªå·±å»æŸ¥é˜… [https://docs.djangoproject.com/en/1.11/ref/models/relations/] [https://docs.djangoproject.com/en/1.11/topics/db/queries/] [https://docs.djangoproject.com/en/1.11/topics/db/queries/#field-lookups-intro] ä¸‹é¢ä»‹ç»Djangoçš„ä¸€ä¸ªç‰›é€¼çš„åå°ï¼Œä»–å«admin é¦–å…ˆæˆ‘ä»¬å¾—å…ˆåˆ›å»ºæˆ‘ä»¬çš„æœ€é«˜æƒé™çš„ç”¨æˆ·ã€‚ æ‰§è¡Œpython manage.py createsuperuser 123456GhCoder_Site python manage.py createsuperuserUsername (leave blank to use 'parallels'): gonghuanEmail address: 11@11.comPassword: Password (again): Superuser created successfully. å†æ¬¡æ‰§è¡Œpython manage.py runserver,ç„¶åæ‰“å¼€http://127.0.0.1:8000/admin/ï¼Œä½ å°±ä¼šçœ‹åˆ°adminçš„åå°ç™»å½•ç³»ç»Ÿäº†ã€‚ ç™»å½•è¿›å»ï¼Œä½ åªä¼šçœ‹è§user,groupçš„æ¨¡å—ï¼Œé‚£å¦‚ä½•æŠŠæˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„pollsçš„appï¼Œå±•ç°åœ¨åå°å‘¢ï¼Ÿæ–¹ä¾¿æˆ‘ç¼–è¾‘æ•°æ®ï¼Ÿ æ‰“å¼€polls/admin.py,å¹¶ä¸”æˆ‘ä»¬éœ€è¦å‘Šè¯‰adminï¼ŒQuestionè¿™ä¸ªæ•°æ®ç±»å‹ï¼Œadminæ˜¯æœ‰æ•°æ®æ¥å£çš„ï¼Œå¯ä»¥æ§åˆ¶ä»–ã€‚ç¼–è¾‘å¦‚ä¸‹ä»£ç ï¼š 12345from django.contrib import adminfrom .models import Questionadmin.site.register(Question) *æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„Questionçš„é…ç½®å‡ºç°åœ¨åå°äº†ï¼Œå¹¶ä¸”å¯ä»¥å¢åˆ æ”¹æŸ¥äº†ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Pythonã€Django</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”¨Pythonçš„Djangoæ¡†æ¶æ­å»ºå‰åå°[å®˜ç½‘æ•™ç¨‹]]]></title>
    <url>%2F2017%2F05%2F09%2F20170509%2F</url>
    <content type="text"><![CDATA[äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨Pythonâ€“ä¸ç®¡ä½ ä¹‹å‰å†™è¿‡å¤šå°‘å…¶ä»–è¯­è¨€ï¼Œå½“ä½ æœ‰ä¸€å¤©å›æ¥å†™pythonçš„æ—¶å€™ï¼Œä½ å°±ä¼šè§‰å¾—â€œä¸–ç•Œæ˜¯é‚£ä¹ˆçš„ç¾å¥½ï¼â€ä»Šå¤©æˆ‘å°±æ¥è®²è®²æˆ‘æ˜¯å¦‚ä½•ç”¨Pythonçš„django[https://docs.djangoproject.com] æ¥æ­å»ºåå°çš„ï¼š æˆ‘æ˜¯åœ¨macçš„ç¯å¢ƒä¸‹æ­å»ºçš„ï¼Œlinuxä¹Ÿè¯•è¿‡ï¼Œå…¶å®æ­å»ºç¯å¢ƒæ¥è¯´ï¼Œéƒ½å·®ä¸å¤š,è¿™é‡Œå°±ä»¥macä¸ºä¾‹å­ é¦–å…ˆmacæˆ–è€…linuxçš„è¯ï¼Œåº”è¯¥æ˜¯è‡ªå¸¦pythonçš„ï¼Œå¦‚æœæ˜¯winç³»ç»Ÿçš„è¯ï¼Œä½ å¯ä»¥è‡ªå·±å»ä¸‹è½½[https://www.python.org/] æ•°æ®åº“ï¼ˆdatabaseï¼‰ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³åšçš„æ˜¯ä¸€ä¸ªå¥å…¨çš„å‰åå°ç³»ç»Ÿã€åæœŸè¿˜éœ€è¦ç»™ç§»åŠ¨ç«¯æä¾›æ•°æ®æ¥æºï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œé€‰ç”¨mysqlï¼Œæˆ‘è¿™é‡Œå·æ‡’å°±ç”¨äº†MAMPä¸€é”®å®‰è£…ï¼Œåœ¨linuxä¸‹ä¹Ÿæœ‰ç›¸åº”çš„å«LAMP,ä¸€æ­¥æ­¥ç‚¹å‡»ä¸‹ä¸€æ­¥ä¹‹åå°±å®Œæˆäº†ï¼Œè¿™é‡Œæˆ‘ç”¨çš„æ˜¯Apache+Mysqlã€‚å®‰è£…å®Œæˆä¹‹åï¼Œä½ å°±å¯ä»¥çœ‹åˆ°mysqlçš„ç«¯å£ã€å¯†ç ã€ç”¨æˆ·åå•¥çš„ï¼ˆè¿™é‡Œå¯èƒ½æœ‰äº›å‘ï¼Œéœ€è¦è‡ªå·±å»è¸©ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼Œè‡ªè¡Œgoogle),è¿™é‡Œè¦å¼„å¥½ï¼Œå› ä¸ºæˆ‘ä»¬åç»­åœ¨é…ç½®djangoçš„æ—¶å€™éœ€è¦é…ç½®ã€‚ ä¸‹é¢è¿›å…¥æ­£å¼å®‰è£…jdangoï¼Œå®˜æ–¹å»ºè®®é€šè¿‡pipå»å®‰è£…ã€‚ 1pip install -U pip å¦‚æœæŠ¥é”™å°±æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š1pip install --upgrade pip ä¸å‡ºæ„å¤–çš„è¯ï¼Œæ­¤æ—¶ä½ çš„pipï¼Œåº”è¯¥å·²ç»å®‰è£…å¥½äº†ã€‚ä¸‹é¢æ¥å®‰è£…ç¯å¢ƒï¼Œè¿™é‡Œç¯å¢ƒï¼Œå®˜æ–¹çš„æ„è§æ˜¯å®‰è£…virtualenvæˆ–è€…virtualenvwrapper,è¿™é‡Œå…¶å®æˆ‘éƒ½è¯•è¿‡ï¼Œä½ ä¹Ÿå¯ä»¥è¯•è¯•ï¼Œè¿™é‡Œå°±ç”¨virtualenv [https://virtualenv.pypa.io/en/stable/] , ä½ ä¹Ÿå¯ä»¥è‡ªå·±å‚è€ƒä¸€ä¸‹virtualenvçš„å®˜æ–¹ä»‹ç» [https://virtualenv.pypa.io/en/stable/installation/] :1[sudo] pip install virtualenv æœ€åæ‰§è¡Œå®‰è£…djangoçš„å‘½ä»¤ï¼š1pip install Django å®˜æ–¹ç»™å‡ºäº†ä¸¥é‡ä½ æ˜¯å¦å®‰è£…æˆåŠŸï¼Œä»¥åŠå®‰è£…çš„ç‰ˆæœ¬,å½“æˆåŠŸæ‰“å°çš„æ—¶å€™ï¼Œå°±ä»£è¡¨å·²ç»æˆåŠŸå®‰è£…äº†ã€‚123&gt;&gt;&gt; import django&gt;&gt;&gt; print(django.get_version())1.11 ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥1python -m django --version ç›´æ¥å¼€å§‹é¡¹ç›®ï¼š ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥ï¼šæ­¤æ—¶åœ¨å½“å‰è·¯å¾„ä¸‹å°±ä¼šçœ‹åˆ°æˆ‘ä»¬åˆ›å»ºçš„GhCoder_Siteæ–‡ä»¶å¤¹ï¼š 1django-admin startproject GhCoder_Site æ–‡ä»¶å¤¹çš„ç»“æ„ï¼š 123456â”œâ”€â”€ GhCoder_Siteâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ settings.pyâ”‚ â”œâ”€â”€ urls.pyâ”‚ â””â”€â”€ wsgi.pyâ””â”€â”€ manage.py è¿™é‡Œå®˜æ–¹ç»™äº†ä¸€äº›è§£é‡Šï¼Œæˆ‘è§‰å¾—å¾ˆå¥½ï¼Œæœ‰åŠ©äºæˆ‘ä»¬çš„ç†è§£, å…¶å®æˆ‘ä¹‹å‰éƒ½æ˜¯å†™phpçš„ï¼Œæ·±æœ‰æ„Ÿè§¦â€“note: If your background is in plain old PHP (with no use of modern frameworks), youâ€™re probably used to putting code under the Web serverâ€™s document root (in a place such as /var/www). With Django, you donâ€™t do that. Itâ€™s not a good idea to put any of this Python code within your Web serverâ€™s document root, because it risks the possibility that people may be able to view your code over the Web. Thatâ€™s not good for security.Put your code in some directory outside of the document root, such as /home/mycode. å®˜æ–¹å¯¹äºæ¯ä¸ªæ–‡ä»¶å¤¹ä»¥åŠæ–‡ä»¶çš„ä½œç”¨éƒ½åšäº†ä¸€å®šçš„è§£é‡Šï¼Œè¿™é‡Œæˆ‘å°±ä¸è§£é‡Šäº†å¾ˆé€šä¿—æ˜“æ‡‚ï¼š The outer GhCoder_Site/ root directory is just a container for your project. Its name doesnâ€™t matter to Django; you can rename it to anything you like. manage.py: A command-line utility that lets you interact with this Django project in various ways. You can read all the details about manage.py in django-admin and manage.py. The inner GhCoder_Site/ directory is the actual Python package for your project. Its name is the Python package name youâ€™ll need to use to import anything inside it (e.g. GhCoder_Site.urls). GhCoder_Site/init.py: An empty file that tells Python that this directory should be considered a Python package. If youâ€™re a Python beginner, read more about packages in the official Python docs. GhCoder_Site/settings.py: Settings/configuration for this Django project. Django settings will tell you all about how settings work. GhCoder_Site/urls.py: The URL declarations for this Django project; a â€œtable of contentsâ€ of your Django-powered site. You can read more about URLs in URL dispatcher. GhCoder_Site/wsgi.py: An entry-point for WSGI-compatible web servers to serve your project. See How to deploy with WSGI for more details. ä¸‹é¢ç›´æ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š1python manage.py runserver ä½ ä¼šå¾—åˆ°è¿™æ ·çš„åé¦ˆï¼š123456789101112Performing system checks...System check identified no issues (0 silenced).//è¯·å¿½ç•¥è¿™é‡ŒYou have 13 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.Run 'python manage.py migrate' to apply them.May 09, 2017 - 07:08:16Django version 1.11, using settings 'GhCoder_Site.settings'Starting development server at http://127.0.0.1:8000/Quit the server with CONTROL-C. æ­¤æ—¶æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥http://127.0.0.1:8000/ï¼Œä½ å°±ä¼šçœ‹åˆ°Welcome to Djangoâ€ page, in pleasant, light-blue pastel. It worked!ï¼Œå°±ä»£è¡¨æˆåŠŸäº†ã€‚åˆ‡æ¢ç«¯å£ï¼š1python manage.py runserver 8080 åˆ‡æ¢ipã€ç›‘å¬æ‰€æœ‰çš„ip1python manage.py runserver 0:8000 Djangoçš„å¼€å‘æ¨¡å¼éƒ½æ˜¯ä¾èµ–äºä¸€ä¸ªä¸ªappï¼Œè¿™ä¸€ç‚¹æˆ‘éå¸¸å–œæ¬¢ï¼ŒåæœŸå°±ç®—é¡¹ç›®å¾ˆå¤§ï¼Œä¹Ÿä¸ä¼šå¾ˆä¹±ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªapp:1python manage.py startapp polls ç»“æ„å¦‚ä¸‹ï¼š123456789101112131415161718192021.â”œâ”€â”€ db.sqlite3â”œâ”€â”€ GhCoder_Siteâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ __init__.pycâ”‚ â”œâ”€â”€ settings.pyâ”‚ â”œâ”€â”€ settings.pycâ”‚ â”œâ”€â”€ urls.pyâ”‚ â”œâ”€â”€ urls.pycâ”‚ â”œâ”€â”€ wsgi.pyâ”‚ â””â”€â”€ wsgi.pycâ”œâ”€â”€ manage.pyâ””â”€â”€ polls â”œâ”€â”€ admin.py â”œâ”€â”€ apps.py â”œâ”€â”€ __init__.py â”œâ”€â”€ migrations â”‚ â””â”€â”€ __init__.py â”œâ”€â”€ models.py â”œâ”€â”€ tests.py â””â”€â”€ views.py åˆ›å»ºç¬¬ä¸€ä¸ªviews,æ‰“å¼€polls/views.py,è¾“å…¥ï¼š12def index(request): return HttpResponse("Hello, world, You are in polls app") ç°åœ¨é…ç½®ä¸€ä¸‹è·¯ç”±,åˆ°æ–‡ä»¶polls,åˆ›å»ºä¸€ä¸ªåä¸ºurls.pyçš„æ–‡ä»¶ã€‚å°†ä¹‹å‰å†™çš„viewå’Œè¿™ä¸ªurlå¯¹åº”ä¸Šï¼š123456from django.conf.urls import url from . import views urlpatterns = [ url(r'^$', views.index, name='index') ] æœ€åå°†appçš„urlï¼Œå†™åˆ°é¡¹ç›®ä¸­çš„urls.pyçš„æ–‡ä»¶é‡Œé¢å»ï¼Œåˆ°GhCoder_Site/urls.pyæ–‡ä»¶é‡Œé¢ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š1234567from django.conf.urls import include, urlfrom django.contrib import adminurlpatterns = [ url(r'^polls/', include('polls.urls')), url(r'^admin/', admin.site.urls),] è¿™é‡Œå…³äºincludeçš„å®˜æ–¹ä»‹ç»ï¼š The include() function allows referencing other URLconfs. Note that the regular expressions for the include() function doesnâ€™t have a $ (end-of-string match character) but rather a trailing slash. Whenever Django encounters include(), it chops off whatever part of the URL matched up to that point and sends the remaining string to the included URLconf for further processing. The idea behind include() is to make it easy to plug-and-play URLs. Since polls are in their own URLconf (polls/urls.py), they can be placed under â€œ/polls/â€, or under â€œ/fun_polls/â€, or under â€œ/content/polls/â€, or any other path root, and the app will still work. æ­¤æ—¶ä½ è®¿é—®http://127.0.0.1:8000/polls/å°±çœ‹åˆ°ä½ åˆšæ‰å†™çš„viewä»¥åŠurl]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Pythonã€Django</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Object-C ç½‘ç®¡ã€ä»¥åŠåˆ‡æ¢AppDelegateçš„RootViewCtroller]]></title>
    <url>%2F2017%2F05%2F05%2F20170505%2F</url>
    <content type="text"><![CDATA[æ˜¨å¤©å°†æœ€æ–°ç‰ˆ1.9.5å‘å¸ƒä¸Šçº¿ã€‚æ€»ç»“ä¸€ä¸‹è¿™ä¸€ç‰ˆæœ¬ä¸­è¸©è¿‡çš„å‘ã€‚äº§å“çš„éœ€æ±‚ï¼š appä¸­é»˜è®¤æ˜¯æ¸¸å®¢èº«ä»½ï¼Œéšç€ä¸åŒèº«ä»½çš„åˆ‡æ¢ï¼Œå¯èƒ½éœ€è¦åˆ‡æ¢ä¸åŒçš„ç½‘ç®¡ã€‚(å‡å¦‚è¯·æ±‚çš„urlä¸º: http://www.siji.com/a.php,é‚£ä¹ˆéšç€èº«ä»½çš„åˆ‡æ¢çš„è¯ï¼Œå¯èƒ½ http://www.siji.coméœ€è¦ä¿®æ”¹ä¸ºhttp://www.chengke.com)ï¼Œå¹¶ä¸”æœ‰äº›è¯·æ±‚ï¼Œæ˜¯ä¸éœ€è¦ä¾èµ–èº«ä»½çš„ï¼š(æ¯”å¦‚ç™»å½•éƒ¨åˆ†è¯·æ±‚å°±æ˜¯http://www.login.com/login.phpã€æ”¯ä»˜éƒ¨åˆ†çš„è¯·æ±‚å°±æ˜¯http://www.pay.com/pay.php)ã€‚ appä¸­éœ€è¦åŒºåˆ†ä¸¤ç§èº«ä»½(ä¾‹å¦‚ 1.å¸æœºèº«ä»½ 2.ä¹˜å®¢èº«ä»½)ï¼Œæœªæ¥å¯èƒ½è¿˜éœ€è¦æ›´å¤šèº«ä»½å»åˆ‡æ¢ï¼Œä¼´éšç€èº«ä»½åˆ‡æ¢ï¼Œå¯èƒ½UIä¸Šä¼šå‘ç”Ÿé‡å¤§çš„æ”¹å˜ï¼Œä¾‹å¦‚ï¼šå¸æœºèº«ä»½æ˜¯UITabBarControllerä¸ºrootViewControllerçš„ï¼Œä¹˜å®¢èº«ä»½åªæ˜¯(UIViewController+UISlideViewController)ä¾§æ»‘çš„æ ·å¼ã€‚ ä¹‹å‰å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œæœ‰ä¸€ç‚¹å¾ˆé‡çš„çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œæˆ‘æ²¡æœ‰è€ƒè™‘åˆ°ï¼Œç°åœ¨æˆ‘å·²ç»åšäº†å“åº”çš„ä¿®æ”¹äº†ã€‚åœ¨å…³äºèƒ½å¤Ÿä¿®æ”¹å­—å…¸ã€æ•°ç»„çš„æ–¹æ³•ä¸­æˆ‘éƒ½ç”¨åˆ°äº†NSRecursiveLockï¼Œä»è€Œèƒ½å¤Ÿä¿è¯çº¿ç¨‹æ˜¯å®‰å…¨çš„ã€‚å±æ€§çš„ç›¸å…³å®‰å…¨æ€§ï¼Œæˆ‘ä¹ŸæŸ¥äº†äº›èµ„æ–™ï¼š[https://zhuanlan.zhihu.com/p/23998703] è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š é¦–å…ˆæˆ‘è¿™é‡Œå¸Œæœ›æˆ‘åœ¨appåˆšè¿›æ¥çš„æ—¶å€™ï¼Œå°±é…ç½®å¥½ï¼Œå¹¶ä¸”æˆ‘è¿™é‡Œå¸Œæœ›ä»–æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”æ–¹ä¾¿get/setå€¼ã€‚è¿™é‡Œæˆ‘é€‰ç”¨å•ä¾‹ã€‚å¹¶ä¸”åœ¨ç³»ç»Ÿåˆšè¿›æ¥çš„æ—¶å€™å°±é…ç½®, æˆ‘å·²ç»åŠ å…¥cocoapodsäº†ï¼š[https://github.com/Ghstart/GateWayObject]ï¼š 12345678910111213141516171819- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123; self.window = [[RootWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]]; //1.è®¾ç½®é»˜è®¤URLï¼Œå°±æ˜¯å…¶ä¸­ä¸€ç§èº«ä»½å¯¹åº”çš„URL //2.è®¾ç½®ä¸€äº›URLçš„æ˜ å°„ï¼Œä¸ä¼šæ ¹æ®ä¹‹å‰èº«ä»½è®¾ç½®æ¥ä¿®æ”¹ [GateWayObject sharedInstanceWithDefaultURL:@"https://cz.redlion56.com/gwcz/" ReflectURLS:@&#123; @"user/login.do": @"https://login.redlion56.com/gwlogin/user/login.do", @"uic/user/logout.do": @"https://cz.redlion56.com/gwcz/uic/user/logout.do" &#125;]; // 3. è®¾ç½®ä¹˜å®¢èº«ä»½å¯¹åº”çš„ç½‘ç®¡ [[GateWayObject currentGateWay] setGateWayURL:@"https://cz.redlion56.com/gwcz/" forKeyObject:carownerRole]; // 4.è®¾ç½®ä¹˜å®¢å¯¹åº”çš„ç½‘ç®¡ [[GateWayObject currentGateWay] setGateWayURL:@"https://sj.redlion56.com/gwsj/" forKeyObject:driverRole];&#125; 123456789// 5.å¹¶ä¸”è¿˜å¯ä»¥æ ¹æ®ç›¸åº”çš„æ¡ä»¶æ¥åˆ‡æ¢ç½‘ç®¡ if (xxx) &#123; [[GateWayObject currentGateWay] swichGateWayBaseOn:carownerRole]; &#125; else &#123; [[GateWayObject currentGateWay] swichGateWayBaseOn:driverRole]; &#125; 12345678910// 7.ç›´æ¥å¯ä»¥å–å¾—æ¬¡ç¯å¢ƒä¸‹å¯¹åº”çš„æ­£ç¡®URL[self GET:[[GateWayObject currentGateWay] currentURLBaseOnRelativeURL:url] parameters:parameters success:^(NSURLSessionDataTask *task, id responseObject) &#123; &#125; &#125; failure:^(NSURLSessionDataTask *task, NSError *error) &#123; if (failure &amp;&amp; error.code != -999 &amp;&amp; ![error.localizedDescription isEqualToString:@"å·²å–æ¶ˆ"]) &#123; failure(error); &#125; &#125;]; ä¸‹é¢çœ‹ä¸€ä¸‹æˆ‘çš„.hæ–‡ä»¶ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546@interface GateWayObject : NSObject@property (nonatomic, readonly) NSString *currentRelateURL;///////////-init-///////////////* ** è·å¾—å½“å‰çš„ç½‘ç®¡ */+ (GateWayObject *)currentGateWay;/* ** ç½‘ç®¡å®ä¾‹åŒ–æ–¹æ³• ** é»˜è®¤ç½‘å…³ */+ (GateWayObject *)sharedInstanceWithDefaultURL:(NSString *)url;/* ** ç½‘å…³å®ä¾‹åŒ– ** å¯ä»¥é…ç½®ä¸€äº›é»˜è®¤çš„URLå¯¹åº”çš„ä¸€äº›ç½‘å…³ */+ (GateWayObject *)sharedInstanceWithDefaultURL:(NSString *)url ReflectURLS:(NSDictionary *)reflectURLS;/* ** è®¾ç½®ç½‘å…³ */- (void)setGateWayURL:(NSString *)url forKeyObject:(id)keyObject;/* ** è®¾ç½®é»˜è®¤çš„ä¸€äº›ç½‘å…³ï¼Œä¼˜å…ˆçº§ä»…æ¬¡äºhttp/https */- (void)setDefaultRelativeURL:(NSString *)relativeURL fullURL:(NSString *)fullURL;/* ** æ ¹æ®ä¹‹å‰çš„è®¾ç½®çš„èº«ä»½åˆ‡æ¢ç½‘ç®¡ ** è¿”å›å€¼ä¸ºtrueåˆ™åˆ‡æ¢æˆåŠŸ falseå¤±è´¥ */- (BOOL)swichGateWayBaseOn:(id)keyObject;/* ** å–å¾—å½“å‰URL */- (NSString *)currentURLBaseOnRelativeURL:(NSString *)url;@end ç¬¬äºŒä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œè‡ªå®šä¹‰RootWindow,è®©å®ƒé›†æˆäº UIWindowï¼Œå¹¶ä¸”è¦†å†™ï¼Œç„¶åè‡ªå·±å†™ä¸€å¥—æ–°çš„stroyboardï¼Œæ¯æ¬¡èº«ä»½åˆ‡æ¢çš„æ—¶å€™ï¼Œç›´æ¥åˆ‡æ¢keyWindowçš„rootViewController123456789101112131415161718192021222324252627- (void)setRootViewController:(UIViewController *)rootViewController&#123; // è¿™é‡Œæˆ‘å‘ç°åœ¨æŸäº›è®¾å¤‡ä¸Šç”±äºpushã€presentä¹‹åå°±ä¸èƒ½å¤Ÿæ­£å¸¸é”€æ¯,è¿™é‡Œå°±éœ€è¦ä½ å»åˆ¤æ–­ï¼Œåšç›¸åº”çš„popã€dismissä¹‹åï¼Œåœ¨å»setRootViewController // ä½†æ˜¯åæ¥åˆå‘ç°ç³»ç»Ÿçš„navigationçš„æ ˆï¼Œæ ˆçš„å¼¹å‡ºéœ€è¦æ—¶é—´æ‰èƒ½å¼¹å‡ºï¼Œä¸æ˜¯ç«‹åˆ»å¼¹å‡ºå•Šçš„ï¼Œè¿™é‡Œå°±å¾ˆé¸¡è‚‹äº†ï¼Œç›®å‰æˆ‘è¿˜æ²¡æƒ³åˆ°å•¥è§£å†³æ–¹æ¡ˆã€‚ [UIViewController fastToRootVC]; //remove old rootViewController's sub views for (UIView* subView in self.rootViewController.view.subviews) &#123; [subView removeFromSuperview]; &#125; //remove old rootViewController's view [self.rootViewController.view removeFromSuperview]; //set new rootViewController [super setRootViewController:rootViewController]; //remove empty UILayoutContainerView(s) remaining on root window for (UIView *subView in self.subviews) &#123; if (subView.subviews.count == 0) &#123; [subView removeFromSuperview]; &#125; &#125;&#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Object-c</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºPHP7çš„æ–°å‘]]></title>
    <url>%2F2017%2F03%2F27%2F20170327%2F</url>
    <content type="text"><![CDATA[è·ç¦»ä¸Šæ¬¡å†™PHPå·²ç»è¿‡äº†2ã€3å¹´äº†ï¼Œæœ€è¿‘é—²æ¥æ— äº‹ï¼Œæƒ³å†æ•´æ•´PHPã€‚æˆ‘æ˜¯é€šè¿‡macå®‰è£…äº†è™šæ‹Ÿæœºï¼ŒUbuntn16.04çš„ç‰ˆæœ¬ï¼Œåœ¨å®‰è£…PHPç¯å¢ƒçš„æ—¶å€™ï¼Œå°±å‘ç°å¾ˆå¤šå‘ï¼Œä¸€äº›å°é—®é¢˜googleå¯ä»¥æŸ¥åˆ°çš„æˆ‘è¿™é‡Œå°±ä¸è¯´äº†ï¼Œåœ¨å®‰è£…å®ŒApacheã€PHPã€Mysqlçš„æ—¶å€™ï¼Œå¹¶ä¸”å®‰è£…å®ŒPhpmyadminçš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ï¼š 1The mysqli extension is missing.... googleä¸€æœå°±ä¼šå‘ç°ï¼š1sudo apt-get install php5-mysql è¿™é‡Œå¯¹åº”çš„php5çš„å®‰è£…ï¼Œé‚£ä½ è¿™é‡Œæ˜¯å†™php7.0-mysqlè¿˜æ˜¯å†™php7.1-mysqlå°±éœ€è¦çœ‹ä½ å®‰è£…phpçš„ç‰ˆæœ¬å·äº†ã€‚ä½ å¯ä»¥é€šè¿‡&lt;?php echo phpinfo();?&gt;ã€ä¹Ÿå¯ä»¥é€šè¿‡php --versionå¯ä»¥çŸ¥é“ï¼Œä½ éœ€è¦å®‰è£…çš„æ˜¯å¤šå°‘ã€‚åœ¨è°ƒç”¨mysqlçš„æ—¶å€™ï¼Œä¹‹å‰æˆ‘è®°å¾—æˆ‘å¾ˆä¹…ä¹‹å‰å°±ä¸€ç›´éƒ½åœ¨ä½¿ç”¨mysql_connect()è¿™ä¸ªå‡½æ•°æ¥è¿æ¥æ•°æ®åº“ï¼Œä½†æ˜¯æœ€è¿‘æˆ‘å‘ç°æˆ‘é€šè¿‡è¿™ä¸ªå‡½æ•°ã€æ²¡æœ‰ä»»ä½•çš„åé¦ˆï¼Œé€šè¿‡try/catchä¹Ÿæ²¡æœ‰ä»»ä½•errorã€è¿™ä¸ªé—®é¢˜ä¸€ç›´çº ç»“äº†å¥½ä¹…ï¼Œä»Šå¤©æ‰å‘ç°åŸæ¥åœ¨php7çš„ç‰ˆæœ¬çš„æ—¶å€™ï¼Œå·²ç»å®Œå…¨åºŸå¼ƒäº†è¿™ä¸ªå‡½æ•°äº†ï¼Œè€Œæ˜¯å·²ç»ä½¿ç”¨mysqli_connect(),è¿™é‡Œæ˜¯PHPå®˜æ–¹æ‰‹å†Œçš„è¯´æ˜ï¼š1234Warningæœ¬æ‰©å±•è‡ª PHP 5.5.0 èµ·å·²åºŸå¼ƒï¼Œå¹¶åœ¨è‡ª PHP 7.0.0 å¼€å§‹è¢«ç§»é™¤ã€‚åº”ä½¿ç”¨ MySQLi æˆ– PDO_MySQL æ‰©å±•æ¥æ›¿æ¢ä¹‹ã€‚å‚è§ MySQLï¼šé€‰æ‹© API æŒ‡å—ä»¥åŠç›¸å…³ FAQ æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚ç”¨ä»¥æ›¿ä»£æœ¬å‡½æ•°çš„æœ‰ï¼šmysqli_connect()PDO::__construct() æ‰€ä»¥æˆ‘è¿™é‡Œå°±ç”¨mysqli_connect()æ¥æ›¿æ¢ï¼Œæˆ‘è¿™é‡Œå»ºç«‹ä¸€ä¸ªvideoçš„åº“ï¼Œå¹¶ä¸”å»ºäº†ä¸€ä¸ªtestçš„è¡¨ï¼š123456789101112131415161718192021222324$servername = "localhost";$username = "root";$password = "123456789";$dbname = "video";// Create connection$conn = new mysqli($servername, $username, $password, $dbname);// Check connectionif ($conn-&gt;connect_error) &#123; die("Connection failed: " . $conn-&gt;connect_error);&#125; $sql = "SELECT * FROM test";$result = $conn-&gt;query($sql);if($result -&gt; num_rows &gt; 0) &#123; while($row = $result -&gt; fetch_assoc()) &#123; echo "Name: ".$row["name"]."-Status: ".$row["status"]."-Time:".$row["time"]."&lt;br&gt;"; &#125;&#125; else &#123; echo 'no datas';&#125;$result-&gt;close();]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ›´æ–°Reveal2çš„ä¸€äº›é—®é¢˜]]></title>
    <url>%2F2017%2F03%2F15%2F20170315%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘ä»»åŠ¡ä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œå°½é‡é€¼è‡ªå·±æŠŠæ¯å¤©å­¦çš„ä¸€äº›çš„ä¸œè¥¿éƒ½è®°å½•ä¸‹æ¥ã€‚ è¿™å¼ å›¾æ¥è‡ªç®€ä¹¦APPï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæœ‹å‹é—»èµ·æ¥æ¥çš„ï¼Œä»–è¯´è¿™æ˜¯åœ¨æ— æ•°æ®ã€æ— ç½‘ç»œçš„çŠ¶æ€ä¸‹å°±ä¼šå‡ºç°è¿™æ ·çš„ç•Œé¢ï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ 1 . æˆ‘å½“æ—¶æƒ³äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯è§‰å¾—è¦ç”¨collectionViewæ¥å®ç°å§ï¼Œå…¶å®çƒ­é—¨æ–‡ç« çš„å†…å®¹ï¼Œå…¶å®è‡ªå·±çœ‹å°±ä¼šå‘ç°ï¼Œä»–å°±ä¸€ç§cellæ ¼å¼ï¼Œè€Œçƒ­é—¨ä¸“é¢˜åº”è¯¥å°±æ˜¯ç”¨collectionviewæ¥åšçš„å§ã€‚ 2 .åæ¥ä¸€æ‹è„‘å­è§‰å¾—ä¸å¯¹å•Šï¼Œè¿™tmå¾—å¤šçƒ¦å•Šï¼Œè€Œä¸”è¿™ä¸ªä»…ä»…åªæ˜¯æ— æ•°æ®çš„ä¸€ç§é¡µé¢çš„å±•ç¤ºå•Šï¼Œè¦æˆ‘åšï¼Œé‚£å°±ç›´æ¥ä¸€å¼ imageé®ç½©ç€ä¸å°±è¡Œäº†ã€‚ çŒœæƒ³äº†åŠå¤©è¿˜æ˜¯ç”¨Revealæ¥çœ‹ä¸€ä¸‹å§ã€‚1 .ç”±äºå¾ˆé•¿æ—¶é—´ä¸ç”¨Revealäº†ï¼Œè€Œä¸”æˆ‘ä¹‹å‰çš„Revealè¿˜æ˜¯1.xçš„ç‰ˆæœ¬ï¼Œç„¶åç”¨è¶Šç‹±æœºå™¨ä¸€çœ‹ï¼Œä¸€ç›´å¯¼å…¥å¤±è´¥ï¼Œä¸€ç›´åœ¨æŠ¥è¿™ä¸ªé”™è¯¯(âŒ) The operation couldnâ€™t be completed. The app is linked against an older version of the Reveal library. You may need to update the Reveal library in your app. 2 .åæ¥å‘ç°ä¹‹å‰å¯¼å…¥åˆ°æœºå™¨ä¸­çš„ä¸€ä¸ªlibReveal.dylibçš„æ–‡ä»¶ä»¥åŠæ‰¾ä¸åˆ°äº†ï¼Œè¿™ä¸‹ï¼Œæˆ‘tmå‚»çœ¼äº†ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºè®©æˆ‘æ›´æ–°ä¸€ä¸‹è¿™ä¸ªæ‰€è°“çš„åŠ¨æ€åº“å‘¢ï¼ åæ¥googleäº†ä¸€ä¸‹ï¼Œå‘ç°äº†å®˜æ–¹çš„å›å¤ï¼š We no longer ship a dynamic library starting with Reveal 2, we include an iOS 8+ framework instead. The good news is that you should be able to make a copy of, and rename the frameworkâ€™s binary (RevealServer.framework/ReveaServer) to libReveal.dylib and then follow the instructions as before æœ€åè¿˜å‘ç°å‡ ä¸ªå¥½ç©çš„ä¸œè¥¿ï¼š å¯ä»¥å‘ç°çœŸçš„å°±å¦‚æˆ‘çš„çŒœæƒ³ï¼Œä»–å…¶å®è¿™äº›éƒ½æ˜¯ä¹‹å‰å°±å®šæ­»çš„ä¸€ä¸ªimageï¼Œé®ç½©åœ¨ä¸Šé¢çš„ï¼Œå…¶ä»–ä¹Ÿå°±ä¸ç”¨è¯´äº†ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Reveal</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å°è¯•Swiftæ­å»ºæœåŠ¡å™¨-å»ºç«‹è‡ªå·±çš„ç½‘ç«™]]></title>
    <url>%2F2017%2F02%2F25%2F20170225%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ Paulå¤§ç¥çš„swift-serverï¼Œæˆ‘ä¹Ÿå°è¯•ç”¨Swiftæ¥æ­å»ºè‡ªå·±çš„ç½‘ç«™ã€‚è¿™é‡Œä¸»è¦ä¾èµ–çš„æ˜¯IBMå¼€æºçš„Kituraæ¡†æ¶ã€‚ ç¯å¢ƒæ­å»º ï¼ˆMacä¸‹ï¼‰ å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨è‡ªå·±çš„macä¸Šæ­å»ºç¯å¢ƒï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½Docker[https://docs.docker.com/docker-for-mac/] è¿™ä¸ªè½¯ä»¶ï¼Œè¿™ä¸ªè½¯ä»¶çš„ä½œç”¨å°±ç›¸å½“äºä¸€å°çœ‹ä¸è§çš„è™šæ‹Ÿæœºï¼Œèƒ½å¤Ÿåœ¨macä¸Šè¿è¡ŒLinuxã€‚ ä¸‹è½½å®Œæˆä¹‹åï¼Œå»ºç«‹æ ¹ç›®å½•æ–‡ä»¶å¤¹ã€‚ 1234cd ~/Desktopmkdir servercd serverdocker run -itv $(pwd):/projects --name projects -w /projects -p 8089:8089 -p 8090:8090 -p 5984:5984 twostraws/server-side-swift /bin/bash 3 . è¿™é‡Œdockerå¼€å¤´çš„å‘½ä»¤ï¼Œæ˜¯è®©dokerè½¯ä»¶æ¥è¿è¡Œçš„ï¼Œå…¶ä¸­â€™/projectsâ€™ æŒ‡çš„æ˜¯æ–‡ä»¶å†…å»ºç«‹ä»¥projectså¼€å¤´çš„æ–‡ä»¶é»˜è®¤æŒ‡å‘çš„æ˜¯å½“å‰çš„æ–‡ä»¶è·¯å¾„ï¼Œå¹¶ä¸”å»ºç«‹çš„8090ã€5984è¿™ä¸¤ä¸ªç«¯å£ã€‚ 4 . å»ºç«‹å¥½ä¹‹åä½ å°±ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¿”å›å€¼ï¼š 1root@f2429f0045db:/projects# å»ºç«‹ç¬¬ä¸€ä¸ªæ–‡ä»¶ è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1234cd ~/Desktop/servermkdir project1cd project1swift package init --type executable æœ€åä¸€è¡Œå‘½ä»¤å¯èƒ½æ¯”è¾ƒå›°æƒ‘ï¼Œå…¶å®è¿™è¡Œå‘½ä»¤å°±æ˜¯å‘Šè¯‰swift packageï¼ˆè¿™é‡Œçš„swift packageç›¸å½“äºOCä¸­çš„cocoapodsã€æˆ–è€…NodeJSä¸­çš„npmä¸€æ ·ï¼‰,æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œâ€™â€“type executableâ€˜çš„æ„æ€æ˜¯æˆ‘ä»¬å¸Œæœ›å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ã€‚çœ‹åˆ°å¦‚ä¸‹è¿”å›å€¼å°±ä»£è¡¨æˆåŠŸäº†ï¼š123456Creating executable package: project1Creating Package.swiftCreating .gitignoreCreating Sources/Creating Sources/main.swiftCreating Tests/ 2 .è¿è¡Œï¼š 1swift build 3 . å†è¿è¡Œ 1.build/debug/project1 å½“çœ‹åˆ°â€Hello world!â€å°±ä»£è¡¨å·²ç»æˆåŠŸäº†ã€‚ 4 .å†è¿è¡Œ 1swift package generate-xcodeproj æ­¤æ—¶ç”¨Xcodeæ‰“å¼€åˆšåˆšç”Ÿæˆçš„project1.xcodeproj,åˆ‡æ¢project1&gt;Sources&gt;project1,å½“æ§åˆ¶å°ä¸­æ‰“å°â€œHello world!â€ 5 . æ‰¾åˆ°Main.swiftæ–‡ä»¶ï¼Œæ›´æ¢å†…å®¹ï¼Œæˆ‘ä»¬å¼•å…¥è·¯ç”±æ¨¡å—ï¼Œå¹¶ä¸”å®ä¾‹åŒ–ï¼Œå¹¶ä¸”ç›‘å¬8090ç«¯å£ 123456import Kituralet router = Router()Kitura.addHTTPServer(onPort: 8090, with: router)Kitura.run() æ­¤æ—¶æ‰“å¼€æµè§ˆå™¨â€http://localhost:8090&quot;,å¤§åŠŸå‘Šæˆï¼ï¼ï¼ ç¯å¢ƒæ­å»º ï¼ˆLinuxä¸‹ï¼‰ å…ˆä¸‹è½½é€‚åˆä½ Linuxç‰ˆæœ¬çš„Swiftçš„ç‰ˆæœ¬[https://swift.org/download/] å…¶å®è¿™é‡ŒKituraçš„å®˜ç½‘ç»™å‡ºäº†æ•™ç¨‹ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‰ç…§å®˜æ–¹çš„æ•™ç¨‹èµ°ä¸‹å»ã€‚[http://www.kitura.io/en/starter/settingup.html] 12$ sudo apt-get update$ sudo apt-get install clang libicu-dev libcurl4-openssl-dev libssl-dev 1$ export PATH=&lt;path to uncompressed tar contents&gt;/usr/bin:$PATH 2 .è¿™é‡Œå·²ç»ä»‹ç»è§£é‡Šçš„å¾ˆæ¸…æ¥šäº†ï¼Œå°±æ˜¯å°†&lt;&gt;ä»¥åŠå…¶ä¸­çš„å†…å®¹æ›¿æ¢æˆä½ åˆšæ‰ä¸‹è½½å¹¶è§£å‹ä¸‹æ¥çš„SwiftåŒ…è·¯å¾„ï¼Œå‡è®¾æˆ‘çš„è·¯å¾„ä¸º/home/gh/swift-3.0.2-release/, é‚£å°±å¯ä»¥åœ¨ç»ˆç«¯è¿è¡Œï¼š 1$ export PATH=/home/gh/swift-3.0.2-release/usr/bin:$PATH 3 .ç´§æ¥ç€è¿è¡Œ,çœ‹åˆ°æ­£å¸¸çš„è¿”å›å°±ä»£è¡¨å·²ç»å®‰è£…æ­£å¸¸ã€‚ 1swift --version 4 .ä¸‹é¢çš„æ–¹æ³•æ­¥éª¤å°±å’Œä¹‹å‰åœ¨Macä¸Šçš„é…ç½®æ˜¯ä¸€æ ·çš„äº†ï¼Œä½ ä¹Ÿå¯ä»¥å‚è€ƒKituraçš„æ•™ç¨‹[http://www.kitura.io/en/starter/gettingstarted.html]]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ é˜¿é‡Œå¼€æºé¡¹ç›®BeeHive(ä¸‰)]]></title>
    <url>%2F2016%2F12%2F01%2F20161201%2F</url>
    <content type="text"><![CDATA[æœ€åæ€»ç»“ä¸€ä¸‹æ•´ä¸ªBeeHiveé¡¹ç›®çš„æ­å»ºã€‚ä»¥åŠæˆ‘çœ‹å®Œä¹‹åçš„ä¸€äº›è´¨ç–‘å’Œæƒ³æ³•ï¼Œæœ‰äº›ä½œè€…ä»¥åŠç»™å‡ºäº†å›ç­”ï¼Œä¼šåœ¨ä¸‹ä¸€ç‰ˆæœ¬çš„æ›´æ–°ä¸­è¿›è¡Œä¿®æ”¹ã€‚ å…ˆè´´ä¸Šæˆ‘è‡ªå·±ç”»çš„ä¸€ä¸ªæçº² é¦–å…ˆï¼Œä¸ºä»€ä¹ˆæ¯ä¸ªViewControlleréƒ½éœ€è¦é…å¤‡ä¸€ä¸ªé…å¤‡ä¸€ä¸ªModuleçš„æ–‡ä»¶ï¼Ÿå› ä¸ºä»–éœ€è¦é€šè¿‡+(void)load{}çš„æ–¹æ³•ï¼ŒåŠ¨æ€çš„å°†moduleInfoçš„ä¿¡æ¯å­˜å‚¨ä¸‹æ¥ï¼Œè¿™é‡Œæ˜¯å­˜å‚¨åœ¨BHModuleManageræ–‡ä»¶ä¸­çš„self.BHModulesæ­¤æ—¶è¿™é‡Œå­˜å‚¨çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè¿˜æ²¡æœ‰åˆ›å»ºä¸ºå®ä¾‹å¯¹è±¡ã€‚ä¸ºä»€ä¹ˆæœ‰äº›moduleçš„æ–‡ä»¶ä¸­æ²¡æœ‰loadæ–¹æ³•ï¼Œä½†æ˜¯ä»–è¿˜æ˜¯åœ¨å¯åŠ¨ä¹‹å‰ä¹Ÿæ³¨å†Œè¿›å»äº†å‘¢ï¼Ÿç­”ï¼šå› ä¸ºè¿™é‡Œä½œè€…éƒ½æ˜¯é€šè¿‡å®çš„çš„å½¢å¼ï¼Œæ¥å¿«é€Ÿå®ç°åŠ è½½çš„ä¿¡æ¯ï¼Œæœ¬è´¨ä¸Šå’Œ+(void)load{}æ˜¯ä¸€æ ·çš„ã€‚BH_EXPORT_MODULE(NO) è¿™é‡Œåœ¨å®˜æ–¹çš„demoä¸­çœ‹åˆ°TestAppDelegateè¿›è¡Œäº†ModuleConfigNameã€ServiceConfigNameçš„è®¾ç½®ï¼Œä¸è®¾ç½®å¯ä»¥å—ï¼Ÿç­”ï¼šå¯ä»¥ï¼ï¼è¿™é‡Œåœ¨BHContextå¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå·²ç»é»˜è®¤è®¾ç½®äº†åˆå§‹å€¼äº†ã€‚ è¿™é‡Œå‡å¦‚æˆ‘æœ‰æ–°çš„åŠŸèƒ½ï¼Œæˆ‘åº”è¯¥å¾€å“ªé‡Œå»æ·»åŠ å‘¢ï¼Ÿç­”ï¼šè¿™é‡Œåªæ˜¯æˆ‘çš„çŒœæƒ³-&gt;åº”è¯¥åœ¨BHContextä¸­å»æ·»åŠ ï¼Œå› ä¸ºåœ¨BHContextå®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå°±é¡ºå¸¦å®ä¾‹åŒ–äº†ä¸€ç³»åˆ—çš„å¯¹è±¡ï¼šBHShortCutItemã€BHOpenURLItemã€BHNotificationItemã€BHUserActivityã€BHConfig,å¹¶ä¸”è¿™äº›å¯¹è±¡éƒ½æ˜¯å•ä¾‹ï¼Œè¿™é‡Œæˆ‘ä¿æŒæˆ‘çš„æ€åº¦ã€‚è¿™é‡Œçš„ifè°ƒè¯•æ—¶ä½œè€…çš„ç¬”è¯¯ï¼Œä»–ä¼šåœ¨ä¸‹ä¸€ç‰ˆæœ¬æ›´æ–° if ([BHInstance isKindOfClass:[BHContext class]]) {}1234567891011121314151617181920-(instancetype)init&#123; self = [super init]; if (self) &#123; self.modulesByName = [[NSMutableDictionary alloc] initWithCapacity:1]; self.servicesByName = [[NSMutableDictionary alloc] initWithCapacity:1]; self.moduleConfigName = @"BeeHive.bundle/BeeHive"; self.serviceConfigName = @"BeeHive.bundle/BHService";#if __IPHONE_OS_VERSION_MAX_ALLOWED &gt; 80400 self.touchShortcutItem = [BHShortcutItem new];#endif self.openURLItem = [BHOpenURLItem new]; self.notificationsItem = [BHNotificationsItem new]; self.userActivityItem = [BHUserActivityItem new]; &#125; return self;&#125; 1234567891011121314+(instancetype) shareInstance&#123; static dispatch_once_t p; static id BHInstance = nil; dispatch_once(&amp;p, ^&#123; BHInstance = [[[self class] alloc] init]; if ([BHInstance isKindOfClass:[BHContext class]]) &#123; ((BHContext *) BHInstance).config = [BHConfig shareInstance]; &#125; &#125;); return BHInstance;&#125; ç³»ç»Ÿæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è½½å…¥æœ¬åœ°çš„ç»„ä»¶ä¿¡æ¯çš„å‘¢ï¼Ÿç­”ï¼šæ˜¯åœ¨å“BeeHiveè°ƒç”¨setContextå¯¹è±¡çš„æ—¶å€™ï¼Œè¿›è¡Œè°ƒç”¨çš„ã€‚å¹¶ä¸”è¿™é‡Œé€šè¿‡contextä¸­çš„æ–‡ä»¶åï¼Œè¿›è¡Œæ‹¼æ¥ï¼Œè¿”å›plistæ–‡ä»¶çš„ä¿¡æ¯ã€‚ æ¯”èµ·åœ¨è¿™é‡Œå°†self.BHModules æ–‡ä»¶ä¿¡æ¯æ¢æˆäº†å“åº”çš„å®ä¾‹å¯¹è±¡ é‚£çœ‹åˆ°å„ä¸ªModuleéƒ½ä¼šè°ƒç”¨modSetUpã€modInitç±»ä¼¼çš„æ–¹æ³•ï¼Œé‚£è¿™äº›æ–¹æ³•æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ï¼Ÿç­”ï¼šæ˜¯åœ¨è°ƒç”¨çˆ¶ç±»çš„Appdelegateçš„æ–¹æ³•çš„æ—¶å€™è°ƒç”¨çš„ï¼Œ åˆäº†ä¸€äº›ä¸»åŠ¨è°ƒç”¨çš„ä¸Šé¢è¿™äº›æ–¹æ³•ï¼Œé‚£ä»€ä¹ˆæ—¶å€™æ‰ä¼šè°ƒç”¨ç³»ç»Ÿçš„æ–¹æ³•ï¼Œç±»ä¼¼è¿›å…¥åå°ã€è¢«æŒ‚èµ·ã€è¿›å…¥å‰å°ã€‚ç­”ï¼šè¿™æ˜¯åœ¨appdelegateçš„å“åº”æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œä¹Ÿä¼šè°ƒç”¨ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ é˜¿é‡Œå¼€æºé¡¹ç›®BeeHive(äºŒ)]]></title>
    <url>%2F2016%2F11%2F28%2F20161128%2F</url>
    <content type="text"><![CDATA[ç´§æ¥ç€å‰é¢é‚£ç¯‡æ–‡ç« ï¼Œå›åˆ°BHAppDelegate.mçš„æ–‡ä»¶é‡Œé¢çš„1- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions ä¹‹å‰å·²ç»æŠŠæ‰€æœ‰çš„timeProdilerçš„è¿™ä¸ªç±»çš„ä½œç”¨ï¼Œå®ä¾‹ï¼Œå·²ç»publicçš„æ–¹æ³•éƒ½å·²ç»è¯´äº†ã€‚åœ¨è¿™ä¸ªæ–¹æ³•çš„å®ç°ä¸­ï¼Œä½œè€…è¿˜åšäº†å¦å¤–ä¸€ä»¶äº‹æƒ…ã€‚ 123456[[BHModuleManager sharedManager] tiggerEvent:BHMSetupEvent];[[BHModuleManager sharedManager] tiggerEvent:BHMInitEvent];dispatch_async(dispatch_get_main_queue(), ^&#123; [[BHModuleManager sharedManager] tiggerEvent:BHMSplashEvent];&#125;); BHModuleManagerä»å­—é¢ä¸Šç†è§£åº”è¯¥å°±æ˜¯ç®¡ç†æ¨¡å—ä¹‹å‰è°ƒç”¨é€»è¾‘çš„æ„æ€ï¼Œå¹¶ä¸”åœ¨BHModuleManager.mä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªç±»ä¹Ÿæ˜¯ä¸ªå•ä¾‹ã€‚ åœ¨initä¹‹åï¼Œç´§æ¥ç€å°±æ˜¯è°ƒç”¨- (void)tiggerEvent:(BHModuleEventType)eventType;çš„æ–¹æ³•ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•çš„å®ç°ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¾ˆé•¿çš„swichè¯­å¥ï¼Œéå†ä½ ä¼ å…¥çš„ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œæ¥åšä¸€ç³»åˆ—çš„äº‹æƒ…ã€‚ å…ˆçœ‹åœ¨didFinishLaunchä¸­ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°ä¸ºBHMSetupEventã€‚ 123case BHMSetupEvent:[self handleModuleEvent:kSetupSelector];break; 123456789101112131415- (void)handleModuleEvent:(NSString *)selectorStr&#123; SEL seletor = NSSelectorFromString(selectorStr); [self.BHModules enumerateObjectsUsingBlock:^(id&lt;BHModuleProtocol&gt; moduleInstance, NSUInteger idx, BOOL * _Nonnull stop) &#123; if ([moduleInstance respondsToSelector:seletor]) &#123;#pragma clang diagnostic push#pragma clang diagnostic ignored "-Warc-performSelector-leaks" [moduleInstance performSelector:seletor withObject:self.wholeContext];#pragma clang diagnostic pop [[BHTimeProfiler sharedTimeProfiler] recordEventTime:[NSString stringWithFormat:@"%@ --- %@", [moduleInstance class], NSStringFromSelector(seletor)]]; &#125; &#125;];&#125; å¯ä»¥çœ‹åˆ°ä¼ å…¥äº†ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå…¥å‚ï¼Œè€Œè¿™ä¸ªå‚æ•°å†™åœ¨è¿™ä¸ªæ–‡ä»¶çš„.mä¸­ã€‚static NSString *kSetupSelector = @&quot;modSetUp:&quot;;å†™æ­»äº†ã€‚ ç´§æ¥ç€åœ¨handleModuleEventçš„å®ç°ä¸­ï¼Œé€šè¿‡runtimeçš„NSSelectorFromStringçš„æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºSELçš„ç±»å‹ã€‚ å†æšä¸¾BHModulesæ•°ç»„ï¼Œä»æšä¸¾ä¸­æˆ‘ä»¬å‘ç°ï¼Œä¸æ˜¯æ‰€æœ‰çš„objectå¯¹è±¡éƒ½æ·»åŠ åœ¨BHModulesçš„MutableArrayä¸­ï¼Œè¿™äº›objectçš„å¯¹è±¡å¿…é¡»è¦éµå®ˆid&lt;BHModuleProtocol&gt;çš„åè®®ã€‚ æŸ¥è¯¢æ•°ç»„ä¸­æœ‰æ²¡æœ‰å¯¹è±¡å¯ä»¥å“åº”è¿™ä¸ªæ–¹æ³•çš„ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”å¼€å§‹reordTimeã€‚ å¹¶ä¸”ä¸ºäº†æ¶ˆé™¤ç¼–è¯‘å™¨æ‰€æŠ¥çš„è­¦å‘Šï¼Œå¯ä»¥é€šè¿‡æ·»åŠ #pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot;,æ¥æ¶ˆé™¤warningã€‚ ç´§æ¥ç€è°ƒç”¨äº†åŒä¸€ä¸ªæ–¹æ³•ï¼Œå´ä¼ å…¥äº†ä¸åŒçš„å‚æ•°1234567[[BHModuleManager sharedManager] tiggerEvent:BHMInitEvent]; case BHMInitEvent: //special [self handleModulesInitEvent]; break; 123456789101112131415161718192021222324252627282930313233- (void)handleModulesInitEvent&#123; [self.BHModules enumerateObjectsUsingBlock:^(id&lt;BHModuleProtocol&gt; moduleInstance, NSUInteger idx, BOOL * _Nonnull stop) &#123; __weak typeof(&amp;*self) wself = self; void ( ^ bk )(); bk = ^()&#123; __strong typeof(&amp;*self) sself = wself; if (sself) &#123; if ([moduleInstance respondsToSelector:@selector(modInit:)]) &#123; [moduleInstance modInit:sself.wholeContext]; &#125; &#125; &#125;; [[BHTimeProfiler sharedTimeProfiler] recordEventTime:[NSString stringWithFormat:@"%@ --- modInit:", [moduleInstance class]]]; if ([moduleInstance respondsToSelector:@selector(async)]) &#123; BOOL async = [moduleInstance async]; if (async) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; bk(); &#125;); &#125; else &#123; bk(); &#125; &#125; else &#123; bk(); &#125; &#125;];&#125; é¦–å…ˆå¾ªç¯éå†self.BHModulesè¿™ä¸ªæ•°ç»„å¯¹è±¡ï¼Œå…ˆç”¨Timer å¼€å§‹è®°å½•ä¸‹initæ–¹æ³•çš„æ—¶é—´ã€‚ åˆ¤æ–­æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å¦å“åº”asyncçš„æ–¹æ³•, è¿™ä¸ª- (BOOL)async;çš„æ–¹æ³•å®šä¹‰åœ¨BHModuleProtocolä¸­ï¼Œå¦‚æœå“åº”äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°±å–å¾—è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼,ä»å­—é¢ä¸Šåˆ¤æ–­è¿™ä¸ªå˜é‡è®°å½•äº†æ˜¯å¦è¿è¡Œåœ¨å¤šçº¿ç¨‹ä¸­ï¼Œè¿™é‡Œæˆ‘åªæ˜¯ä¸ªçŒœæµ‹ã€‚ å¦‚æœæ˜¯åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œå°±å›åˆ°ä¸»çº¿ç¨‹ä¸­æ¥æ‰§è¡Œä¸Šé¢æ‰€å®šä¹‰çš„blockï¼švoid ( ^ bk )();ï¼Œå¦‚æœä¸æ˜¯çš„è¯æˆ–è€…æ²¡æœ‰å“åº”async,éƒ½ç›´æ¥è¿è¡Œè¿™ä¸ªblockï¼Œåº”è¯¥é»˜è®¤çŠ¶æ€ä¸‹å°±æ˜¯ä¸»çº¿ç¨‹äº†ã€‚ ä»ä»£ç ä¸Šçœ‹æ¥ï¼Œå°±æ˜¯ä¸ç®¡åœ¨ä»€ä¹ˆçº¿ç¨‹æˆ–è€…æ˜¯å¦å“åº”asyncçš„æ–¹æ³•ï¼Œä¸Šé¢çš„blockæ˜¯è‚¯å®šè¦æ‰§è¡Œçš„ã€‚ blockä¸­æ‰€åšçš„äº‹æƒ…ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­è¿™ä¸ªå…ƒç´ å¯¹è±¡æ˜¯å¦å“åº”- (void)modInit:(BHContext *)context;,è¿™ä¸ªprotocolçš„ä»£ç†æ–¹æ³•ï¼Œå¦‚æœå“åº”çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œè¿™æ®µä»£ç ï¼Œè‡³äºè¿™é‡Œçš„BHContextçš„å¯¹è±¡ï¼Œæˆ‘ç›®å‰æ²¡çœ‹åˆ°åœ¨å“ªé‡Œä¼ å…¥è¿›æ¥ï¼Œè¿™é‡Œåªçœ‹åˆ°äº†ä¸€ä¸ªSetterçš„æ–¹æ³•ã€‚ 12345- (void)setWholeContext:(BHContext *)wholeContext&#123; _wholeContext = wholeContext; self.modulesConfigFilename = _wholeContext.moduleConfigName;&#125; æœ€åæ‰§è¡Œçš„ä¸€ä¸ªæ–¹æ³•123dispatch_async(dispatch_get_main_queue(), ^&#123; [[BHModuleManager sharedManager] tiggerEvent:BHMSplashEvent]; &#125;); è¿™ä¸ªæ–¹æ³•å’Œ[self handleModuleEvent:kSetupSelector];ä¸€æ ·ï¼Œé™¤äº†ä¼ å…¥çš„å‚æ•°ä¸åŒï¼Œå“åº”çš„æ–¹æ³•ä¸åŒï¼Œå…¶ä»–éƒ½æ˜¯ä¸€æ ·ã€‚ è¿™é‡Œè¿˜è¦å¼ºåˆ¶è¦æ±‚è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¸€å®šè¦åœ¨ä¸»çº¿ç¨‹ä¸­ã€‚ è¿™æ ·å°±å·²ç»æŠŠè‡ªå®šä¹‰çš„BHAppDelegateçš„ä¸»è¦å‡ ä¸ªå®ç°å·²ç»ä»‹ç»äº†ä¸€ä¸‹ï¼Œä¸‹é¢æ¥çœ‹çœ‹demoä¸­çš„å®ç°ã€‚åœ¨TestAppDelegateçš„didFinishLaunchingWithOptionsçš„æ–¹æ³•ä¸­ã€‚è¿™å››è¡Œä»£ç æ¶‰åŠåˆ°äº†åŒä¸€ä¸ªå¯¹è±¡BHContext,ä»å­—é¢ä¸Šåˆ¤æ–­åº”è¯¥æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œåº”è¯¥æ˜¯å¯¹è±¡ä¹‹é—´çš„è°ƒç”¨ä¼šéœ€è¦ç”¨å®ƒæ¥è®°å½•ä¸€ä¸‹ï¼Œè¿™é‡Œæ˜¯æˆ‘çš„çŒœæµ‹1234[BHContext shareInstance].application = application;[BHContext shareInstance].launchOptions = launchOptions;[BHContext shareInstance].moduleConfigName = @"BeeHive.bundle/BeeHive";//å¯é€‰ï¼Œé»˜è®¤ä¸ºBeeHive.bundle/BeeHive.plist[BHContext shareInstance].serviceConfigName = @"BeeHive.bundle/BHService"; åœ¨BHContext.mçš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿæ˜¯ä¸ªå•ä¾‹ï¼Œåœ¨è¿™ä¸ªå•ä¾‹çš„initæ–¹æ³•ä¸­ï¼š1234567891011121314151617181920-(instancetype)init&#123; self = [super init]; if (self) &#123; self.modulesByName = [[NSMutableDictionary alloc] initWithCapacity:1]; self.servicesByName = [[NSMutableDictionary alloc] initWithCapacity:1]; self.moduleConfigName = @"BeeHive.bundle/BeeHive"; self.serviceConfigName = @"BeeHive.bundle/BHService";#if __IPHONE_OS_VERSION_MAX_ALLOWED &gt; 80400 self.touchShortcutItem = [BHShortcutItem new];#endif self.openURLItem = [BHOpenURLItem new]; self.notificationsItem = [BHNotificationsItem new]; self.userActivityItem = [BHUserActivityItem new]; &#125; return self;&#125; å®šä¹‰äº†modulesByNameã€servicesByNameä¸ºNSMutableDictionaryçš„å¯¹è±¡ï¼Œåªèƒ½å®¹çº³ä¸€ä¸ªå…ƒç´ ã€‚ å®šä¹‰äº†moduleConfigNameã€serviceConfigNameä¸ºStringçš„å¯¹è±¡ã€‚ åœ¨ç³»ç»Ÿå¤§äº8.0.4çš„æ—¶å€™ï¼Œæ”¯æŒ3D touchçš„è¯ï¼Œä¼šé¢å¤–è®¾ç½®ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢å°±ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯UIApplicationShortcutItem *shortcutItem;, ä¸€ä¸ªæ˜¯typedef void (^shortcutItemCompletionHandler)(BOOL);,éƒ½æ˜¯åœ¨è°ƒç”¨3D touchçš„æ—¶å€™ä¼šè°ƒç”¨åˆ°ã€‚ æ¶‰åŠåˆ°äº†å¦ä¸€ä¸ªå¯¹è±¡BHOpenURLItem,è¿™ä¸ªå¯¹è±¡å«æœ‰ä¸‰ä¸ªå˜é‡NSURL *openURL;,NSString *sourceApplication;,NSDictionary *options;ã€‚ è®¾è®¡äº†é€šçŸ¥çš„ä¸€ä¸ªå¯¹è±¡BHNotificationsItem,è¿™ä¸ªå¯¹è±¡å«æœ‰äº”ä¸ªå˜é‡ï¼šNSError *notificationsError;,NSData *deviceToken;,NSDictionary *userInfo;,typedef void (^notificationResultHandler)(UIBackgroundFetchResult);,UILocalNotification *localNotification;ã€‚ è¿˜æœ‰ä¸€ä¸ªæ¶‰åŠåˆ°ç”¨æˆ·ä¿¡æ¯çš„ä¸€ä¸ªå¯¹è±¡ï¼šBHUserActivityItem,å«æœ‰å››ä¸ªå˜é‡ï¼šNSString *userActivityType;,NSUserActivity *userActivity;,NSError *userActivityError;, typedef void (^restorationHandler)(NSArray *);ã€‚ æ€»ä½“çœ‹æ¥è¿™ä¸ªå¯¹è±¡å®Œæˆçš„åŠŸèƒ½å¾ˆå¤šï¼Œå¹¶ä¸”ä»¥åå¾ˆå¤šç±»ä¼¼3D touch è¿™ç§é’ˆå¯¹æŸç§ç³»ç»Ÿçš„æ–°åŠŸèƒ½éƒ½å¯ä»¥åœ¨è¿™ä¸ªç±»ä¸­æ¥æ‹“å±•ï¼Œè€Œä¸”å¾ˆæ–¹ä¾¿ä½¿ç”¨ã€‚ åœ¨æœ¬ç±»çš„shareInstanceçš„æ–¹æ³•ä¸­ï¼š123456dispatch_once(&amp;p, ^&#123; BHInstance = [[[self class] alloc] init]; if ([BHInstance isKindOfClass:[BHContext class]]) &#123; ((BHContext *) BHInstance).config = [BHConfig shareInstance]; &#125; &#125;); è¿™é‡Œåœ¨è®¾ç½®configçš„å˜é‡ä¹‹å‰åˆ¤æ–­if ([BHInstance isKindOfClass:[BHContext class]]) {}è¿™ä¸ªè¯´å®è¯ï¼Œæˆ‘æ²¡å¤ªæ˜ç™½è¿™ä¹ˆåšçš„åŸå› æ˜¯ä»€ä¹ˆï¼Œä¸Šé¢éƒ½å·²ç»BHInstance = [[[self class] alloc] init];è°ƒç”¨äº†ï¼Œé‚£è¿™ä¸ªåˆ¤æ–­è¿˜æœ‰ä»€ä¹ˆæ„æ€å—ï¼Ÿå¹¶ä¸”è¿™ä¸ªå¯¹è±¡æ˜¯ç»§æ‰¿çš„NSObjectçš„å¯¹è±¡ã€‚ è¿™é‡Œçš„BHConfigå¯¹è±¡ï¼Œä»ä»£ç ä¸Šçœ‹ä¹Ÿæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå¹¶ä¸”å®šä¹‰äº†ä¸€ç³»åˆ—å­˜å‚¨ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œåœ¨.mçš„æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªNSMutableDictionary *config;çš„å¯¹è±¡ï¼Œç»Ÿä¸€å­˜å‚¨åœ¨è¿™ä¸ªé‡Œé¢ï¼Œå¯ä»¥æ˜¯å¯¹è±¡ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€äº›åŸºç¡€çš„æ•°æ®ç±»å‹ã€‚ 1234[BHContext shareInstance].application = application;[BHContext shareInstance].launchOptions = launchOptions;[BHContext shareInstance].moduleConfigName = @"BeeHive.bundle/BeeHive";//å¯é€‰ï¼Œé»˜è®¤ä¸ºBeeHive.bundle/BeeHive.plist[BHContext shareInstance].serviceConfigName = @"BeeHive.bundle/BHService"; ç°åœ¨å¯ä»¥çœ‹å‡ºæ¥ï¼Œé¦–å…ˆè¿™4è¡Œä»£ç å°±æ˜¯ç®€å•çš„èµ‹å€¼çš„åŠ¨ä½œï¼Œæœ‰äº›ç±»çš„å€¼ä½ å¯ä»¥ä¸èµ‹å€¼ï¼Œç±»ä¼¼çš„æœ‰ï¼šmoduleConfigName,serviceConfigName,å› ä¸ºåœ¨å¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå°±å·²ç»è¿›è¡Œäº†èµ‹å€¼ã€‚ ç´§æ¥ç€åœ¨ä¸‹é¢çš„ä¸¤è¡Œä»£ç ä¸­æ¶‰åŠåˆ°äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼š12[BeeHive shareInstance].enableExpection = YES;[[BeeHive shareInstance] setContext:[BHContext shareInstance]]; 123456789101112#pragma mark - Private-(void)setContext:(BHContext *)context&#123; _context = context; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; [self loadStaticServices]; [self loadStaticModules]; &#125;);&#125; é¦–å…ˆåœ¨BeeHive.mçš„æ–‡ä»¶ä¸­ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿæ˜¯ä¸ªå•ä¾‹ã€‚ ç´§æ¥ç€åœ¨publicçš„å±æ€§ä¸­ï¼Œè®¾ç½®äº†å…¨å±€äº†BHContextçš„å¯¹è±¡ï¼Œå¹¶ä¸”å°†å®ƒä¿å­˜ä¸‹æ¥ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œå¤å†™äº†Setterçš„æ–¹æ³•,å¹¶ä¸”åœ¨Setteræ–¹æ³•çš„æ—¶å€™,åˆè°ƒç”¨äº†ä¸¤ä¸ªæ–°çš„æ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä¸”ä»…è°ƒç”¨ä¸€æ¬¡ã€‚ 123456789-(void)loadStaticServices&#123; [BHServiceManager sharedManager].enableException = self.enableExpection; [[BHServiceManager sharedManager] setWholeContext:self.context]; [[BHServiceManager sharedManager] registerLocalServices];&#125; åœ¨loadStaticServicesçš„æ–¹æ³•ä¸­ï¼Œåˆåˆ›å»ºäº†ä¸€ä¸ªBHServiceManagerçš„å•ä¾‹å¯¹è±¡ã€‚ åœ¨BHServiceManagerä¸­è®¾è®¡äº†enableExceptionçš„å±æ€§ã€‚ åœ¨BHServiceManagerä¸­è®¾ç½®äº†BHContextçš„å¯¹è±¡ï¼Œå°†BHContextå¯¹è±¡ä¹Ÿèƒ½å¤Ÿåœ¨BHServiceManagerä¸­èƒ½å¤ŸæŒæœ‰è¿™ä¸ªå¯¹è±¡ã€‚ æœ€åè°ƒç”¨åˆ°äº†loadStaticServicesä¸­çš„registerLocalServicesçš„æ–¹æ³•ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 123456789101112131415- (void)registerLocalServices&#123; NSString *serviceConfigName = self.wholeContext.serviceConfigName; NSString *plistPath = [[NSBundle mainBundle] pathForResource:serviceConfigName ofType:@"plist"]; if (!plistPath) &#123; return; &#125; NSArray *serviceList = [[NSArray alloc] initWithContentsOfFile:plistPath]; [self.lock lock]; [self.allServices addObjectsFromArray:serviceList]; [self.lock unlock];&#125; é€šè¿‡ä¼ å…¥çš„contextæ‰¾åˆ°serviceConfigNameçš„å˜é‡ï¼Œæ‹¼æ¥æˆplistæ–‡ä»¶åï¼Œå¦‚æœé¡¹ç›®ä¸­ç¡®å®å­˜åœ¨çš„è¯ï¼Œå°±æ‰“å¼€è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚ è¿™é‡Œé€šè¿‡é”ï¼Œæ¥å°†plistæ–‡ä»¶ä¸­å–åˆ°çš„å˜é‡NSArrayï¼Œå­˜å‚¨åˆ°allServicesç§æœ‰å˜é‡ä¸­å»ã€‚ å¦ä¸€ä¸ªæ–¹æ³•ï¼š12345678- (void)loadStaticModules&#123; [[BHModuleManager sharedManager] setWholeContext:self.context]; [[BHModuleManager sharedManager] loadLocalModules]; [[BHModuleManager sharedManager] registedAllModules];&#125; ä¸Šé¢å·²ç»åˆ†æè¿‡äº†ï¼Œè¿™ä¸ªBHModuleManagerä¹Ÿæ˜¯ä¸€ä¸ªå•ä¾‹ã€‚é¦–å…ˆå°†å…¨å±€çš„contextçš„å˜é‡è®¾ç½®ä¸Šå»ï¼Œå¹¶ä¸”å°†contextä¸­çš„moduleConfigNameçš„å˜é‡èµ‹å€¼ç»™modulesConfigFilenameã€‚ å°†åˆšæ‰çš„å˜é‡modulesConfigFilenameæ‹¼æ¥æˆplistæ–‡ä»¶ï¼Œç„¶åå°†å–å¾—çš„æ•°æ®æ”¾å…¥åˆ°æ•°ç»„ä¸­ã€‚ åœ¨registedAllModulesçš„æ–¹æ³•ä¸­ï¼Œå¬è¿‡æ¯”è¾ƒå­—å…¸ä¸­çš„moduleLevelçš„valueå€¼ï¼Œè¿›è¡Œæ¯”è¾ƒã€æ’åºï¼Œç„¶åé€šè¿‡æšä¸¾ï¼ŒæŒ¨ä¸ªå®ä¾‹åŒ–å¯¹è±¡ä¹‹åï¼Œåœ¨å­˜å…¥BHModulesçš„å¯å˜æ•°ç»„ä¸­ã€‚ 1id&lt;HomeServiceProtocol&gt; homeVc = [[BeeHive shareInstance] createService:@protocol(HomeServiceProtocol)]; 123456789101112131415161718192021222324252627282930313233- (id)createService:(Protocol *)service&#123; id implInstance = nil; if (![self checkValidService:service] &amp;&amp; self.enableException) &#123; @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@"%@ protocol does not been registed", NSStringFromProtocol(service)] userInfo:nil]; &#125; Class implClass = [self serviceImplClass:service]; implInstance = [[implClass alloc] init]; if (![implInstance respondsToSelector:@selector(singleton)]) &#123; return implInstance; &#125; NSString *serviceStr = NSStringFromProtocol(service); if ([implInstance singleton]) &#123; id protocol = [[BHContext shareInstance].servicesByName objectForKey:serviceStr]; if (protocol) &#123; return protocol; &#125; else &#123; [[BHContext shareInstance].servicesByName setObject:implInstance forKey:serviceStr]; &#125; &#125; else &#123; [[BHContext shareInstance].servicesByName setObject:implInstance forKey:serviceStr]; &#125; return implInstance;&#125; ç´§æ¥ç€è°ƒç”¨äº†BeeHiveçš„publicçš„æ–¹æ³•ï¼š- (id)createService:(Protocol *)proto;ä¼ å…¥ä¸€ä¸ªprotocolï¼Œè¿”å›ä¸€ä¸ªidç±»å‹çš„å¯¹è±¡ã€‚ å…¶å®è¿™é‡Œself checkValidService:serviceå€¼æ˜¯åˆ¤æ–­ä¹‹å‰registerLocalServicesè¿™ä¸ªé‡Œé¢æœ‰æ²¡æœ‰éµå¾ªè¿™ä¸ªprotocolçš„ï¼Œå‡å¦‚æ²¡æœ‰ï¼Œå¹¶ä¸”å¼€å¯self.enableExceptionçš„è¯ï¼Œä»–å°±ä¼šæŠ›å‡ºä¸€ä¸ªNSExceptionã€‚ å¦åˆ™å°±ä¼šéµå¾ªè¿™ä¸ªprotocolçš„ç±»ï¼Œå¹¶ä¸”è¿”å›ã€‚ åˆ¤æ–­è¿™ä¸ªç±»æœ‰æ²¡æœ‰éµå¾ªBHServiceProtocolè¿™ä¸ªåè®®çš„singleton,å¹¶ä¸”å®ç°ï¼Œå‡å¦‚æ²¡æœ‰å®ç°çš„è¯ï¼Œå°±ç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œä¸å†å¾€ä¸‹æ‰§è¡Œäº†ã€‚ æ ¹æ®è¿™ä¸ªprotocolåœ¨[BHContext shareInstance].servicesByNameå­—å…¸ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰å¯¹åº”valueå€¼ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±ç›´æ¥æ”¾å›è¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œæ”¾å›å¯¹è±¡çš„åŒæ—¶ï¼Œå°†è¿™ä¸ªprotocolå­˜å‚¨åˆ°è¿™ä¸ª[BHContext shareInstance].servicesByNameå­—å…¸ä¸­ã€‚ æœ€åè®²ä¸ªhomeVCè®¾ç½®ä¸ºAppdelegateçš„RootWindowã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ é˜¿é‡Œå¼€æºé¡¹ç›®BeeHive(-)]]></title>
    <url>%2F2016%2F11%2F25%2F20161125%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ é˜¿é‡Œå¼€æº BeeHive ,æ¯æ¬¡å­¦ä¹ åˆ«äººå†™çš„æ¡†æ¶ï¼Œæˆ–è€…å¥½ä¸œè¥¿éƒ½ä¼šè®©è‡ªå·±å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥æ‰¯ä»£ç ã€‚æºç ä¸­çš„å‡ ä¸ªå°é—®é¢˜ï¼š1. åœ¨Exampleä¸­ï¼Œç¨‹åºçš„å…¥å£æ–‡ä»¶TestAppDelegate,ä½ å°±æƒŠå¥‡åœ°å‘ç°ï¼Œä»–ä¸æ˜¯ç»§æ‰¿äº†UIAppDelegateï¼Œä¹Ÿä¸æ˜¯ç»§æ‰¿äº†UIAppDelegateçš„å­ç±»ï¼Œè€Œæ˜¯è‡ªå·±å†™äº†ä¸€ä¸ª&quot;AppDelegate&quot; 1@interface TestAppDelegate : BHAppDelegate &lt;UIApplicationDelegate&gt; åœ¨ BHAppDelegate.mçš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªç±»å®ç°äº†å¾ˆå¤šappDelegaeçš„å¾ˆå¤šä»£ç†æ–¹æ³• 123456789101112131415161718192021222324- (void)applicationWillResignActive:(UIApplication *)application&#123; [[BHModuleManager sharedManager] tiggerEvent:BHMWillResignActiveEvent];&#125;- (void)applicationDidEnterBackground:(UIApplication *)application&#123; [[BHModuleManager sharedManager] tiggerEvent:BHMDidEnterBackgroundEvent];&#125;- (void)applicationWillEnterForeground:(UIApplication *)application&#123; [[BHModuleManager sharedManager] tiggerEvent:BHMWillEnterForegroundEvent];&#125;- (void)applicationDidBecomeActive:(UIApplication *)application&#123; [[BHModuleManager sharedManager] tiggerEvent:BHMDidBecomeActiveEvent];&#125;- (void)applicationWillTerminate:(UIApplication *)application&#123; [[BHModuleManager sharedManager] tiggerEvent:BHMWillTerminateEvent];&#125; ####å½“ç„¶è¿™é‡Œå…ˆå¿½ç•¥ï¼Œæˆ‘ä»¬ä¸€ç‚¹ç‚¹è¯´ï¼š 1234567891011121314151617181920- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions&#123;#ifdef DEBUG self.timeProdiler = [BHTimeProfiler sharedTimeProfiler];#endif [[BHModuleManager sharedManager] tiggerEvent:BHMSetupEvent]; [[BHModuleManager sharedManager] tiggerEvent:BHMInitEvent]; dispatch_async(dispatch_get_main_queue(), ^&#123; [[BHModuleManager sharedManager] tiggerEvent:BHMSplashEvent]; &#125;);#ifdef DEBUG [self.timeProdiler printOutTimeProfileResult]; [self.timeProdiler saveTimeProfileDataIntoFile:@"BeeHiveTimeProfiler"];#endif return YES;&#125; åœ¨debugçŠ¶æ€ä¸‹ï¼Œè¿™ä¸ªç¨‹åºå¯åŠ¨çš„æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªtimeProdilerçš„å®ä¾‹ï¼Œå¹¶ä¸”åœ¨returnä¹‹å‰æ‰§è¡Œäº†timeProdilerçš„ä¸¤ä¸ªæ–¹æ³•ã€‚è¿›å…¥åˆ° BHTimeProfiler.mçš„æ–‡ä»¶é‡Œé¢å‘ç°ï¼Œè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå•ä¾‹ã€‚åœ¨è¿™ä¸ªç±»çš„initçš„æ–¹æ³•ä¸­å‘ç°12345678910- (instancetype)initTimeProfilerWithMainKey:(NSString *)mainKey&#123; self = [super init]; if (self) &#123; _mainIdentifier = [mainKey copy]; _lastTime = CACurrentMediaTime(); _recordStartTime = CACurrentMediaTime(); &#125; return self;&#125; ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹ç§æœ‰çš„_mainIdentifierçš„å­—ç¬¦ä¸²ç±»å‹è¿›è¡Œäº†èµ‹å€¼ã€‚ åˆ›å»ºäº†ä¸€ä¸ªæ—¶é—´çš„å€¼èµ‹ç»™äº†_lastTimeã€‚ åˆ›å»ºäº†ä¸€ä¸ªæ—¶é—´çš„å€¼èµ‹ç»™äº†_recordStartTimeã€‚è¿™é‡Œçš„æ—¶é—´ç±»å‹å¹¶æ²¡æœ‰ç”¨NSDateå»å®ä¾‹åŒ–ï¼Œè€Œæ˜¯ç”¨äº†CACurrentMediaTimeï¼Œè¿™ä¸ªæ—¶é—´åœ¨è®¾å¤‡ä¸Šæ‰€æœ‰è¿›ç¨‹éƒ½æ˜¯å…¨å±€çš„ï¼Œå¹¶ä¸”åœ¨è®¾å¤‡ä¼‘çœ çš„çŠ¶æ€çš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼ä¼šæš‚åœ 123456789- (void)recordEventTime:(NSString *)eventName&#123;#ifdef DEBUG NSString *keyName = [eventName copy]; [self.identifiers addObject:keyName]; [self.timeDataDic setObject:@(CACurrentMediaTime()) forKey:keyName];#endif&#125; åªæœ‰åœ¨debugçš„çŠ¶æ€ä¸‹è°ƒç”¨è¿™ä¸ªpublicçš„æ–¹æ³•æ‰æœ‰æ„ä¹‰ã€‚è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯ç”¨mutableArrayæ¥å­˜å‚¨keyName,å¹¶ä¸”å°†æ—¶é—´çš„å€¼ä½œä¸ºvalueå­˜å‚¨åœ¨MutableDictionaryä¸­ã€‚è¿™å…¶å®æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ç‚¹å´å¼•èµ·äº†æˆ‘çš„æ³¨æ„ï¼š 12345678#if __has_feature(objc_generics)# define TM__GENERICS(class, ...) class&lt;__VA_ARGS__&gt;#else# define TM__GENERICS(class, ...) class#endif#define TMMutableArrayWith(valueType) TM__GENERICS(NSMutableArray, valueType)#define TMMutableDictionaryWith(keyType, valueType) TM__GENERICS(NSMutableDictionary, keyType, valueType) __has_feature(objc_generics)åˆ¤æ–­æ˜¯å¦æ”¯æŒObj-Cæ³›å‹çš„ç‰¹å¾ã€‚ ...è¡¨ç¤ºï¼Œè¿™ä¸ªè¡¨ç¤ºç¬¦é‡Œé¢å¯ä»¥æ¥å—0ä¸ªï¼Œæˆ–è€…1ä¸ªï¼Œæˆ–è€…å¤šä¸ªå‚æ•°ã€‚ é™¤äº†ç¬¬ä¸€ä¸ªclassçš„å‚æ•°ï¼Œå…¶ä»–çš„å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“åœ¨__VA_ARGS__é‡Œé¢è¿”å›ã€‚ 1234567891011121314- (void)printOutTimeProfileResult&#123;#ifdef DEBUG for (NSString *eventName in self.identifiers) &#123; NSAssert([self.timeDataDic objectForKey:eventName] != nil &amp;&amp; [[self.timeDataDic objectForKey:eventName] isKindOfClass:[NSNumber class]], @"Save Wrong Type TimeStamp"); CFTimeInterval current = [[self.timeDataDic objectForKey:eventName] doubleValue]; printf("[%s] time stamp: %gms and execute for %gms -&gt; \n", [eventName UTF8String], (current - self.recordStartTime) * 1000, (current - self.lastTime) * 1000); self.lastTime = current; &#125;#endif&#125; éå†keyNameçš„æ•°ç»„ï¼Œæ‹¿åˆ°æ¯ä¸ªkeyNameï¼Œå…ˆå»å­—å…¸ä¸­æ‰¾å¯¹åº”çš„æ—¶é—´å€¼ï¼Œå‡å¦‚æ²¡æœ‰çš„è¯ï¼Œå°±åªä¼šæ–­ç‚¹æ–­ä½ã€‚ ç®—å‡ºç°åœ¨çš„æ—¶é—´å€¼ï¼Œä¸lastTime,recordTimeçš„å€¼å¾—å·®å€¼ã€‚ æœ€ååŠ lastTimeçš„å€¼é‡æ–°è®¾ç½®ä¸ºå½“å‰çš„å€¼ã€‚ 1234567891011121314151617181920212223242526272829- (void)saveTimeProfileDataIntoFile:(NSString *)fileName&#123; NSString *documentPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject]; NSString *filePath = [documentPath stringByAppendingPathComponent:[fileName stringByAppendingPathExtension:@"txt"]]; NSLog(@"TMTimeProfiler::SaveFilePath is %@", filePath); BOOL res=[[NSFileManager defaultManager] createFileAtPath:filePath contents:nil attributes:nil]; if (!res) &#123; return; &#125; NSFileHandle *handle = [NSFileHandle fileHandleForWritingAtPath:filePath]; for (NSString *eventName in self.identifiers) &#123; CFTimeInterval current = [[self.timeDataDic objectForKey:eventName] doubleValue]; NSString *output = [NSString stringWithFormat:@"%@ time stamp %g and execute for %g\n", eventName, current, (current - self.lastTime) * 1000]; [handle writeData:[output dataUsingEncoding:NSUTF8StringEncoding]]; self.lastTime = current; &#125; [handle closeFile];&#125; è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶çš„åå­—ï¼Œç„¶åå°†å¯åŠ¨æ—¶é—´ï¼Œrecordæ—¶é—´ï¼Œè®°å½•ä¸‹æ¥ï¼Œè¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚ 123456789101112131415161718- (void)postTimeProfileResultNotification&#123; NSMutableArray *logArray = [NSMutableArray array]; for (NSString *eventName in self.identifiers) &#123; CFTimeInterval current = [[self.timeDataDic objectForKey:eventName] doubleValue]; [logArray addObject: @&#123;@"eventName":eventName,@"costTime": @((current - self.lastTime) * 1000)&#125;]; self.lastTime = current; &#125; [[NSNotificationCenter defaultCenter] postNotificationName:kTimeProfilerResultNotificationName object:nil userInfo:@&#123;kNotificationUserInfoKey:logArray&#125;];&#125; 1.ç”¨NSNotificationCenterï¼Œå°†ä¸Šæ¬¡lastTimeä¸ç°åœ¨æ—¶é—´çš„å·®å€¼ä½œä¸ºNSNotificationCenterä¸­çš„userInfoçš„å‚æ•°ä¼ è¾“å‡ºå»ã€‚è¿™æ ·åªè¦ç›‘å¬è¿™ä¸ªNSNotificationCenterï¼Œä½ æ¯æ¬¡postå°±èƒ½æ¥å—åˆ°è¿™ä¸ªå…¨å±€çš„é€šçŸ¥ã€‚å…‰è¿™ä¸€ä¸ªæ—¶é—´çš„ç»Ÿè®¡åŠŸèƒ½ï¼Œäº§å“ã€æŠ€æœ¯ä¸Šå°±èƒ½åšå¥½å¤šæ–‡ç« ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ›å»ºç§æœ‰çš„Cocoapods]]></title>
    <url>%2F2016%2F10%2F28%2F20161028%2F</url>
    <content type="text"><![CDATA[åˆ›å»ºç§æœ‰Cocoapods,æœ€è¿‘ä¸€ç›´æƒ³å°†è‡ªå·±çš„Appæ¨¡å—åŒ–ï¼Œå°±æƒ³å°±Appæ‹†æˆæ¯ä¸ªæ¨¡å—ç»„ä»¶ï¼Œæ¯”å¦‚ï¼šç™»å½•æ¨¡å—ã€ç½‘ç»œæ¨¡å—ã€æ¶ˆæ¯æ¨¡å—ã€ç”¨æˆ·ä¸­å¿ƒæ¨¡å—â€¦ä½†æ˜¯åŸºäºè¿™äº›æƒ³æ³•ï¼Œæˆ‘é¦–å…ˆè¦å…ˆæå®šç§æœ‰åŒ–Cocoapodsçš„é—®é¢˜ï¼Œè¿™æ ·å›¢é˜Ÿä¸­æ–°äººï¼Œæƒ³è°ƒç”¨çš„æ—¶å€™ï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿï¼Œä¾¿æ·çš„è°ƒç”¨äº†ï¼Œåªéœ€è¦ pod xxx 1.å…ˆåˆ°è‡ªå·±çš„gitè´¦å·ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ ï¼Œæˆ‘ä»¬å–åå­— GH 2.å¼€å§‹ç»ˆç«¯ï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼š 1cd ~/Desktop 3.åˆå§‹åŒ–pod 1pod lib create GH 4.æ¥ç€ç³»ç»Ÿä¼šé—®ä¸€ä¸‹é—®é¢˜ï¼Œä½ å¯ä»¥è‡ªå·±æŒ‰ç…§é¡¹ç›®éœ€æ±‚æ¥å›ç­”ï¼Œä¹Ÿå¯ä»¥å‚ç…§æˆ‘çš„ 123456789101112131415What language do you want to use?? [ Swift / ObjC ] &gt; ObjCWould you like to include a demo application with your library? [ Yes / No ] &gt; YesWhich testing frameworks will you use? [ Specta / Kiwi / None ] &gt; NoneWould you like to do view based testing? [ Yes / No ] &gt; NoWhat is your class prefix? &gt; GG 5.ä¿®æ”¹ä¸€ä¸‹podçš„é…ç½®æ–‡ä»¶,podçš„é…ç½®æ–‡ä»¶åº”è¯¥éƒ½æ˜¯ä¸€æ ·çš„åç¼€åï¼Œæˆ‘è¿™é‡Œå« Gh.podspec steps1.è¿™é‡Œæˆ‘å…ˆè®²descriptionçš„æè¿°å†…å®¹æ³¨é‡Šæ‰123#s.description = &lt;&lt;-DESC#TODO: Add long description of the pod here.# DESC 2.ä¿®æ”¹homepageçš„è·¯å¾„ï¼Œåœ¨ç¬¬24è¡Œ1s.homepage = 'https://github.com/Ghstart/Gh' 3.ä¿®æ”¹gitçš„è·¯å¾„ï¼Œåœ¨ç¬¬28è¡Œ1s.source = &#123; :git =&gt; 'https://github.com/Ghstart/Gh.gi t', :tag =&gt; s.version.to_s &#125; 5.ä¿å­˜å¥½é€€å‡ºï¼Œå†æ¬¡è¿›å…¥åˆ°é‚£ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå°†æ–‡ä»¶å†…å®¹æäº¤åˆ°githubä¸Š,æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯å‘½ä»¤çš„æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨githubå®¢æˆ·ç«¯ 1234567cd Ghgit initgit remote add origin https://github.com/Ghstart/GH.git // è¿™ä¸ªè·¯å¾„åœ¨ä½ åˆšæ‰æ–°å»ºä»“åº“çš„é‚£ä¸ªé¡µé¢å°±èƒ½æ‰¾åˆ°git add .git commit -m 'Gh first creats private own cocoapods'git tag 0.1.0 // è¿™é‡Œçš„0.1.0åœ¨åˆšæ‰çš„é…ç½®æ–‡ä»¶é‡Œæœ‰ï¼Œå¯¹åº”èµ·æ¥å°±å¥½äº†git push -u origin master --tags æœ€åå†å»ä½ åˆšæ‰æ–°å»ºä»“åº“çš„é¡µé¢åˆ·æ–°ä¸€ä¸‹ï¼Œå°±ä¼šå‘ç°å¥‡è¿¹ã€‚ã€‚ ç°åœ¨å¼€å§‹æ·»åŠ è‡ªå·±çš„ç±» æ‰¾åˆ°å­˜æ”¾ç±»çš„ç›®å½•ä¸‹ï¼Œ/Users/è‡ªå·±çš„macåå­—/Desktop/Gh/Gh/Classesï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ï¼Œä½ ä¼šå‘ç°ä¸€ä¸ªåå­—å«åšReplaceMe.mï¼Œè¿™ä¸ªçœŸæ˜¯å¤ªè´´å¿ƒäº†ï¼Œcocoapodséƒ½å·²ç»ä¸ºæˆ‘ä»¬æƒ³åˆ°äº†ï¼Œåœ¨è¿™é‡Œä½ å…ˆåˆ é™¤è¿™ä¸ªç±»ï¼Œç„¶åæ·»åŠ è‡ªå·±æƒ³è¦çš„ç±»ï¼Œç„¶ååœ¨èµ°ä¸€ä¸‹ä¸‹é¢çš„å‘½ä»¤ã€‚ æˆ‘è§‰å¾—è¿™é‡Œï¼Œä½ æ—¢ç„¶å·²ç»ä¿®æ”¹äº†å†…å®¹ï¼Œæˆ–è€…æƒ³å‘å¸ƒç¬¬ä¸€ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä¿®æ”¹é…ç½®æ–‡ä»¶çš„tagsä¿®æ”¹ä¸º0.1.1 1234git add .git commit -m"add files"git tag 0.1.1git push -u origin master --tags ç°åœ¨åˆ°è‡ªå·±çš„githubé¡µé¢ç†Ÿæ‚‰ä¸€ä¸‹ï¼Œå°±ä¼šå‘ç°è‡ªå·±åˆ›å»ºçš„0.1.1çš„ç‰ˆæœ¬ï¼Œä»¥åŠæ–°æ·»åŠ çš„æ–‡ä»¶ã€‚ä¸‹é¢æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„è¿™ä¸ªcocoapodsæäº¤ç»™cocoapodså®¡æ ¸ï¼Œå¹¶ä¸”å‘å¸ƒã€‚ 12pod lib lint Gh.podspec // è®¤è¯é€šè¿‡pod trunk push // æäº¤ 123456åœ¨æœ€å pod trunk push æ—¶å€™å¦‚æœæŠ¥é”™ å¦‚ï¼š[!] Authentication token is invalid or unverified. Either verify it with the email that was sent or register a new session.è¿™è¯´æ˜ä½ ä¹‹å‰çš„è®¤è¯tokenå·²ç»å¤±æ•ˆäº†ï¼Œé‡æ–°æ³¨å†Œä¸€ä¸‹å°±å¥½äº†ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š pod trunk register gonghuan2020@gmail.com 'gonghuan'ç„¶ååœ¨é‡æ–° pod trunk push å°±å¯ä»¥äº†ã€‚ 123456å¦‚æœå¼¹ [!] The spec did not pass validation, due to 1 warning (but you can use `--allow-warnings` to ignore it).pod trunk push --allow-warningså¦‚æœå¼¹ You can use the `--no-clean` option to inspect any issue.pod lib lint GateWayObject.podspec --allow-warnings --no-clean å¤§åŠŸå‘Šæˆï¼ï¼è¿™é‡Œcocoapodsæ˜¯ä¸€ä¸ªå¾ˆå…³é”®çš„é—®é¢˜ï¼Œå°¤å…¶ä½ åˆšè·Ÿæ–°podæˆ–è€…xcodeï¼Œé‚£é—®é¢˜ä¼šå¾ˆå¤šï¼Œå»ºè®®å‡ºç°ä¸€äº›å¥‡è‘©çš„é—®é¢˜ï¼Œå¯ä»¥å…ˆå¸è½½cocoapodsï¼Œç„¶åå†è£…æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
        <tag>Cocoapods</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React-Native å®æˆ˜(-)]]></title>
    <url>%2F2016%2F10%2F21%2F20161021%2F</url>
    <content type="text"><![CDATA[å®æˆ˜(-) React-Native é‡å†™çº¢ç‹®ç‰©æµAppçš„é¡¹ç›®ã€‚ä¸‹é¢çš„çš„å‡ æ¬¡åšå®¢æˆ‘ä¼šä»¥å®Œæˆä¸€ä¸ªç°æœ‰çš„é¡¹ç›®ï¼Œå°†å®ƒæ•´ä½“éƒ½ç”¨Reacté‡å†™ã€‚é¡¹ç›®æˆ‘å·²ç»ä¸Šä¼ åˆ°github[https://github.com/Ghstart/HongshiWuliuRN]é¦–å…ˆæ‰¾åˆ°index.ios.jsæ–‡ä»¶ï¼Œç”±äºæˆ‘ä»¬çš„appçš„æ¶æ„å°±æ˜¯ä¸»æµçš„tabçš„è¿™ç§ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œç”¨åˆ°äº†TabBarIOSçš„ä¸»ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148import React, &#123; Component &#125; from 'react';import &#123; AppRegistry, StyleSheet, Text, View, TabBarIOS&#125; from 'react-native';import Task from './ios_views/task';import Goods from './ios_views/goods'import Home from './ios_views/home'import Message from './ios_views/message'import Setting from './ios_views/setting'class HongshiWuLiuRN extends Component &#123; constructor() &#123; super(); this.state = &#123; selected: 'home' &#125; &#125; _renderView(moduleName) &#123; switch (moduleName) &#123; case 'task': return ( &lt;Task/&gt; ); break; case 'goods': return ( &lt;Goods/&gt; ); break; case 'home': return ( &lt;Home/&gt; ); break; case 'message': return ( &lt;Message/&gt; ); break; case 'setting': return ( &lt;Setting/&gt; ); break; default: return ( &lt;View&gt;&lt;/View&gt; ); break; &#125; &#125; render() &#123; return( &lt;TabBarIOS tintColor = '#e23f42' &gt; &lt;TabBarIOS.Item title = "ä»»åŠ¡" selected = &#123; this.state.selected === 'task' &#125; icon = &#123;require('./images/mission@2x.png')&#125; selectedIcon=&#123;require('./images/mission-1@2x.png')&#125; onPress = &#123;() =&gt; &#123; this.setState(&#123; selected: 'task' &#125;) &#125;&#125;&gt; &#123;this._renderView(this.state.selected)&#125; &lt;/TabBarIOS.Item&gt; &lt;TabBarIOS.Item title = "è´§æº" selected = &#123; this.state.selected === 'goods' &#125; icon = &#123;require('./images/goods@2x.png')&#125; selectedIcon=&#123;require('./images/goods-1@2x.png')&#125; onPress = &#123;() =&gt; &#123; this.setState(&#123; selected: 'goods' &#125;) &#125;&#125;&gt; &#123;this._renderView(this.state.selected)&#125; &lt;/TabBarIOS.Item&gt; &lt;TabBarIOS.Item title = "é¦–é¡µ" selected = &#123; this.state.selected === 'home' &#125; icon = &#123;require('./images/home@2x.png')&#125; selectedIcon=&#123;require('./images/home-1@2x.png')&#125; onPress = &#123;() =&gt; &#123; this.setState(&#123; selected: 'home' &#125;) &#125;&#125;&gt; &#123;this._renderView(this.state.selected)&#125; &lt;/TabBarIOS.Item&gt; &lt;TabBarIOS.Item title = "æ¶ˆæ¯" selected = &#123; this.state.selected === 'message' &#125; icon = &#123;require('./images/news@2x.png')&#125; selectedIcon=&#123;require('./images/news-1@2x.png')&#125; onPress = &#123;() =&gt; &#123; this.setState(&#123; selected: 'message' &#125;) &#125;&#125;&gt; &#123;this._renderView(this.state.selected)&#125; &lt;/TabBarIOS.Item&gt; &lt;TabBarIOS.Item title = "è®¾ç½®" selected = &#123; this.state.selected === 'setting' &#125; icon = &#123;require('./images/user@2x.png')&#125; selectedIcon=&#123;require('./images/user-1@2x.png')&#125; onPress = &#123;() =&gt; &#123; this.setState(&#123; selected: 'setting' &#125;) &#125;&#125;&gt; &#123;this._renderView(this.state.selected)&#125; &lt;/TabBarIOS.Item&gt; &lt;/TabBarIOS&gt; ); &#125;&#125;const styles = StyleSheet.create(&#123;&#125;);AppRegistry.registerComponent('HongshiWuLiuRN', () =&gt; HongshiWuLiuRN); é¦–å…ˆä½ å…ˆä¸è¦è¿è¡Œï¼Œæˆ‘å…ˆè§£é‡Šä¸€ä¸‹å‡ ç‚¹æ¯”è¾ƒé‡è¦çš„é—®é¢˜ï¼š å¼•å…¥ç³»ç»Ÿä¸»ä»¶(å…³äºç³»ç»Ÿä¸»ä»¶ï¼Œä½ å¯ä»¥ç›´æ¥copyå°±å¥½ï¼Œè¿™é‡Œæˆ‘çš„æ„è§å°±æ˜¯å®˜æ–¹å»ºè®®é‚£ç§å†™æ³•ï¼Œä½ å°±ä»¥è¿™ç§å†™æ³•ä¸ºä¸»)ã€ç¬¬ä¸‰æ–¹ä¸»ä»¶ã€ä»¥åŠè‡ªå·±å®šä¹‰çš„ä¸»ä»¶(è¿™é‡Œä¸€å®šè¦ç†æ¸…æ¥šè‡ªå·±å†™çš„ä¸»ä»¶çš„è·¯å¾„)ã€‚ 12345678910111213141516// å¼•å…¥ç³»ç»Ÿä¸»ä»¶import React, &#123; Component &#125; from 'react';import &#123; AppRegistry, StyleSheet, Text, View, TabBarIOS&#125; from 'react-native';// å¼•å…¥è‡ªå®šä¹‰çš„ä¸»ä»¶import Task from './ios_views/task';import Goods from './ios_views/goods'import Home from './ios_views/home'import Message from './ios_views/message'import Setting from './ios_views/setting' å¦‚ä½•å®šä¹‰ä¸»ä»¶,è¿™é‡Œæˆ‘ç›®å‰å†™äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œä¹Ÿæ˜¯æœ€å¸¸ä½¿ç”¨çš„ä¸¤ä¸ªæ–¹æ³•ï¼šå…¶ä¸­constructoræ˜¯è¿™ä¸ªä¸»ä»¶çš„å®ä¾‹åŒ–æ–¹æ³•ï¼Œè€ŒçœŸæ­£è®©è§†å›¾æ¸²æŸ“åˆ°å±å¹•ä¸Šçš„æ˜¯renderçš„æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æƒ³æ¸²æŸ“ä¸Šå»çš„è§†å›¾å†…å®¹ã€‚ 123456789class HongshiWuLiuRN extends Component &#123; constructor() &#123; super(); &#125; render() &#123; &#125;&#125; å¦‚ä½•å®šä¹‰ä¸»ä»¶è§†å›¾çš„æ ·å¼ï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°stylesheet æ‰€åˆ›åˆ›å»ºçš„å¯¹è±¡ï¼Œåœ¨è¿™é‡Œä½ å°±å¯ä»¥åƒå†™CSSæ ·å¼ä¸€æ ·ï¼Œæ¥å®šä¹‰è§†å›¾äº†ã€‚ 123const styles = StyleSheet.create(&#123;&#125;); å¦‚ä½•å®šä¹‰åº”ç”¨çš„å…¥å£æ–‡ä»¶ï¼Œå°±æƒ³Cå‡½æ•°ä¸€æ ·ï¼Œéœ€è¦ä¸€ä¸ªmainå‡½æ•°ä½œä¸ºå…¥å£æ–‡ä»¶ï¼Œåœ¨RNä¸­ï¼Œæˆ‘éœ€è¦ä½¿ç”¨AppRegistryæ¥æ³¨å†Œè¿™ä¸ªä¸»ä»¶ï¼ŒåŒæ—¶ä¹Ÿä½œä¸ºå…¥å£æ–‡ä»¶ã€‚ 1AppRegistry.registerComponent('HongshiWuLiuRN', () =&gt; HongshiWuLiuRN); å¦‚ä½•æ·»åŠ å›¾ç‰‡ï¼Œä½ å¯ä»¥å‘ç°è¿™æ®µä»£ç  å¯¼å…¥å›¾ç‰‡å’Œè‡ªå®šä¹‰çš„ä¸»ä»¶æ˜¯ä¸€æ ·ï¼Œéœ€è¦å†™æ¸…æ¥šå›¾ç‰‡æ‰€åœ¨çš„è·¯å¾„ï¼Œè¿™é‡Œä¸ºäº†è°ƒè¯•ï¼Œä½ å¯ä»¥å…ˆæ³¨é‡Šåˆ°ï¼š 12icon = &#123;require('./images/news@2x.png')&#125;selectedIcon=&#123;require('./images/news-1@2x.png')&#125; æ•´ä¸ªTabBarçš„åŠŸèƒ½ï¼Œæ˜¯ç”±TabBarIOSæ¥å®ç°çš„ï¼Œå…·ä½“åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®tintColor = â€˜#e23f42â€™å¯ä»¥è®¾ç½®TabBarç‚¹é€‰é€‚åˆçš„é¢œè‰²ï¼Œè€Œå…·ä½“çš„å›¾ç‰‡çš„æ ·å¼ï¼Œæ–‡å­—ï¼Œä»¥åŠç‚¹å‡»çš„æ–¹æ³•å°±éœ€è¦åœ¨TabBarIOS.Itemæ¥è¿›è¡Œè®¾ç½®,é‡ç‚¹è¯´ä¸€ä¸‹è¿™ä¸ªè¿™æ®µä»£ç ï¼šè¿™é‡Œå®šä¹‰ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œä¼ å…¥äº†ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ï¼Œåœ¨æ‹¿åˆ°çš„å‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ç”¨swichçš„çš„æ–¹æ³•ï¼Œæ ¹æ®ä¼ å…¥ä¸åŒçš„å‚æ•°ï¼Œè¿”å›ä¸åŒçš„è‡ªå®šä¹‰çš„ä¸»ä»¶ 12345678910111213141516171819202122232425262728293031323334&#123;this._renderView(this.state.selected)&#125; _renderView(moduleName) &#123; switch (moduleName) &#123; case 'task': return ( &lt;Task/&gt; ); break; case 'goods': return ( &lt;Goods/&gt; ); break; case 'home': return ( &lt;Home/&gt; ); break; case 'message': return ( &lt;Message/&gt; ); break; case 'setting': return ( &lt;Setting/&gt; ); break; default: return ( &lt;View&gt;&lt;/View&gt; ); break; &#125; &#125; è¿™é‡Œæ ¹æ®è‡ªå®šä¹‰ä¸»ä»¶çš„è·¯å¾„ï¼Œå¯ä»¥çŒœåˆ°ï¼Œæˆ‘åœ¨åŒçº§ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªios_viewsçš„æ–‡ä»¶å¤¹ï¼Œåœ¨ios_viewsçš„æ–‡ä»¶ä¸‹æˆ‘æœ‰åˆ›å»ºäº†å››ä¸ªjsæ–‡ä»¶ï¼š goods.jsã€home.jsã€message.jsã€setting.jsã€task.js,ä»£ç å¦‚ä¸‹,è¿™ä¸ªäº”ä¸ªæ–‡ä»¶ï¼Œä½ ç›®å‰å¯ä»¥ä¸€æ ·çš„ä»£ç ï¼Œåªéœ€è¦ä¿®æ”¹ç›¸åº”çš„åå­—ï¼Œå°±å¯ä»¥äº†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738import React, &#123; Component &#125; from 'react';import &#123; StyleSheet, View, NavigatorIOS&#125; from 'react-native';class home_views extends Component &#123; render() &#123; return ( &lt;View&gt; &lt;/View&gt; ); &#125;&#125;class home extends Component &#123; render() &#123; return( &lt;NavigatorIOS initialRoute=&#123;&#123; component: home_views, title: "çº¢ç‹®ç‰©æµ", titleTextColor: '#fff', barTintColor: '#e23f42', &#125;&#125; /&gt; ); &#125;&#125;const styles = StyleSheet.create(&#123;&#125;);module.exports = home è¿™é‡Œç”¨åˆ°äº†NavigatorIOSçš„ä¸»ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯å¼ºå¤§çš„è·¯ç”±ä¸»ä»¶ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨é‡Œé¢å¿…é¡»è¦å®šä¹‰åˆå§‹è·¯ç”±å¯¹åº”äºå“ªä¸ªä¸»ä»¶ï¼Œä»¥åŠnavçš„èƒŒæ™¯è‰²ï¼Œtitleï¼Œå­—ä½“é¢œè‰²ç­‰ç­‰ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
        <tag>React Native</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ React Nativeä¸­]]></title>
    <url>%2F2016%2F08%2F24%2F20160824%2F</url>
    <content type="text"><![CDATA[å…¶å®ä»å»å¹´æˆ‘å°±ä¸€ç›´çœ‹å­¦ä¹ å¹¶çœ‹React Native,å¼€å§‹å­¦ä¹ åªæ˜¯ä¸ºäº†å…´è¶£ï¼Œç°åœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†æœ‰äº›æ›´æ–°çš„åŠŸèƒ½ï¼Œæˆ‘å°±æ˜¯ç”¨React native æ¥åšçš„ã€‚å…¶å®è¿˜æ˜¯è›®å¥½çš„ï¼Œä½†æ˜¯æˆ‘å‘ç°æ›´æ–°å®åœ¨æ˜¯å¤ªå¿«äº†ï¼Œç°åœ¨å®˜ç½‘çš„ç¨³å®šç‰ˆæœ¬æ˜¯0.31ç‰ˆæœ¬ ä½¿ç”¨ æ‰“å¼€terminal, cdåˆ°æŸä¸ªè·¯å¾„ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ react-native init helloworld[^è¿™é‡Œçš„hellowordå°±æ˜¯ä½ åˆ›å»ºçš„é¡¹ç›®åå­—]å¦‚æœå‡ºç°è¿™æ ·çš„ä»£ç å°±ä»£ç åˆ›å»ºæˆåŠŸã€‚ 12345678910To run your app on iOS: cd /Users/gonghuan/Desktop/helloworld react-native run-ios - or - Open /Users/gonghuan/Desktop/helloworld/ios/helloworld.xcodeproj in Xcode Hit the Run buttonTo run your app on Android: Have an Android emulator running (quickest way to get started), or a device connected cd /Users/gonghuan/Desktop/helloworld react-native run-android æ­¤æ—¶ä½ å¯ä»¥é€šè¿‡ç±»ä¼¼react-native run-ioså¯ä»¥ç›´æ¥è°ƒèµ·iOSæ¨¡æ‹Ÿå™¨ï¼Œæ­¤æ—¶ä½ å¯ä»¥çœ‹åˆ°ä½ çš„ç»ˆç«¯ä¸æ–­åœ¨è§£æï¼Œç„¶åå°±å¯ä»¥æˆåŠŸè¿è¡Œäº†ã€‚è¯´åˆ°è¿™é‡Œï¼Œåº”è¯¥ä½ å·²ç»å¯ä»¥è¿è¡Œä½ çš„appäº†ï¼Œè‡³äºä¹‹å‰è¦å®‰è£… brew nodeç­‰ç­‰ï¼Œæˆ‘è¿™é‡Œå°±ä¸å†å¤šè¯´äº†ï¼Œä½ å¯ä»¥å»å®˜ç½‘ä¸Šèµ°ä¸€éï¼Œå¾ˆç®€å•ã€‚ å·¥å…· æˆ‘è¿™é‡Œæˆ‘é€‰ç”¨çš„æ˜¯atomï¼Œè¿™é‡Œè¯´ä¸€ä¸ªæˆ‘é‡åˆ°çš„å°é—®é¢˜ï¼Œä¹Ÿè®¸ä½ ä¹Ÿä¼šé‡åˆ°ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨atomçš„æ—¶å€™ï¼Œéœ€è¦å®‰è£…ä¸€äº›æ’ä»¶æ¥å¸®åŠ©æˆ‘ä»¬èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆçš„å†™ä»£ç ï¼Œå°±æ¯”å¦‚facebookå¼€å‘çš„Nuclide æŒ‰ç…§å®˜æ–¹installçš„è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æœ‰ä¸¤ç§å®‰è£…çš„æ–¹å¼ï¼Œä¸€ç§å°±æ˜¯é€šè¿‡ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥apm install nuclide,ä½†æ˜¯è¯´å®è¯ï¼Œæˆ‘å°±æˆåŠŸè¿‡ä¸€æ¬¡ï¼Œè€Œä¸”è¿˜æ˜¯è¦æŒ‚vpnï¼Œä¹‹åå°±ä¸€ç›´æ²¡æœ‰æˆåŠŸè¿‡äº†ï¼Œè¿™æˆ‘å°±å‘µå‘µäº†ã€‚ å®˜æ–¹å»ºè®®ç¬¬äºŒç§æ–¹å¼ï¼šç›´æ¥åœ¨atom-&gt;Setting Views-&gt;Manage Packages,æœç´¢Nuclideï¼Œç›´æ¥å®‰è£…ã€‚ ç¬¬ä¸‰ç§ï¼šé€šè¿‡è¿™ç§æ–¹å¼ä½ å¯ä»¥å®‰è£…Themesã€packages 1234 cd ~/.atom/packagesgit clone [packgae-url] # git clone https://github.com/facebook/nuclidecd [package] #nuclidenpm install ###å¥½äº†ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»å¯ä»¥ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å¼€å§‹è¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥å®‰è£…è‡ªå·±å–œæ¬¢çš„æ’ä»¶ï¼Œå·²ç»ä¿®æ”¹è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜äº†ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹coding,æˆ‘ä»¬å…ˆé€šè¿‡atomæ‰“å¼€æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„helloworldçš„é¡¹ç›®ï¼Œå¹¶ä¸”æ‰¾åˆ°index.ios.js,åˆ é™¤é‡Œé¢æ‰€æœ‰çš„ä»£ç ï¼Œä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬ä¼šæ…¢æ…¢çš„æ·»åŠ è¿›å»æ‰€æœ‰çš„ä»£ç ã€‚ 1234567891011class firstRN extends Component &#123; render() &#123; return( &lt;Text&gt; Hello world &lt;/Text&gt; ); &#125;&#125;AppRegistry.registerComponent('helloworld', ()=&gt;firstRN); è¿™é‡Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªfirstRNçš„ç±»ï¼Œç»§æ‰¿è‡ªComponentå¯¹è±¡ï¼Œè¿™é‡Œä½ å…ˆä¸è¦ç®¡ï¼Œæˆ‘ä»¬åé¢éƒ½ä¼šè§£é‡Šçš„ã€‚ ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬ç”¨AppRegistryè¿™ä¸ªæ³¨å†Œä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„åå­—æ˜¯æˆ‘ä»¬åº”ç”¨çš„åå­—â€˜helloworldâ€™ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å‘çš„æ˜¯æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„firstRNç±»ã€‚ æˆ‘ä»¬ç‚¹å‡»æ¨¡æ‹Ÿå™¨ï¼Œå‘ç°æŠ¥é”™ï¼ŒUnhandled JS Exception:xxxx: Can&#39;t find variable: Component,åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ  12import React, &#123; Component &#125; from 'react';import &#123; AppRegistry, Text &#125; from 'react-native'; The AppRegistry just tells React Native which component is the root one for the whole application. You wonâ€™t be thinking about AppRegistry a lot - there will probably just be one call to AppRegistry.registerComponent in your whole app. Itâ€™s included in these examples so you can paste the whole thing into your index.ios.js or index.android.js file and get it running.â€”-è¿™é‡Œæ˜¯å®˜æ–¹ç»™çš„AppRegistryï¼Œå…¶å®AppRegistryåªåšäº†ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å‘Šè¯‰è¿™ä¸ªåº”ç”¨ï¼Œè°æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹æ§åˆ¶å™¨ï¼Œè¿™æ ·ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹index.ios.jsæ¥ä¿®æ”¹iOSçš„æ ¹æ§åˆ¶å™¨æ˜¯å•¥ï¼Ÿå®‰å“ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¿®æ”¹çš„index.android.jså†æ¬¡åˆ·æ–°æ¨¡æ‹Ÿå™¨ï¼Œå°±ä¼šå‘ç°å·¦ä¸Šè§’ä¼šå‡ºç°æˆ‘ä»¬å†™çš„Hello worldçš„æ–‡å­—ã€‚è¿™é‡Œæˆ‘ä»¬è§‰å¾—æ ·å¼å¥½ä¸‘ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Œæ²¡äº‹ï¼ŒRNä¹Ÿæ˜¯å¯ä»¥åšåˆ°ä¿®æ”¹çš„ã€‚ 1234567891011121314151617181920212223import React, &#123; Component &#125; from 'react';import &#123; AppRegistry, Text , StyleSheet &#125; from 'react-native';class firstRN extends Component &#123; render() &#123; return( &lt;Text style = &#123;styles.helloWorldStyle&#125;&gt; Hello world &lt;/Text&gt; ); &#125;&#125;const styles = StyleSheet.create(&#123; helloWorldStyle: &#123; color:'red', fontSize:30, fontWeight:'bold' &#125;&#125;)AppRegistry.registerComponent('helloworld', ()=&gt;firstRN); è¿™é‡Œæˆ‘ä»¬éœ€è¦åœ¨importä¸­å¯¼è¯» StyleSheet,å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨åé¢çš„è®¾ç½®æ ·å¼çš„æ—¶å€™ï¼Œç”¨åˆ°è¿™ä¸ªç±»ã€‚ç›´æ¥åœ¨textåé¢æ·»åŠ styleçš„æ ·å¼ç†Ÿæ‚‰ç›´æ¥åœ¨åé¢åˆ›å»ºstylesçš„å±æ€§ï¼Œé€šè¿‡StyleSheetæ¥åˆ›å»ºã€‚å†æ¬¡åˆ·æ–°æ¨¡æ‹Ÿå™¨ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ã€‚ å…ˆè¯´è¿™ä¹ˆå¤šï¼ŒåæœŸæˆ‘ä»¬è¿˜ä¼šè¯´åˆ°å¾ˆå¤šåœ¨appå¼€å‘ä¸­é‡åˆ°çš„å„ç§é—®é¢˜ï¼Œå¯¼èˆªæ ï¼Œç½‘ç»œè¯·æ±‚ï¼Œä¼ å€¼ç­‰ç­‰ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
        <tag>React Native</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å› ä¸ºæˆ‘ä¸æƒ³æ‰“å¡ï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿ]]></title>
    <url>%2F2016%2F08%2F15%2F20160815%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘ä¸€ç›´æ²¡å•¥æ—¶é—´æ¥æ•´ç†ä¸€äº›å­¦ä¹ èµ„æ–™ä»¥åŠå­¦ä¹ çš„å†…å®¹ï¼Œæ„Ÿè§‰è¿™æ ·ä¸æ˜¯å¾ˆå¥½ã€‚åˆç”±äºå…¬å¸è¦æ‰“å¡äº†ï¼Œæ‰€ä»¥æˆ‘å°±å†™å†™æˆ‘æ˜¯æ€ä¹ˆä¸æ‰“å¡çš„å§ï¼O(âˆ©_âˆ©)O~~~ macç”µè„‘å…ˆå®‰è£…æŠ“åŒ…ç¥å™¨ï¼šCharles (ç½‘ä¸Šæœ‰å¾ˆå¤šè¿™ä¸ªä½¿ç”¨æ•™ç¨‹ï¼Œæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œæ¯•ç«Ÿæ˜¯å·¥å…·ï¼Œæ²¡å•¥éš¾åº¦) ç‚¹å‡»Help-&gt;Local IP Address,å°†æœ¬æœºçš„IPæ‰“å°å‡ºæ¥ï¼Œç„¶ååœ¨æ‰‹æœºé‡Œé¢è®¾ç½®ä»£ç†ä¸ºç›¸åº”çš„IPï¼Œç«¯å£ä¸ºï¼š8888 æ­¤æ—¶ä½ å°±å¯ä»¥å¼€å§‹çœ‹åˆ°æ•°æ®çš„è¿”å›ã€å’Œè¯·æ±‚äº†ã€‚ ![1.pi](media/14712518179704/1.pic.jpg) ç„¶åä½ å°±å¯ä»¥çœ‹åˆ°ä½ æƒ³è¦çš„ä»£ç è¯·æ±‚äº†ï¼Œå…¶å®è¿™ä¸ªAndroidå’ŒiOS,è¿˜æœ‰ç‚¹ä¸åŒï¼ŒAndroidè¿”å›çš„ä»£ç ä¸æ˜¯text/json,è€Œæ˜¯text/html,æˆ‘åœ¨æˆ‘ä»£ç ä¸­åŠ å…¥äº†ä»£ç æ ¼å¼çš„è½¬æ¢ã€‚ 1234567891011__block NSDictionary *par = @&#123;@&quot;employeeNo&quot;:pp.employeeNo,@&quot;coord&quot;:@&quot;30.249812,120.211494&quot;,@&quot;img_ids&quot;:@&quot;&quot;,@&quot;identifier&quot;: pp.identifier,@&quot;type&quot;: @&quot;0&quot;&#125;&#125;; AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager]; [manager POST:@&quot;http://xxxx/HSSCM/appmail/employeeRecordManage/sign.do&quot; parameters:par success:^(AFHTTPRequestOperation * _Nonnull operation, id _Nonnull responseObject) &#123; NSLog(@&quot;%@&quot;,operation); NSLog(@&quot;%@&quot;,responseObject); &#125; failure:^(AFHTTPRequestOperation * _Nullable operation, NSError * _Nonnull error) &#123; NSLog(@&quot;%@&quot;,operation); NSLog(@&quot;%@&quot;,error); &#125;]; ä½ æˆ–è®¸å·²ç»å‘ç°äº†å‚æ•°çš„è§„å¾‹äº†ï¼Œè¿™é‡Œçš„employeeNOå°±æ˜¯æˆ‘ä»¬ä¹‹å‰æŠ“åŒ…çš„ç”¨æˆ·å”¯ä¸€æ ‡ç¤ºç¬¦ï¼ˆå®‰å“è¿™è¾¹è¿˜è€äº†ä¸ªå¿ƒçœ¼ï¼Œå–äº†ä¸€ä¸ªå¾ˆæ€ªçš„åå­—ï¼Œè§†å›¾è¯¯å¯¼æˆ‘ä»¬ï¼‰ coordå°±æ˜¯ç»çº¬åº¦ï¼Œç”¨é€—å·é“¾æ¥èµ·æ¥çš„ä¸€ä¸ªå­—ç¬¦ä¸² img_idsæˆ‘ä¸çŸ¥é“æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œåæ­£å¯æœ‰å¯æ—  identifioræ˜¯æ‰‹æœºçš„udidï¼ˆiOSä¸­è¿™æ ·ç§°å‘¼å§ï¼‰,è¿™é‡Œæˆ‘çŒœæƒ³ä»–çš„employeeNOä¸æ‰‹æœºidentifioræ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ‰€ä»¥è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘åœ¨æ¢æ‰‹æœºçš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ type:0â€“å°±æ˜¯ç­¾å‡ºï¼Œ1â€“å°±æ˜¯ç­¾åˆ° ##ç°åœ¨é—®é¢˜éƒ½å·²ç»åˆ†æå®Œäº†ï¼Œæˆ‘ä»¬è¯¥ç”¨ä»€ä¹ˆå¯¹ç­–æ¥è‡ªåŠ¨å¸®æˆ‘ä»¬æ‰“å¡å‘¢ã€‚ ####ç”±äºå¿…é¡»éœ€è¦å†…ç½‘æ‰èƒ½æ‰“å¡ï¼Œæˆ‘ä»¬ä¸èƒ½å¤–ç½‘æˆ–è€…4Gçš„æ¡ä»¶ä¸‹æ‰“å¡ï¼ŒæŠ˜è®©æˆ‘ä»¬å¾ˆè›‹ç–¼ï¼Œè¿™é‡Œæˆ‘æƒ³åˆ°å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼š å®‰å“çš„æ‰‹æœºï¼Œå¯ä»¥å€Ÿç”¨ä¸€æ¬¾å«åš&lt;æŒ‰é”®ç²¾çµ&gt;çš„app,ä½†æ˜¯æœ‰ä¸ªæ¡ä»¶å°±æ˜¯ä½ å¿…é¡»æ‹¿åˆ°rootæƒé™ï¼Œè¿™æ ·å°±å¯ä»¥å½•åˆ¶ä½ æŒ‰é”®çš„åŠ¨ä½œï¼Œä½ å¯ä»¥æŒ‡å®šæ—¶é—´æ‰§è¡Œã€‚ å…¬å¸çš„ç”µè„‘ã€æˆ–è€…æµ‹è¯•æœºï¼Œå®‰è£…ä¸€ä¸ªteamViewerï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨å®¶é‡Œè¿œç¨‹æ“æ§ä»–ã€‚ å…¬å¸çš„æµ‹è¯•æœºå……å½“æœåŠ¡å™¨çš„åŠŸèƒ½ã€ä¸€ç›´åœ¨è·‘ï¼Œè¿™æ ·æˆ‘éœ€è¦å…³å¿ƒçš„åªæœ‰ä¸€ä»¶äº‹ï¼šæ‰‹æœºæœ‰ç”µã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657 - (NSArray *)setUPDatas:(TypeStatus)typeStatus &#123; NSMutableArray *datas = [NSMutableArray new]; NSArray *employeeNos = @[@"31330034", @"31330040", @"31330035"]; NSArray *identifiers = @[@"05B7A575-2D2A-4006-890A-D0994EFF3DAC", @"a000004f73cb94", @"1B65EB63-487B-49BF-B751-F2D544175BE7"]; for (int i = 0 ; i &lt; employeeNos.count ; i++) &#123; People *people = [[People alloc] init]; people.employeeNo = employeeNos[i]; people.coord = @"30.249812,120.211494"; people.img_ids = @""; people.identifier = identifiers[i]; if (typeStatus == LogIn) &#123; people.type = @"1"; &#125; else &#123; people.type = @"0"; &#125; people.random_signInMin = [self getRandomNumber:5 to:25]; people.random_signInSec = [self getRandomNumber:1 to:59]; people.random_signOutMin = [self getRandomNumber:5 to:25]; people.random_signOutSec = [self getRandomNumber:1 to:59]; [datas addObject:people]; &#125; return [datas copy]; &#125; - (int)getRandomNumber:(int)from to:(int)to &#123; return (int)(from + (arc4random() % (to - from + 1))); &#125;#### æˆ‘åœ¨è¿™é‡Œå®ä¾‹åŒ–äº†ç”¨æˆ·çš„å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªå¯¹è±¡ç”Ÿæˆçš„åŒäº‹ï¼Œå°±å·²ç»ç¡®å®šè¿™ä¸ªå¯¹è±¡ç­¾åˆ°çš„æ—¶é—´ï¼Œå’Œç­¾å‡ºçš„æ—¶é—´ï¼ˆåœ¨æŸä¸ªæ•°èŒƒå›´å†…éšæœºç”Ÿæˆï¼‰ã€‚if (hour == signOutHour) &#123; // ç­¾å‡º--0 if (self.needSignOut.count == 0) return; for (int i = 0 ; i &lt; self.needSignOut.count; i++) &#123; People *pp = self.needSignOut[i]; if (pp.random_signOutMin &lt; min || (pp.random_signOutMin == min &amp;&amp; pp.random_signOutSec &lt;= sec)) &#123; par = @&#123; @"employeeNo":pp.employeeNo, @"coord": @"30.249812,120.211494", @"img_ids":@"", @"identifier": pp.identifier, @"type": pp.type&#125;; [self SignOrSignOut:par week:week time:[NSString stringWithFormat:@"%ld:%ld:%ld",(long)hour,(long)min,(long)sec]]; &#125; &#125; &#125; 12345678910111213141516171819- (void)needToRemove:(TypeStatus)status identifior:(NSString *)identifior realtime:(NSString *)realtime&#123; if (status == LogIn) &#123; for (int i = 0 ; i &lt; self.needSignIn.count; i++) &#123; NSMutableDictionary *tempDic = [NSMutableDictionary new]; People *pp = self.needSignIn[i]; if ([pp.identifier isEqualToString:identifior] &amp;&amp; ![identifior isEqualToString:@""]) &#123; NSLog(@"ç§»é™¤people:%@---loginMin:%ld----loginSec:%ld",pp.identifier,(long)pp.random_signInMin, (long)pp.random_signInSec); [self.needSignIn removeObject:pp]; if (pp.identifier != nil) [tempDic setObject:pp.identifier forKey:@"iden"]; [tempDic setObject:[NSString stringWithFormat:@"ç­¾åˆ°æ—¶é—´:%ld:%ld:%ld", signInHour, pp.random_signInMin, pp.random_signInSec] forKey:@"time"]; if (realtime != nil) [tempDic setObject:realtime forKey:@"realtime"]; if (tempDic != nil) [self.tableViewDatas addObject:tempDic]; &#125; &#125; è¿™é‡Œä½ ä¼šå‘ç°æˆ‘åœ¨éå†çš„åŒäº‹ï¼Œåˆå¯¹mutableArrayå¯¹è±¡è¿›è¡Œçš„æ“ä½œï¼Œå¼€å§‹ä¸€ç›´crashï¼Œä¼šæŠ¥è¿™ä¸ªé”™ï¼šcollection __nsarraym was mutated while being enumerated æ„æ€å°±æ˜¯è¯´ï¼Œä½ åœ¨éå†è¿™ä¸ªå¯¹è±¡çš„åŒäº‹ï¼Œåˆå¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œäº†æ·»åŠ ã€åˆ é™¤çš„æ“ä½œã€‚è¿™é‡Œç»™ä½ ä¸‰ç§è§£å†³çš„æ€è·¯ã€‚ 1 1for (int i = 0 ; i &lt; self.needSignIn.count; i++) &#123;&#125; æ›¿æ¢ 1for (People *pp in self.needSignIn) &#123;&#125; 2 123NSSortDescriptor *sd1 = [NSSortDescriptor sortDescriptorWithKey:nil ascending:NO];//yeså‡åºæ’åˆ—ï¼Œno,é™åºæ’åˆ—NSArray *myary = [ary sortedArrayUsingDescriptors:[NSArray arrayWithObjects:sd1, nil]];//æ³¨æ„è¿™é‡Œçš„aryè¿›è¡Œæ’åºåä¼šç”Ÿäº§ä¸€ä¸ªæ–°çš„æ•°ç»„æŒ‡é’ˆï¼Œmyaryï¼Œä¸èƒ½åœ¨ç”¨ary,aryè¿˜æ˜¯ä¿æŒä¸å˜çš„ã€‚for (People *pp in myary) &#123;&#125; 3 1ç”Ÿæˆä¸€ä¸ªé›¶æ—¶çš„æ•°ç»„ï¼Œç”¨æ¥éå†ï¼Œä¹‹å‰çš„æ•°æ®ç”¨æ¥æ“ä½œã€‚ å…¶å®è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œæƒ³äº†å¥½ä¹…æ‰æƒ³æ˜ç™½ï¼šä¸ºä»€ä¹ˆæ­£åºæ’åˆ—ä¸è¡Œï¼Œå€’åºå°±å¯ä»¥å‘¢ï¼Ÿï¼Ÿ,ä¸ºä»€ä¹ˆforä¸è¡Œï¼Œä½†æ˜¯forinçš„å¯ä»¥å‘¢ï¼Ÿ ####å…¶å®forçš„è¯­å¥å¯ä»¥ç­‰åŒäºï¼šå‡å¦‚è¯´æˆ‘æœ‰10ä¸ªå…ƒç´ ï¼Œåœ¨ç¬¬ä¸€ä¸ªçš„æ—¶å€™ï¼Œæˆ‘å°±removeäº†ï¼Œé‚£æ˜¯ä¸æ˜¯åˆ°äº†ç¬¬ä¹ä¸ªçš„æ—¶å€™å°±è¶Šç•Œäº†å‘¢ï¼Ÿï¼Ÿ 1int count = arr.count; for (i=0;i&lt;count;i++) &#123;&#125; å€’åºåŒæ ·çš„é“ç†ï¼š 12int count = arr.count;for (i = count - 1;i&gt;=0 ;iâ€”) &#123;&#125; å½“æˆ‘ç§»é™¤å½“å‰è¿™ä¸ªçš„æ—¶å€™ï¼Œå…¶å®æ¯”ä¸å½±å“æˆ‘å…¶ä»–çš„å…ƒç´ å¸ƒå±€ã€‚ä½†æ˜¯è¿™ä¸¤ç§æƒ…å†µï¼Œå‡å¦‚ä½ ä½¿ç”¨forçš„è¯­å¥æ ¼å¼ï¼Œå°±ä¸ä¼šæœ‰é—®é¢˜äº† 1for (int i = 0 ; i &lt; self.needSignIn.count; i++) &#123;&#125; ###æ€»ç»“ä¸€å¥è¯ï¼š å½“æˆ‘ä»¬æ­£åºéå†æ—¶,å¦‚æœåˆ é™¤äº†ä¸€ä¸ª,é‚£ä¹ˆæ²¡æœ‰éå†åˆ°çš„å…ƒç´ ä½ç½®éƒ½ä¼šå¾€å‰ç§»åŠ¨ä¸€ä½,è¿™æ ·ç³»ç»Ÿå°±æ— æ³•ç¡®å®šæ¥ä¸‹æ¥éå†æ˜¯ä»åˆ é™¤ä½ç½®å¼€å§‹å‘¢,è¿˜æ˜¯ä»åˆ é™¤ä½ç½®ä¸‹ä¸€ä½å¼€å§‹å‘¢ å¯¹äºé€†åºéå†å°±ä¸ä¼š,å› ä¸ºæˆ‘ä»¬é€†åºéå†æ—¶,é‡åˆ°åŒ¹é…çš„å…ƒç´ åˆ é™¤å,ä½ç½®æ”¹å˜çš„æ˜¯éå†è¿‡å¾—å…ƒç´ ,è€Œæ²¡æœ‰éå†åˆ°çš„å…ƒç´ ä½ç½®å´æ²¡æœ‰æ”¹å˜,æ‰€ä»¥éå†èƒ½å¤Ÿæ­£å¸¸è¿›è¡Œ.]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
        <tag>Obeject-c</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­å»ºSDKä¸­æ‰€é‡åˆ°çš„å‘]]></title>
    <url>%2F2016%2F05%2F10%2F20160510%2F</url>
    <content type="text"><![CDATA[å…¶å®å¼€å§‹ä¹‹å‰ï¼Œæˆ‘æ‰¾åˆ°ä¸€ç¯‡å¾ˆä¸é”™çš„æ–‡ç« ï¼Œæƒ³ç¿»è¯‘çš„ï¼Œä½†æ˜¯googleäº†ä¸€ä¸‹ï¼Œå‘ç°å·²ç»æœ‰å¥½å¤šäººç¿»è¯‘è¿‡è¿™ç¯‡æ–‡ç« äº†ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†å¤šè¯´ä»€ä¹ˆäº†ï¼ŒæŠŠåŸæ–‡çš„é“¾æ¥è´´å‡ºæ¥ã€‚https://www.raywenderlich.com/65964/create-a-framework-for-ios,è¿™é‡Œæˆ‘å°±è¯´ä¸€ä¸‹ï¼Œæˆ‘åœ¨æ­å»ºsdkçš„æ—¶å€™ï¼Œé‡åˆ°çš„å‘å§ã€‚ å…¶å®ä½ è¦æ˜¯èƒ½å¤Ÿèµ°å®Œä¸Šé¢çš„æµç¨‹ï¼Œä½ åŸºæœ¬ä¸Šå·²ç»å®Œæˆäº†80%äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯å‘ç°é—®é¢˜ï¼Œå†å»æ‰“åŒ…ã€‚ ç¬¬ä¸€ä¸ªé”™è¯¯*** Terminating app due to uncaught exception &#39;NSInvalidArgumentException&#39;, reason: &#39;Could not find a storyboard named &#39;XXXXname&#39; in bundle NSBundle è¿™ä¸ªé”™è¯¯å¯èƒ½ç›´æ¥å°±ä¼šå¯¼è‡´appèµ·ä¸æ¥ï¼Œä¸€å¯åŠ¨å°±ä¼šcrashï¼Œè¿™é‡Œéœ€è¦å°†æ‰€æœ‰ä½ ç”¨åˆ°xibï¼Œstoryboardçš„æ–‡ä»¶éƒ½ç»Ÿä¸€ä½œå‡ºä¿®æ”¹ã€‚å…¶å®è¿™ä¸ªé—®é¢˜åœ¨é‡åˆ°ç”¨xib/SBåˆ›å»ºçš„cellçš„æ—¶å€™ã€åœ¨xib/SBä¸­æ·»åŠ å›¾ç‰‡çš„æ—¶å€™éœ€è¦å°†[UIImage imageNamed:@&quot;&quot;] =======&gt; ä¿®æ”¹ä¸º [UIImage imageNamed:@&quot;xxxx.bundle/xxxxName&quot;] 12345UIStoryboard *main = [UIStoryboard storyboardWithName:@"xxxxName" bundle:[NSBundle mainBundle]];ä¿®æ”¹ä¸º===============================UIStoryboard *main = [UIStoryboard storyboardWithName:@"xxxx.bundle/xxxxName" bundle:[NSBundle mainBundle]]; ç¬¬äºŒä¸ªé”™è¯¯å¯èƒ½ä¼šåœ¨Iphone4çš„æ—¶å€™ï¼Œç›´æ¥æ— æ³•build,ç›´æ¥æŠ¥è¿™ä¸ªé”™ï¼š dyld: Symbol not found: ___NSDictionary0__ 1éœ€è¦å°†é¡¹ç›®ä¸­çš„build Phases ä¸­çš„core foundationçš„stastuçš„çŠ¶æ€ ä»Requiredä¿®æ”¹ä¸ºOptional åç»­å¦‚æœè¿˜æœ‰å…¶ä»–çš„bugï¼Œæˆ‘å†è´´å‡ºæ¥å§ï¼]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>Obeject-c</tag>
        <tag>é¡¹ç›®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºå­¦ä¹ UITableViewCellçš„é«˜åº¦è®¡ç®—çš„æ¡†æ¶-UITableView-FDTemplateLayoutCellã€‚]]></title>
    <url>%2F2016%2F05%2F05%2F20160505%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ UITableViewçš„é«˜åº¦è®¡ç®—çš„æ¡†æ¶ è¿™é‡Œå­¦ä¹ çš„æ˜¯UITableView-FDTemplateLayoutCellhttps://github.com/forkingdog/UITableView-FDTemplateLayoutCellä½ ä¹Ÿå¯ä»¥è‡ªå·±å»ä¸‹è½½å¹¶ä¸”å­¦ä¹ ã€‚ ä»–çš„æ–‡ä»¶å¾ˆç®€å•ï¼Œç›´æ¥åœ¨UITableViewçš„é«˜åº¦æ”¾å›ä¸­å»è°ƒç”¨æ–¹æ³•ï¼šç›´æ¥è°ƒç”¨UITableView ä¸­(FDTemplateLayoutCell)çš„categoryçš„æ–¹æ³•,å…¶å®ä»–çš„categoryé‡Œé¢ä¸€å…±å†™äº†ä¸‰ç§å¯ä»¥è®¡ç®—é«˜åº¦çš„æ–¹æ³•ï¼Œè¿™æ˜¯å…¶ä¸­çš„ä¸€ç§ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778- (CGFloat)fd_heightForCellWithIdentifier:(NSString *)identifier configuration:(void (^)(id cell))configuration &#123; //1. if (!identifier) &#123; return 0; &#125; //2. UITableViewCell *templateLayoutCell = [self fd_templateCellForReuseIdentifier:identifier]; // Manually calls to ensure consistent behavior with actual cells. (that are displayed on screen) [templateLayoutCell prepareForReuse]; //8. // Customize and provide content for our template cell. if (configuration) &#123; configuration(templateLayoutCell); &#125; return [self fd_systemFittingHeightForConfiguratedCell:templateLayoutCell];//2.- (__kindof UITableViewCell *)fd_templateCellForReuseIdentifier:(NSString *)identifier &#123; //.... //4. if (!templateCellsByIdentifiers) &#123; templateCellsByIdentifiers = @&#123;&#125;.mutableCopy; objc_setAssociatedObject(self, _cmd, templateCellsByIdentifiers, OBJC_ASSOCIATION_RETAIN_NONATOMIC); &#125; //5. if (!templateCell) &#123; templateCell = [self dequeueReusableCellWithIdentifier:identifier]; NSAssert(templateCell != nil, @"Cell must be registered to table view for identifier - %@", identifier); //6. templateCell.fd_isTemplateLayoutCell = YES; templateCell.contentView.translatesAutoresizingMaskIntoConstraints = NO; templateCellsByIdentifiers[identifier] = templateCell; [self fd_debugLog:[NSString stringWithFormat:@"layout cell created - %@", identifier]]; &#125; //....)//3./** * Returns the value associated with a given object for a given key. * * @param object The source object for the association. * @param key The key for the association. * * @return The value associated with the key \e key for \e object. * * @see objc_setAssociatedObject */OBJC_EXPORT id objc_getAssociatedObject(id object, const void *key)//6./// Indicate this is a template layout cell for calculation only./// You may need this when there are non-UI side effects when configure a cell./// Like:/// - (void)configureCell:(FooCell *)cell atIndexPath:(NSIndexPath *)indexPath &#123;/// cell.entity = [self entityAtIndexPath:indexPath];/// if (!cell.fd_isTemplateLayoutCell) &#123;/// [self notifySomething]; // non-UI side effects/// &#125;/// &#125;///@property (nonatomic, assign) BOOL fd_isTemplateLayoutCell;//7.- (BOOL)fd_isTemplateLayoutCell &#123; return [objc_getAssociatedObject(self, _cmd) boolValue];&#125;- (void)setFd_isTemplateLayoutCell:(BOOL)isTemplateLayoutCell &#123; objc_setAssociatedObject(self, @selector(fd_isTemplateLayoutCell), @(isTemplateLayoutCell), OBJC_ASSOCIATION_RETAIN);&#125; è¿™é‡Œå‡å¦‚ä¸ä¼ å…¥identifiorçš„å€¼å¾—è¯ï¼Œä»–å°±ç›´æ¥ç›´æ¥è¿”å›0ï¼Œè¡¨ç¤ºä¸è®¡ç®—é«˜åº¦äº†ã€‚ è¿™é‡Œæ ¹æ®ä¼ å…¥çš„identifiorçš„å€¼ï¼Œæ¥æ‰¾åˆ°ç›¸åº”çš„UITableViewCell è¿™é‡Œæ˜¯runtimeæºç ä¸­æ‰€ç”³æ˜çš„ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ˜¯æ ¹æ®ç»™çš„Objectä»¥åŠç»™çš„Keyæ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ ç¬¬ä¸€æ¬¡ç”³æ˜çš„è¯ï¼Œå®ƒå°±ä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„å¯å˜å­—å…¸å¯¹è±¡,å­—å…¸çš„å¯¹è±¡æ˜¯{},keyæ˜¯String, valueæ˜¯UITableViewCellã€‚ å½“ç¬¬ä¸€æ¬¡æ²¡æœ‰UITableViewCellçš„å¯¹è±¡çš„æ—¶å€™ï¼Œå°±å¼€å§‹åœ¨é‡ç”¨æ± ä¸­ï¼Œæ‰¾UITableViewCellçš„å¯¹è±¡,å¹¶å°†UITableViewCellå¯¹è±¡å¡è¿›ä¹‹å‰çš„å­—å…¸å¯¹è±¡ã€‚ è¿™è¾¹åœ¨å¡å…¥UITableViewCellå¯¹è±¡çš„æ—¶å€™ï¼Œé€šè¿‡category(7.)æ¥è¿™æ˜¯è¿™ä¸ªUITableViewCellçš„å±æ€§ï¼Œè¿™ä¸ªä½œè€…çš„ç”¨æ„å°±æ˜¯è¡¨æ˜è¿™ä¸ªåªæ˜¯ç”¨è®¡ç®—é«˜åº¦çš„ã€‚ å¦‚æœéœ€è¦åœ¨cellä¸­è®¾ç½®cellå…ƒç´ ä¸­çš„å€¼ï¼Œå°±åœ¨è¿™é‡Œè®¾ç½®ã€‚æœ€åæ‹¿åˆ°UITableViewCellçš„å¯¹è±¡ã€‚ æœ€åå°†æ‹¿åˆ°çš„UITableViewCellçš„å¯¹è±¡ä¸¢åˆ°è¿™ä¸ªå‡½æ•°ä¸­è®¡ç®—123456- (CGFloat)fd_systemFittingHeightForConfiguratedCell:(UITableViewCell *)cell &#123; // Auto layout engine does its math // 6. fittingHeight = [cell.contentView systemLayoutSizeFittingSize:UILayoutFittingCompressedSize].height; [cell.contentView removeConstraint:widthFenceConstraint];&#125; è¿™é‡Œé¦–å…ˆè·å¾—è¿™ä¸ªUITableViewCellçš„å®½åº¦ï¼Œèµ‹å€¼ç»™contentViewWidthçš„å¯¹è±¡ã€‚ ä¸‹é¢åˆ¤æ–­è¿™ä¸ªcellä¸­æœ‰æ²¡æœ‰è®¾ç½®accessoryViewçš„è¿™ä¸ªviewï¼Œå¦‚æœè®¾ç½®äº†accessoryViewçš„è¯ï¼Œè¿™ä¸ªcellçš„å®½åº¦æŒ‰ä¼šç¨å¾®å°ä¸€ç‚¹ï¼ˆ16 + CGRectGetWidth(cell.accessoryView.frame)ï¼‰ å¦åˆ™ä¼šæ ¹æ®accessoryViewçš„ç±»å‹ä¸åŒï¼Œéœ€è¦å‡å»ä¸åŒçš„å®½åº¦ã€‚ fd_enforceFrameLayoutæ˜¯ç”¨autolayoutçš„ã€è¿˜æ˜¯ä½¿ç”¨çš„frameçš„å¸ƒå±€ã€‚ é€šè¿‡NSLayoutConstraintï¼Œå°†cell.contentViewçš„å®½åº¦è®¾ç½®ä¸ºcontentViewWidthã€‚ ç›´æ¥è¿”å›é«˜åº¦ï¼Œå¹¶å°†çº¦æŸç§»é™¤æ‰ã€‚è¿™é‡Œæˆ‘ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·åšã€‚ å¦‚æœè¿™é‡Œçš„UITableviewçš„æ ¼å¼å¦‚æœä¸æ˜¯UITableViewCellSeparatorStyleNoneï¼Œé«˜åº¦å¯èƒ½ä¼šæœ‰ç‚¹åå·®ï¼ŒåŠ ä¸Šè¿™ä¸ªåå·®ï¼ˆ1.0 / [UIScreen mainScreen].scaleï¼‰ ##Demoä¸­ç¬¬äºŒç§æ–¹æ³•ï¼Œå…¶ä»–å‚æ•°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯å¤šäº†ä¸€ä¸ªcacheByIndexPath,å°±æ˜¯æ ¹æ®IndexPathçš„å¯¹è±¡æ¥å­˜å‚¨åˆšæ‰è®¡ç®—çš„é«˜åº¦ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677/// This method does what "-fd_heightForCellWithIdentifier:configuration" does, and/// calculated height will be cached by its index path, returns a cached height/// when needed. Therefore lots of extra height calculations could be saved.////// No need to worry about invalidating cached heights when data source changes, it/// will be done automatically when you call "-reloadData" or any method that triggers/// UITableView's reloading.////// @param indexPath where this cell's height cache belongs.///- (CGFloat)fd_heightForCellWithIdentifier:(NSString *)identifier cacheByIndexPath:(NSIndexPath *)indexPath configuration:(void (^)(id cell))configuration &#123; // Hit cache //1. if ([self.fd_indexPathHeightCache existsHeightAtIndexPath:indexPath]) &#123; [self fd_debugLog:[NSString stringWithFormat:@"hit cache by index path[%@:%@] - %@", @(indexPath.section), @(indexPath.row), @([self.fd_indexPathHeightCache heightForIndexPath:indexPath])]]; return [self.fd_indexPathHeightCache heightForIndexPath:indexPath]; &#125; //9. CGFloat height = [self fd_heightForCellWithIdentifier:identifier configuration:configuration]; [self.fd_indexPathHeightCache cacheHeight:height byIndexPath:indexPath]; [self fd_debugLog:[NSString stringWithFormat: @"cached by index path[%@:%@] - %@", @(indexPath.section), @(indexPath.row), @(height)]]; return height;&#125;//2.- (BOOL)existsHeightAtIndexPath:(NSIndexPath *)indexPath &#123; //6. NSNumber *number = self.heightsBySectionForCurrentOrientation[indexPath.section][indexPath.row]; return ![number isEqualToNumber:@-1];&#125;//3.- (void)buildCachesAtIndexPathsIfNeeded:(NSArray *)indexPaths &#123; [indexPaths enumerateObjectsUsingBlock:^(NSIndexPath *indexPath, NSUInteger idx, BOOL *stop) &#123; //4. [self buildSectionsIfNeeded:indexPath.section]; //5. [self buildRowsIfNeeded:indexPath.row inExistSection:indexPath.section]; &#125;];&#125;- (void)buildSectionsIfNeeded:(NSInteger)targetSection &#123; [self enumerateAllOrientationsUsingBlock:^(FDIndexPathHeightsBySection *heightsBySection) &#123; for (NSInteger section = 0; section &lt;= targetSection; ++section) &#123; if (section &gt;= heightsBySection.count) &#123; heightsBySection[section] = [NSMutableArray array]; &#125; &#125; &#125;];&#125;- (void)buildRowsIfNeeded:(NSInteger)targetRow inExistSection:(NSInteger)section &#123; [self enumerateAllOrientationsUsingBlock:^(FDIndexPathHeightsBySection *heightsBySection) &#123; NSMutableArray&lt;NSNumber *&gt; *heightsByRow = heightsBySection[section]; for (NSInteger row = 0; row &lt;= targetRow; ++row) &#123; if (row &gt;= heightsByRow.count) &#123; heightsByRow[row] = @-1; &#125; &#125; &#125;];&#125;//6.typedef NSMutableArray&lt;NSMutableArray&lt;NSNumber *&gt; *&gt; FDIndexPathHeightsBySection;//7.- (CGFloat)heightForIndexPath:(NSIndexPath *)indexPath &#123; [self buildCachesAtIndexPathsIfNeeded:@[indexPath]]; NSNumber *number = self.heightsBySectionForCurrentOrientation[indexPath.section][indexPath.row];&#125;//8.- (FDIndexPathHeightsBySection *)heightsBySectionForCurrentOrientation &#123; return UIDeviceOrientationIsPortrait([UIDevice currentDevice].orientation) ? self.heightsBySectionForPortrait: self.heightsBySectionForLandscape;&#125; å’Œä¸Šé¢æ–¹æ³•ä¸€æ ·çš„æˆ‘å°±ä¸è¯´äº†ï¼Œè¿™é‡Œçš„é«˜åº¦ç¼“å­˜éƒ¨åˆ†è¿˜æ˜¯è›®æœ‰æ„æ€çš„ï¼Œè¿™é‡Œæ–°å»ºäº†ä¸€ä¸ªfd_indexPathHeightCacheçš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯ç”¨æ¥ç®¡ç†ç¼“å­˜çš„éƒ¨åˆ†ï¼Œå¯¹è±¡ç»§æ‰¿çš„æ˜¯NSObject é€šè¿‡ä¼ å…¥çš„indexPathæ¥è¿”å›è¿™ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»ç¼“å­˜è¿›å»äº†ã€‚ åœ¨å°†indexPathçš„å¯¹è±¡æ‰“åŒ…æˆNSArrayçš„å¯¹è±¡ï¼Œå¯¹åˆ°ä¸‹ä¸€ä¸ªå‡½æ•°ä¸­ å°†indexPath.section,å¦‚æœæ•°ç»„ä¸­ä¸å«æœ‰è¿™ä¸ªsectionçš„è¯ï¼Œé‚£å°±æ–°å»ºä¸€ä¸ªï¼Œé€šè¿‡6.å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªæ˜¯ä¸ªäºŒä½æ•°ç»„ï¼Œæœ€å¤–å±‚æ•°ç»„çš„indexçš„æ•°ç›®å°±æ˜¯section ä¸‹ä¸€ä¸ªæ–¹æ³•å°±æ˜¯æ ¹æ®sectionï¼Œæ‰¾åˆ°é‡Œé¢ä¸€å±‚çš„æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„æ”¾çš„å°±æ˜¯å¯¹åº”çš„rowsçš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šé»˜è®¤å¡å…¥ä¸€ä¸ª-1çš„å€¼ã€‚ å†æ ¹æ®åŒæ ·çš„æ–¹æ³•ï¼Œåˆ°äºŒç»´æ•°ç»„ä¸­æŸ¥æ‰¾å¯¹è±¡ï¼Œå¦‚æœä¸æ˜¯æˆ‘ä»¬ä¹‹å‰å¡å…¥çš„-1,é‚£å°±æ˜¯trueï¼Œå¦åˆ™å°±æ˜¯falseã€‚ è¿™é‡Œæˆ‘æ²¡çœ‹æ‡‚ï¼Œå·²ç»çŸ¥é“åœ¨ç¼“å­˜ä¸­å­˜åœ¨äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å†æ‰ä¸€é[self buildCachesAtIndexPathsIfNeeded:@[indexPath]]; è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œä½œè€…æ ¹æ®æ¨ªç«–å±è®¾ç½®äº†ä¸¤ä¸ªä¸åŒçš„æ•°æ®ï¼Œå°±æ˜¯ä¸ºäº†åˆ†åˆ«å­˜å‚¨ã€æå–ã€‚ å¦‚æœä¹‹å‰æ²¡æœ‰ç¼“å­˜çš„è¯ï¼Œå®ƒä¼šå…ˆå»è°ƒç”¨ä¸€éä¹‹å‰è®¡ç®—é«˜åº¦çš„æ–¹æ³•ï¼Œç„¶åå°†è®¡ç®—å‡ºæ¥çš„é«˜åº¦ï¼Œä¸¢åˆ°ä¹‹å‰çš„äºŒç»´æ•°ç»„ä¸­å»ã€‚ ###ç¬¬ä¸‰ç§çš„è®¡ç®—æ–¹å¼ï¼Œå°±æ˜¯æ ¹æ®æ¯ä¸ªmodelè®¾ç½®ä¸åŒkeyå€¼æ¥å­˜å‚¨é«˜åº¦ã€‚123456789101112131415161718/// This method caches height by your model entity's identifier./// If your model's changed, call "-invalidateHeightForKey:(id &lt;NSCopying&gt;)key" to/// invalidate cache and re-calculate, it's much cheaper and effective than "cacheByIndexPath".////// @param key model entity's identifier whose data configures a cell.///- (CGFloat)fd_heightForCellWithIdentifier:(NSString *)identifier cacheByKey:(id&lt;NSCopying&gt;)key configuration:(void (^)(id cell))configuration &#123; //1. // Hit cache if ([self.fd_keyedHeightCache existsHeightForKey:key]) &#123; CGFloat cachedHeight = [self.fd_keyedHeightCache heightForKey:key]; [self fd_debugLog:[NSString stringWithFormat:@"hit cache by key[%@] - %@", key, @(cachedHeight)]]; return cachedHeight; &#125; //2. @property (nonatomic, strong) NSMutableDictionary&lt;id&lt;NSCopying&gt;, NSNumber *&gt; *mutableHeightsByKeyForPortrait;&#125; ä½œè€…ä¹Ÿè¯´äº†ï¼Œè¿™ä¸ªæ•ˆç‡ä¼šæ¯”ä¹‹å‰æŒ‰ç…§indexPathçš„è®¡ç®—æ•ˆç‡è¦é«˜ã€‚ é€šè¿‡è¿™ä¸ªï¼Œæˆ‘ä»¬å¤§æ¦‚å°±çŸ¥é“ï¼Œä½œè€…æ‰€è°“çš„æ•ˆç‡é«˜ï¼Œåº”è¯¥å°±æ˜¯è¿™ä¸ªæ„æ€ï¼Œè¿™é‡Œä¸æ˜¯ä»€ä¹ˆäºŒç»´æ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªNSMutableDictionaryå¯¹è±¡ã€‚å…¶ä»–åŸºæœ¬ä¸Šç±»ä¼¼ã€‚ æœ€åè¯´ä¸€ä¸‹è‡ªå·±çš„ä¸€ä¸ªç–‘é—®ï¼šç¬¬äºŒç§æ–¹æ³•ä¸­ï¼Œä½œè€…ä¸ºä»€ä¹ˆä¸å°†keyå’Œvalueç»è¿‡ç®€å•çš„è¿ç®—ï¼Œä½œä¸ºkeyï¼Œæ¥ç”¨NSDictionaryæ¥å­˜å‚¨æ•°æ®å‘¢ï¼Ÿä½œè€…çš„è§£é‡Šæ˜¯ï¼šé‡Œé¢è¦é…åˆ section row çš„insert removeçš„è¯ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥ä½œè€…æœ€åè¿˜æ˜¯é€‰æ‹©çš„äºŒç»´æ•°ç»„ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
        <tag>Obeject-c</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºå›¾ç‰‡åœ†è§’çš„åŠŸèƒ½å­¦ä¹ ã€‚]]></title>
    <url>%2F2016%2F04%2F19%2F20160418%2F</url>
    <content type="text"><![CDATA[å›¾ç‰‡çš„æ€§èƒ½é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šé¢è¯•çš„æ—¶å€™ï¼Œéƒ½ä¼šè¢«é—®åˆ°ï¼Œç°åœ¨åœ¨è‡ªå·±çš„appä¸­ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸ºäº†è§£å†³çš„æ€§èƒ½çš„é—®é¢˜ï¼Œæ‰€ä»¥äº†è§£äº†ä¸€äº›å…³äºå›¾ç‰‡æ€§èƒ½çš„åº“ï¼Œçœ‹ä¸€ä¸‹æºç , ç°åœ¨åº”è¯¥æœ‰å¾ˆå¤šè¿™ç§åº“äº†ã€‚æˆ‘çœ‹çš„æ˜¯è¿™ä¸ªï¼šhttps://github.com/CoderJackyHuang/HYBImageCliped è¿™ä¸ªåº“æ˜¯é€šè¿‡Categoryæ¥åˆ†åˆ«å®ç°è¿™äº›åŠŸèƒ½ï¼Œé¦–å…ˆçœ‹çœ‹UIViewçš„Category,æ˜¯æ€ä¹ˆå®ç°çš„UIViewçš„åœ†è§’ã€‚ 1234567891011121314151617/** * ä½¿ç”¨æŒ‡å®šçš„å›¾ç‰‡æ¥å¡«å……ï¼Œä½†æ˜¯ç”Ÿæˆçš„æ˜¯åœ†å½¢å›¾ç‰‡ï¼ŒèƒŒæ™¯é¢œè‰²ä¸ºç™½è‰²ã€‚ * * @param image å›¾ç‰‡åç§°æˆ–è€…å›¾ç‰‡å¯¹è±¡ï¼Œç”šè‡³æ”¯æŒNSData * @param targetSize ç”ŸæˆæŒ‡å®šå¤§å°çš„å›¾ç‰‡ * @param isEqualScale æ˜¯å¦ç­‰æ¯”ä¾‹ç¼©æ”¾å›¾ç‰‡ * @param backgroundColor é»˜è®¤å–æœ€é¡¶å±‚çˆ¶è§†å›¾çš„èƒŒæ™¯è‰²ï¼Œè‹¥ä¸ºé€æ˜ï¼Œåˆ™å–æœ¬èº«èƒŒæ™¯è‰²ï¼Œè‹¥ä¹Ÿä¸ºé€æ˜ï¼Œåˆ™å–ç™½è‰² * @parma callback åªæœ‰å½“å›¾ç‰‡çœŸæ­£è¢«è£å‰ªæˆåŠŸåï¼Œæ‰ä¼šå›è°ƒï¼Œè¿”å›è£å‰ªåçš„å›¾ç‰‡ * * @return è£å‰ªå‰çš„å›¾ç‰‡ */- (UIImage *)hyb_setCircleImage:(id)image size:(CGSize)targetSize isEqualScale:(BOOL)isEqualScale backgrounColor:(UIColor *)backgroundColor onCliped:(HYBClipedCallback)callback; è¿™åªæ˜¯å…¶ä¸­ä¸€ç§Publicçš„æ–¹æ³•ï¼Œæˆ‘æ˜¯æŒ‰ç…§Demoæ¥çœ‹çš„ã€‚ä½†æ˜¯æ— è®ºå“ªä¸€ç§Publicçš„æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨çš„éƒ½æ˜¯ç»Ÿä¸€çš„ä¸€ä¸ªPrivate çš„æ–¹æ³•ã€‚ 12345678- (UIImage *)hyb_private_setImage:(id)image size:(CGSize)targetSize cornerRadius:(CGFloat)cornerRadius rectCorener:(UIRectCorner)rectCorner backgroundColor:(UIColor *)bgColor isEqualScale:(BOOL)isEqualScale isCircle:(BOOL)isCircle onCliped:(HYBClipedCallback)callback é‡Œé¢æœ‰ä¸ªè¿™ä¸ªæ–¹æ³•ï¼šå¯ä»¥çœ‹å‡ºæ¥ï¼Œå‡å¦‚ä½ ä¸è®¾ç½®bgColorè¿™ä¸ªå±æ€§çš„è¯ï¼Œä»–ä¼šéå†å¾ªç¯ï¼Œä¸€ç›´ä¼šæ‰¾åˆ°æœ€é¡¶å±‚çš„çˆ¶ç±»ï¼Œå»é™¤çˆ¶ç±»çš„é¢œè‰²ã€‚æ‰€ä»¥æˆ‘è§‰å¾—ä½ è¦æ˜¯æ²¡äº‹è¯ï¼Œè¿˜æ˜¯è‡ªå·±è®¾ç½®ä¸€ä¸‹é¢œè‰²å§ï¼è¿™è¾¹å‡å¦‚å±‚çº§å¾ˆå¤æ‚ï¼Œå¹¶ä¸”å…ƒç´ å¾ˆå¤šçš„è¯ï¼Œè¿™ä¸ªæ€§èƒ½å¯èƒ½ä¼šè®©ä½ å“­å§... 123456789101112 if (bgColor == nil || CGColorEqualToColor(bgColor.CGColor, [UIColor clearColor].CGColor)) &#123; UIView *superview = self.superview; while (superview.backgroundColor == nil || CGColorEqualToColor(superview.backgroundColor.CGColor, [UIColor clearColor].CGColor)) &#123; if (!superview) &#123; break; &#125; superview = [superview superview]; &#125; bgColor = superview.backgroundColor;&#125; å¥½å§ï¼Œä¸‹é¢è¿™æ®µä»£ç åˆè¦æåˆ°é¢è¯•å®å…¸ä¸­å•¥ç»å…¸è¯é¢˜äº†ï¼Œå¦‚ä½•åœ¨categoryä¸­ç»™ç°æœ‰çš„ç±»æ·»åŠ å±æ€§å‘¢ï¼Ÿhttp://nshipster.com/associated-objects/Matt å¤§ç¥æ›¾ç»å†™è¿‡ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ã€‚ 123456789__block UIImage *clipedImage = nil; //1. dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; //2. willBeClipedImage.hyb_pathColor = self.hyb_pathColor; willBeClipedImage.hyb_pathWidth = self.hyb_pathWidth; willBeClipedImage.hyb_borderColor = self.hyb_borderColor; willBeClipedImage.hyb_borderWidth = self.hyb_borderWidth; &#125;); 123456789101112è¿™é‡Œæ¶‰åŠåˆ°çš„pathColor,pathWidth,borderColor,borderWidth,éƒ½æ˜¯é€šè¿‡åœ¨runtimeçš„ç‰¹æ€§ï¼Œåœ¨å·²æœ‰çš„ç±»ä¸­æ·»åŠ å±æ€§çš„æ–¹å¼æ¥å­˜å‚¨å’Œä½¿ç”¨çš„ã€‚- (UIColor *)hyb_pathColor &#123; UIColor *color = objc_getAssociatedObject(self, s_hyb_image_pathColorKey); if (color) &#123; return color; &#125; return [UIColor whiteColor];&#125;//...ä¸‹é¢éƒ½æ˜¯æ¢æ±¤ä¸æ¢è¯çš„ã€‚ ä¸‹é¢æ¶‰åŠåˆ°çœŸæ­£çš„ç”»å›¾éƒ¨åˆ†äº† è¿™é‡Œå¦èµ·ä¸€ä¸ªçº¿ç¨‹æ¥ç»˜åˆ¶åœ†è§’ã€‚è¿™é‡Œæˆ‘æœ‰ä¸ªé—®é¢˜ï¼šæ¯ä¸ªå›¾ç‰‡éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªæ˜¯ä¸æ˜¯æœ‰ç‚¹é—®é¢˜ã€‚è€Œä¸”è¿™ä¸ªdispatch_get_global_queueä¹Ÿæœ‰é—®é¢˜ï¼ŒGlobal Dispatch Queueåˆ›å»ºçš„é˜Ÿåˆ—,å…¶çº¿ç¨‹æ•°ç›®æ˜¯ä¸å®šçš„,æ˜¯æ ¹æ®XNUå†…æ ¸å†³å®šçš„ã€‚æˆ‘è§‰å¾—è¿™ä¸€ç‚¹ï¼Œæºç ä¸­æ²¡æœ‰è§£é‡Šã€‚ ç»˜åˆ¶åœ†è§’çš„æ ¸å¿ƒå‡½æ•°æ˜¯è¿™ä¸ªã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445//1.- (UIImage *)hyb_private_clipImageToSize:(CGSize)targetSize cornerRadius:(CGFloat)cornerRadius corners:(UIRectCorner)corners backgroundColor:(UIColor *)backgroundColor isEqualScale:(BOOL)isEqualScale isCircle:(BOOL)isCircle &#123;&#125; CGContextRef ctx = UIGraphicsGetCurrentContext(); //2. if (isCircle) &#123; CGContextAddEllipseInRect(ctx, rect); &#125; else &#123; CGContextAddRect(ctx, rect); &#125; CGContextClip(ctx); [self drawInRect:rectImage]; //3. CGContextSetStrokeColorWithColor(ctx, [borderColor CGColor]); CGContextSetLineWidth(ctx, borderWidth); if (isCircle) &#123; CGContextStrokeEllipseInRect(ctx, rectImage); CGContextStrokeEllipseInRect(ctx, rect); &#125; else if (cornerRadius == 0) &#123; CGContextStrokeRect(ctx, rectImage); CGContextStrokeRect(ctx, rect); &#125; //4. UIBezierPath *path2 = [UIBezierPath bezierPathWithRoundedRect:rect byRoundingCorners:corners cornerRadii:CGSizeMake(cornerRadius + minusPath1 ,cornerRadius + minusPath1)]; //5. UIImage *finalImage = UIGraphicsGetImageFromCurrentImageContext(); return finalImage; é‡Œé¢æ›´æ–°sizeåšäº†ä¸€äº›æ–‡ç« ã€‚æ˜¯åˆ°åº•è¦åšæˆªæˆä¸€ä¸ªæ­£åœ†ï¼Œè¿˜æ˜¯åªæˆªåœ¨å“ªä¸ªè§’çš„åœ†ã€‚ å¦‚æœæ˜¯æ­£åœ†ã€å¹¶ä¸”ä¸å¸¦åœ†è§’çš„è¯ï¼Œå°±ç”¨core graphicæ¥ç”»ã€‚ å†…çº¿å’Œå¤–çº¿çš„ç»˜åˆ¶ã€ä»¥åŠç²—ç»†ã€é¢œè‰²ã€‚ å¦‚æœä¸æ˜¯æ­£åœ†ã€å¸¦åœ†è§’çš„å¤šè¾¹å½¢çš„å›¾å½¢ï¼Œç”¨UIBezierPath æ›²çº¿æ¥ç»˜åˆ¶ã€‚å…³é”®æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œä»£è¡¨å“ªä¸€ä¸ªæˆ–è€…å“ªä¸€äº›åœ†è§’éœ€è¦ç»˜åˆ¶ã€è‹¹æœå®˜æ–¹çš„æ–‡æ¡£ä¸ºcorners: A bitmask value that identifies the corners that you want rounded. You can use this parameter to round only a subset of the corners of the rectangle. æœ€åç›´æ¥å°†ç»˜åˆ¶çš„å›¾å½¢è¿”å›å‡ºæ¥ã€‚ æœ€åè¯´ä¸€ç‚¹ã€æ— è®ºæ˜¯UIbuttonã€UIImageã€è¿˜æ˜¯ä»€ä¹ˆã€ç¬”è€…çš„æ€è·¯éƒ½æ˜¯å…ˆåœ¨UIViewä¸­æ·»åŠ æ–¹æ³•ã€å†åœ¨UIImageæ·»åŠ æ–¹æ³•ã€å¹¶ä¸”è¿›è¡Œè°ƒç”¨ã€ç»˜åˆ¶å›¾å½¢ï¼Œå¹¶ä¸”è¿”å›ã€‚]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
        <tag>Obeject-c</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ YYModel]]></title>
    <url>%2F2016%2F04%2F01%2F20160401%2F</url>
    <content type="text"><![CDATA[ä»¥YYModelçš„ä¾‹å­ï¼Œå®ƒä»¥ç±»çš„æ–¹å¼è°ƒç”¨ 1234567+ (instancetype)yy_modelWithJSON:(id)json &#123; NSDictionary *dic = [self _yy_dictionaryWithJSON:json]; return [self yy_modelWithDictionary:dic];&#125;&lt;!-- 1. ç›´æ¥å°†jsonçš„æ ¼å¼ä¸¢ç»™è¿™ä¸ªå‡½æ•° --&gt;&lt;!-- 2. ç„¶åè°ƒç”¨ä¸‹é¢çš„è¿™ä¸ªå‡½æ•°ï¼Œä¸»è¦æ˜¯è®²è¿™ä¸ªjsonè½¬åŒ–ä¸ºNSDictionaryçš„æ ¼å¼ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ä¼šå°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºNSData,ç„¶åå†è½¬åŒ–ä¸ºNSDictionary --&gt; 1+ (NSDictionary *)_yy_dictionaryWithJSON:(id)json &#123; ç°åœ¨å¼€å§‹è¿›å…¥æœ€é‡è¦çš„å‡½æ•°éƒ¨åˆ†äº† 12//è¿™ä¸ªå‡½æ•°é‡Œè·å–modelå…ƒæ˜¯é€šè¿‡è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼Œclsæ˜¯è·å–æœ¬ç±»è€Œå¾—åˆ°çš„Classç±»å‹+ (instancetype)yy_modelWithDictionary:(NSDictionary *)dictionary &#123;&#125; 1[_YYModelMeta metaWithClass:cls] 1234567891011121314151617181920212223+ (instancetype)metaWithClass:(Class)cls &#123; if (!cls) return nil; static CFMutableDictionaryRef cache; static dispatch_once_t onceToken; //1.. static dispatch_semaphore_t lock; dispatch_once(&amp;onceToken, ^&#123; cache = CFDictionaryCreateMutable(CFAllocatorGetDefault(), 0, &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks); lock = dispatch_semaphore_create(1); &#125;); dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER); _YYModelMeta *meta = CFDictionaryGetValue(cache, (__bridge const void *)(cls)); dispatch_semaphore_signal(lock); if (!meta || meta-&gt;_classInfo.needUpdate) &#123; meta = [[_YYModelMeta alloc] initWithClass:cls]; if (meta) &#123; dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER); CFDictionarySetValue(cache, (__bridge const void *)(cls), (__bridge const void *)(meta)); dispatch_semaphore_signal(lock); &#125; &#125; return meta;&#125; 1234&lt;!-- //ä»¥ä¿¡å·é‡çš„æ–¹å¼ä¿æŒåŒæ­¥ï¼Œä½œç”¨æ˜¯ä¸ºäº†ä»cacheçš„å†…å­˜ä¸­è·å–metaçš„æ•°æ®æ˜¯åŒæ­¥çš„ã€‚ --&gt;dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER); _YYModelMeta *meta = CFDictionaryGetValue(cache, (__bridge const void *)(cls)); dispatch_semaphore_signal(lock); 123456789&lt;!-- //æˆ–è€…åœ¨è®²metaçš„å€¼å¡å…¥å†…å­˜ä¸­ä¿æŒåŒæ­¥ --&gt; if (!meta || meta-&gt;_classInfo.needUpdate) &#123; meta = [[_YYModelMeta alloc] initWithClass:cls]; if (meta) &#123; dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER); CFDictionarySetValue(cache, (__bridge const void *)(cls), (__bridge const void *)(meta)); dispatch_semaphore_signal(lock); &#125; &#125; 1234567&lt;!-- å…¶ä¸­åˆ›å»ºmetaçš„æ—¶å€™å›è°ƒç”¨ --&gt;meta = [[_YYModelMeta alloc] initWithClass:cls];- (instancetype)initWithClass:(Class)cls &#123; YYClassInfo *classInfo = [YYClassInfo classInfoWithClass:cls]; ..... &#125; 12345678910111213141516 &lt;!-- è¿™é‡Œæ¶‰åŠåˆ°YYClassInfoçš„å®ä¾‹åŒ–æ–¹æ³•,é€šè¿‡runtimeçš„ä¸€äº›æ–¹æ³•ï¼Œæ‰¾åˆ°æœ¬ç±»ï¼Œçˆ¶ç±»ï¼Œå…ƒç±»ã€‚ --&gt; - (instancetype)initWithClass:(Class)cls &#123; if (!cls) return nil; self = [super init]; _cls = cls; _superCls = class_getSuperclass(cls); _isMeta = class_isMetaClass(cls); if (!_isMeta) &#123; _metaCls = objc_getMetaClass(class_getName(cls)); &#125; _name = NSStringFromClass(cls); [self _update]; _superClassInfo = [self.class classInfoWithClass:_superCls]; return self;&#125; ç„¶ååœ¨_updateçš„æ–¹æ³•ä¸­ 12345678910111213141516171819202122232425&lt;!-- è¿™é‡Œè®²modelä¸­çš„æ–¹æ³•ã€å±æ€§ï¼Œivarä»¥key-valueçš„å½¢å¼å­˜æ”¾åœ¨å­—å…¸ä¸­ã€‚æœ¬ç±»è°ƒç”¨å®Œåä¼šåœ¨çˆ¶ç±»ä¸­è°ƒç”¨å†è°ƒç”¨ä¸€éã€‚ --&gt; Class cls = self.cls; unsigned int methodCount = 0; Method *methods = class_copyMethodList(cls, &amp;methodCount); if (methods) &#123; NSMutableDictionary *methodInfos = [NSMutableDictionary new]; _methodInfos = methodInfos; for (unsigned int i = 0; i &lt; methodCount; i++) &#123; YYClassMethodInfo *info = [[YYClassMethodInfo alloc] initWithMethod:methods[i]]; if (info.name) methodInfos[info.name] = info; &#125; free(methods); &#125; unsigned int propertyCount = 0; objc_property_t *properties = class_copyPropertyList(cls, &amp;propertyCount); if (properties) &#123; NSMutableDictionary *propertyInfos = [NSMutableDictionary new]; _propertyInfos = propertyInfos; for (unsigned int i = 0; i &lt; propertyCount; i++) &#123; YYClassPropertyInfo *info = [[YYClassPropertyInfo alloc] initWithProperty:properties[i]]; if (info.name) propertyInfos[info.name] = info; &#125; free(properties); &#125;.... 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859&lt;!-- * æœ€æœ€å…³é”®çš„æ˜ å°„æ¥äº†ï¼ŒYYModelæŠŠè¿™ä¸ªåŠŸèƒ½ç”¨ä¸€ä¸ªé€’å½’å‡½æ•°æ¥å®ç°äº†ã€‚ --&gt;// create mapper NSMutableDictionary *mapper = [NSMutableDictionary new]; NSMutableArray *keyPathPropertyMetas = [NSMutableArray new]; NSMutableArray *multiKeysPropertyMetas = [NSMutableArray new]; if ([cls respondsToSelector:@selector(modelCustomPropertyMapper)]) &#123; NSDictionary *customMapper = [(id &lt;YYModel&gt;)cls modelCustomPropertyMapper]; [customMapper enumerateKeysAndObjectsUsingBlock:^(NSString *propertyName, NSString *mappedToKey, BOOL *stop) &#123; _YYModelPropertyMeta *propertyMeta = allPropertyMetas[propertyName]; if (!propertyMeta) return; [allPropertyMetas removeObjectForKey:propertyName]; if ([mappedToKey isKindOfClass:[NSString class]]) &#123; if (mappedToKey.length == 0) return; propertyMeta-&gt;_mappedToKey = mappedToKey; NSArray *keyPath = [mappedToKey componentsSeparatedByString:@&quot;.&quot;]; if (keyPath.count &gt; 1) &#123; propertyMeta-&gt;_mappedToKeyPath = keyPath; [keyPathPropertyMetas addObject:propertyMeta]; &#125; propertyMeta-&gt;_next = mapper[mappedToKey] ?: nil; mapper[mappedToKey] = propertyMeta; &#125; else if ([mappedToKey isKindOfClass:[NSArray class]]) &#123; NSMutableArray *mappedToKeyArray = [NSMutableArray new]; for (NSString *oneKey in ((NSArray *)mappedToKey)) &#123; if (![oneKey isKindOfClass:[NSString class]]) continue; if (oneKey.length == 0) continue; NSArray *keyPath = [oneKey componentsSeparatedByString:@&quot;.&quot;]; if (keyPath.count &gt; 1) &#123; [mappedToKeyArray addObject:keyPath]; &#125; else &#123; [mappedToKeyArray addObject:oneKey]; &#125; if (!propertyMeta-&gt;_mappedToKey) &#123; propertyMeta-&gt;_mappedToKey = oneKey; propertyMeta-&gt;_mappedToKeyPath = keyPath.count &gt; 1 ? keyPath : nil; &#125; &#125; if (!propertyMeta-&gt;_mappedToKey) return; propertyMeta-&gt;_mappedToKeyArray = mappedToKeyArray; [multiKeysPropertyMetas addObject:propertyMeta]; propertyMeta-&gt;_next = mapper[mappedToKey] ?: nil; mapper[mappedToKey] = propertyMeta; &#125; &#125;]; &#125; &lt;!-- * æºç ä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ˜ å°„çš„å‡½æ•°ï¼Œä½ éœ€è¦å¤å†™modelCustomPropertyMapper è¿™ä¸ªå‡½æ•° * æ˜ å°„è¿™ä¸ªå‡½æ•°ï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªNSStringçš„å­—ç¬¦ä¸²ï¼Œå‡å¦‚ä½ å¾—å­—ç¬¦ä¸²ä¸­å«æœ‰â€œ.â€è¿™ä¸ªçš„è¯ï¼Œä»–å°±ä¼šå°†è¿™ä¸ªå­—ç¬¦ä¸²ä»¥â€œ.â€åˆ†éš”æˆNSArray,ç„¶åå­˜å…¥åˆ°_mappedToKeyPath è¿™ä¸ªå˜é‡ä¸­ã€‚ * æ˜ å°„ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªNSArray,è¿™æ ·å°±å¯ä»¥å®ç°åŒä¸€ä¸ªmodelæ˜ å°„åˆ°ä¸åŒçš„keyä¸Šäº†ã€‚ --&gt;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
        <tag>Obeject-c</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ–°çš„å¼€å§‹]]></title>
    <url>%2F2016%2F03%2F28%2F20160328%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘èº«è¾¹å‘ç”Ÿäº†å¤ªå¤šå¤ªå¤šäº‹æƒ…ï¼Œè®©æˆ‘è®¤è¯†åˆ°äº†ç”Ÿå‘½æ˜¯å¤šä¹ˆçš„è„†å¼±ã€‚æ»¡æ€€æœŸæœ›ç­‰å¾…ç€ä¸€ä¸ªä»€ä¹ˆçš„åˆ°æ¥ã€å¯æƒœTaå´æ‚„æ‚„åœ°ç¦»å¼€äº†æˆ‘ä»¬ã€‚æˆ‘ç°åœ¨åªæƒ³å¥½å¥½çˆ±ç€æˆ‘èº«è¾¹è‚‰ä¸ï¼Œä¸€è¾ˆå­éƒ½å‘µæŠ¤åœ¨å¥¹èº«è¾¹ï¼Œä¸€ç›´ä¿æŠ¤å¥¹ï¼Œçˆ±æŠ¤å¥¹ï¼Œä¸è¦è®©å¥¹æ”¶åˆ°ä¸€ç‚¹ç‚¹çš„ä¼¤å®³ã€‚ ä¸ºäº†Roseã€æˆ‘äº†è¿™ä¸ªå®¶ã€ä¸ºäº†TAåˆ°æ¥ã€‚æˆ‘è¦å¥½å¥½é¼“åŠ±å·¥ä½œï¼Œç»™ä½ ä»¬æœ€å¥½çš„æœªæ¥ã€‚ 123while(!isSuccess)&#123; func keepMoving()&#125;]]></content>
      <categories>
        <category>æ—¥å¿—</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
        <tag>æˆ‘</tag>
      </tags>
  </entry>
</search>
