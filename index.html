<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Ghcoder" />





  <link rel="alternate" href="/atom.xml" title="Ghstart" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="Ghstart">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Ghstart">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ghstart">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>


  <title> Ghstart </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Ghstart</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
            menu.首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-列表">
          <a href="/archives" rel="section">
            
            menu.列表
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/28/20161028/" itemprop="url">
                  创建私有的Cocoapods
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-10-28T11:53:12+08:00" content="2016-10-28">
              2016-10-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="创建私有Cocoapods-最近一直想将自己的App模块化，就想就App拆成每个模块组件，比如：登录模块、网络模块、消息模块、用户中心模块…但是基于这些想法，我首先要先搞定私有化Cocoapods的问题，这样团队中新人，想调用的时候，就能够快速，便捷的调用了，只需要-pod-xxx"><a href="#创建私有Cocoapods-最近一直想将自己的App模块化，就想就App拆成每个模块组件，比如：登录模块、网络模块、消息模块、用户中心模块…但是基于这些想法，我首先要先搞定私有化Cocoapods的问题，这样团队中新人，想调用的时候，就能够快速，便捷的调用了，只需要-pod-xxx" class="headerlink" title="创建私有Cocoapods,最近一直想将自己的App模块化，就想就App拆成每个模块组件，比如：登录模块、网络模块、消息模块、用户中心模块…但是基于这些想法，我首先要先搞定私有化Cocoapods的问题，这样团队中新人，想调用的时候，就能够快速，便捷的调用了，只需要  pod xxx"></a>创建私有Cocoapods,最近一直想将自己的App模块化，就想就App拆成每个模块组件，比如：登录模块、网络模块、消息模块、用户中心模块…但是基于这些想法，我首先要先搞定私有化Cocoapods的问题，这样团队中新人，想调用的时候，就能够快速，便捷的调用了，只需要  <em>pod xxx</em></h3><blockquote>
<p>1.先到自己的git账号，创建一个新的仓库 ，我们取名字 <em>GH</em></p>
<p>2.开始终端，找到一个合适的位置：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~/Desktop</div></pre></td></tr></table></figure>
<blockquote>
<p>3.初始化pod</p>
</blockquote>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod <span class="class"><span class="keyword">lib</span> <span class="title">create</span> <span class="title">GH</span></span></div></pre></td></tr></table></figure>
<blockquote>
<p>4.接着系统会问一下问题，你可以自己按照项目需求来回答，也可以参照我的</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">What language <span class="keyword">do</span> you want <span class="keyword">to</span> <span class="keyword">use</span>?? [ Swift / ObjC ]</div><div class="line"> &gt; ObjC</div><div class="line"></div><div class="line">Would you <span class="keyword">like</span> <span class="keyword">to</span> <span class="keyword">include</span> a demo application <span class="keyword">with</span> your <span class="keyword">library</span>? [ Yes / <span class="keyword">No</span> ]</div><div class="line"> &gt; Yes</div><div class="line"></div><div class="line">Which testing frameworks will you <span class="keyword">use</span>? [ Specta / Kiwi / <span class="keyword">None</span> ]</div><div class="line"> &gt; <span class="keyword">None</span></div><div class="line"></div><div class="line">Would you <span class="keyword">like</span> <span class="keyword">to</span> <span class="keyword">do</span> <span class="keyword">view</span> based testing? [ Yes / <span class="keyword">No</span> ]</div><div class="line"> &gt; <span class="keyword">No</span></div><div class="line"></div><div class="line">What <span class="keyword">is</span> your <span class="keyword">class</span> prefix?</div><div class="line"> &gt; GG</div></pre></td></tr></table></figure>
<blockquote>
<p>5.修改一下pod的配置文件,pod的配置文件应该都是一样的后缀名，我这里叫 <em>Gh.podspec</em></p>
</blockquote>
<h3 id="stpes"><a href="#stpes" class="headerlink" title="stpes"></a>stpes</h3><h4 id="1-这里我先讲description的描述内容注释掉"><a href="#1-这里我先讲description的描述内容注释掉" class="headerlink" title="1.这里我先讲description的描述内容注释掉"></a>1.这里我先讲description的描述内容注释掉</h4><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#s.description      = &lt;&lt;-DESC</span></div><div class="line"><span class="meta">#TODO: Add long description of the pod here.</span></div><div class="line"><span class="meta">#                        DESC</span></div></pre></td></tr></table></figure>
<h4 id="2-修改homepage的路径，在第24行"><a href="#2-修改homepage的路径，在第24行" class="headerlink" title="2.修改homepage的路径，在第24行"></a>2.修改homepage的路径，在第24行</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s<span class="selector-class">.homepage</span>         = <span class="string">'https://github.com/Ghstart/Gh'</span></div></pre></td></tr></table></figure>
<h4 id="3-修改git的路径，在第28行"><a href="#3-修改git的路径，在第28行" class="headerlink" title="3.修改git的路径，在第28行"></a>3.修改git的路径，在第28行</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s<span class="selector-class">.source</span>           = &#123; :git =&gt; <span class="string">'https://github.com/Ghstart/Gh.gi    t'</span>, :tag =&gt; s<span class="selector-class">.version</span><span class="selector-class">.to_s</span> &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>5.保存好退出，再次进入到那个文件夹中，将文件内容提交到github上,我这里选择的是命令的方式，你也可以用github客户端</p>
</blockquote>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> Gh</div><div class="line">git init</div><div class="line">git remote <span class="built_in">add</span> origin http<span class="variable">s:</span>//github.<span class="keyword">com</span>/Ghstart/GH.git // 这个路径在你刚才新建仓库的那个页面就能找到</div><div class="line">git <span class="built_in">add</span> .</div><div class="line">git commit -<span class="keyword">m</span> <span class="string">'Gh first creats private own cocoapods'</span></div><div class="line">git <span class="keyword">tag</span> <span class="number">0.1</span>.<span class="number">0</span> // 这里的<span class="number">0.1</span>.<span class="number">0</span>在刚才的配置文件里有，对应起来就好了</div><div class="line">git push -<span class="keyword">u</span> origin master --<span class="keyword">tags</span></div></pre></td></tr></table></figure>
<blockquote>
<p>最后再去你刚才新建仓库的页面刷新一下，就会发现奇迹。。</p>
</blockquote>
<h3 id="现在开始添加自己的类"><a href="#现在开始添加自己的类" class="headerlink" title="现在开始添加自己的类"></a>现在开始添加自己的类</h3><blockquote>
<p>找到存放类的目录下，<em>/Users/</em>自己的mac名字<em>/Desktop/Gh/Gh/Classes</em>，在这个文件夹下面，你会发现一个名字叫做<em>ReplaceMe.m</em>，这个真是太贴心了，cocoapods都已经为我们想到了，在这里你先删除这个类，然后添加自己想要的类，然后在走一下下面的命令。</p>
<p>我觉得这里，你既然已经修改了内容，或者想发布第一版本，那么修改配置文件的tags修改为<em>0.1.1</em></p>
</blockquote>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m<span class="string">"add files"</span></div><div class="line">git <span class="keyword">tag</span> <span class="title">0</span>.<span class="number">1.1</span></div><div class="line">git push -u origin <span class="keyword">master</span> <span class="title">--tags</span></div></pre></td></tr></table></figure>
<blockquote>
<p>现在到自己的github页面熟悉一下，就会发现自己创建的0.1.1的版本，以及新添加的文件。下面我们需要将我们自己创建的这个cocoapods提交给cocoapods审核，并且发布。</p>
</blockquote>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pod <span class="class"><span class="keyword">lib</span> <span class="title">lint</span> <span class="title">Gh</span>.<span class="title">podspec</span> // 认证通过</span></div><div class="line">pod trunk push    /<span class="regexp">/ 提交</span></div></pre></td></tr></table></figure>
<p>大功告成！！<em>这里cocoapods是一个很关键的问题，尤其你刚跟新pod或者xcode，那问题会很多，建议出现一些奇葩的问题，可以先卸载cocoapods，然后再装最新的稳定版本。</em></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/21/20161021/" itemprop="url">
                  React-Native 实战(-)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-10-21T15:47:12+08:00" content="2016-10-21">
              2016-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="实战-React-Native-重写红狮物流App的项目。下面的的几次博客我会以完成一个现有的项目，将它整体都用React重写。项目我已经上传到github-https-github-com-Ghstart-HongshiWuliuRN"><a href="#实战-React-Native-重写红狮物流App的项目。下面的的几次博客我会以完成一个现有的项目，将它整体都用React重写。项目我已经上传到github-https-github-com-Ghstart-HongshiWuliuRN" class="headerlink" title="实战(-) React-Native 重写红狮物流App的项目。下面的的几次博客我会以完成一个现有的项目，将它整体都用React重写。项目我已经上传到github[https://github.com/Ghstart/HongshiWuliuRN]"></a>实战(-) React-Native 重写红狮物流App的项目。下面的的几次博客我会以完成一个现有的项目，将它整体都用React重写。项目我已经上传到github[<a href="https://github.com/Ghstart/HongshiWuliuRN" target="_blank" rel="external">https://github.com/Ghstart/HongshiWuliuRN</a>]</h2><h3 id="首先找到index-ios-js文件，由于我们的app的架构就是主流的tab的这种，所以我这里用到了TabBarIOS的主件，代码如下："><a href="#首先找到index-ios-js文件，由于我们的app的架构就是主流的tab的这种，所以我这里用到了TabBarIOS的主件，代码如下：" class="headerlink" title="首先找到index.ios.js文件，由于我们的app的架构就是主流的tab的这种，所以我这里用到了TabBarIOS的主件，代码如下："></a>首先找到<code>index.ios.js</code>文件，由于我们的app的架构就是主流的tab的这种，所以我这里用到了TabBarIOS的主件，代码如下：</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; from <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  AppRegistry,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View,</div><div class="line">  TabBarIOS</div><div class="line">&#125; from <span class="string">'react-native'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> Task     from <span class="string">'./ios_views/task'</span>;</div><div class="line"><span class="keyword">import</span> Goods    from <span class="string">'./ios_views/goods'</span></div><div class="line"><span class="keyword">import</span> Home     from <span class="string">'./ios_views/home'</span></div><div class="line"><span class="keyword">import</span> Message  from <span class="string">'./ios_views/message'</span></div><div class="line"><span class="keyword">import</span> Setting  from <span class="string">'./ios_views/setting'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HongshiWuLiuRN</span> <span class="title">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">    <span class="keyword">super</span>();</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.state = &#123;</div><div class="line">      selected: <span class="string">'home'</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  _renderView(moduleName) &#123;</div><div class="line">    switch (moduleName) &#123;</div><div class="line">      case <span class="string">'task'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          &lt;Task/&gt;</div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      case <span class="string">'goods'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          &lt;Goods/&gt;</div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      case <span class="string">'home'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          &lt;Home/&gt;</div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      case <span class="string">'message'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          &lt;Message/&gt;</div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      case <span class="string">'setting'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          &lt;Setting/&gt;</div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="keyword">default</span>:</div><div class="line">        <span class="keyword">return</span> ( &lt;View&gt;&lt;/View&gt; );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span>(</div><div class="line">      &lt;TabBarIOS</div><div class="line">        tintColor = <span class="string">'#e23f42'</span></div><div class="line">      &gt;</div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          title = <span class="string">"任务"</span></div><div class="line">          selected = &#123; <span class="keyword">this</span>.state.selected === <span class="string">'task'</span> &#125;</div><div class="line">          icon = &#123;require(<span class="string">'./images/mission@2x.png'</span>)&#125;</div><div class="line">          selectedIcon=&#123;require(<span class="string">'./images/mission-1@2x.png'</span>)&#125;</div><div class="line">          onPress = &#123;() =&gt; &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;</div><div class="line">              selected: <span class="string">'task'</span></div><div class="line">            &#125;)</div><div class="line">          &#125;&#125;&gt;</div><div class="line"></div><div class="line">          &#123;<span class="keyword">this</span>._renderView(<span class="keyword">this</span>.state.selected)&#125;</div><div class="line"></div><div class="line"></div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line"></div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          title = <span class="string">"货源"</span></div><div class="line">          selected = &#123; <span class="keyword">this</span>.state.selected === <span class="string">'goods'</span> &#125;</div><div class="line">          icon = &#123;require(<span class="string">'./images/goods@2x.png'</span>)&#125;</div><div class="line">          selectedIcon=&#123;require(<span class="string">'./images/goods-1@2x.png'</span>)&#125;</div><div class="line">          onPress = &#123;() =&gt; &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;</div><div class="line">              selected: <span class="string">'goods'</span></div><div class="line">            &#125;)</div><div class="line">          &#125;&#125;&gt;</div><div class="line"></div><div class="line"></div><div class="line">          &#123;<span class="keyword">this</span>._renderView(<span class="keyword">this</span>.state.selected)&#125;</div><div class="line"></div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line"></div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          title = <span class="string">"首页"</span></div><div class="line">          selected = &#123; <span class="keyword">this</span>.state.selected === <span class="string">'home'</span> &#125;</div><div class="line">          icon = &#123;require(<span class="string">'./images/home@2x.png'</span>)&#125;</div><div class="line">          selectedIcon=&#123;require(<span class="string">'./images/home-1@2x.png'</span>)&#125;</div><div class="line">          onPress = &#123;() =&gt; &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;</div><div class="line">              selected: <span class="string">'home'</span></div><div class="line">            &#125;)</div><div class="line">        &#125;&#125;&gt;</div><div class="line"></div><div class="line">          &#123;<span class="keyword">this</span>._renderView(<span class="keyword">this</span>.state.selected)&#125;</div><div class="line"></div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line"></div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          title = <span class="string">"消息"</span></div><div class="line">          selected = &#123; <span class="keyword">this</span>.state.selected === <span class="string">'message'</span> &#125;</div><div class="line">          icon = &#123;require(<span class="string">'./images/news@2x.png'</span>)&#125;</div><div class="line">          selectedIcon=&#123;require(<span class="string">'./images/news-1@2x.png'</span>)&#125;</div><div class="line">          onPress = &#123;() =&gt; &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;</div><div class="line">              selected: <span class="string">'message'</span></div><div class="line">            &#125;)</div><div class="line">          &#125;&#125;&gt;</div><div class="line"></div><div class="line">          &#123;<span class="keyword">this</span>._renderView(<span class="keyword">this</span>.state.selected)&#125;</div><div class="line"></div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line"></div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          title = <span class="string">"设置"</span></div><div class="line">          selected = &#123; <span class="keyword">this</span>.state.selected === <span class="string">'setting'</span> &#125;</div><div class="line">          icon = &#123;require(<span class="string">'./images/user@2x.png'</span>)&#125;</div><div class="line">          selectedIcon=&#123;require(<span class="string">'./images/user-1@2x.png'</span>)&#125;</div><div class="line">          onPress = &#123;() =&gt; &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;</div><div class="line">              selected: <span class="string">'setting'</span></div><div class="line">            &#125;)</div><div class="line">          &#125;&#125;&gt;</div><div class="line"></div><div class="line">          &#123;<span class="keyword">this</span>._renderView(<span class="keyword">this</span>.state.selected)&#125;</div><div class="line"></div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line">      &lt;/TabBarIOS&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">const styles = StyleSheet.create(&#123;</div><div class="line"></div><div class="line">&#125;);</div><div class="line"></div><div class="line">AppRegistry.registerComponent(<span class="string">'HongshiWuLiuRN'</span>, () =&gt; HongshiWuLiuRN);</div></pre></td></tr></table></figure>
<h3 id="首先你先不要运行，我先解释一下几点比较重要的问题："><a href="#首先你先不要运行，我先解释一下几点比较重要的问题：" class="headerlink" title="首先你先不要运行，我先解释一下几点比较重要的问题："></a>首先你先不要运行，我先解释一下几点比较重要的问题：</h3><blockquote>
<p>引入系统主件(<strong>关于系统主件，你可以直接copy就好，这里我的意见就是官方建议那种写法，你就以这种写法为主</strong>)、第三方主件、以及自己定义的主件(<strong>这里一定要理清楚自己写的主件的路径</strong>)。</p>
</blockquote>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 引入系统主件</span></div><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  AppRegistry,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View,</div><div class="line">  TabBarIOS</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div><div class="line"></div><div class="line"><span class="comment">// 引入自定义的主件</span></div><div class="line"><span class="keyword">import</span> <span class="keyword">Task</span>     <span class="keyword">from</span> <span class="string">'./ios_views/task'</span>;</div><div class="line"><span class="keyword">import</span> Goods    <span class="keyword">from</span> <span class="string">'./ios_views/goods'</span></div><div class="line"><span class="keyword">import</span> Home     <span class="keyword">from</span> <span class="string">'./ios_views/home'</span></div><div class="line"><span class="keyword">import</span> Message  <span class="keyword">from</span> <span class="string">'./ios_views/message'</span></div><div class="line"><span class="keyword">import</span> Setting  <span class="keyword">from</span> <span class="string">'./ios_views/setting'</span></div></pre></td></tr></table></figure>
<blockquote>
<p>如何定义主件,这里我目前写了两个方法，也是最常使用的两个方法：<strong>其中constructor是这个主件的实例化方法，而真正让视图渲染到屏幕上的是render的方法，你可以在这里添加想渲染上去的视图内容。</strong></p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HongshiWuLiuRN</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  constructor() &#123;</div><div class="line">    <span class="keyword">super</span>();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">	render() &#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>如何定义主件视图的样式，<strong>这里我们就需要用到stylesheet 所创创建的对象，在这里你就可以像写CSS样式一样，来定义视图了。</strong></p>
</blockquote>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">const styles</span> = StyleSheet.create(&#123;</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>如何定义应用的入口文件，<strong>就想C函数一样，需要一个main函数作为入口文件，在RN中，我需要使用AppRegistry来注册这个主件，同时也作为入口文件。</strong></p>
</blockquote>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AppRegistry.registerComponent(<span class="string">'HongshiWuLiuRN'</span>, <span class="function"><span class="params">()</span> =&gt;</span> HongshiWuLiuRN);</div></pre></td></tr></table></figure>
<blockquote>
<p>如何添加图片，你可以发现这段代码 <strong>导入图片和自定义的主件是一样，需要写清楚图片所在的路径，这里为了调试，你可以先注释到</strong>：</p>
</blockquote>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">icon</span> = &#123;require(<span class="string">'./images/news@2x.png'</span>)&#125;</div><div class="line"><span class="attr">selectedIcon</span>=&#123;require(<span class="string">'./images/news-1@2x.png'</span>)&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>整个TabBar的功能，是由<strong>TabBarIOS</strong>来实现的，具体在这里，我们可以通过设置<strong>tintColor = ‘#e23f42’</strong>可以设置TabBar点选适合的颜色，而具体的图片的样式，文字，以及点击的方法就需要在<strong>TabBarIOS.Item</strong>来进行设置,重点说一下这个这段代码：这里定义一个私有方法，传入了一个字符串类型的参数，在拿到的参数的时候，我用<strong>swich</strong>的的方法，根据传入不同的参数，返回不同的<strong>自定义的主件</strong></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="keyword">this</span>._renderView(<span class="keyword">this</span>.state.selected)&#125;</div><div class="line"></div><div class="line"> _renderView(moduleName) &#123;</div><div class="line">    <span class="keyword">switch</span> (moduleName) &#123;</div><div class="line">      <span class="keyword">case</span> <span class="string">'task'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          <span class="xml"><span class="tag">&lt;<span class="name">Task</span>/&gt;</span></span></div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">'goods'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          <span class="xml"><span class="tag">&lt;<span class="name">Goods</span>/&gt;</span></span></div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">'home'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          <span class="xml"><span class="tag">&lt;<span class="name">Home</span>/&gt;</span></span></div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">'message'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          <span class="xml"><span class="tag">&lt;<span class="name">Message</span>/&gt;</span></span></div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">'setting'</span>:</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">          <span class="xml"><span class="tag">&lt;<span class="name">Setting</span>/&gt;</span></span></div><div class="line">        );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="keyword">default</span>:</div><div class="line">        <span class="keyword">return</span> ( <span class="xml"><span class="tag">&lt;<span class="name">View</span>&gt;</span><span class="tag">&lt;/<span class="name">View</span>&gt;</span></span> );</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>这里根据自定义主件的路径，可以猜到，我在同级目录下创建一个<strong>ios_views</strong>的文件夹，在<strong>ios_views</strong>的文件下我有创建了四个js文件： <strong>goods.js</strong>、<strong>home.js</strong>、<strong>message.js</strong>、<strong>setting.js</strong>、<strong>task.js</strong>,代码如下,这个五个文件，你目前可以一样的代码，只需要修改相应的名字，就可以了：</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span> &#125; from <span class="symbol">'reac</span>t';</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  <span class="type">StyleSheet</span>,</div><div class="line">  <span class="type">View</span>,</div><div class="line">  <span class="type">NavigatorIOS</span></div><div class="line">&#125; from <span class="symbol">'react</span>-native';</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">home_views</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;<span class="type">View</span>&gt;</div><div class="line"></div><div class="line">      &lt;/<span class="type">View</span>&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">home</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span>(</div><div class="line">      &lt;<span class="type">NavigatorIOS</span></div><div class="line">          initialRoute=&#123;&#123;</div><div class="line">          component: home_views,</div><div class="line">          title: <span class="string">"红狮物流"</span>,</div><div class="line">          titleTextColor: '#fff',</div><div class="line">          barTintColor: '#e23f42',</div><div class="line">        &#125;&#125;</div><div class="line">      /&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">const styles = <span class="type">StyleSheet</span>.create(&#123;</div><div class="line"></div><div class="line">&#125;);</div><div class="line"></div><div class="line">module.exports = home</div></pre></td></tr></table></figure>
<blockquote>
<p>这里用到了<strong>NavigatorIOS</strong>的主件，这个就是强大的路由主件。你可以看到，在里面必须要定义初始路由对应于哪个主件，以及nav的背景色，title，字体颜色等等。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/24/20160824/" itemprop="url">
                  学习React Native中
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-08-24T14:53:12+08:00" content="2016-08-24">
              2016-08-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="其实从去年我就一直看学习并看React-Native-开始学习只是为了兴趣，现在项目中用到了有些更新的功能，我就是用React-native-来做的。其实还是蛮好的，但是我发现更新实在是太快了，现在官网的稳定版本是0-31版本"><a href="#其实从去年我就一直看学习并看React-Native-开始学习只是为了兴趣，现在项目中用到了有些更新的功能，我就是用React-native-来做的。其实还是蛮好的，但是我发现更新实在是太快了，现在官网的稳定版本是0-31版本" class="headerlink" title="其实从去年我就一直看学习并看React Native,开始学习只是为了兴趣，现在项目中用到了有些更新的功能，我就是用React native 来做的。其实还是蛮好的，但是我发现更新实在是太快了，现在官网的稳定版本是0.31版本"></a>其实从去年我就一直看学习并看React Native,开始学习只是为了兴趣，现在项目中用到了有些更新的功能，我就是用React native 来做的。其实还是蛮好的，但是我发现更新实在是太快了，现在官网的稳定版本是<a href="https://facebook.github.io/react-native/" target="_blank" rel="external">0.31版本</a></h2><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><blockquote>
<p>打开terminal, cd到某个路径下，执行命令 <code>react-native init helloworld</code>[^这里的helloword就是你创建的项目名字]<br>如果出现这样的代码就代码创建成功。</p>
</blockquote>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">To <span class="built_in">run</span> your app <span class="keyword">on</span> iOS:</div><div class="line">   cd /Users/gonghuan/Desktop/helloworld</div><div class="line">   react-native <span class="built_in">run</span>-ios</div><div class="line">   - <span class="keyword">or</span> -</div><div class="line">   Open /Users/gonghuan/Desktop/helloworld/ios/helloworld.xcodeproj <span class="keyword">in</span> Xcode</div><div class="line">   Hit <span class="keyword">the</span> Run button</div><div class="line">To <span class="built_in">run</span> your app <span class="keyword">on</span> Android:</div><div class="line">   Have an Android emulator <span class="built_in">running</span> (quickest way <span class="keyword">to</span> <span class="keyword">get</span> started), <span class="keyword">or</span> a device connected</div><div class="line">   cd /Users/gonghuan/Desktop/helloworld</div><div class="line">   react-native <span class="built_in">run</span>-android</div></pre></td></tr></table></figure>
<blockquote>
<p>此时你可以通过类似<code>react-native run-ios</code>可以直接调起iOS模拟器，此时你可以看到你的终端不断在解析，然后就可以成功运行了。</p>
<h2 id="说到这里，应该你已经可以运行你的app了，至于之前要安装-brew-node等等，我这里就不再多说了，你可以去官网上走一遍，很简单。"><a href="#说到这里，应该你已经可以运行你的app了，至于之前要安装-brew-node等等，我这里就不再多说了，你可以去官网上走一遍，很简单。" class="headerlink" title="说到这里，应该你已经可以运行你的app了，至于之前要安装 brew node等等，我这里就不再多说了，你可以去官网上走一遍，很简单。"></a>说到这里，应该你已经可以运行你的app了，至于之前要安装 brew node等等，我这里就不再多说了，你可以去官网上走一遍，很简单。</h2></blockquote>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><blockquote>
<p>我这里我选用的是atom，这里说一个我遇到的小问题，也许你也会遇到，在我们使用atom的时候，需要安装一些插件来帮助我们能够更加高效的写代码，就比如facebook开发的<a href="https://nuclide.io/docs/editor/setup/#quick-install" target="_blank" rel="external">Nuclide</a></p>
</blockquote>
<ol>
<li>按照官方install的说明，我们可以知道有两种安装的方式，一种就是通过直接在终端输入<code>apm install nuclide</code>,但是说实话，我就成功过一次，而且还是要挂vpn，之后就一直没有成功过了，这我就呵呵了。</li>
<li>官方建议第二种方式：直接在atom-&gt;Setting Views-&gt;Manage Packages,搜索Nuclide，直接安装。</li>
<li><p>第三种：通过这种方式你可以安装Themes、packages</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> <span class="built_in">cd</span> ~/.atom/packages</div><div class="line">git <span class="built_in">clone</span> [packgae-url] <span class="comment"># git clone https://github.com/facebook/nuclide</span></div><div class="line"><span class="built_in">cd</span> [package] <span class="comment">#nuclide</span></div><div class="line">npm install</div></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<p>###好了，到目前为止，你已经可以，我们已经可以开始运行，并且可以安装自己喜欢的插件，已经修改自己喜欢的主题了。下面我们开始coding,我们先通过atom打开我们之前创建的helloworld的项目，并且找到<code>index.ios.js</code>,删除里面所有的代码，不要着急，我们会慢慢的添加进去所有的代码。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">firstRN</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span>(</div><div class="line">      &lt;<span class="type">Text</span>&gt;</div><div class="line">        <span class="type">Hello</span> world</div><div class="line">      &lt;/<span class="type">Text</span>&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="type">AppRegistry</span>.registerComponent(<span class="symbol">'helloworl</span>d', ()=&gt;firstRN);</div></pre></td></tr></table></figure>
<ol>
<li>这里我们先创建一个firstRN的类，继承自Component对象，这里你先不要管，我们后面都会解释的。</li>
<li>第二步，我们用AppRegistry这个注册一个对象，这个对象的名字是我们应用的名字‘helloworld’，第二个参数指向的是我们刚才创建的firstRN类。</li>
<li>我们点击模拟器，发现报错，<code>Unhandled JS Exception:xxxx: Can&#39;t find variable: Component</code>,在文件头部添加</li>
</ol>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; AppRegistry, Text &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div></pre></td></tr></table></figure>
<blockquote>
<p>The AppRegistry just tells React Native which component is the root one for the whole application. You won’t be thinking about AppRegistry a lot - there will probably just be one call to AppRegistry.registerComponent in your whole app. It’s included in these examples so you can paste the whole thing into your index.ios.js or index.android.js file and get it running.—-这里是官方给的AppRegistry，其实AppRegistry只做了一件事情，就是告诉这个应用，谁是整个应用的根控制器，这样你可以通过修改index.ios.js来修改iOS的根控制器是啥？安卓也是一样，修改的index.android.js<br>再次刷新模拟器，就会发现左上角会出现我们写的Hello world的文字。<br>这里我们觉得样式好丑，那该怎么办，没事，RN也是可以做到修改的。</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span> &#125; from <span class="symbol">'reac</span>t';</div><div class="line"><span class="keyword">import</span> &#123; <span class="type">AppRegistry</span>, <span class="type">Text</span> , <span class="type">StyleSheet</span> &#125; from <span class="symbol">'react</span>-native';</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">firstRN</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span>(</div><div class="line">      &lt;<span class="type">Text</span> style = &#123;styles.helloWorldStyle&#125;&gt;</div><div class="line">        <span class="type">Hello</span> world</div><div class="line">      &lt;/<span class="type">Text</span>&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">const styles = <span class="type">StyleSheet</span>.create(&#123;</div><div class="line">  helloWorldStyle: &#123;</div><div class="line">    color:<span class="symbol">'re</span>d',</div><div class="line">    fontSize:<span class="number">30</span>,</div><div class="line">    fontWeight:<span class="symbol">'bol</span>d'</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"></div><div class="line"><span class="type">AppRegistry</span>.registerComponent(<span class="symbol">'helloworl</span>d', ()=&gt;firstRN);</div></pre></td></tr></table></figure>
<blockquote>
<p>这里我们需要在import中导读 StyleSheet,因为我们需要在后面的设置样式的时候，用到这个类。<br>直接在text后面添加style的样式熟悉<br>直接在后面创建styles的属性，通过StyleSheet来创建。<br>再次刷新模拟器，你就可以看到效果了。</p>
</blockquote>
<hr>
<h3 id="先说这么多，后期我们还会说到很多在app开发中遇到的各种问题，导航栏，网络请求，传值等等。"><a href="#先说这么多，后期我们还会说到很多在app开发中遇到的各种问题，导航栏，网络请求，传值等等。" class="headerlink" title="先说这么多，后期我们还会说到很多在app开发中遇到的各种问题，导航栏，网络请求，传值等等。"></a>先说这么多，后期我们还会说到很多在app开发中遇到的各种问题，导航栏，网络请求，传值等等。</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/15/20160815/" itemprop="url">
                  因为我不想打卡，不要问我为什么？？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-08-15T14:28:12+08:00" content="2016-08-15">
              2016-08-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###最近一直没啥时间来整理一些学习资料以及学习的内容，感觉这样不是很好。又由于公司要打卡了，所以我就写写我是怎么不打卡的吧！O(∩_∩)O~~~</p>
<ol>
<li>mac电脑先安装抓包神器：Charles (网上有很多这个使用教程，我就不多说了，毕竟是工具，没啥难度)</li>
<li>点击Help-&gt;Local IP Address,将本机的IP打印出来，然后在手机里面设置代理为相应的IP，端口为：8888</li>
<li>此时你就可以开始看到数据的返回、和请求了。</li>
</ol>
<pre><code>![1.pi](media/14712518179704/1.pic.jpg)
</code></pre><ol>
<li>然后你就可以看到你想要的代码请求了，其实这个Android和iOS,还有点不同，Android返回的代码不是text/json,而是text/html,我在我代码中加入了代码格式的转换。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">__block NSDictionary *par = @&#123;@&quot;employeeNo&quot;:pp.employeeNo,@&quot;coord&quot;:@&quot;30.249812,120.211494&quot;,@&quot;img_ids&quot;:@&quot;&quot;,@&quot;identifier&quot;: pp.identifier,@&quot;type&quot;: @&quot;0&quot;&#125;&#125;;</div><div class="line"></div><div class="line">   AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">          [manager POST:@&quot;http://xxxx/HSSCM/appmail/employeeRecordManage/sign.do&quot; parameters:par success:^(AFHTTPRequestOperation * _Nonnull operation, id  _Nonnull responseObject) &#123;</div><div class="line">              NSLog(@&quot;%@&quot;,operation);</div><div class="line">              NSLog(@&quot;%@&quot;,responseObject);</div><div class="line">          &#125; failure:^(AFHTTPRequestOperation * _Nullable operation, NSError * _Nonnull error) &#123;</div><div class="line">              NSLog(@&quot;%@&quot;,operation);</div><div class="line">              NSLog(@&quot;%@&quot;,error);</div><div class="line">          &#125;];</div></pre></td></tr></table></figure>
<ol>
<li>你或许已经发现了参数的规律了，这里的employeeNO就是我们之前抓包的用户唯一标示符（安卓这边还耍了个心眼，取了一个很怪的名字，视图误导我们）</li>
<li>coord就是经纬度，用逗号链接起来的一个字符串</li>
<li>img_ids我不知道是个什么东西，反正可有可无</li>
<li>identifior是手机的udid（iOS中这样称呼吧）,这里我猜想他的employeeNO与手机identifior是一一对应的，<strong>所以这也就解释了为什么我在换手机的时候，会报错</strong></li>
<li>type:0–就是签出，1–就是签到</li>
</ol>
<hr>
<p>##现在问题都已经分析完了，我们该用什么对策来自动帮我们打卡呢。</p>
<p>####由于必须需要内网才能打卡，我们不能外网或者4G的条件下打卡，折让我们很蛋疼，这里我想到几个解决方案：</p>
<ol>
<li>安卓的手机，可以借用一款叫做&lt;按键精灵&gt;的app,但是有个条件就是你必须拿到root权限，这样就可以录制你按键的动作，你可以指定时间执行。</li>
<li>公司的电脑、或者测试机，安装一个teamViewer，这样你就可以在家里远程操控他。</li>
<li>公司的测试机充当服务器的功能、一直在跑，这样我需要关心的只有一件事：手机有电。</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">	- (<span class="built_in">NSArray</span> *)setUPDatas:(TypeStatus)typeStatus &#123;</div><div class="line">     <span class="built_in">NSMutableArray</span> *datas = [<span class="built_in">NSMutableArray</span> new];</div><div class="line"></div><div class="line">     <span class="built_in">NSArray</span> *employeeNos = @[<span class="string">@"31330034"</span>, <span class="string">@"31330040"</span>, <span class="string">@"31330035"</span>];</div><div class="line">     <span class="built_in">NSArray</span> *identifiers = @[<span class="string">@"05B7A575-2D2A-4006-890A-D0994EFF3DAC"</span>, <span class="string">@"a000004f73cb94"</span>, <span class="string">@"1B65EB63-487B-49BF-B751-F2D544175BE7"</span>];</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; employeeNos.count ; i++) &#123;</div><div class="line">         People *people = [[People alloc] init];</div><div class="line">         people.employeeNo = employeeNos[i];</div><div class="line">         people.coord = <span class="string">@"30.249812,120.211494"</span>;</div><div class="line">         people.img_ids = <span class="string">@""</span>;</div><div class="line">         people.identifier = identifiers[i];</div><div class="line">         <span class="keyword">if</span> (typeStatus == LogIn) &#123;</div><div class="line">             people.type = <span class="string">@"1"</span>;</div><div class="line">         &#125; <span class="keyword">else</span> &#123;</div><div class="line">             people.type = <span class="string">@"0"</span>;</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         people.random_signInMin = [<span class="keyword">self</span> getRandomNumber:<span class="number">5</span> to:<span class="number">25</span>];</div><div class="line">         people.random_signInSec = [<span class="keyword">self</span> getRandomNumber:<span class="number">1</span> to:<span class="number">59</span>];</div><div class="line">         people.random_signOutMin = [<span class="keyword">self</span> getRandomNumber:<span class="number">5</span> to:<span class="number">25</span>];</div><div class="line">         people.random_signOutSec = [<span class="keyword">self</span> getRandomNumber:<span class="number">1</span> to:<span class="number">59</span>];</div><div class="line"></div><div class="line">         [datas addObject:people];</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="keyword">return</span> [datas <span class="keyword">copy</span>];</div><div class="line"> 	&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"> 	- (<span class="keyword">int</span>)getRandomNumber:(<span class="keyword">int</span>)from to:(<span class="keyword">int</span>)to &#123;</div><div class="line">     <span class="keyword">return</span> (<span class="keyword">int</span>)(from + (arc4random() % (to - from + <span class="number">1</span>)));</div><div class="line"> 	&#125;</div><div class="line"></div><div class="line"><span class="meta">#### 我在这里实例化了用户的对象，在这个对象生成的同事，就已经确定这个对象签到的时间，和签出的时间（在某个数范围内随机生成）。</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> (hour == signOutHour) &#123; <span class="comment">// 签出--0</span></div><div class="line"></div><div class="line">             <span class="keyword">if</span> (<span class="keyword">self</span>.needSignOut.count == <span class="number">0</span>) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="keyword">self</span>.needSignOut.count; i++) &#123;</div><div class="line">                 People *pp = <span class="keyword">self</span>.needSignOut[i];</div><div class="line"></div><div class="line">                 <span class="keyword">if</span> (pp.random_signOutMin &lt; min || (pp.random_signOutMin == min &amp;&amp; pp.random_signOutSec &lt;= sec)) &#123;</div><div class="line">                     par = @&#123;</div><div class="line">                             <span class="string">@"employeeNo"</span>:pp.employeeNo,</div><div class="line">                             <span class="string">@"coord"</span>: <span class="string">@"30.249812,120.211494"</span>,</div><div class="line">                             <span class="string">@"img_ids"</span>:<span class="string">@""</span>,</div><div class="line">                             <span class="string">@"identifier"</span>: pp.identifier,</div><div class="line">                             <span class="string">@"type"</span>: pp.type&#125;;</div><div class="line"></div><div class="line">                     [<span class="keyword">self</span> SignOrSignOut:par week:week time:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%ld:%ld:%ld"</span>,(<span class="keyword">long</span>)hour,(<span class="keyword">long</span>)min,(<span class="keyword">long</span>)sec]];</div><div class="line">                 &#125;</div><div class="line">             &#125;</div><div class="line">            &#125;</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)<span class="string">needToRemove:</span>(TypeStatus)status <span class="string">identifior:</span>(NSString *)identifior <span class="string">realtime:</span>(NSString *)realtime&#123;</div><div class="line"> <span class="keyword">if</span> (status == LogIn) &#123;</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; self.needSignIn.count; i++) &#123;</div><div class="line">         NSMutableDictionary *tempDic = [NSMutableDictionary <span class="keyword">new</span>];</div><div class="line">         People *pp = self.needSignIn[i];</div><div class="line">         <span class="keyword">if</span> ([pp.identifier <span class="string">isEqualToString:</span>identifior] &amp;&amp; ![identifior <span class="string">isEqualToString:</span>@<span class="string">""</span>]) &#123;</div><div class="line">             NSLog(@<span class="string">"移除people:%@---loginMin:%ld----loginSec:%ld"</span>,pp.identifier,(<span class="keyword">long</span>)pp.random_signInMin, (<span class="keyword">long</span>)pp.random_signInSec);</div><div class="line"></div><div class="line">             [self.needSignIn <span class="string">removeObject:</span>pp];</div><div class="line"></div><div class="line"></div><div class="line">             <span class="keyword">if</span> (pp.identifier != nil) [tempDic <span class="string">setObject:</span>pp.identifier <span class="string">forKey:</span>@<span class="string">"iden"</span>];</div><div class="line">             [tempDic <span class="string">setObject:</span>[NSString <span class="string">stringWithFormat:</span>@<span class="string">"签到时间:%ld:%ld:%ld"</span>, signInHour, pp.random_signInMin, pp.random_signInSec] <span class="string">forKey:</span>@<span class="string">"time"</span>];</div><div class="line">             <span class="keyword">if</span> (realtime != nil) [tempDic <span class="string">setObject:</span>realtime <span class="string">forKey:</span>@<span class="string">"realtime"</span>];</div><div class="line"></div><div class="line">             <span class="keyword">if</span> (tempDic != nil) [self.tableViewDatas <span class="string">addObject:</span>tempDic];</div><div class="line"></div><div class="line">         &#125;</div><div class="line">     &#125;</div></pre></td></tr></table></figure>
<ol>
<li>这里你会发现我在遍历的同事，又对mutableArray对象进行的操作，开始一直crash，会报这个错：<strong>collection __nsarraym was mutated while being enumerated</strong></li>
<li>意思就是说，你在遍历这个对象的同事，又对这个对象进行了添加、删除的操作。这里给你三种解决的思路。</li>
</ol>
<blockquote>
<p>1</p>
</blockquote>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (int <span class="built_in">i</span> = <span class="number">0</span> ; <span class="built_in">i</span> &lt; self.needSignIn.count; <span class="built_in">i</span>++) &#123;&#125;</div></pre></td></tr></table></figure>
<p>替换</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (People *pp <span class="keyword">in</span> <span class="keyword">self</span>.needSignIn) &#123;&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>2</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSSortDescriptor</span> *sd1 = [<span class="built_in">NSSortDescriptor</span> sortDescriptorWithKey:<span class="literal">nil</span> ascending:<span class="literal">NO</span>];<span class="comment">//yes升序排列，no,降序排列</span></div><div class="line"><span class="built_in">NSArray</span> *myary = [ary sortedArrayUsingDescriptors:[<span class="built_in">NSArray</span> arrayWithObjects:sd1, <span class="literal">nil</span>]];<span class="comment">//注意这里的ary进行排序后会生产一个新的数组指针，myary，不能在用ary,ary还是保持不变的。</span></div><div class="line"><span class="keyword">for</span> (People *pp <span class="keyword">in</span> myary) &#123;&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>3</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">生成一个零时的数组，用来遍历，之前的数据用来操作。</div></pre></td></tr></table></figure>
<p><strong>其实这里有个问题，想了好久才想明白：为什么正序排列不行，倒序就可以呢？？,为什么for不行，但是forin的可以呢？</strong></p>
<p>####其实for的语句可以等同于：假如说我有10个元素，在第一个的时候，我就remove了，那是不是到了第九个的时候就越界了呢？？</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> <span class="keyword">count</span> =  arr.<span class="keyword">count</span>; <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="keyword">count</span>;i++) &#123;&#125;</div></pre></td></tr></table></figure>
<p><strong>倒序同样的道理：</strong></p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> <span class="keyword">count</span> =  arr.<span class="keyword">count</span>;</div><div class="line"><span class="keyword">for</span> (i = <span class="keyword">count</span> - <span class="number">1</span>;i&gt;=<span class="number">0</span> ;i—) &#123;&#125;</div></pre></td></tr></table></figure>
<h4 id="当我移除当前这个的时候，其实比不影响我其他的元素布局。"><a href="#当我移除当前这个的时候，其实比不影响我其他的元素布局。" class="headerlink" title="当我移除当前这个的时候，其实比不影响我其他的元素布局。"></a>当我移除当前这个的时候，其实比不影响我其他的元素布局。</h4><p><strong>但是这两种情况，假如你使用for的语句格式，就不会有问题了</strong></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (int <span class="built_in">i</span> = <span class="number">0</span> ; <span class="built_in">i</span> &lt; self.needSignIn.count; <span class="built_in">i</span>++) &#123;&#125;</div></pre></td></tr></table></figure>
<p>###总结一句话：</p>
<ol>
<li>当我们正序遍历时,如果删除了一个,那么没有遍历到的元素位置都会往前移动一位,这样系统就无法确定接下来遍历是从删除位置开始呢,还是从删除位置下一位开始呢</li>
<li>对于逆序遍历就不会,因为我们逆序遍历时,遇到匹配的元素删除后,位置改变的是遍历过得元素,而没有遍历到的元素位置却没有改变,所以遍历能够正常进行.</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/10/20160510/" itemprop="url">
                  搭建SDK中所遇到的坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-10T09:41:12+08:00" content="2016-05-10">
              2016-05-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="其实开始之前，我找到一篇很不错的文章，想翻译的，但是google了一下，发现已经有好多人翻译过这篇文章了，这里我就不再多说什么了，把原文的链接贴出来。https-www-raywenderlich-com-65964-create-a-framework-for-ios-这里我就说一下，我在搭建sdk的时候，遇到的坑吧。"><a href="#其实开始之前，我找到一篇很不错的文章，想翻译的，但是google了一下，发现已经有好多人翻译过这篇文章了，这里我就不再多说什么了，把原文的链接贴出来。https-www-raywenderlich-com-65964-create-a-framework-for-ios-这里我就说一下，我在搭建sdk的时候，遇到的坑吧。" class="headerlink" title="其实开始之前，我找到一篇很不错的文章，想翻译的，但是google了一下，发现已经有好多人翻译过这篇文章了，这里我就不再多说什么了，把原文的链接贴出来。https://www.raywenderlich.com/65964/create-a-framework-for-ios,这里我就说一下，我在搭建sdk的时候，遇到的坑吧。"></a>其实开始之前，我找到一篇很不错的文章，想翻译的，但是google了一下，发现已经有好多人翻译过这篇文章了，这里我就不再多说什么了，把原文的链接贴出来。<a href="https://www.raywenderlich.com/65964/create-a-framework-for-ios" target="_blank" rel="external">https://www.raywenderlich.com/65964/create-a-framework-for-ios</a>,这里我就说一下，我在搭建sdk的时候，遇到的坑吧。</h2><ol>
<li>其实你要是能够走完上面的流程，你基本上已经完成了80%了，剩下的就是发现问题，再去打包。</li>
</ol>
<h3 id="第一个错误"><a href="#第一个错误" class="headerlink" title="第一个错误"></a>第一个错误</h3><p><code>*** Terminating app due to uncaught exception &#39;NSInvalidArgumentException&#39;, reason: &#39;Could not find a storyboard named &#39;XXXXname&#39; in bundle NSBundle</code></p>
<ul>
<li>这个错误可能直接就会导致app起不来，一启动就会crash，这里需要将所有你用到xib，storyboard的文件都统一作出修改。<code>其实这个问题在遇到用xib/SB创建的cell的时候、在xib/SB中添加图片的时候需要将[UIImage imageNamed:@&quot;&quot;] =======&gt; 修改为 [UIImage imageNamed:@&quot;xxxx.bundle/xxxxName&quot;]</code></li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIStoryboard</span> *main = [<span class="built_in">UIStoryboard</span> storyboardWithName:<span class="string">@"xxxxName"</span> bundle:[<span class="built_in">NSBundle</span> mainBundle]];</div><div class="line"></div><div class="line">修改为===============================</div><div class="line"></div><div class="line"><span class="built_in">UIStoryboard</span> *main = [<span class="built_in">UIStoryboard</span> storyboardWithName:<span class="string">@"xxxx.bundle/xxxxName"</span> bundle:[<span class="built_in">NSBundle</span> mainBundle]];</div></pre></td></tr></table></figure>
<h3 id="第二个错误"><a href="#第二个错误" class="headerlink" title="第二个错误"></a>第二个错误</h3><p><code>可能会在Iphone4的时候，直接无法build,直接报这个错： dyld: Symbol not found: ___NSDictionary0__</code></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">需要将项目中的<span class="keyword">build </span>Phases 中的core foundation的stastu的状态 从Required修改为Optional</div></pre></td></tr></table></figure>
<p><code>后续如果还有其他的bug，我再贴出来吧！</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/05/20160505/" itemprop="url">
                  关于学习UITableViewCell的高度计算的框架-UITableView-FDTemplateLayoutCell。
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-05-05T17:06:12+08:00" content="2016-05-05">
              2016-05-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="学习UITableView的高度计算的框架"><a href="#学习UITableView的高度计算的框架" class="headerlink" title="学习UITableView的高度计算的框架"></a>学习UITableView的高度计算的框架</h2><h2 id="这里学习的是UITableView-FDTemplateLayoutCellhttps-github-com-forkingdog-UITableView-FDTemplateLayoutCell你也可以自己去下载并且学习。"><a href="#这里学习的是UITableView-FDTemplateLayoutCellhttps-github-com-forkingdog-UITableView-FDTemplateLayoutCell你也可以自己去下载并且学习。" class="headerlink" title="这里学习的是UITableView-FDTemplateLayoutCellhttps://github.com/forkingdog/UITableView-FDTemplateLayoutCell你也可以自己去下载并且学习。"></a>这里学习的是UITableView-FDTemplateLayoutCell<a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell" target="_blank" rel="external">https://github.com/forkingdog/UITableView-FDTemplateLayoutCell</a>你也可以自己去下载并且学习。</h2><ul>
<li>他的文件很简单，直接在UITableView的高度放回中去调用方法：直接调用UITableView 中(FDTemplateLayoutCell)的category的方法,其实他的category里面一共写了三种可以计算高度的方法，这是其中的一种：</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGFloat</span>)fd_heightForCellWithIdentifier:(<span class="built_in">NSString</span> *)identifier configuration:(<span class="keyword">void</span> (^)(<span class="keyword">id</span> cell))configuration &#123;</div><div class="line">		<span class="comment">//1.</span></div><div class="line">	    <span class="keyword">if</span> (!identifier) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//2.</span></div><div class="line">    <span class="built_in">UITableViewCell</span> *templateLayoutCell = [<span class="keyword">self</span> fd_templateCellForReuseIdentifier:identifier];</div><div class="line"></div><div class="line">    <span class="comment">// Manually calls to ensure consistent behavior with actual cells. (that are displayed on screen)</span></div><div class="line">    [templateLayoutCell prepareForReuse];</div><div class="line"></div><div class="line">    <span class="comment">//8.</span></div><div class="line">    <span class="comment">// Customize and provide content for our template cell.</span></div><div class="line">    <span class="keyword">if</span> (configuration) &#123;</div><div class="line">        configuration(templateLayoutCell);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> fd_systemFittingHeightForConfiguratedCell:templateLayoutCell];</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//2.</span></div><div class="line">- (__kindof <span class="built_in">UITableViewCell</span> *)fd_templateCellForReuseIdentifier:(<span class="built_in">NSString</span> *)identifier &#123;</div><div class="line">	<span class="comment">//....</span></div><div class="line">		<span class="comment">//4.</span></div><div class="line">	    <span class="keyword">if</span> (!templateCellsByIdentifiers) &#123;</div><div class="line">        templateCellsByIdentifiers = @&#123;&#125;.mutableCopy;</div><div class="line">        objc_setAssociatedObject(<span class="keyword">self</span>, _cmd, templateCellsByIdentifiers, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    	<span class="comment">//5.</span></div><div class="line">        <span class="keyword">if</span> (!templateCell) &#123;</div><div class="line">        templateCell = [<span class="keyword">self</span> dequeueReusableCellWithIdentifier:identifier];</div><div class="line">        <span class="built_in">NSAssert</span>(templateCell != <span class="literal">nil</span>, <span class="string">@"Cell must be registered to table view for identifier - %@"</span>, identifier);</div><div class="line">        <span class="comment">//6.</span></div><div class="line">        templateCell.fd_isTemplateLayoutCell = <span class="literal">YES</span>;</div><div class="line">        templateCell.contentView.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</div><div class="line">        templateCellsByIdentifiers[identifier] = templateCell;</div><div class="line">        [<span class="keyword">self</span> fd_debugLog:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"layout cell created - %@"</span>, identifier]];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	<span class="comment">//....</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment">//3.</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Returns the value associated with a given object for a given key.</div><div class="line"> *</div><div class="line"> * @param object The source object for the association.</div><div class="line"> * @param key The key for the association.</div><div class="line"> *</div><div class="line"> * @return The value associated with the key \e key for \e object.</div><div class="line"> *</div><div class="line"> * @see objc_setAssociatedObject</div><div class="line"> */</div><div class="line">OBJC_EXPORT <span class="keyword">id</span> objc_getAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key)</div><div class="line"></div><div class="line"><span class="comment">//6.</span></div><div class="line"><span class="comment">/// Indicate this is a template layout cell for calculation only.</span></div><div class="line"><span class="comment">/// You may need this when there are non-UI side effects when configure a cell.</span></div><div class="line"><span class="comment">/// Like:</span></div><div class="line"><span class="comment">///   - (void)configureCell:(FooCell *)cell atIndexPath:(NSIndexPath *)indexPath &#123;</span></div><div class="line"><span class="comment">///       cell.entity = [self entityAtIndexPath:indexPath];</span></div><div class="line"><span class="comment">///       if (!cell.fd_isTemplateLayoutCell) &#123;</span></div><div class="line"><span class="comment">///           [self notifySomething]; // non-UI side effects</span></div><div class="line"><span class="comment">///       &#125;</span></div><div class="line"><span class="comment">///   &#125;</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> fd_isTemplateLayoutCell;</div><div class="line"></div><div class="line"><span class="comment">//7.</span></div><div class="line">- (<span class="built_in">BOOL</span>)fd_isTemplateLayoutCell &#123;</div><div class="line">    <span class="keyword">return</span> [objc_getAssociatedObject(<span class="keyword">self</span>, _cmd) boolValue];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setFd_isTemplateLayoutCell:(<span class="built_in">BOOL</span>)isTemplateLayoutCell &#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(fd_isTemplateLayoutCell), @(isTemplateLayoutCell), OBJC_ASSOCIATION_RETAIN);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>这里假如不传入identifior的值得话，他就直接直接返回0，表示不计算高度了。</li>
<li>这里根据传入的identifior的值，来找到相应的UITableViewCell</li>
<li>这里是runtime源码中所申明的，可以看到这个是根据给的Object以及给的Key来返回一个对象</li>
<li>第一次申明的话，它就会创建一个空的可变字典对象,字典的对象是{<nsstring *,="" uitableviewcell="" *="">},key是String, value是UITableViewCell。</nsstring></li>
<li>当第一次没有UITableViewCell的对象的时候，就开始在重用池中，找UITableViewCell的对象,并将UITableViewCell对象塞进之前的字典对象。</li>
<li>这边在塞入UITableViewCell对象的时候，通过category(7.)来这是这个UITableViewCell的属性，这个作者的用意就是表明这个只是用计算高度的。</li>
<li>如果需要在cell中设置cell元素中的值，就在这里设置。最后拿到UITableViewCell的对象。</li>
</ol>
<h2 id="最后将拿到的UITableViewCell的对象丢到这个函数中计算"><a href="#最后将拿到的UITableViewCell的对象丢到这个函数中计算" class="headerlink" title="最后将拿到的UITableViewCell的对象丢到这个函数中计算"></a>最后将拿到的UITableViewCell的对象丢到这个函数中计算</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (CGFloat)<span class="string">fd_systemFittingHeightForConfiguratedCell:</span>(UITableViewCell *)cell &#123;</div><div class="line">	  <span class="comment">// Auto layout engine does its math</span></div><div class="line">	  <span class="comment">// 6.</span></div><div class="line">        fittingHeight = [cell.contentView <span class="string">systemLayoutSizeFittingSize:</span>UILayoutFittingCompressedSize].height;</div><div class="line">        [cell.contentView <span class="string">removeConstraint:</span>widthFenceConstraint];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>这里首先获得这个UITableViewCell的宽度，赋值给contentViewWidth的对象。</li>
<li>下面判断这个cell中有没有设置accessoryView的这个view，如果设置了accessoryView的话，这个cell的宽度按会稍微小一点（16 + CGRectGetWidth(cell.accessoryView.frame)）</li>
<li>否则会根据accessoryView的类型不同，需要减去不同的宽度。</li>
<li>fd_enforceFrameLayout是用autolayout的、还是使用的frame的布局。</li>
<li>通过NSLayoutConstraint，将cell.contentView的宽度设置为contentViewWidth。</li>
<li><code>直接返回高度，并将约束移除掉。这里我不是很明白，为什么要这样做。</code></li>
<li>如果这里的UITableview的格式如果不是UITableViewCellSeparatorStyleNone，高度可能会有点偏差，加上这个偏差（1.0 / [UIScreen mainScreen].scale）</li>
</ol>
<p>##Demo中第二种方法，其他参数都是一样的，就是多了一个cacheByIndexPath,就是根据IndexPath的对象来存储刚才计算的高度。<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/// This method does what "-fd_heightForCellWithIdentifier:configuration" does, and</span></div><div class="line"><span class="comment">/// calculated height will be cached by its index path, returns a cached height</span></div><div class="line"><span class="comment">/// when needed. Therefore lots of extra height calculations could be saved.</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// No need to worry about invalidating cached heights when data source changes, it</span></div><div class="line"><span class="comment">/// will be done automatically when you call "-reloadData" or any method that triggers</span></div><div class="line"><span class="comment">/// UITableView's reloading.</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// @param indexPath where this cell's height cache belongs.</span></div><div class="line"><span class="comment">///</span></div><div class="line">- (<span class="built_in">CGFloat</span>)fd_heightForCellWithIdentifier:(<span class="built_in">NSString</span> *)identifier cacheByIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath configuration:(<span class="keyword">void</span> (^)(<span class="keyword">id</span> cell))configuration &#123;</div><div class="line"></div><div class="line">	    <span class="comment">// Hit cache</span></div><div class="line">	    <span class="comment">//1.</span></div><div class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.fd_indexPathHeightCache existsHeightAtIndexPath:indexPath]) &#123;</div><div class="line">        [<span class="keyword">self</span> fd_debugLog:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"hit cache by index path[%@:%@] - %@"</span>, @(indexPath.section), @(indexPath.row), @([<span class="keyword">self</span>.fd_indexPathHeightCache heightForIndexPath:indexPath])]];</div><div class="line">        <span class="keyword">return</span> [<span class="keyword">self</span>.fd_indexPathHeightCache heightForIndexPath:indexPath];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//9.</span></div><div class="line">     <span class="built_in">CGFloat</span> height = [<span class="keyword">self</span> fd_heightForCellWithIdentifier:identifier configuration:configuration];</div><div class="line">    [<span class="keyword">self</span>.fd_indexPathHeightCache cacheHeight:height byIndexPath:indexPath];</div><div class="line">    [<span class="keyword">self</span> fd_debugLog:[<span class="built_in">NSString</span> stringWithFormat: <span class="string">@"cached by index path[%@:%@] - %@"</span>, @(indexPath.section), @(indexPath.row), @(height)]];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> height;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//2.</span></div><div class="line">- (<span class="built_in">BOOL</span>)existsHeightAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">	<span class="comment">//6.</span></div><div class="line">	 <span class="built_in">NSNumber</span> *number = <span class="keyword">self</span>.heightsBySectionForCurrentOrientation[indexPath.section][indexPath.row];</div><div class="line">    <span class="keyword">return</span> ![number isEqualToNumber:@<span class="number">-1</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//3.</span></div><div class="line">- (<span class="keyword">void</span>)buildCachesAtIndexPathsIfNeeded:(<span class="built_in">NSArray</span> *)indexPaths &#123;</div><div class="line">	  [indexPaths enumerateObjectsUsingBlock:^(<span class="built_in">NSIndexPath</span> *indexPath, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> *stop) &#123;</div><div class="line">	  <span class="comment">//4.</span></div><div class="line">        [<span class="keyword">self</span> buildSectionsIfNeeded:indexPath.section];</div><div class="line">      <span class="comment">//5.</span></div><div class="line">        [<span class="keyword">self</span> buildRowsIfNeeded:indexPath.row inExistSection:indexPath.section];</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)buildSectionsIfNeeded:(<span class="built_in">NSInteger</span>)targetSection &#123;</div><div class="line">    [<span class="keyword">self</span> enumerateAllOrientationsUsingBlock:^(FDIndexPathHeightsBySection *heightsBySection) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSInteger</span> section = <span class="number">0</span>; section &lt;= targetSection; ++section) &#123;</div><div class="line">            <span class="keyword">if</span> (section &gt;= heightsBySection.count) &#123;</div><div class="line">                heightsBySection[section] = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)buildRowsIfNeeded:(<span class="built_in">NSInteger</span>)targetRow inExistSection:(<span class="built_in">NSInteger</span>)section &#123;</div><div class="line">    [<span class="keyword">self</span> enumerateAllOrientationsUsingBlock:^(FDIndexPathHeightsBySection *heightsBySection) &#123;</div><div class="line">        <span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSNumber</span> *&gt; *heightsByRow = heightsBySection[section];</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSInteger</span> row = <span class="number">0</span>; row &lt;= targetRow; ++row) &#123;</div><div class="line">            <span class="keyword">if</span> (row &gt;= heightsByRow.count) &#123;</div><div class="line">                heightsByRow[row] = @<span class="number">-1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//6.</span></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSNumber</span> *&gt; *&gt; FDIndexPathHeightsBySection;</div><div class="line"></div><div class="line"><span class="comment">//7.</span></div><div class="line">- (<span class="built_in">CGFloat</span>)heightForIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">    [<span class="keyword">self</span> buildCachesAtIndexPathsIfNeeded:@[indexPath]];</div><div class="line">    <span class="built_in">NSNumber</span> *number = <span class="keyword">self</span>.heightsBySectionForCurrentOrientation[indexPath.section][indexPath.row];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//8.</span></div><div class="line">- (FDIndexPathHeightsBySection *)heightsBySectionForCurrentOrientation &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">UIDeviceOrientationIsPortrait</span>([<span class="built_in">UIDevice</span> currentDevice].orientation) ? <span class="keyword">self</span>.heightsBySectionForPortrait: <span class="keyword">self</span>.heightsBySectionForLandscape;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>和上面方法一样的我就不说了，这里的高度缓存部分还是蛮有意思的，这里新建了一个fd_indexPathHeightCache的对象，这个对象就是用来管理缓存的部分，对象继承的是NSObject</li>
<li>通过传入的indexPath来返回这个对象是否已经缓存进去了。</li>
<li>在将indexPath的对象打包成NSArray的对象，对到下一个函数中</li>
<li>将indexPath.section,如果数组中不含有这个section的话，那就新建一个，通过6.可以知道，这个是个二位数组，最外层数组的index的数目就是section</li>
<li>下一个方法就是根据section，找到里面一层的数组，这个数组放的就是对应的rows的对象，如果没有就会默认塞入一个-1的值。</li>
<li>再根据同样的方法，到二维数组中查找对象，如果不是我们之前塞入的-1,那就是true，否则就是false。</li>
<li><code>这里我没看懂，已经知道在缓存中存在了，为什么还要再掉一遍[self buildCachesAtIndexPathsIfNeeded:@[indexPath]];</code></li>
<li>这里可以知道，作者根据横竖屏设置了两个不同的数据，就是为了分别存储、提取。</li>
<li>如果之前没有缓存的话，它会先去调用一遍之前计算高度的方法，然后将计算出来的高度，丢到之前的二维数组中去。</li>
</ol>
<p>###第三种的计算方式，就是根据每个model设置不同key值来存储高度。<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/// This method caches height by your model entity's identifier.</span></div><div class="line"><span class="comment">/// If your model's changed, call "-invalidateHeightForKey:(id &lt;NSCopying&gt;)key" to</span></div><div class="line"><span class="comment">/// invalidate cache and re-calculate, it's much cheaper and effective than "cacheByIndexPath".</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// @param key model entity's identifier whose data configures a cell.</span></div><div class="line"><span class="comment">///</span></div><div class="line">- (<span class="built_in">CGFloat</span>)fd_heightForCellWithIdentifier:(<span class="built_in">NSString</span> *)identifier cacheByKey:(<span class="keyword">id</span>&lt;<span class="built_in">NSCopying</span>&gt;)key configuration:(<span class="keyword">void</span> (^)(<span class="keyword">id</span> cell))configuration &#123;</div><div class="line">	<span class="comment">//1.</span></div><div class="line">	   <span class="comment">// Hit cache</span></div><div class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.fd_keyedHeightCache existsHeightForKey:key]) &#123;</div><div class="line">        <span class="built_in">CGFloat</span> cachedHeight = [<span class="keyword">self</span>.fd_keyedHeightCache heightForKey:key];</div><div class="line">        [<span class="keyword">self</span> fd_debugLog:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"hit cache by key[%@] - %@"</span>, key, @(cachedHeight)]];</div><div class="line">        <span class="keyword">return</span> cachedHeight;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//2.</span></div><div class="line">    <span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span>&lt;<span class="keyword">id</span>&lt;<span class="built_in">NSCopying</span>&gt;, <span class="built_in">NSNumber</span> *&gt; *mutableHeightsByKeyForPortrait;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>作者也说了，这个效率会比之前按照indexPath的计算效率要高。</li>
<li>通过这个，我们大概就知道，作者所谓的效率高，应该就是这个意思，这里不是什么二维数组，而是一个NSMutableDictionary对象。其他基本上类似。</li>
</ol>
<p><code>最后说一下自己的一个疑问：第二种方法中，作者为什么不将key和value经过简单的运算，作为key，来用NSDictionary来存储数据呢？作者的解释是：里面要配合 section row 的insert remove的话，会比较麻烦。所以作者最后还是选择的二维数组。</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/19/20160418/" itemprop="url">
                  关于图片圆角的功能学习。
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-04-19T11:12:12+08:00" content="2016-04-19">
              2016-04-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###图片的性能问题，基本上面试的时候，都会被问到，现在在自己的app中，我也是为了解决的性能的问题，所以了解了一些关于图片性能的库，看一下源码, 现在应该有很多这种库了。我看的是这个：<a href="https://github.com/CoderJackyHuang/HYBImageCliped" target="_blank" rel="external">https://github.com/CoderJackyHuang/HYBImageCliped</a></p>
<ul>
<li>这个库是通过Category来分别实现这些功能，首先看看UIView的Category,是怎么实现的UIView的圆角。</li>
</ul>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> *	使用指定的图片来填充，但是生成的是圆形图片，背景颜色为白色。</div><div class="line"> *</div><div class="line"> *	<span class="doctag">@param</span> image			图片名称或者图片对象，甚至支持NSData</div><div class="line"> *	<span class="doctag">@param</span> targetSize	生成指定大小的图片</div><div class="line"> *	<span class="doctag">@param</span> isEqualScale	是否等比例缩放图片</div><div class="line"> *  <span class="doctag">@param</span> backgroundColor 默认取最顶层父视图的背景色，若为透明，则取本身背景色，若也为透明，则取白色</div><div class="line"> *  <span class="doctag">@parma</span> callback   只有当图片真正被裁剪成功后，才会回调，返回裁剪后的图片</div><div class="line"> *</div><div class="line"> *	<span class="doctag">@return</span> 裁剪前的图片</div><div class="line"> */</div><div class="line"></div><div class="line">- (UIImage *)hyb_setCircleImage:(id)image</div><div class="line">                           size:(CGSize)targetSize</div><div class="line">                   isEqualScale:(<span class="keyword">BOOL</span>)isEqualScale</div><div class="line">                 backgrounColor:(UIColor *)backgroundColor</div><div class="line">                       onCliped:(HYBClipedCallback)callback;</div></pre></td></tr></table></figure>
<ul>
<li>这只是其中一种Public的方法，我是按照Demo来看的。但是无论哪一种Public的方法，最终调用的都是统一的一个Private 的方法。</li>
</ul>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- <span class="params">(UIImage *)</span>hyb_private_setImage:<span class="params">(id)</span>image</div><div class="line">                             size:<span class="params">(CGSize)</span>targetSize</div><div class="line">                     cornerRadius:<span class="params">(CGFloat)</span>cornerRadius</div><div class="line">                      rectCorener:<span class="params">(UIRectCorner)</span>rectCorner</div><div class="line">                  backgroundColor:<span class="params">(UIColor *)</span>bgColor</div><div class="line">                     isEqualScale:<span class="params">(BOOL)</span>isEqualScale</div><div class="line">                         isCircle:<span class="params">(BOOL)</span>isCircle</div><div class="line">                         onCliped:<span class="params">(HYBClipedCallback)</span>callback</div></pre></td></tr></table></figure>
<ul>
<li><p>里面有个这个方法：可以看出来，假如你不设置bgColor这个属性的话，他会遍历循环，一直会找到最顶层的父类，去除父类的颜色。<code>所以我觉得你要是没事话，还是自己设置一下颜色吧！这边假如层级很复杂，并且元素很多的话，这个性能可能会让你哭吧...</code></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">if</span> (bgColor == <span class="literal">nil</span> || <span class="built_in">CGColorEqualToColor</span>(bgColor.CGColor, [<span class="built_in">UIColor</span> clearColor].CGColor)) &#123;</div><div class="line">  <span class="built_in">UIView</span> *superview = <span class="keyword">self</span>.superview;</div><div class="line">  <span class="keyword">while</span> (superview.backgroundColor == <span class="literal">nil</span> || <span class="built_in">CGColorEqualToColor</span>(superview.backgroundColor.CGColor, [<span class="built_in">UIColor</span> clearColor].CGColor)) &#123;</div><div class="line">    <span class="keyword">if</span> (!superview) &#123;</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    superview = [superview superview];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  bgColor = superview.backgroundColor;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>好吧，下面这段代码又要提到面试宝典中啥经典话题了，<code>如何在category中给现有的类添加属性呢？</code><br><a href="http://nshipster.com/associated-objects/" target="_blank" rel="external">http://nshipster.com/associated-objects/</a>Matt 大神曾经写过，你可以看一下。</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">__block <span class="built_in">UIImage</span> *clipedImage = <span class="literal">nil</span>;</div><div class="line">	<span class="comment">//1.</span></div><div class="line">  <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</div><div class="line">  <span class="comment">//2.</span></div><div class="line">    willBeClipedImage.hyb_pathColor = <span class="keyword">self</span>.hyb_pathColor;</div><div class="line">    willBeClipedImage.hyb_pathWidth = <span class="keyword">self</span>.hyb_pathWidth;</div><div class="line">    willBeClipedImage.hyb_borderColor = <span class="keyword">self</span>.hyb_borderColor;</div><div class="line">    willBeClipedImage.hyb_borderWidth = <span class="keyword">self</span>.hyb_borderWidth;</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">这里涉及到的pathColor,pathWidth,borderColor,borderWidth,都是通过在runtime的特性，在已有的类中添加属性的方式来存储和使用的。</div><div class="line">- (<span class="built_in">UIColor</span> *)hyb_pathColor &#123;</div><div class="line">  <span class="built_in">UIColor</span> *color = objc_getAssociatedObject(<span class="keyword">self</span>, s_hyb_image_pathColorKey);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (color) &#123;</div><div class="line">    <span class="keyword">return</span> color;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> [<span class="built_in">UIColor</span> whiteColor];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//...下面都是换汤不换药的。</span></div></pre></td></tr></table></figure>
<p><code>下面涉及到真正的画图部分了</code></p>
<ol>
<li>这里另起一个线程来绘制圆角。这里我有个问题：<code>每个图片都创建一个线程，这个是不是有点问题。而且这个dispatch_get_global_queue也有问题，Global Dispatch Queue创建的队列,其线程数目是不定的,是根据XNU内核决定的。我觉得这一点，源码中没有解释。</code></li>
</ol>
<ul>
<li>绘制圆角的核心函数是这个。</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//1.</span></div><div class="line">- (<span class="built_in">UIImage</span> *)hyb_private_clipImageToSize:(<span class="built_in">CGSize</span>)targetSize</div><div class="line">                            cornerRadius:(<span class="built_in">CGFloat</span>)cornerRadius</div><div class="line">                                 corners:(<span class="built_in">UIRectCorner</span>)corners</div><div class="line">                         backgroundColor:(<span class="built_in">UIColor</span> *)backgroundColor</div><div class="line">                            isEqualScale:(<span class="built_in">BOOL</span>)isEqualScale</div><div class="line">                                isCircle:(<span class="built_in">BOOL</span>)isCircle &#123;&#125;</div><div class="line"></div><div class="line">                                <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//2.</span></div><div class="line">    <span class="keyword">if</span> (isCircle) &#123;</div><div class="line">      <span class="built_in">CGContextAddEllipseInRect</span>(ctx, rect);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="built_in">CGContextAddRect</span>(ctx, rect);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">CGContextClip</span>(ctx);</div><div class="line">    [<span class="keyword">self</span> drawInRect:rectImage];</div><div class="line"></div><div class="line">    <span class="comment">//3.</span></div><div class="line"></div><div class="line">        <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [borderColor <span class="built_in">CGColor</span>]);</div><div class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, borderWidth);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (isCircle) &#123;</div><div class="line">      <span class="built_in">CGContextStrokeEllipseInRect</span>(ctx, rectImage);</div><div class="line">      <span class="built_in">CGContextStrokeEllipseInRect</span>(ctx, rect);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cornerRadius == <span class="number">0</span>) &#123;</div><div class="line">      <span class="built_in">CGContextStrokeRect</span>(ctx, rectImage);</div><div class="line">      <span class="built_in">CGContextStrokeRect</span>(ctx, rect);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//4.</span></div><div class="line">     <span class="built_in">UIBezierPath</span> *path2 = [<span class="built_in">UIBezierPath</span> bezierPathWithRoundedRect:rect</div><div class="line">                                                byRoundingCorners:corners</div><div class="line">                                                      cornerRadii:<span class="built_in">CGSizeMake</span>(cornerRadius + minusPath1 ,cornerRadius + minusPath1)];</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//5.</span></div><div class="line">    <span class="built_in">UIImage</span> *finalImage = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</div><div class="line"></div><div class="line">    <span class="keyword">return</span> finalImage;</div></pre></td></tr></table></figure>
<ol>
<li>里面更新size做了一些文章。是到底要做截成一个正圆，还是只截在哪个角的圆。</li>
<li>如果是正圆、并且不带圆角的话，就用core graphic来画。</li>
<li>内线和外线的绘制、以及粗细、颜色。</li>
<li><p>如果不是正圆、带圆角的多边形的图形，用UIBezierPath 曲线来绘制。关键是第二个参数，是一个枚举类型，代表哪一个或者哪一些圆角需要绘制、苹果官方的文档为<code>corners:
A bitmask value that identifies the corners that you want rounded. You can use this parameter to round only a subset of the corners of the rectangle.</code></p>
</li>
<li><p>最后直接将绘制的图形返回出来。</p>
</li>
<li>最后说一点、无论是UIbutton、UIImage、还是什么、笔者的思路都是先在UIView中添加方法、再在UIImage添加方法、并且进行调用、绘制图形，并且返回。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/01/20160401/" itemprop="url">
                  学习YYModel
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-04-01T14:28:12+08:00" content="2016-04-01">
              2016-04-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以YYModel的例子，它以类的方式调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)yy_modelWithJSON:(id)json &#123;</div><div class="line">    NSDictionary *dic = [self _yy_dictionaryWithJSON:json];</div><div class="line">    return [self yy_modelWithDictionary:dic];</div><div class="line">&#125;</div><div class="line"></div><div class="line">&lt;!-- 1. 直接将json的格式丢给这个函数 --&gt;</div><div class="line">&lt;!-- 2. 然后调用下面的这个函数，主要是讲这个json转化为NSDictionary的格式，如果是字符串会将字符串转化为NSData,然后再转化为NSDictionary --&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (NSDictionary *)_yy_dictionaryWithJSON:(id)json &#123;</div></pre></td></tr></table></figure>
<ul>
<li>现在开始进入最重要的函数部分了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//这个函数里获取model元是通过调用下面的方法，cls是获取本类而得到的Class类型</div><div class="line">+ (instancetype)yy_modelWithDictionary:(NSDictionary *)dictionary &#123;&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[_YYModelMeta metaWithClass:cls]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)metaWithClass:(Class)cls &#123;</div><div class="line">    if (!cls) return nil;</div><div class="line">    static CFMutableDictionaryRef cache;</div><div class="line">    static dispatch_once_t onceToken;</div><div class="line">    //1..</div><div class="line">    static dispatch_semaphore_t lock;</div><div class="line">    dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">        cache = CFDictionaryCreateMutable(CFAllocatorGetDefault(), 0, &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);</div><div class="line">        lock = dispatch_semaphore_create(1);</div><div class="line">    &#125;);</div><div class="line">    dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER);</div><div class="line">    _YYModelMeta *meta = CFDictionaryGetValue(cache, (__bridge const void *)(cls));</div><div class="line">    dispatch_semaphore_signal(lock);</div><div class="line">    if (!meta || meta-&gt;_classInfo.needUpdate) &#123;</div><div class="line">        meta = [[_YYModelMeta alloc] initWithClass:cls];</div><div class="line">        if (meta) &#123;</div><div class="line">            dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER);</div><div class="line">            CFDictionarySetValue(cache, (__bridge const void *)(cls), (__bridge const void *)(meta));</div><div class="line">            dispatch_semaphore_signal(lock);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return meta;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;!-- //以信号量的方式保持同步，作用是为了从cache的内存中获取meta的数据是同步的。 --&gt;</div><div class="line">dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER);</div><div class="line">   _YYModelMeta *meta = CFDictionaryGetValue(cache, (__bridge const void *)(cls));</div><div class="line">   dispatch_semaphore_signal(lock);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;!-- //或者在讲meta的值塞入内存中保持同步 --&gt;</div><div class="line">	    if (!meta || meta-&gt;_classInfo.needUpdate) &#123;</div><div class="line">       meta = [[_YYModelMeta alloc] initWithClass:cls];</div><div class="line">       if (meta) &#123;</div><div class="line">           dispatch_semaphore_wait(lock, DISPATCH_TIME_FOREVER);</div><div class="line">           CFDictionarySetValue(cache, (__bridge const void *)(cls), (__bridge const void *)(meta));</div><div class="line">           dispatch_semaphore_signal(lock);</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 其中创建meta的时候回调用 --&gt;</div><div class="line">meta = [[_YYModelMeta alloc] initWithClass:cls];</div><div class="line"></div><div class="line">- (instancetype)initWithClass:(Class)cls &#123;</div><div class="line">   YYClassInfo *classInfo = [YYClassInfo classInfoWithClass:cls];</div><div class="line"> 	.....  </div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> &lt;!-- 这里涉及到YYClassInfo的实例化方法,通过runtime的一些方法，找到本类，父类，元类。 --&gt;</div><div class="line"> - (instancetype)initWithClass:(Class)cls &#123;</div><div class="line">    if (!cls) return nil;</div><div class="line">    self = [super init];</div><div class="line">    _cls = cls;</div><div class="line">    _superCls = class_getSuperclass(cls);</div><div class="line">    _isMeta = class_isMetaClass(cls);</div><div class="line">    if (!_isMeta) &#123;</div><div class="line">        _metaCls = objc_getMetaClass(class_getName(cls));</div><div class="line">    &#125;</div><div class="line">    _name = NSStringFromClass(cls);</div><div class="line">    [self _update];</div><div class="line"></div><div class="line">    _superClassInfo = [self.class classInfoWithClass:_superCls];</div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>然后在_update的方法中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 这里讲model中的方法、属性，ivar以key-value的形式存放在字典中。本类调用完后会在父类中调用再调用一遍。 --&gt;</div><div class="line">  Class cls = self.cls;</div><div class="line">    unsigned int methodCount = 0;</div><div class="line">    Method *methods = class_copyMethodList(cls, &amp;methodCount);</div><div class="line">    if (methods) &#123;</div><div class="line">        NSMutableDictionary *methodInfos = [NSMutableDictionary new];</div><div class="line">        _methodInfos = methodInfos;</div><div class="line">        for (unsigned int i = 0; i &lt; methodCount; i++) &#123;</div><div class="line">            YYClassMethodInfo *info = [[YYClassMethodInfo alloc] initWithMethod:methods[i]];</div><div class="line">            if (info.name) methodInfos[info.name] = info;</div><div class="line">        &#125;</div><div class="line">        free(methods);</div><div class="line">    &#125;</div><div class="line">    unsigned int propertyCount = 0;</div><div class="line">    objc_property_t *properties = class_copyPropertyList(cls, &amp;propertyCount);</div><div class="line">    if (properties) &#123;</div><div class="line">        NSMutableDictionary *propertyInfos = [NSMutableDictionary new];</div><div class="line">        _propertyInfos = propertyInfos;</div><div class="line">        for (unsigned int i = 0; i &lt; propertyCount; i++) &#123;</div><div class="line">            YYClassPropertyInfo *info = [[YYClassPropertyInfo alloc] initWithProperty:properties[i]];</div><div class="line">            if (info.name) propertyInfos[info.name] = info;</div><div class="line">        &#125;</div><div class="line">        free(properties);</div><div class="line">    &#125;</div><div class="line">....</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">&lt;!-- * 最最关键的映射来了，YYModel把这个功能用一个递归函数来实现了。 --&gt;</div><div class="line">// create mapper</div><div class="line">   NSMutableDictionary *mapper = [NSMutableDictionary new];</div><div class="line">   NSMutableArray *keyPathPropertyMetas = [NSMutableArray new];</div><div class="line">   NSMutableArray *multiKeysPropertyMetas = [NSMutableArray new];</div><div class="line"></div><div class="line">   if ([cls respondsToSelector:@selector(modelCustomPropertyMapper)]) &#123;</div><div class="line">       NSDictionary *customMapper = [(id &lt;YYModel&gt;)cls modelCustomPropertyMapper];</div><div class="line">       [customMapper enumerateKeysAndObjectsUsingBlock:^(NSString *propertyName, NSString *mappedToKey, BOOL *stop) &#123;</div><div class="line">           _YYModelPropertyMeta *propertyMeta = allPropertyMetas[propertyName];</div><div class="line">           if (!propertyMeta) return;</div><div class="line">           [allPropertyMetas removeObjectForKey:propertyName];</div><div class="line"></div><div class="line">           if ([mappedToKey isKindOfClass:[NSString class]]) &#123;</div><div class="line">               if (mappedToKey.length == 0) return;</div><div class="line"></div><div class="line">               propertyMeta-&gt;_mappedToKey = mappedToKey;</div><div class="line">               NSArray *keyPath = [mappedToKey componentsSeparatedByString:@&quot;.&quot;];</div><div class="line">               if (keyPath.count &gt; 1) &#123;</div><div class="line">                   propertyMeta-&gt;_mappedToKeyPath = keyPath;</div><div class="line">                   [keyPathPropertyMetas addObject:propertyMeta];</div><div class="line">               &#125;</div><div class="line">               propertyMeta-&gt;_next = mapper[mappedToKey] ?: nil;</div><div class="line">               mapper[mappedToKey] = propertyMeta;</div><div class="line"></div><div class="line">           &#125; else if ([mappedToKey isKindOfClass:[NSArray class]]) &#123;</div><div class="line"></div><div class="line">               NSMutableArray *mappedToKeyArray = [NSMutableArray new];</div><div class="line">               for (NSString *oneKey in ((NSArray *)mappedToKey)) &#123;</div><div class="line">                   if (![oneKey isKindOfClass:[NSString class]]) continue;</div><div class="line">                   if (oneKey.length == 0) continue;</div><div class="line"></div><div class="line">                   NSArray *keyPath = [oneKey componentsSeparatedByString:@&quot;.&quot;];</div><div class="line">                   if (keyPath.count &gt; 1) &#123;</div><div class="line">                       [mappedToKeyArray addObject:keyPath];</div><div class="line">                   &#125; else &#123;</div><div class="line">                       [mappedToKeyArray addObject:oneKey];</div><div class="line">                   &#125;</div><div class="line"></div><div class="line">                   if (!propertyMeta-&gt;_mappedToKey) &#123;</div><div class="line">                       propertyMeta-&gt;_mappedToKey = oneKey;</div><div class="line">                       propertyMeta-&gt;_mappedToKeyPath = keyPath.count &gt; 1 ? keyPath : nil;</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">               if (!propertyMeta-&gt;_mappedToKey) return;</div><div class="line"></div><div class="line">               propertyMeta-&gt;_mappedToKeyArray = mappedToKeyArray;</div><div class="line">               [multiKeysPropertyMetas addObject:propertyMeta];</div><div class="line"></div><div class="line">               propertyMeta-&gt;_next = mapper[mappedToKey] ?: nil;</div><div class="line">               mapper[mappedToKey] = propertyMeta;</div><div class="line">           &#125;</div><div class="line">       &#125;];</div><div class="line">   &#125;</div><div class="line"></div><div class="line"></div><div class="line">   &lt;!-- * 源码中就可以看出，这个映射的函数，你需要复写modelCustomPropertyMapper 这个函数</div><div class="line">   * 映射这个函数，你可以定义一个NSString的字符串，假如你得字符串中含有“.”这个的话，他就会将这个字符串以“.”分隔成NSArray,然后存入到_mappedToKeyPath 这个变量中。</div><div class="line">   * 映射也可以是一个NSArray,这样就可以实现同一个model映射到不同的key上了。 --&gt;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/28/20160328/" itemprop="url">
                  新的开始
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-03-28T14:28:12+08:00" content="2016-03-28">
              2016-03-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/日志/" itemprop="url" rel="index">
                    <span itemprop="name">日志</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近身边发生了太多太多事情，让我认识到了生命是多么的脆弱。满怀期望等待着一个什么的到来、可惜Ta却悄悄地离开了我们。我现在只想好好爱着我身边肉丝，一辈子都呵护在她身边，一直保护她，爱护她，不要让她收到一点点的伤害。 为了Rose、我了这个家、为了TA到来。我要好好鼓励工作，给你们最好的未来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">while(!isSuccess)&#123;</div><div class="line">    func keepMoving()</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Ghstart" />
          <p class="site-author-name" itemprop="name">Ghstart</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ghstart</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  

  

  

  

  


</body>
</html>
