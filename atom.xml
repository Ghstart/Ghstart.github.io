<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Ghcoder</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.ghcoder.com/"/>
  <updated>2019-01-26T03:15:10.202Z</updated>
  <id>http://www.ghcoder.com/</id>
  
  <author>
    <name>Ghcoder</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Appä¸»é¢˜åˆ‡æ¢åŠŸèƒ½&amp;èµ„æºç®¡ç†åŠŸèƒ½</title>
    <link href="http://www.ghcoder.com/2019/01/26/20190126/"/>
    <id>http://www.ghcoder.com/2019/01/26/20190126/</id>
    <published>2019-01-26T11:28:12.000Z</published>
    <updated>2019-01-26T03:15:10.202Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸»é¢˜çš®è‚¤åˆ‡æ¢æ¨¡å—"><a href="#ä¸»é¢˜çš®è‚¤åˆ‡æ¢æ¨¡å—" class="headerlink" title="ä¸»é¢˜çš®è‚¤åˆ‡æ¢æ¨¡å—"></a>ä¸»é¢˜çš®è‚¤åˆ‡æ¢æ¨¡å—</h2><h3 id="GCTThemeé…ç½®ç¯‡"><a href="#GCTThemeé…ç½®ç¯‡" class="headerlink" title="GCTThemeé…ç½®ç¯‡"></a>GCTThemeé…ç½®ç¯‡</h3><ul><li>è°ƒç”¨<code>GCTThemeManager</code>ä¹‹å‰éœ€è¦æ³¨å†Œé…ç½®æ•°æ®, è°ƒç”¨çš„æ—¶æœºç›®å‰æ˜¯åœ¨<code>didFinishLaunchingWithOptions</code>çš„æ—¶å€™ ï¼ˆè¿™ä¸ªåæœŸå¯ä»¥ä¿®æ”¹ï¼ï¼ï¼‰</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. GCTThemeSwitchObject æ§åˆ¶å¼€å…³çš„ç±»ï¼Œçµæ´»æ§åˆ¶å¼€å…³å°±å¯ä»¥é…ç½®è¿™ä¸ªç±» ï¼ˆé¢å‘åè®®ï¼‰</span></span><br><span class="line">GCTThemeSwitchObject *switchObj = [GCTThemeSwitchObject <span class="keyword">new</span>];</span><br><span class="line">[switchObj <span class="string">setGCTThemeSwitch:</span>YES];</span><br><span class="line"><span class="comment">// 2. GCTThemeData æ•°æ®æºçš„ç±»ï¼Œç›®å‰åªè¯»å–æœ¬åœ°æ•°æ®ï¼ŒåæœŸè¿œç¨‹æ•°æ®åªéœ€è¦é…ç½®å®ƒï¼ˆé¢å‘åè®®ï¼‰</span></span><br><span class="line">[[GCTThemeManager <span class="string">sharedInstanceWithThemeData:</span>[GCTThemeData <span class="keyword">new</span>]] <span class="string">switchBaseOn:</span>switchObj];</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="GCTThemeä½¿ç”¨ç¯‡"><a href="#GCTThemeä½¿ç”¨ç¯‡" class="headerlink" title="GCTThemeä½¿ç”¨ç¯‡"></a>GCTThemeä½¿ç”¨ç¯‡</h3><ul><li>æ–¹æ³•1ï¼šå¦‚æœè¦ä¿®æ”¹çš„æ§ä»¶æ˜¯<strong>UIViewæˆ–è€…æ˜¯å®ƒçš„å­ç±»</strong>å¹¶ä¸”è¿™ä¸ª<strong>UIViewä¸ç­‰äºnil</strong>ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨æ–¹æ³•</li><li><strong>ï¼ï¼è¿™é‡Œçš„GCTThemeModuleTypeså·²ç»ä¸å†éœ€è¦ï¼Œå› ä¸ºGCT.Rå¯ä»¥è‡ªå·±ç”Ÿæˆç›¸åº”çš„ç±»ã€å±æ€§</strong></li></ul><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"> (void)<span class="symbol">configSkinWithModule:</span>(GCTThemeModuleTypes)<span class="class"><span class="keyword">module</span> <span class="title">skinDatas</span>:(<span class="title">NSDictionary</span>&lt;NSString *, <span class="title">NSString</span> *&gt; *)<span class="title">skinDatas</span>;</span></span></span><br></pre></td></tr></table></figure><ul><li>æ–¹æ³•2ï¼šå¦‚æœä¸Šé¢çš„æ¡ä»¶æœ‰å…¶ä¸­ä¸€ä¸ªä¸æ»¡è¶³ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨å•ä¾‹<code>GCTThemeManager</code></li><li><strong>ï¼ï¼è¿™é‡Œçš„GCTThemeModuleTypeså·²ç»ä¸å†éœ€è¦ï¼Œå› ä¸ºGCT.Rå¯ä»¥è‡ªå·±ç”Ÿæˆç›¸åº”çš„ç±»ã€å±æ€§</strong></li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éœ€è¦é…ç½®çš®è‚¤æ›¿æ¢åŠŸèƒ½çš„ï¼Œå›¾ç‰‡è·å–éœ€è¦ 1. moduleName  2. imgKey</span></span><br><span class="line"><span class="selector-tag">-</span> (UIImage *)<span class="selector-tag">getImageByKey</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-tag">imgKey</span> <span class="selector-tag">from</span><span class="selector-pseudo">:(GCTThemeModuleTypes)module</span>;</span><br><span class="line"><span class="selector-tag">-</span> (NSString *)<span class="selector-tag">getImageNameByKey</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-tag">imgKey</span> <span class="selector-tag">from</span><span class="selector-pseudo">:(GCTThemeModuleTypes)module</span>;</span><br><span class="line"><span class="comment">// éœ€è¦é…ç½®çš®è‚¤æ›¿æ¢åŠŸèƒ½çš„ï¼Œé¢œè‰²è·å–éœ€è¦ 1. moduleName  2. colorKey</span></span><br><span class="line"><span class="selector-tag">-</span> (UIColor *)<span class="selector-tag">getColorByKey</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-tag">colorKey</span> <span class="selector-tag">from</span><span class="selector-pseudo">:(GCTThemeModuleTypes)module</span>;</span><br><span class="line"><span class="comment">// éœ€è¦é…ç½®çš®è‚¤æ›¿æ¢åŠŸèƒ½çš„ï¼Œæ–‡å­—è·å–éœ€è¦ 1. moduleName  2. titleKey</span></span><br><span class="line"><span class="selector-tag">-</span> (NSString *)<span class="selector-tag">getTitleByKey</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-tag">titleKey</span> <span class="selector-tag">from</span><span class="selector-pseudo">:(GCTThemeModuleTypes)module</span>;</span><br></pre></td></tr></table></figure><h4 id="å®é™…ä½¿ç”¨æƒ…å†µ"><a href="#å®é™…ä½¿ç”¨æƒ…å†µ" class="headerlink" title="å®é™…ä½¿ç”¨æƒ…å†µ"></a>å®é™…ä½¿ç”¨æƒ…å†µ</h4><ul><li>ç›´æ¥é…ç½®TabBarControllerå›¾ç‰‡ã€æ–‡å­—ã€‚ã€<strong>å› ä¸ºtabBarItemé»˜è®¤æ˜¯æ‡’åŠ è½½çš„ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡GCTThemeManagerå»å®ç°</strong>ã€‘</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">navController.tabBarItem.title = [[GCTThemeManager sharedInstance] <span class="string">getTitleByKey:</span>model.titleKey <span class="string">from:</span>GCTThemeModuleTypeHomeTabbar];</span><br><span class="line">navController.tabBarItem.image = [UIImage <span class="string">imageMakeWithName:</span>model.imageName <span class="string">type:</span>@<span class="string">"png"</span>];</span><br><span class="line">NSString *imageName = [[GCTThemeManager sharedInstance] <span class="string">getImageNameByKey:</span>model.imageSelectedKey <span class="string">from:</span>GCTThemeModuleTypeHomeTabbar];</span><br><span class="line">navController.tabBarItem.selectedImage = [[UIImage <span class="string">imageMakeWithName:</span>imageName <span class="string">type:</span>@<span class="string">"png"</span>] <span class="string">imageWithRenderingMode:</span>UIImageRenderingModeAlwaysOriginal];</span><br></pre></td></tr></table></figure><ul><li><ol><li><strong>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„æ˜¯èƒŒæ™¯è‰²</strong>ã€‚ 2. <strong>åœ¨æ˜¥èŠ‚çš®è‚¤çš„é…ç½®ä¸‹ä½¿ç”¨çš„æ˜¯å›¾ç‰‡</strong> ã€è¿™é‡Œå¯ä»¥ä»¥æ­¤ç±»æ¨ï¼ŒæŸç§çš®è‚¤ä¸‹é¢ä½¿ç”¨çš„å±æ€§1ï¼Œåœ¨å¦ä¸€ç§çš®è‚¤ä¸‹ä½¿ç”¨çš„æ˜¯å±æ€§2ï¼Œå› ä¸ºå½“æ‰¾ä¸åˆ°å¯¹åº”çš„å±æ€§å€¼çš„æ—¶å€™è¿”å›nilï¼Œä¹Ÿå°±æ˜¯ä¸å®ç°ã€‘</li></ol></li></ul><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self.tipsView.homeBG.image = [[GCTThemeManager <span class="keyword">sharedInstance] </span>getImageByKey:@<span class="string">"home_wifi_scaning_unconnected"</span> from:GCTThemeModuleTypeHomeWifi]<span class="comment">;</span></span><br><span class="line">self.<span class="keyword">backgroundColor </span>= [[GCTThemeManager <span class="keyword">sharedInstance] </span>getColorByKey:@<span class="string">"home_wifi_found_scaning"</span> from:GCTThemeModuleTypeHomeWifi]<span class="comment">;</span></span><br></pre></td></tr></table></figure><h3 id="GCTThemeåŸç†ç¯‡"><a href="#GCTThemeåŸç†ç¯‡" class="headerlink" title="GCTThemeåŸç†ç¯‡"></a>GCTThemeåŸç†ç¯‡</h3><ul><li>GCTThemeSwitchObjectéµå¾ªçš„åè®®</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">GCTThemeSwitchProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setGCTThemeSwitch:(<span class="built_in">BOOL</span>)isOpen;</span><br><span class="line">- (<span class="built_in">BOOL</span>)GCTThemeSwitchIsOpen;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><ul><li>æ•°æ®æºGCTThemeDataéµå¾ªçš„åè®®</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSUInteger</span> &#123;</span><br><span class="line">    GCTThemeDefaultData,</span><br><span class="line">    GCTThemeFestivalData</span><br><span class="line">&#125; GCTThemeDataTypes;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">GCTThemeDataProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Getter Method</span></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)skinDataFor:(GCTThemeDataTypes)themeType;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Setter Method</span></span><br><span class="line">- (<span class="keyword">void</span>)setSkinData:(<span class="built_in">NSDictionary</span> *)data <span class="keyword">for</span>:(GCTThemeDataTypes)themeType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><ul><li><strong>GCTThemeManageræ ¸å¿ƒä»£ç </strong></li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)findResourceBy:(<span class="built_in">NSString</span> *)key from:(GCTThemeModuleTypes)module with:(<span class="built_in">NSString</span> *)subKey &#123;</span><br><span class="line">    <span class="comment">// åˆ‡æ¢æ•°æ®</span></span><br><span class="line">    <span class="built_in">NSDictionary</span> *resourcesData = <span class="keyword">self</span>.switchIsOpen ? <span class="keyword">self</span>.tempSkinData : <span class="keyword">self</span>.skinData;</span><br><span class="line">    <span class="built_in">NSString</span> *moduleString = [<span class="keyword">self</span> convertThemeType2String:module];</span><br><span class="line">    <span class="keyword">if</span> (moduleString == <span class="literal">nil</span> || [moduleString isEqualToString:<span class="string">@""</span>] || resourcesData == <span class="literal">nil</span> || ![resourcesData.allKeys containsObject:moduleString]) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *moduleDic = resourcesData[moduleString];</span><br><span class="line">    <span class="keyword">if</span> (![moduleDic.allKeys containsObject:subKey]) &#123; <span class="keyword">return</span> <span class="literal">nil</span>; &#125;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *Dic = moduleDic[subKey];</span><br><span class="line">    <span class="keyword">if</span> (![Dic.allKeys containsObject:key]) &#123; <span class="keyword">return</span> <span class="literal">nil</span>; &#125;</span><br><span class="line">    <span class="keyword">return</span> Dic[key];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•ç¯‡"><a href="#æµ‹è¯•ç¯‡" class="headerlink" title="æµ‹è¯•ç¯‡"></a>æµ‹è¯•ç¯‡</h3><ul><li>é…ç½®ä»¥åŠMockæ•°æ®</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setUp &#123;</span><br><span class="line">    <span class="keyword">self</span>.themeData = [GCTThemeData new];</span><br><span class="line">    <span class="comment">// Mock Data</span></span><br><span class="line">    [<span class="keyword">self</span>.themeData setSkinData:@&#123;<span class="string">@"home_tabbar"</span>: @&#123;<span class="string">@"images"</span>: @&#123;<span class="string">@"image_home_button_selected"</span>: <span class="string">@"Home_Selected"</span>,</span><br><span class="line">                                                                 <span class="string">@"image_video_button_selected"</span>: <span class="string">@"Provider_Selected"</span>,</span><br><span class="line">                                                                 <span class="string">@"image_discovery_button_selected"</span>: <span class="string">@"Discovery_Selected"</span>,</span><br><span class="line">                                                                 <span class="string">@"image_mine_button_selected"</span>: <span class="string">@"Mine_Selected"</span>&#125;&#125;&#125; <span class="keyword">for</span>:GCTThemeDefaultData];</span><br><span class="line">    [<span class="keyword">self</span>.themeData setSkinData:@&#123;<span class="string">@"home_middle"</span>: @&#123;<span class="string">@"colors"</span>: @&#123;<span class="string">@"color_before_background"</span>: <span class="string">@"#cccccc"</span>&#125;,</span><br><span class="line">                                                    <span class="string">@"values"</span>: @&#123;<span class="string">@"value_home_title"</span>: <span class="string">@"æµ‹è¯•"</span>&#125;</span><br><span class="line">                                                    &#125;&#125; <span class="keyword">for</span>:GCTThemeFestivalData];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Mock Switch</span></span><br><span class="line">    <span class="keyword">self</span>.switchObject = [GCTThemeSwitchObject new];</span><br><span class="line">    [<span class="keyword">self</span>.switchObject setGCTThemeSwitch:<span class="literal">NO</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.manager = [GCTThemeManager sharedInstanceWithThemeData:<span class="keyword">self</span>.themeData];</span><br><span class="line">    [<span class="keyword">self</span>.manager switchBaseOn:<span class="keyword">self</span>.switchObject];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> ** æµ‹è¯•æ˜¯å¦ä¸ºå•ä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testGCTThemeManagerIsSingle &#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *managers = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">            GCTThemeManager *tempManager = [[GCTThemeManager alloc] init];</span><br><span class="line">            [managers addObject:tempManager];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    [managers enumerateObjectsUsingBlock:^(GCTThemeManager *obj, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</span><br><span class="line">        <span class="built_in">XCTAssertEqual</span>(<span class="keyword">self</span>.manager, obj, <span class="string">@"GCTThemeManager is not single"</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> ** æµ‹è¯•å¼€å…³</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testGCTThemeSwitch &#123;</span><br><span class="line">    <span class="built_in">XCTAssertFalse</span>(<span class="keyword">self</span>.manager.switchIsOpen, <span class="string">"default switch is closed"</span>);</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.switchObject setGCTThemeSwitch:<span class="literal">YES</span>];</span><br><span class="line">    [<span class="keyword">self</span>.manager switchBaseOn:<span class="keyword">self</span>.switchObject];</span><br><span class="line">    <span class="built_in">XCTAssertTrue</span>(<span class="keyword">self</span>.manager.switchIsOpen, <span class="string">"switch is open"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> ** åˆå§‹åŒ–åæ•°æ®æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testGCTThemeInitNoMockDataIsNotNil &#123;</span><br><span class="line">    <span class="built_in">XCTAssertNotNil</span>(<span class="keyword">self</span>.manager.skinData, <span class="string">"default data is not to be nil"</span>);</span><br><span class="line">    <span class="built_in">XCTAssertTrue</span>(<span class="keyword">self</span>.manager.skinData.count != <span class="number">0</span>, <span class="string">"default data is not to be nil"</span>);</span><br><span class="line">    <span class="built_in">XCTAssertNotNil</span>(<span class="keyword">self</span>.manager.tempSkinData, <span class="string">"temp data is not to be nil"</span>);</span><br><span class="line">    <span class="built_in">XCTAssertTrue</span>(<span class="keyword">self</span>.manager.tempSkinData.count != <span class="number">0</span>, <span class="string">"temp data is not be nil"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> ** é€šè¿‡keyæ¥è·å–å›¾ç‰‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testGCTThemeGetImageByKey &#123;</span><br><span class="line">    <span class="built_in">XCTAssertNil</span>([<span class="keyword">self</span>.manager getImageByKey:<span class="string">@""</span> from:GCTThemeModuleTypeHomeTabbar], <span class="string">"key is nil image should be nil"</span>);</span><br><span class="line">    <span class="built_in">XCTAssertNil</span>([<span class="keyword">self</span>.manager getImageByKey:<span class="string">@"image_home_button_selected_error"</span> from:GCTThemeModuleTypeHomeTabbar], <span class="string">"key error image should be nil"</span>);</span><br><span class="line">    <span class="built_in">XCTAssertNil</span>([<span class="keyword">self</span>.manager getImageByKey:<span class="string">@"image_home_button_selected"</span> from:GCTThemeModuleTypeHomeWifi], <span class="string">@"type is error image should be nil"</span>);</span><br><span class="line">    <span class="built_in">XCTAssertNotNil</span>([<span class="keyword">self</span>.manager getImageByKey:<span class="string">@"image_home_button_selected"</span> from:GCTThemeModuleTypeHomeTabbar], <span class="string">"key and type is right and data has value, image should not be nil"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> ** é€šè¿‡keyæ¥è·å–å›¾ç‰‡åå­—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testGCTThemeGetImageNameByKey &#123;</span><br><span class="line">    <span class="built_in">XCTAssertEqual</span>([<span class="keyword">self</span>.manager getImageNameByKey:<span class="string">@"image_home_button_selected"</span> from:GCTThemeModuleTypeHomeTabbar], <span class="string">@"Home_Selected"</span>, <span class="string">"image name should be equal"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> ** é€šè¿‡keyæ¥è·å–é¢œè‰²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testGetColorByKey &#123;</span><br><span class="line">    <span class="comment">// ä»æ˜¥èŠ‚ä¸»é¢˜ä¸­è·å–</span></span><br><span class="line">    [<span class="keyword">self</span>.switchObject setGCTThemeSwitch:<span class="literal">YES</span>];</span><br><span class="line">    [<span class="keyword">self</span>.manager switchBaseOn:<span class="keyword">self</span>.switchObject];</span><br><span class="line">    <span class="built_in">XCTAssertTrue</span>([[<span class="keyword">self</span>.manager getColorByKey:<span class="string">@"color_before_background"</span> from:GCTThemeModuleTypeHomeMiddleContent] isEqual:[<span class="built_in">UIColor</span> colorWithHexString:<span class="string">@"#cccccc"</span>]], <span class="string">"UIColor should be equal"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)testGCTThemeGetTitleByKey &#123;</span><br><span class="line">    <span class="comment">// ä»æ˜¥èŠ‚ä¸»é¢˜ä¸­è·å–</span></span><br><span class="line">    [<span class="keyword">self</span>.switchObject setGCTThemeSwitch:<span class="literal">YES</span>];</span><br><span class="line">    [<span class="keyword">self</span>.manager switchBaseOn:<span class="keyword">self</span>.switchObject];</span><br><span class="line">    <span class="built_in">XCTAssertTrue</span>([[<span class="keyword">self</span>.manager getTitleByKey:<span class="string">@"value_home_title"</span> from:GCTThemeModuleTypeHomeMiddleContent] isEqual:<span class="string">@"æµ‹è¯•"</span>], <span class="string">"Title should be equal"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€è€ƒç¯‡ğŸ¤”"><a href="#æ€è€ƒç¯‡ğŸ¤”" class="headerlink" title="æ€è€ƒç¯‡ğŸ¤”"></a>æ€è€ƒç¯‡ğŸ¤”</h3><ul><li><del>é…ç½®çš„æ—¶æœºï¼Œéœ€è¦åˆ‡æ¢ï¼Œå°½é‡ä¸è¦æ”¾åˆ°<code>AppDelegate</code>ä¸­ï¼Œå½±å“å¯åŠ¨æ—¶é—´</del>ã€‚<strong>å·²ç»é€šè¿‡GCT.Rå»¶æ—¶å¤„ç†äº†</strong></li><li><code>GCTThemeManager</code>ä¸­çš„å¼€å…³<code>GCTThemeSwitchObject</code>ä»¥åŠæ•°æ®æº<code>GCTThemeData</code>ç›¸åº”çš„å±æ€§éƒ½æ˜¯åŒæ—¶åˆ<code>Getter/Setter</code>æ–¹æ³•çš„ï¼Œ<strong>æ•°æ®ä¸å®‰å…¨ï¼ï¼</strong></li><li><del><strong>ï¼ï¼éƒ½è¦é€šè¿‡å­—ç¬¦ä¸²å»æŸ¥æ‰¾ï¼Œç¼–ç ä¸æ˜¯å¾ˆå‹å¥½ï¼ï¼ˆåæœŸä¼šé€šè¿‡R.Objå»ä¿®æ­£è¿™ä¸ªé—®é¢˜ã€‚ï¼‰</strong></del> <strong>å·²ç»é€šè¿‡GCT.Rå¤„ç†äº†</strong></li><li>ç»Ÿä¸€ä¿®æ”¹çš„æ—¶æœºæ¯æ¬¡å¯åŠ¨åªæœ‰ä¸€æ¬¡ï¼ŒåæœŸè¿™é‡Œéœ€è¦ä¿®æ”¹ã€‚</li></ul><p>##GCT.Rä½¿ç”¨è¯´æ˜ï¼š</p><ul><li>ä»£ç å®åœ¨R.objcä¸Šä»£ç çš„ä¿®æ”¹ï¼Œæ€è·¯ç±»ä¼¼äºR.Swiftä¸€æ ·</li></ul><p>###CGT.Rä½¿ç”¨æ­¥éª¤ï¼š<strong>æ·»åŠ ä¹‹å‰é…ç½®ä¸€ä¸‹è‡ªå·±çš„xcode, è®©xcodeé‡åˆ°é”™è¯¯çš„æ—¶å€™ç»§ç»­ç¼–è¯‘ï¼Œå‹¾é€‰: Perferences-&gt;General-&gt;Continue building after errors</strong></p><ol><li><code>pod &#39;GCT.R</code></li><li><code>TARGETS</code> -&gt; <code>Build Phases</code> -&gt; <code>New Run Script Phase</code> æ·»åŠ ä¸‹é¢çš„å‘½ä»¤<code>&quot;${PODS_ROOT}/GCT.R/GCT.R/GCTR&quot; -p &quot;$SRCROOT&quot;</code></li><li><code>build</code>æˆ–è€…<code>run</code>é¡¹ç›®ï¼Œä½ ä¼šå‘ç°å¤šäº†ä¸ª<code>R.h</code>å’Œ<code>R.m</code>ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ‹–è¿›é¡¹ç›®ä¸­ï¼Œä¸è¦å‹¾é€‰<code>Copy items if needed</code></li></ol><h3 id="GCTThemeå’ŒGCT-Ré…åˆä½¿ç”¨"><a href="#GCTThemeå’ŒGCT-Ré…åˆä½¿ç”¨" class="headerlink" title="GCTThemeå’ŒGCT.Ré…åˆä½¿ç”¨"></a>GCTThemeå’ŒGCT.Ré…åˆä½¿ç”¨</h3><ul><li>ä¸¤ä¸ªä¸œè¥¿çš„ä½œç”¨æ˜¯ç›¸å¯¹ç‹¬ç«‹ï¼Œä¹Ÿæœ‰ä¸€å®šçš„è¦†ç›–ï¼š</li></ul><ol><li>GCThemeèµ‹å€¼åˆ‡æ¢çš®è‚¤ï¼ˆè¿™é‡ŒåŒ…è£¹å›¾ç‰‡ã€æ–‡å­—ï¼Œé¢œè‰²ï¼Œè¿™é‡Œéƒ½æ˜¯æœ¬åœ°èµ„æºï¼‰ï¼ŒåæœŸä¼šåŠ å…¥æœåŠ¡ç«¯èµ„æºï¼Œä»¥åŠå…¶ä»–ç±»å‹çš„èµ„æºæ–‡ä»¶ã€‚</li><li><del>é…ç½®çš„æ—¶æœºï¼Œéœ€è¦åˆ‡æ¢ï¼Œå°½é‡ä¸è¦æ”¾åˆ°<code>AppDelegate</code>ä¸­ï¼Œå½±å“å¯åŠ¨æ—¶é—´</del>ã€‚<strong>å·²ç»é€šè¿‡GCT.Rå»¶æ—¶å¤„ç†äº†</strong></li><li><del><strong>ï¼ï¼éƒ½è¦é€šè¿‡å­—ç¬¦ä¸²å»æŸ¥æ‰¾ï¼Œç¼–ç ä¸æ˜¯å¾ˆå‹å¥½ï¼ï¼ˆåæœŸä¼šé€šè¿‡R.Objå»ä¿®æ­£è¿™ä¸ªé—®é¢˜ã€‚ï¼‰</strong></del> <strong>å·²ç»é€šè¿‡GCT.Rå¤„ç†äº†</strong></li><li>GCT.Rä»£ç çš„åŠŸèƒ½ï¼Œå°±æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œç”Ÿæˆä¸€ç³»åˆ—çš„ç±»ã€å±æ€§ï¼Œä»è€Œé¿å…é€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼æ¥è·å–å›¾ç‰‡ã€æ–‡å­—ç­‰èµ„æºæ–‡ä»¶[åæœŸè¿™ä¸ªä¹Ÿå¯ä»¥åšæ‰©å±•ã€storyboard/xib/æœ¬åœ°strings/å¤šè¯­è¨€/åŸºæœ¬æ ¡éªŒä»£ç åŠŸèƒ½]</li></ol><h3 id="ä¸ºäº†è§£å†³ä¸Šé¢å‰ä¸‰ä¸ªé—®é¢˜ï¼Œå¼€å§‹åœ¨GCT-Rçš„ä»£ç åšè¿›ä¸€æ­¥çš„ä¿®æ”¹ï¼š"><a href="#ä¸ºäº†è§£å†³ä¸Šé¢å‰ä¸‰ä¸ªé—®é¢˜ï¼Œå¼€å§‹åœ¨GCT-Rçš„ä»£ç åšè¿›ä¸€æ­¥çš„ä¿®æ”¹ï¼š" class="headerlink" title="ä¸ºäº†è§£å†³ä¸Šé¢å‰ä¸‰ä¸ªé—®é¢˜ï¼Œå¼€å§‹åœ¨GCT.Rçš„ä»£ç åšè¿›ä¸€æ­¥çš„ä¿®æ”¹ï¼š"></a>ä¸ºäº†è§£å†³ä¸Šé¢å‰ä¸‰ä¸ªé—®é¢˜ï¼Œå¼€å§‹åœ¨GCT.Rçš„ä»£ç åšè¿›ä¸€æ­¥çš„ä¿®æ”¹ï¼š</h3><h4 id="ä¿®æ”¹é—®é¢˜1ã€3"><a href="#ä¿®æ”¹é—®é¢˜1ã€3" class="headerlink" title="ä¿®æ”¹é—®é¢˜1ã€3"></a>ä¿®æ”¹é—®é¢˜1ã€3</h4><ul><li>é¦–å…ˆåŒä¸€å¼ å›¾ç‰‡æ–‡ä»¶ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯å±äºçš®è‚¤ç®¡ç†çš„æ–‡ä»¶ï¼ŒRéƒ½ä¼šç”ŸæˆRImagesç±»ï¼Œé‡Œé¢ä¼šå°†ä¸ªä¸ªå›¾ç‰‡çš„åå­—è½¬æ¢ä¸ºå±æ€§åã€‚</li><li>å¦‚æœæ˜¯çš®è‚¤ç®¡ç†çš„èµ„æºï¼Œä¼šåœ¨Rä¸‹é¢ç”Ÿæˆä¸€ä¸ªRThemeçš„ç±»ï¼Œä¸‹ä¸€çº§å°±æ˜¯å„ä¸ª<code>plist</code>æ–‡ä»¶ä¸­æŒ‡å‘çš„<code>key</code></li><li>è€Œå…·ä½“çš„å®ç°æ˜¯äº¤ç»™äº†GCTThemeæ¥åˆ¤æ–­ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RThemes</span></span></span><br><span class="line">- (<span class="built_in">NSString</span> *)value_home_title &#123; <span class="keyword">return</span> GCTThemeTitle(<span class="string">@"value_home_title"</span>, <span class="string">@"home_tabbar"</span>); &#125;</span><br><span class="line">- (<span class="built_in">UIImage</span> *)home_wifi_scaning_unconnected &#123; <span class="keyword">return</span> GCTThemeImg(<span class="string">@"home_wifi_scaning_unconnected"</span>, <span class="string">@"home_wifi"</span>); &#125;</span><br><span class="line">- (<span class="built_in">UIColor</span> *)home_wifi_connected &#123; <span class="keyword">return</span> GCTThemeColor(<span class="string">@"home_wifi_connected"</span>, <span class="string">@"home_wifi"</span>); &#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><ul><li>ä½†æ˜¯è¿™é‡Œå…¶å®ä¹Ÿæ˜¯æœ‰ç‚¹é—®é¢˜çš„ï¼šå¦‚æœåœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­ï¼ˆhome_tabbar/home_wifiï¼‰ä¸­ï¼Œimagesæˆ–è€…colorså–äº†ä¸€ä¸ªç›¸åŒçš„key, ä½†æ˜¯å¯¹äºçš„valueåˆæ˜¯ä¸ä¸€æ ·çš„ã€‚[è¿™é‡Œè®¤ä¸ºæ˜¯è®¤ä¸ºçš„æ“ä½œé”™è¯¯âŒï¼Œåº”è¯¥å»ä¿®æ­£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»£ç çš„æ–¹å¼ä¿®æ”¹ï¼Œç»Ÿä¸€åœ¨RThemeä¸‹é¢ç”ŸæˆRColors/RImages/RStrings, ç„¶ååœ¨å“åº”çš„RColors/RImages/RStringsä¸‹é¢ç”Ÿæˆå¯¹äºçš„èµ„æºåç§°]ï¼Œé—®é¢˜å¯ä»¥ä¿®æ”¹ï¼Œä½†æ˜¯ä½¿ç”¨è€…çš„æˆæœ¬ä¹Ÿä¼šæé«˜ã€‚</li></ul><h4 id="ä¿®æ”¹é—®é¢˜2"><a href="#ä¿®æ”¹é—®é¢˜2" class="headerlink" title="ä¿®æ”¹é—®é¢˜2"></a>ä¿®æ”¹é—®é¢˜2</h4><ul><li>ç¬¬äºŒä¸ªé—®é¢˜çš„ä¿®æ”¹ï¼Œé¿å…åœ¨Appdelegateä¸­å®æ–½æ³¨å†Œï¼Œè¿™é‡Œé€šè¿‡åœ¨Rå¯¹è±¡æ‡’åŠ è½½ä¸­å®ä¾‹åŒ–ï¼š</li><li>è¿™é‡Œå› ä¸ºRçš„å¯¹è±¡å°±æ˜¯å•ä¾‹ï¼Œå¹¶ä¸”UIçš„ä¿®æ”¹åº”è¯¥éƒ½æ˜¯ä¸»çº¿ç¨‹ä¸­çš„ï¼Œæ‰€æœ‰è¿™é‡Œå°±ä¸éœ€è¦ä¸º<code>RThemes</code>çš„å®åŠ›ç”Ÿæˆä¸ºå•ä¾‹ã€‚</li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+ (RThemes*)theme &#123; </span><br><span class="line"> GCTThemeSwitchObject *switchObj = [GCTThemeSwitchObject new];</span><br><span class="line"> [switchObj setGCTThemeSwitch:<span class="literal">YES</span>];</span><br><span class="line"> [[GCTThemeManager sharedInstanceWithThemeData:[GCTThemeData new]] switchBaseOn:switchObj];</span><br><span class="line"> <span class="keyword">return</span> [[R sharedInstance] theme];</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> - (RThemes*)theme</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!_theme)</span><br><span class="line">&#123;</span><br><span class="line">_theme = [RThemes new];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _theme;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸»é¢˜çš®è‚¤åˆ‡æ¢æ¨¡å—&quot;&gt;&lt;a href=&quot;#ä¸»é¢˜çš®è‚¤åˆ‡æ¢æ¨¡å—&quot; class=&quot;headerlink&quot; title=&quot;ä¸»é¢˜çš®è‚¤åˆ‡æ¢æ¨¡å—&quot;&gt;&lt;/a&gt;ä¸»é¢˜çš®è‚¤åˆ‡æ¢æ¨¡å—&lt;/h2&gt;&lt;h3 id=&quot;GCTThemeé…ç½®ç¯‡&quot;&gt;&lt;a href=&quot;#GCTThemeé…ç½®ç¯‡&quot; class=&quot;headerlink&quot; title=&quot;GCTThemeé…ç½®ç¯‡&quot;&gt;&lt;/a&gt;GCTThemeé…ç½®ç¯‡&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;è°ƒç”¨&lt;code&gt;GCTThemeManager&lt;/code&gt;ä¹‹å‰éœ€è¦æ³¨å†Œé…ç½®æ•°æ®, è°ƒç”¨çš„æ—¶æœºç›®å‰æ˜¯åœ¨&lt;code&gt;didFinishLaunchingWithOptions&lt;/code&gt;çš„æ—¶å€™ ï¼ˆè¿™ä¸ªåæœŸå¯ä»¥ä¿®æ”¹ï¼ï¼ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 1. GCTThemeSwitchObject æ§åˆ¶å¼€å…³çš„ç±»ï¼Œçµæ´»æ§åˆ¶å¼€å…³å°±å¯ä»¥é…ç½®è¿™ä¸ªç±» ï¼ˆé¢å‘åè®®ï¼‰&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCTThemeSwitchObject *switchObj = [GCTThemeSwitchObject &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[switchObj &lt;span class=&quot;string&quot;&gt;setGCTThemeSwitch:&lt;/span&gt;YES];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 2. GCTThemeData æ•°æ®æºçš„ç±»ï¼Œç›®å‰åªè¯»å–æœ¬åœ°æ•°æ®ï¼ŒåæœŸè¿œç¨‹æ•°æ®åªéœ€è¦é…ç½®å®ƒï¼ˆé¢å‘åè®®ï¼‰&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[[GCTThemeManager &lt;span class=&quot;string&quot;&gt;sharedInstanceWithThemeData:&lt;/span&gt;[GCTThemeData &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt;]] &lt;span class=&quot;string&quot;&gt;switchBaseOn:&lt;/span&gt;switchObj];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Object-C" scheme="http://www.ghcoder.com/tags/Object-C/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºKiwiæµ‹è¯•</title>
    <link href="http://www.ghcoder.com/2019/01/17/20190117/"/>
    <id>http://www.ghcoder.com/2019/01/17/20190117/</id>
    <published>2019-01-17T11:28:12.000Z</published>
    <updated>2019-01-17T04:14:56.162Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Kiwi-æµ‹è¯•æ¡†æ¶"><a href="#Kiwi-æµ‹è¯•æ¡†æ¶" class="headerlink" title="Kiwi æµ‹è¯•æ¡†æ¶"></a>Kiwi æµ‹è¯•æ¡†æ¶</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><ul><li>é€šè¿‡<code>Cocoapods</code>å®‰è£…<code>Kiwi</code>ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">target 'xxxTests' do</span><br><span class="line">  inherit! :search_paths</span><br><span class="line">  <span class="meta"># Pods for testing</span></span><br><span class="line">  pod 'Kiwi'</span><br><span class="line">end</span><br></pre></td></tr></table></figure><ul><li>å®‰è£…<code>Kiwiçš„Xcode Template</code></li></ul><ol><li>ä¸‹è½½ <a href="https://github.com/kiwi-bdd/Kiwi/tree/master/Xcode%20Templates" target="_blank" rel="noopener">Kiwi Template</a></li><li>æ‰§è¡Œå®‰è£…è„šæœ¬ <code>sh ./install-templates.sh</code></li></ol><a id="more"></a><h4 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><ul><li>é€šè¿‡<code>Xcode</code>-&gt; <code>File</code> -&gt; <code>New</code> -&gt; <code>File...</code></li><li>è¾“å…¥<code>Kiwi</code>è¿‡æ»¤å‡º<code>Kiwi Spec</code> -&gt; <code>Next</code> åˆ›å»ºå®Œæˆ [ <strong>è¿™é‡Œè¾“å…¥çš„æ–‡ä»¶åå°±æ˜¯ä½ è¦æµ‹è¯•çš„ç±»å</strong> ]</li></ul><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><blockquote><p>Kiwiæµ‹è¯•ä¸­çš„è¡Œä¸ºæè¿°ï¼š<code>Given</code>ã€<code>When</code>ã€<code>Then</code><br>ä¸€ä¸ªæµ‹è¯•ç±»ä¸­ï¼Œä¸€ä¸ªæµ‹è¯•ç±»åªä¼šå­˜åœ¨ä¸€ä¸ª<code>describe</code> (ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶åº”è¯¥ä¸“æ³¨äºä¸€ä¸ªæµ‹è¯•ç±»)<br>ä¸€ä¸ª<code>describe</code>å¯ä»¥å­˜åœ¨å¤šä¸ª<code>context</code><br>ä¸€ä¸ª<code>context</code>å¯ä»¥å­˜åœ¨å¤šä¸ª<code>it</code></p></blockquote><h5 id="è¿™é‡Œå†™äº†ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç®€å•çš„Userå¯¹è±¡-åŸºæœ¬æ–­è¨€æµ‹è¯•æ–‡æ¡£"><a href="#è¿™é‡Œå†™äº†ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç®€å•çš„Userå¯¹è±¡-åŸºæœ¬æ–­è¨€æµ‹è¯•æ–‡æ¡£" class="headerlink" title="è¿™é‡Œå†™äº†ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç®€å•çš„Userå¯¹è±¡, åŸºæœ¬æ–­è¨€æµ‹è¯•æ–‡æ¡£"></a>è¿™é‡Œå†™äº†ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç®€å•çš„Userå¯¹è±¡, <a href="https://github.com/kiwi-bdd/Kiwi/wiki/Expectations" target="_blank" rel="noopener">åŸºæœ¬æ–­è¨€æµ‹è¯•æ–‡æ¡£</a></h5><ul><li><a href="https://github.com/Ghstart/testKiwi" target="_blank" rel="noopener">Demoä¸‹è½½</a></li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">DataBaseManager</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GCTUser</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *userName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">readonly</span>) <span class="built_in">NSInteger</span> password;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSArray</span> *addressDatas;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithUserName:(<span class="built_in">NSString</span> *)userName password:(<span class="built_in">NSInteger</span>)password;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)registerAddressWith:(<span class="built_in">NSString</span> *)addressName;</span><br><span class="line">- (<span class="keyword">void</span>)unregisterAddress;</span><br><span class="line"><span class="comment">// æµ‹è¯•Exceptionæ–­è¨€</span></span><br><span class="line">- (<span class="keyword">void</span>)forceUnregisterAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ç”¨æˆ·ä¿¡æ¯æ•°æ®</span></span><br><span class="line"><span class="comment">// 1. </span></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)userInfos;</span><br><span class="line"><span class="comment">// 2. å¤–éƒ¨ä¼ å…¥</span></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)getUserInfosFrom:(DataBaseManager *)dataBaseManager;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">@"Given a GCTUser"</span>, ^&#123; <span class="comment">// &lt;--Given</span></span><br><span class="line">    <span class="comment">/* -- 1 -- */</span></span><br><span class="line">    context(<span class="string">@"when user userName is 'Hello world' and password is '123456'"</span>, ^&#123;<span class="comment">// &lt;-- When</span></span><br><span class="line">        </span><br><span class="line">        GCTUser *user = [[GCTUser alloc] initWithUserName:<span class="string">@"Hello world"</span> password:<span class="number">123456</span>];</span><br><span class="line">        </span><br><span class="line">        it(<span class="string">@"user is exists"</span>, ^&#123;</span><br><span class="line">            [[user shouldNot] beNil];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        it(<span class="string">@"userName is 'Hello world'"</span>, ^&#123; <span class="comment">// &lt;-- Then (with description)</span></span><br><span class="line">            [[user.userName should] equal:<span class="string">@"Hello world"</span>];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        specify(^&#123;</span><br><span class="line">            [[theValue(<span class="number">123456</span>) should] equal:theValue(user.password)];  <span class="comment">// &lt;-- Then (without description)</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* -- 2 -- */</span></span><br><span class="line">    context(<span class="string">@"when user created"</span>, ^&#123;<span class="comment">// &lt;-- When</span></span><br><span class="line">       </span><br><span class="line">        __block GCTUser *user = <span class="literal">nil</span>;</span><br><span class="line">        beforeAll(^&#123;</span><br><span class="line">            user = [GCTUser new];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        afterAll(^&#123;</span><br><span class="line">            user = <span class="literal">nil</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        it(<span class="string">@"when user is created, address data should be empty"</span>, ^&#123; <span class="comment">// &lt;-- Then (with description)</span></span><br><span class="line">            [[user.addressDatas should] beEmpty];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* -- 3 -- */</span></span><br><span class="line">    context(<span class="string">@"when register address name"</span>, ^&#123;<span class="comment">// &lt;-- When</span></span><br><span class="line">        GCTUser *user = [GCTUser new];</span><br><span class="line">        beforeEach(^&#123;</span><br><span class="line">            [user registerAddressWith:<span class="string">@"hangzhou"</span>];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        afterEach(^&#123;</span><br><span class="line">            [user unregisterAddress];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        it(<span class="string">@"after user register, then"</span>, ^&#123; <span class="comment">// &lt;-- Then (with description)</span></span><br><span class="line">            [[user.addressDatas.firstObject should] equal:<span class="string">@"hangzhou"</span>];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* -- 4 -- */</span></span><br><span class="line">    context(<span class="string">@"when unregister address"</span>, ^&#123;<span class="comment">// &lt;-- When</span></span><br><span class="line">        GCTUser *user = [GCTUser new];</span><br><span class="line">        beforeAll(^&#123;</span><br><span class="line">            [user registerAddressWith:<span class="string">@"beijing"</span>];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        beforeEach(^&#123;</span><br><span class="line">            [user unregisterAddress];</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        it(<span class="string">@"after user unregister"</span>, ^&#123;<span class="comment">// &lt;-- Then (with description)</span></span><br><span class="line">            [[user.addressDatas should] beEmpty];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* -- 5 -- */</span></span><br><span class="line">    context(<span class="string">@"when user addresses are empty"</span>, ^&#123;</span><br><span class="line">        GCTUser *user = [GCTUser new];</span><br><span class="line">        </span><br><span class="line">        it(<span class="string">@"called force ungister, will throw exception"</span>, ^&#123;</span><br><span class="line">            [[theBlock(^&#123;</span><br><span class="line">                [user forceUnregisterAddress];</span><br><span class="line">            &#125;) should] raiseWithName:<span class="string">@"GCTUserAddressDatasEmptyException"</span>] ;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="ç¬¬äºŒä¸ªä¾‹å­ï¼Œæˆ‘ç”¨MVVMæ¨¡å¼ï¼Œå†™äº†ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œè¿™é‡Œé¢ç”¨åˆ°äº†UITableView-é‡ç‚¹æµ‹è¯•ViewModel-viewModelä»£ç å¦‚ä¸‹ï¼š"><a href="#ç¬¬äºŒä¸ªä¾‹å­ï¼Œæˆ‘ç”¨MVVMæ¨¡å¼ï¼Œå†™äº†ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œè¿™é‡Œé¢ç”¨åˆ°äº†UITableView-é‡ç‚¹æµ‹è¯•ViewModel-viewModelä»£ç å¦‚ä¸‹ï¼š" class="headerlink" title="ç¬¬äºŒä¸ªä¾‹å­ï¼Œæˆ‘ç”¨MVVMæ¨¡å¼ï¼Œå†™äº†ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œè¿™é‡Œé¢ç”¨åˆ°äº†UITableView, é‡ç‚¹æµ‹è¯•ViewModel, viewModelä»£ç å¦‚ä¸‹ï¼š"></a>ç¬¬äºŒä¸ªä¾‹å­ï¼Œæˆ‘ç”¨MVVMæ¨¡å¼ï¼Œå†™äº†ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œè¿™é‡Œé¢ç”¨åˆ°äº†<em>UITableView</em>, é‡ç‚¹æµ‹è¯•<em>ViewModel</em>, viewModelä»£ç å¦‚ä¸‹ï¼š</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HttpClient.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^TableViewCellConfigBlock)(<span class="keyword">id</span> cell, <span class="keyword">id</span> item);</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^HomeViewModelSuccessBlock)(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^HomeViewModelFailureBlock)(<span class="built_in">NSError</span> *e);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HomeViewModel</span> : <span class="title">NSObject</span>&lt;<span class="title">UITableViewDataSource</span>&gt;</span></span><br><span class="line"><span class="comment">//**??**</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) HttpClient *httpClient; <span class="comment">// å…·ä½“å®ç°ç½‘ç»œè¯·æ±‚çš„ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCellIdentifior:(<span class="built_in">NSString</span> *)cellIdentifior configureCellBlock:(TableViewCellConfigBlock)configureCellBlock;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç½‘ç»œè¯·æ±‚æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)requestHomeDatasBasedOn:(<span class="built_in">NSString</span> *)homeID</span><br><span class="line">                        success:(HomeViewModelSuccessBlock)success</span><br><span class="line">                        failure:(HomeViewModelFailureBlock)failure;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•ç½‘ç»œè¯·æ±‚ç±»ï¼š</li><li>è¿™é‡Œä¸»è¦ç”¨åˆ°äº†å¼‚æ­¥æ–­è¨€<code>[[expectFutureValue(theValue(errorOccur)) shouldEventuallyBeforeTimingOutAfter(2.0)] equal:theValue(YES)];</code> <a href="https://github.com/kiwi-bdd/Kiwi/wiki/Asynchronous-Testing" target="_blank" rel="noopener">Asynchronousæµ‹è¯•å‚è€ƒæ–‡æ¡£</a></li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">@"HomeViewModel"</span>, ^&#123;</span><br><span class="line"></span><br><span class="line">    context(<span class="string">@"Normal Request"</span>, ^&#123;</span><br><span class="line"></span><br><span class="line">        HomeViewModel *viewModel = [HomeViewModel new];</span><br><span class="line">        __block <span class="built_in">NSError</span> *noInputError = <span class="literal">nil</span>;</span><br><span class="line">        __block <span class="built_in">BOOL</span> errorOccur = <span class="literal">NO</span>;</span><br><span class="line">        __block <span class="built_in">BOOL</span> successOccur = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">        it(<span class="string">@"å½“å…¥å‚HomeIDä¸ºç©ºçš„æ—¶å€™ï¼Œå°†ä¼šè°ƒç”¨failureçš„callback, å¹¶ä¸”ä¼šè¿”å›åˆ¶å®šçš„error"</span>, ^&#123;</span><br><span class="line">            [viewModel requestHomeDatasBasedOn:<span class="string">@""</span> success:^&#123;&#125; failure:^(<span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line">                noInputError = error;</span><br><span class="line">                errorOccur = <span class="literal">YES</span>;</span><br><span class="line">            &#125;];</span><br><span class="line">            [[expectFutureValue(theValue(errorOccur)) shouldEventuallyBeforeTimingOutAfter(<span class="number">2.0</span>)] equal:theValue(<span class="literal">YES</span>)];</span><br><span class="line">            [[noInputError shouldNot] beNil];</span><br><span class="line">            [[noInputError should] equal:[<span class="built_in">NSError</span> errorWithDomain:<span class="string">@"empty input"</span> code:<span class="number">1011</span> userInfo:<span class="literal">nil</span>]];</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        it(<span class="string">@"å½“ä¼ å…¥HomeIDçš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨successçš„callBack, å¹¶ä¸”ä¼šè¿”å›æ•°æ®"</span>, ^&#123;</span><br><span class="line">            [viewModel requestHomeDatasBasedOn:<span class="string">@"HomeID"</span> success:^&#123;</span><br><span class="line">                successOccur = <span class="literal">YES</span>;</span><br><span class="line">            &#125; failure:^(<span class="built_in">NSError</span> * _Nonnull error) &#123;&#125;];</span><br><span class="line">            [[expectFutureValue(theValue(successOccur)) shouldEventuallyBeforeTimingOutAfter(<span class="number">2.0</span>)] equal:theValue(<span class="literal">YES</span>)];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œæˆ‘å¯ä»¥é€šè¿‡Mock HttpClientçš„è¿”å›æ•°æ®æ¥æµ‹è¯•è¿”å›ç»“æœ</li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> context(<span class="string">@"Mock Request"</span>, ^&#123;</span><br><span class="line">        </span><br><span class="line">        HomeViewModel *homeViewModel = [HomeViewModel new];</span><br><span class="line">        <span class="keyword">id</span> mockTableView = [<span class="built_in">UITableView</span> mock];</span><br><span class="line">        </span><br><span class="line">        it(<span class="string">@"å¦‚æœç½‘ç»œè¯·æ±‚è¿”å›çš„æ˜¯ä¸¤ä¸ªæ•°æ®ï¼Œåˆ™UITableView DataSourceçš„æ•°æ®æºä¹Ÿæ˜¯ä¸¤ä¸ª"</span>, ^&#123;</span><br><span class="line">            HttpClient *client = [HttpClient new];</span><br><span class="line">            <span class="built_in">NSArray</span> *mockDatas = @[[[HomeModel alloc] initWithTitle:<span class="string">@"test-1"</span>], [[HomeModel alloc] initWithTitle:<span class="string">@"test-2"</span>], [[HomeModel alloc] initWithTitle:<span class="string">@"test-2"</span>]];</span><br><span class="line">            [client stub:<span class="keyword">@selector</span>(requestHomeDataBy:success:failure:) withBlock:^<span class="keyword">id</span>(<span class="built_in">NSArray</span> *params) &#123;</span><br><span class="line">                HttpClientSuccessBlock successB = [params objectAtIndex:<span class="number">1</span>];</span><br><span class="line">                successB(mockDatas);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">            &#125;];</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            homeViewModel.httpClient = client;</span><br><span class="line">            [homeViewModel requestHomeDatasBasedOn:<span class="string">@"test"</span> success:^&#123;</span><br><span class="line">                <span class="built_in">NSInteger</span> count = [homeViewModel tableView:mockTableView numberOfRowsInSection:<span class="number">0</span>];</span><br><span class="line">                [[theValue(count) should] equal:theValue(<span class="number">3</span>)];</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">            &#125; failure:^(<span class="built_in">NSError</span> *e) &#123;&#125;];</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•blockçš„å›è°ƒä»£ç å¦‚ä¸‹ï¼Œå’Œä¸Šé¢çš„mock httpClienté›·åŒ</li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">context(<span class="string">@"Configuration"</span>, ^&#123;</span><br><span class="line">       __block <span class="built_in">UITableViewCell</span> *configuredCell = <span class="literal">nil</span>;</span><br><span class="line">       __block <span class="keyword">id</span> configuredObject = <span class="literal">nil</span>;</span><br><span class="line">       </span><br><span class="line">       TableViewCellConfigBlock block = ^(<span class="built_in">UITableViewCell</span> *a, <span class="keyword">id</span> b)&#123;</span><br><span class="line">           configuredCell = a;</span><br><span class="line">           configuredObject = b;</span><br><span class="line">       &#125;;</span><br><span class="line">       HomeViewModel *homeViewModel = [[HomeViewModel alloc] initWithCellIdentifior:<span class="string">@"HomeTableViewCell"</span> configureCellBlock:block];</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">id</span> mockTableView = [<span class="built_in">UITableView</span> mock];</span><br><span class="line">       <span class="built_in">UITableViewCell</span> *cell = [[<span class="built_in">UITableViewCell</span> alloc] init];</span><br><span class="line">       </span><br><span class="line">       __block <span class="keyword">id</span> result = <span class="literal">nil</span>;</span><br><span class="line">       <span class="built_in">NSIndexPath</span> *indexPath = [<span class="built_in">NSIndexPath</span> indexPathForRow:<span class="number">0</span> inSection:<span class="number">0</span>];</span><br><span class="line">       </span><br><span class="line">       it(<span class="string">@"å¦‚æœç½‘ç»œè¯·æ±‚è¿”å›çš„æ˜¯ä¸¤ä¸ªæ•°æ®ï¼Œåˆ™UITableView DataSourceçš„æ•°æ®æºä¹Ÿæ˜¯ä¸¤ä¸ª"</span>, ^&#123;</span><br><span class="line">           HttpClient *client = [HttpClient new];</span><br><span class="line">           <span class="built_in">NSArray</span> *mockDatas = @[[[HomeModel alloc] initWithTitle:<span class="string">@"test-1"</span>], [[HomeModel alloc] initWithTitle:<span class="string">@"test-2"</span>], [[HomeModel alloc] initWithTitle:<span class="string">@"test-2"</span>]];</span><br><span class="line">           [client stub:<span class="keyword">@selector</span>(requestHomeDataBy:success:failure:) withBlock:^<span class="keyword">id</span>(<span class="built_in">NSArray</span> *params) &#123;</span><br><span class="line">               HttpClientSuccessBlock successB = [params objectAtIndex:<span class="number">1</span>];</span><br><span class="line">               successB(mockDatas);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">           &#125;];</span><br><span class="line">           </span><br><span class="line">           </span><br><span class="line">           homeViewModel.httpClient = client;</span><br><span class="line">           [homeViewModel requestHomeDatasBasedOn:<span class="string">@"test"</span> success:^&#123;</span><br><span class="line">               </span><br><span class="line">               [[mockTableView should] receive:<span class="keyword">@selector</span>(dequeueReusableCellWithIdentifier:forIndexPath:) andReturn:cell withArguments:<span class="string">@"HomeTableViewCell"</span>,indexPath];</span><br><span class="line">               result = [homeViewModel tableView:mockTableView cellForRowAtIndexPath:indexPath];</span><br><span class="line">               </span><br><span class="line">               [[result should] equal:cell];</span><br><span class="line"></span><br><span class="line">               [[configuredCell should] equal:cell];</span><br><span class="line"></span><br><span class="line">               [[configuredObject should] beKindOfClass:[HomeModel <span class="keyword">class</span>]];</span><br><span class="line">               HomeModel *hM = (HomeModel *)configuredObject;</span><br><span class="line">               [[hM.showTitle should] equal:<span class="string">@"test-1"</span>];</span><br><span class="line">               </span><br><span class="line">           &#125; failure:^(<span class="built_in">NSError</span> *e) &#123;&#125;];</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œæœ‰ç‚¹é—®é¢˜ï¼š</li></ul><ol><li>é¦–å…ˆï¼Œæµ‹è¯•ç»“æœä»æ—§å–å†³äºç½‘ç»œçŠ¶å†µï¼Œå› æ­¤æˆ‘ä»¬å¾ˆéš¾ä¿è¯å¤šæ¬¡æµ‹è¯•ç»“æœçš„ä¸€è‡´æ€§ï¼›</li><li>å…¶æ¬¡ï¼Œå½“æˆ‘ä»¬è¦æµ‹è¯•ä¸€ä¸ªRESTæœåŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæ¯ä¸ªURLçš„æµ‹è¯•éƒ½åŸºäºå®é™…ç½‘ç»œè®¿é—®å’Œè¶…æ—¶çš„æœºåˆ¶ï¼Œå°†ä¼šæ˜¾è‘—å¢åŠ æµ‹è¯•æ‰§è¡Œçš„æ—¶é—´</li></ol><ul><li>æˆ‘çš„è§‚ç‚¹æ˜¯ <strong>1. æµ‹è¯•è¿‡ç¨‹è¦ä¸ä¾èµ–äºä»»ä½•å¤–éƒ¨æ¡ä»¶å’Œç³»ç»Ÿï¼›2. åœ¨ä»»ä½•ç¯å¢ƒã€æµ‹è¯•ä»»æ„å¤šæ¬¡ï¼Œç»“æœåº”è¯¥ä¿æŒä¸å˜ï¼›</strong></li></ul><h5 id="é¡µé¢çš„è·³è½¬æµ‹è¯•"><a href="#é¡µé¢çš„è·³è½¬æµ‹è¯•" class="headerlink" title="é¡µé¢çš„è·³è½¬æµ‹è¯•"></a>é¡µé¢çš„è·³è½¬æµ‹è¯•</h5><ul><li>è¿™é‡Œä¸»è¦ç”¨åˆ°äº†<code>stub</code>å’Œ<code>mock</code></li></ul><blockquote><p>ç»´åŸºç™¾ç§‘å¯¹<code>stub</code>çš„è§£é‡Š : æ¡©[1]ï¼ˆStub / Method Stubï¼‰æ˜¯æŒ‡ç”¨æ¥æ›¿æ¢ä¸€éƒ¨åˆ†åŠŸèƒ½çš„ç¨‹åºæ®µã€‚æ¡©ç¨‹åºå¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿå·²æœ‰ç¨‹åºçš„è¡Œä¸ºï¼ˆæ¯”å¦‚ä¸€ä¸ªè¿œç«¯æœºå™¨çš„è¿‡ç¨‹ï¼‰æˆ–æ˜¯å¯¹å°†è¦å¼€å‘çš„ä»£ç çš„ä¸€ç§ä¸´æ—¶æ›¿ä»£ã€‚å› æ­¤ï¼Œæ‰“æ¡©æŠ€æœ¯åœ¨ç¨‹åºç§»æ¤ã€åˆ†å¸ƒå¼è®¡ç®—ã€é€šç”¨è½¯ä»¶å¼€å‘å’Œæµ‹è¯•ä¸­ç”¨å¤„å¾ˆå¤§<br>ç»´åŸºç™¾ç§‘å¯¹<code>mock</code>çš„è§£é‡Š : åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­ï¼Œæ¨¡æ‹Ÿå¯¹è±¡ï¼ˆè‹±è¯­ï¼šmock objectï¼Œä¹Ÿè¯‘ä½œæ¨¡ä»¿å¯¹è±¡ï¼‰æ˜¯ä»¥å¯æ§çš„æ–¹å¼æ¨¡æ‹ŸçœŸå®å¯¹è±¡è¡Œä¸ºçš„å‡çš„å¯¹è±¡ã€‚ç¨‹åºå‘˜é€šå¸¸åˆ›é€ æ¨¡æ‹Ÿå¯¹è±¡æ¥æµ‹è¯•å…¶ä»–å¯¹è±¡çš„è¡Œä¸ºï¼Œå¾ˆç±»ä¼¼æ±½è½¦è®¾è®¡è€…ä½¿ç”¨ç¢°æ’æµ‹è¯•å‡äººæ¥æ¨¡æ‹Ÿè½¦è¾†ç¢°æ’ä¸­äººçš„åŠ¨æ€è¡Œä¸ºã€‚</p></blockquote><ul><li>æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œå¦‚æœä½ åªæ˜¯éœ€è¦ä»¿ç…§æ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå°±ç”¨<code>stub</code>ï¼Œå¦‚æœéœ€è¦ä»¿ç…§çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ç”¨<code>mock</code></li></ul><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">describe(@<span class="string">"HomeViewController"</span>, ^&#123;</span><br><span class="line">    <span class="built_in">context</span>(@<span class="string">"when click a cell in table view"</span>, ^&#123;</span><br><span class="line">        it(@<span class="string">"A PushViewController should be pushed"</span>, ^&#123;</span><br><span class="line">            HomeViewController *homeViewController = [[HomeViewController alloc] init]<span class="comment">;</span></span><br><span class="line">            UIView *view = homeViewController.view<span class="comment">;</span></span><br><span class="line">            [[view <span class="keyword">shouldNot] </span><span class="keyword">beNil];</span></span><br><span class="line"><span class="keyword"> </span>           </span><br><span class="line">            UINavigationController *mockNavController = [UINavigationController mock]<span class="comment">;</span></span><br><span class="line">            [homeViewController stub:@selector(navigationController) <span class="keyword">andReturn:mockNavController];</span></span><br><span class="line"><span class="keyword"> </span>           </span><br><span class="line">            [[mockNavController <span class="keyword">should] </span>receive:@selector(pushViewController:animated:)]<span class="comment">;</span></span><br><span class="line">            KWCaptureSpy *spy = [mockNavController captureArgument:@selector(pushViewController:animated:) atIndex:<span class="number">0</span>]<span class="comment">;</span></span><br><span class="line">            [homeViewController tableView:homeViewController.tableView <span class="keyword">didSelectRowAtIndexPath:[NSIndexPath </span>indexPathForRow:<span class="number">0</span> <span class="keyword">inSection:0]];</span></span><br><span class="line"><span class="keyword"> </span>           </span><br><span class="line">            id obj = spy.argument<span class="comment">;</span></span><br><span class="line">            PushViewController *vc = obj<span class="comment">;</span></span><br><span class="line">            [[vc <span class="keyword">should] </span><span class="keyword">beKindOfClass:[PushViewController </span>class]]<span class="comment">;</span></span><br><span class="line">        &#125;)<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">&#125;)<span class="comment">;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Kiwi-æµ‹è¯•æ¡†æ¶&quot;&gt;&lt;a href=&quot;#Kiwi-æµ‹è¯•æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;Kiwi æµ‹è¯•æ¡†æ¶&quot;&gt;&lt;/a&gt;Kiwi æµ‹è¯•æ¡†æ¶&lt;/h3&gt;&lt;h4 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;Cocoapods&lt;/code&gt;å®‰è£…&lt;code&gt;Kiwi&lt;/code&gt;ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;target &#39;xxxTests&#39; do&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  inherit! :search_paths&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;# Pods for testing&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  pod &#39;Kiwi&#39;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£…&lt;code&gt;Kiwiçš„Xcode Template&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;ä¸‹è½½ &lt;a href=&quot;https://github.com/kiwi-bdd/Kiwi/tree/master/Xcode%20Templates&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Kiwi Template&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå®‰è£…è„šæœ¬ &lt;code&gt;sh ./install-templates.sh&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Object-Cï¼ŒUnit-Test" scheme="http://www.ghcoder.com/tags/Object-C%EF%BC%8CUnit-Test/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºR.Objå·¥å…·</title>
    <link href="http://www.ghcoder.com/2019/01/09/20190109/"/>
    <id>http://www.ghcoder.com/2019/01/09/20190109/</id>
    <published>2019-01-09T11:28:12.000Z</published>
    <updated>2019-01-09T03:45:18.003Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h3><ul><li>æƒ³é€šè¿‡R.Objè¿™ä¸ªå·¥å…·åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå»ç®¡ç†å›¾ç‰‡ã€å­—ç¬¦ä¸²ã€ä¸»é¢˜çš„èµ„æºæ–‡ä»¶ï¼Ÿï¼Ÿ</li><li>å¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªé™æ€åº“ã€æˆ–è€…åŠ¨æ€åº“ï¼Ÿï¼Ÿ</li><li>ä»¥åŠåæœŸå¦‚ä½•è‡ªå®šä¹‰ï¼Ÿï¼Ÿ</li></ul><a id="more"></a><h3 id="R-obj-é—®é¢˜ï¼š"><a href="#R-obj-é—®é¢˜ï¼š" class="headerlink" title="R.obj é—®é¢˜ï¼š"></a>R.obj é—®é¢˜ï¼š</h3><ul><li>å¦‚æœå›¾ç‰‡ä¸æ”¾åœ¨Assestä¸­çš„è¯ï¼Œä¼šæœ‰é—®é¢˜ï¼šä¾‹å¦‚å­˜åœ¨å›¾ç‰‡ <a href="mailto:`Test@2x.png" target="_blank" rel="noopener">`Test@2x.png</a><code>ã€</code><a href="mailto:Test@3x.png" target="_blank" rel="noopener">Test@3x.png</a><code>, æœ€åç¼–è¯‘æˆçš„æ¨¡æ¿ä¼šå­˜åœ¨ä¸¤å¼ å›¾ç‰‡åç§°</code>Test2x<code>ã€</code>Test3x`ï¼Œå¦‚æœç»Ÿä¸€å°†å›¾ç‰‡ç»Ÿä¸€æ”¾å…¥åˆ°Assestä¸­ï¼Œå°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚âŒ</li><li>å¦‚æœå›¾ç‰‡ä¸æ”¾åœ¨Assestä¸­çš„è¯ï¼Œå®ƒå½¢æˆçš„æ¨¡æ¿çš„ä»£ç å¦‚ä¸‹, è‡ªåŠ¨ä¼šå¸¦ä¸Šå›¾ç‰‡çš„åç¼€ï¼Œä½†æ˜¯æ”¾å…¥åˆ°Asstetä¸­åˆ™æ­£å¸¸ã€‚âŒ</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIImage</span>*)wifiConnectingShowBg &#123; <span class="keyword">return</span> [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"Wifi_connecting_show_bg.png"</span>]; &#125;</span><br></pre></td></tr></table></figure><pre><code>âƒ    * å¦‚æœä¸»é¡¹ç›®ä¸­å­˜åœ¨`R.obj`,é‚£ä¹ˆå­˜åœ¨äºä¸»ç›®å½•ä¸­çš„ä»»æ„å¤šä¸ª`Bundle`ï¼Œå…¶ä¸­å›¾ç‰‡å¯èƒ½å­˜åœ¨é‡å¤å¤šä¸ªï¼Œä½†æ˜¯ç”Ÿæˆçš„`R.obj`çš„æ¨¡æ¿æ–‡ä»¶æ˜¯å”¯ä¸€çš„ã€‚ä½†æ˜¯æœ¬è´¨ä¸Šæ²¡æœ‰å»é‡ã€‚âŒ  (è¿™é‡Œå¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬åˆ é™¤ï¼Œåœ¨elseçš„æ—¶å€™æ‰§è¡Œåˆ é™¤è„šæœ¬)ã€‚</code></pre><ul><li>ç›´æ¥æ›¿æ¢æ‰å›¾ç‰‡ï¼Œå¯ä»¥åŒæ­¥ã€‚âœ”ï¸ ï¼ˆæ¯æ¬¡ç¼–è¯‘çš„æ—¶å€™ï¼Œéƒ½ä¼šæ¯æ¬¡ç”Ÿæˆä¸€æ¬¡æ¨¡æ¿ï¼‰</li></ul><h3 id="é™æ€åº“å’ŒR-obj-é…åˆä½¿ç”¨çš„é—®é¢˜ï¼š"><a href="#é™æ€åº“å’ŒR-obj-é…åˆä½¿ç”¨çš„é—®é¢˜ï¼š" class="headerlink" title="é™æ€åº“å’ŒR.obj é…åˆä½¿ç”¨çš„é—®é¢˜ï¼š"></a>é™æ€åº“å’ŒR.obj é…åˆä½¿ç”¨çš„é—®é¢˜ï¼š</h3><h4 id="æƒ…å†µä¸€ï¼š"><a href="#æƒ…å†µä¸€ï¼š" class="headerlink" title="æƒ…å†µä¸€ï¼š"></a>æƒ…å†µä¸€ï¼š</h4><blockquote><ol><li>åˆ›å»ºäº†ä¸€å¥—<code>.framework</code>ã€<code>.a</code>çš„é™æ€åº“ã€‚</li><li>åˆ›å»ºäº†ä¸€å¥—<code>.bundle</code>çš„èµ„æºæ–‡ä»¶ã€‚ï¼ˆ<strong>é™æ€åº“æ²¡æœ‰ç›´æ¥è°ƒç”¨bundleé‡Œé¢çš„èµ„æº</strong>ï¼‰</li><li>ç»è¿‡<code>R.obj</code>ç¼–è¯‘è¿‡åã€‚</li></ol></blockquote><h4 id="ç»“æœï¼š"><a href="#ç»“æœï¼š" class="headerlink" title="ç»“æœï¼š"></a>ç»“æœï¼š</h4><ul><li><ol><li>å¤–éƒ¨å¯ä»¥ç›´æ¥è°ƒç”¨é™æ€åº“ä¸­çš„ä»£ç  âœ”ï¸</li></ol></li><li><ol start="2"><li>å›¾ç‰‡èµ„æºçš„åç§°ï¼Œç›®å‰æ²¡æ³•åˆ¶å®š<code>Bundle</code>çš„å‰ç¼€åç§° âŒ</li></ol></li></ul><h4 id="æƒ…å†µäºŒï¼š"><a href="#æƒ…å†µäºŒï¼š" class="headerlink" title="æƒ…å†µäºŒï¼š"></a>æƒ…å†µäºŒï¼š</h4><blockquote><ol><li>åˆ›å»ºäº†ä¸€å¥—<code>.framework</code>ã€<code>.a</code>çš„é™æ€åº“, ç›´æ¥é€šè¿‡<code>ä»£ç </code>çš„æ–¹å¼è·å–å¤–éƒ¨å…¬ç”¨<code>bundle</code>çš„èµ„æºã€‚</li><li>ç»è¿‡<code>R.obj</code>ç¼–è¯‘è¿‡åã€‚ä»£ç å¦‚ä¸‹ï¼š</li></ol></blockquote><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">icon.<span class="built_in">image</span> = [UIImage imageNamed:@<span class="string">"å¤–éƒ¨bundle/é€šè¿‡R.objç”Ÿæˆçš„å›¾ç‰‡"</span>];</span><br></pre></td></tr></table></figure><h4 id="ç»“æœï¼š-1"><a href="#ç»“æœï¼š-1" class="headerlink" title="ç»“æœï¼š"></a>ç»“æœï¼š</h4><ol><li>é¦–å…ˆè‡ªåŠ¨ç”Ÿæˆçš„R.objä¼šå†²çªï¼Œæ— ä¸å‘ç¼–è¯‘ã€‚âŒ</li><li>åœ¨é™æ€åº“ä¸­é€šè¿‡è°ƒç”¨<code>R.obj</code>ç¼–è¯‘åçš„æ¨¡æ¿ä»£ç ï¼Œæ˜¯å¯ä»¥æ˜¾ç¤ºæ­£å¸¸ï¼Œå¹¶ä¸”å¤–éƒ¨å¯ä»¥é€šè¿‡é™æ€åº“è°ƒèµ·è§†å›¾ã€‚âœ”ï¸</li></ol><h4 id="æƒ…å†µä¸‰ï¼š"><a href="#æƒ…å†µä¸‰ï¼š" class="headerlink" title="æƒ…å†µä¸‰ï¼š"></a>æƒ…å†µä¸‰ï¼š</h4><blockquote><ol><li>åˆ›å»ºäº†ä¸€å¥—<code>.framework</code>ã€<code>.a</code>çš„é™æ€åº“ã€‚</li><li>å¤šå¥—<code>bundle</code>èµ„æºã€‚ï¼ˆè¿™é‡Œå¯èƒ½ä¼šé‡å¤ï¼‰</li><li>ç»è¿‡<code>R.obj</code>ç¼–è¯‘è¿‡åã€‚</li></ol></blockquote><h4 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><ul><li>å¦‚æœä¸»é¡¹ç›®ä¸­å­˜åœ¨<code>R.obj</code>,é‚£ä¹ˆå­˜åœ¨äºä¸»ç›®å½•ä¸­çš„ä»»æ„å¤šä¸ª<code>Bundle</code>ï¼Œå…¶ä¸­å›¾ç‰‡å¯èƒ½å­˜åœ¨é‡å¤å¤šä¸ªï¼Œä½†æ˜¯ç”Ÿæˆçš„<code>R.obj</code>çš„æ¨¡æ¿æ–‡ä»¶æ˜¯å”¯ä¸€çš„ã€‚ä½†æ˜¯æœ¬è´¨ä¸Šæ²¡æœ‰å»é‡ã€‚âŒ  (è¿™é‡Œå¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬åˆ é™¤ï¼Œåœ¨elseçš„æ—¶å€™æ‰§è¡Œåˆ é™¤è„šæœ¬)</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç›®çš„&quot;&gt;&lt;a href=&quot;#ç›®çš„&quot; class=&quot;headerlink&quot; title=&quot;ç›®çš„&quot;&gt;&lt;/a&gt;ç›®çš„&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æƒ³é€šè¿‡R.Objè¿™ä¸ªå·¥å…·åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå»ç®¡ç†å›¾ç‰‡ã€å­—ç¬¦ä¸²ã€ä¸»é¢˜çš„èµ„æºæ–‡ä»¶ï¼Ÿï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªé™æ€åº“ã€æˆ–è€…åŠ¨æ€åº“ï¼Ÿï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä»¥åŠåæœŸå¦‚ä½•è‡ªå®šä¹‰ï¼Ÿï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Object-C" scheme="http://www.ghcoder.com/tags/Object-C/"/>
    
  </entry>
  
  <entry>
    <title>æ”¶é“¶å°å¼€å‘-å·¥å‚æ¨¡å¼-è®¾è®¡æ¨¡å¼(3)</title>
    <link href="http://www.ghcoder.com/2018/12/16/20181216/"/>
    <id>http://www.ghcoder.com/2018/12/16/20181216/</id>
    <published>2018-12-16T11:28:12.000Z</published>
    <updated>2018-12-17T04:54:27.422Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åœ¨å¼€å‘è¿™ä¸ªæ”¶é“¶å°é¡¹ç›®çš„æ—¶å€™ï¼Œå…¶å®ç”¨åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿ç”¨æœ€æœ€å¹¿æ³›çš„ï¼Œæˆ‘æƒ³é™¤äº†å•ä¾‹æ¨¡å¼ï¼Œå°±è¦æ•°ä»Šå¤©è¦è¯´çš„å·¥å‚æ¨¡å¼ï¼š"><a href="#åœ¨å¼€å‘è¿™ä¸ªæ”¶é“¶å°é¡¹ç›®çš„æ—¶å€™ï¼Œå…¶å®ç”¨åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿ç”¨æœ€æœ€å¹¿æ³›çš„ï¼Œæˆ‘æƒ³é™¤äº†å•ä¾‹æ¨¡å¼ï¼Œå°±è¦æ•°ä»Šå¤©è¦è¯´çš„å·¥å‚æ¨¡å¼ï¼š" class="headerlink" title="åœ¨å¼€å‘è¿™ä¸ªæ”¶é“¶å°é¡¹ç›®çš„æ—¶å€™ï¼Œå…¶å®ç”¨åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿ç”¨æœ€æœ€å¹¿æ³›çš„ï¼Œæˆ‘æƒ³é™¤äº†å•ä¾‹æ¨¡å¼ï¼Œå°±è¦æ•°ä»Šå¤©è¦è¯´çš„å·¥å‚æ¨¡å¼ï¼š"></a>åœ¨å¼€å‘è¿™ä¸ªæ”¶é“¶å°é¡¹ç›®çš„æ—¶å€™ï¼Œå…¶å®ç”¨åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿ç”¨æœ€æœ€å¹¿æ³›çš„ï¼Œæˆ‘æƒ³é™¤äº†å•ä¾‹æ¨¡å¼ï¼Œå°±è¦æ•°ä»Šå¤©è¦è¯´çš„å·¥å‚æ¨¡å¼ï¼š</h3><h4 id="é—®é¢˜ï¼šæˆ‘ä»¬åœ¨é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªæ”¯ä»˜åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº†é“¶è¡Œå¡æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è‡ªå·±çš„æ”¯ä»˜ï¼Œä½†æ˜¯è¿™ä¸ªæ”¯ä»˜çš„æ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯å…±æ€§å°±æ˜¯å¯ä»¥æ”¯ä»˜ï¼Œè¿™é‡Œå¦‚ä½•æŠ½è±¡å‘¢ï¼Ÿ"><a href="#é—®é¢˜ï¼šæˆ‘ä»¬åœ¨é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªæ”¯ä»˜åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº†é“¶è¡Œå¡æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è‡ªå·±çš„æ”¯ä»˜ï¼Œä½†æ˜¯è¿™ä¸ªæ”¯ä»˜çš„æ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯å…±æ€§å°±æ˜¯å¯ä»¥æ”¯ä»˜ï¼Œè¿™é‡Œå¦‚ä½•æŠ½è±¡å‘¢ï¼Ÿ" class="headerlink" title="é—®é¢˜ï¼šæˆ‘ä»¬åœ¨é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªæ”¯ä»˜åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº†é“¶è¡Œå¡æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è‡ªå·±çš„æ”¯ä»˜ï¼Œä½†æ˜¯è¿™ä¸ªæ”¯ä»˜çš„æ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯å…±æ€§å°±æ˜¯å¯ä»¥æ”¯ä»˜ï¼Œè¿™é‡Œå¦‚ä½•æŠ½è±¡å‘¢ï¼Ÿ"></a>é—®é¢˜ï¼šæˆ‘ä»¬åœ¨é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªæ”¯ä»˜åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº†é“¶è¡Œå¡æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è‡ªå·±çš„æ”¯ä»˜ï¼Œä½†æ˜¯è¿™ä¸ªæ”¯ä»˜çš„æ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯å…±æ€§å°±æ˜¯å¯ä»¥æ”¯ä»˜ï¼Œè¿™é‡Œå¦‚ä½•æŠ½è±¡å‘¢ï¼Ÿ</h4><h4 id="è§£ç­”ï¼šæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨å·¥å‚æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š"><a href="#è§£ç­”ï¼šæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨å·¥å‚æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š" class="headerlink" title="è§£ç­”ï¼šæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨å·¥å‚æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š"></a>è§£ç­”ï¼šæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨å·¥å‚æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</h4><a id="more"></a><h4 id="å·¥å‚æ¨¡å¼è®¾è®¡ä¸­çš„è§’è‰²æœ‰å“ªäº›ï¼š"><a href="#å·¥å‚æ¨¡å¼è®¾è®¡ä¸­çš„è§’è‰²æœ‰å“ªäº›ï¼š" class="headerlink" title="å·¥å‚æ¨¡å¼è®¾è®¡ä¸­çš„è§’è‰²æœ‰å“ªäº›ï¼š"></a>å·¥å‚æ¨¡å¼è®¾è®¡ä¸­çš„è§’è‰²æœ‰å“ªäº›ï¼š</h4><ol><li>æŠ½è±¡å·¥å‚(åè®®ã€æ¥å£)ã€‚</li><li>å…·ä½“å·¥å‚(éµå¾ªäº†ä¸Šé¢æ¥å£çš„å…·ä½“å·¥å‚)ã€‚</li><li>æŠ½è±¡äº§å“(å·¥å‚ç”Ÿäº§äº§å“çš„åè®®ã€æ¥å£)ã€‚</li><li>å…·ä½“äº§å“(éµå¾ªäº†ä¸Šé¢æ¥å£çš„å…·ä½“äº§å“)ã€‚</li></ol><h4 id="Demoå±•ç¤ºï¼Œè¿™é‡Œä»¥ä¸¤ç§æ”¯ä»˜æ–¹å¼ï¼ˆ1-AliPay-2-WeChatPayï¼‰"><a href="#Demoå±•ç¤ºï¼Œè¿™é‡Œä»¥ä¸¤ç§æ”¯ä»˜æ–¹å¼ï¼ˆ1-AliPay-2-WeChatPayï¼‰" class="headerlink" title="Demoå±•ç¤ºï¼Œè¿™é‡Œä»¥ä¸¤ç§æ”¯ä»˜æ–¹å¼ï¼ˆ1. AliPay  2. WeChatPayï¼‰"></a>Demoå±•ç¤ºï¼Œè¿™é‡Œä»¥ä¸¤ç§æ”¯ä»˜æ–¹å¼ï¼ˆ1. AliPay  2. WeChatPayï¼‰</h4><ul><li>æŠ½è±¡çš„æ”¯ä»˜â€å·¥å‚â€(è¯´ç™½äº†ï¼Œå°±æ˜¯äº§ç”Ÿæ”¯ä»˜çš„ä¸€ä¸ªç±»)ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸º<code>PayProtocol</code>ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@protocol</span> PayProtocol <span class="variable">&lt;NSObject&gt;</span></span><br><span class="line"></span><br><span class="line">- (id<span class="variable">&lt;PayItemProtocol&gt;</span>)getPayItem;</span><br><span class="line"></span><br><span class="line"><span class="meta">@end</span></span><br></pre></td></tr></table></figure><ul><li>ä¸Šé¢è¿™ä¸ªå·¥å‚åªä¼šç”Ÿäº§ä¸€ç§<code>ä¸œè¥¿</code>, è¿™ç§ä¸œè¥¿æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå«<code>PayItemProtocol</code>,è¯´ç™½äº†å°±æ˜¯æˆ‘ä»¬æ ¹æ®è¿™ç§æ”¯ä»˜æ–¹å¼ï¼Œäº§ç”Ÿçš„<code>Dictionary</code>çš„æ•°æ®ç»“æ„ï¼Œæœ€åå¯ä»¥æäº¤åˆ°åå°å»ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">PayItemProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)createPayRequestDatas;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><ul><li>ä¸‹é¢çœ‹ä¸€ä¸‹å…·ä½“ç±»å®ç°ï¼š</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*--AliPayçš„å…·ä½“å·¥å‚ç±»AliPayManager*/</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AliPayManager</span> : <span class="title">NSObject</span>&lt;<span class="title">PayProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AliPay.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AliPayManager</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>&lt;PayItemProtocol&gt;)getPayItem &#123; <span class="keyword">return</span> [[AliPay alloc] init]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*--AliPayItemçš„å…·ä½“å®ç°ç±»--*/</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AliPay</span> : <span class="title">NSObject</span>&lt;<span class="title">PayItemProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AliPay</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)createPayRequestDatas &#123;</span><br><span class="line">    <span class="keyword">return</span> @&#123;<span class="string">@"uid"</span>: <span class="string">@"aid_111"</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------ä¸‹é¢æ˜¯WeChatPay----------------------*/</span></span><br><span class="line"><span class="comment">/*--WeChatPayManager--*/</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WeChatPayManager</span> : <span class="title">NSObject</span>&lt;<span class="title">PayProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"WeChatPay.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WeChatPayManager</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>&lt;PayItemProtocol&gt;)getPayItem &#123; <span class="keyword">return</span> [[WeChatPay alloc] init]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*--WeChatPay--*/</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WeChatPay</span> : <span class="title">NSObject</span>&lt;<span class="title">PayItemProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WeChatPay</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)createPayRequestDatas &#123;</span><br><span class="line">    <span class="keyword">return</span> @&#123;<span class="string">@"uid"</span>: <span class="string">@"we_222"</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><ul><li>å…·ä½“ä½¿ç”¨, éœ€è¦æ”¹å˜çš„åªæœ‰ä¸€ä¸ªåœ°æ–¹ï¼Œè¿™é‡Œå°±èƒ½çœ‹å‡ºæ¥å·¥å‚ç±»çš„ä¼˜åŠ¿äº†ï¼š</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*--AliPayçš„ä½¿ç”¨æ–¹å¼--*/</span></span><br><span class="line">id&lt;<span class="symbol">PayProtocol</span>&gt;manager = [[<span class="symbol">AliPayManager</span> alloc] init];</span><br><span class="line">id&lt;<span class="symbol">PayItemProtocol</span>&gt;payItem = [manager getPayItem];</span><br><span class="line"><span class="symbol">NSLog</span>(@<span class="string">"%@"</span>, [payItem createPayRequestDatas]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*--WeChatPayçš„ä½¿ç”¨æ–¹å¼--*/</span></span><br><span class="line">id&lt;<span class="symbol">PayProtocol</span>&gt;manager = [[<span class="symbol">WeChatPayManager</span> alloc] init];</span><br><span class="line">id&lt;<span class="symbol">PayItemProtocol</span>&gt;payItem = [manager getPayItem];</span><br><span class="line"><span class="symbol">NSLog</span>(@<span class="string">"%@"</span>, [payItem createPayRequestDatas]);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;åœ¨å¼€å‘è¿™ä¸ªæ”¶é“¶å°é¡¹ç›®çš„æ—¶å€™ï¼Œå…¶å®ç”¨åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿ç”¨æœ€æœ€å¹¿æ³›çš„ï¼Œæˆ‘æƒ³é™¤äº†å•ä¾‹æ¨¡å¼ï¼Œå°±è¦æ•°ä»Šå¤©è¦è¯´çš„å·¥å‚æ¨¡å¼ï¼š&quot;&gt;&lt;a href=&quot;#åœ¨å¼€å‘è¿™ä¸ªæ”¶é“¶å°é¡¹ç›®çš„æ—¶å€™ï¼Œå…¶å®ç”¨åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿ç”¨æœ€æœ€å¹¿æ³›çš„ï¼Œæˆ‘æƒ³é™¤äº†å•ä¾‹æ¨¡å¼ï¼Œå°±è¦æ•°ä»Šå¤©è¦è¯´çš„å·¥å‚æ¨¡å¼ï¼š&quot; class=&quot;headerlink&quot; title=&quot;åœ¨å¼€å‘è¿™ä¸ªæ”¶é“¶å°é¡¹ç›®çš„æ—¶å€™ï¼Œå…¶å®ç”¨åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿ç”¨æœ€æœ€å¹¿æ³›çš„ï¼Œæˆ‘æƒ³é™¤äº†å•ä¾‹æ¨¡å¼ï¼Œå°±è¦æ•°ä»Šå¤©è¦è¯´çš„å·¥å‚æ¨¡å¼ï¼š&quot;&gt;&lt;/a&gt;åœ¨å¼€å‘è¿™ä¸ªæ”¶é“¶å°é¡¹ç›®çš„æ—¶å€™ï¼Œå…¶å®ç”¨åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿ç”¨æœ€æœ€å¹¿æ³›çš„ï¼Œæˆ‘æƒ³é™¤äº†å•ä¾‹æ¨¡å¼ï¼Œå°±è¦æ•°ä»Šå¤©è¦è¯´çš„å·¥å‚æ¨¡å¼ï¼š&lt;/h3&gt;&lt;h4 id=&quot;é—®é¢˜ï¼šæˆ‘ä»¬åœ¨é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªæ”¯ä»˜åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº†é“¶è¡Œå¡æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è‡ªå·±çš„æ”¯ä»˜ï¼Œä½†æ˜¯è¿™ä¸ªæ”¯ä»˜çš„æ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯å…±æ€§å°±æ˜¯å¯ä»¥æ”¯ä»˜ï¼Œè¿™é‡Œå¦‚ä½•æŠ½è±¡å‘¢ï¼Ÿ&quot;&gt;&lt;a href=&quot;#é—®é¢˜ï¼šæˆ‘ä»¬åœ¨é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªæ”¯ä»˜åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº†é“¶è¡Œå¡æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è‡ªå·±çš„æ”¯ä»˜ï¼Œä½†æ˜¯è¿™ä¸ªæ”¯ä»˜çš„æ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯å…±æ€§å°±æ˜¯å¯ä»¥æ”¯ä»˜ï¼Œè¿™é‡Œå¦‚ä½•æŠ½è±¡å‘¢ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜ï¼šæˆ‘ä»¬åœ¨é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªæ”¯ä»˜åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº†é“¶è¡Œå¡æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è‡ªå·±çš„æ”¯ä»˜ï¼Œä½†æ˜¯è¿™ä¸ªæ”¯ä»˜çš„æ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯å…±æ€§å°±æ˜¯å¯ä»¥æ”¯ä»˜ï¼Œè¿™é‡Œå¦‚ä½•æŠ½è±¡å‘¢ï¼Ÿ&quot;&gt;&lt;/a&gt;é—®é¢˜ï¼šæˆ‘ä»¬åœ¨é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªæ”¯ä»˜åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº†é“¶è¡Œå¡æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è‡ªå·±çš„æ”¯ä»˜ï¼Œä½†æ˜¯è¿™ä¸ªæ”¯ä»˜çš„æ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯å…±æ€§å°±æ˜¯å¯ä»¥æ”¯ä»˜ï¼Œè¿™é‡Œå¦‚ä½•æŠ½è±¡å‘¢ï¼Ÿ&lt;/h4&gt;&lt;h4 id=&quot;è§£ç­”ï¼šæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨å·¥å‚æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&quot;&gt;&lt;a href=&quot;#è§£ç­”ï¼šæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨å·¥å‚æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&quot; class=&quot;headerlink&quot; title=&quot;è§£ç­”ï¼šæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨å·¥å‚æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&quot;&gt;&lt;/a&gt;è§£ç­”ï¼šæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨å·¥å‚æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&lt;/h4&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Object-Cã€è®¾è®¡æ¨¡å¼" scheme="http://www.ghcoder.com/tags/Object-C%E3%80%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ”¶é“¶å°å¼€å‘-è¿­ä»£å™¨æ¨¡å¼-è®¾è®¡æ¨¡å¼(2)</title>
    <link href="http://www.ghcoder.com/2018/12/14/20181214/"/>
    <id>http://www.ghcoder.com/2018/12/14/20181214/</id>
    <published>2018-12-14T09:48:12.000Z</published>
    <updated>2018-12-14T07:41:28.381Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é—®é¢˜ï¼š-æ”¶é“¶å°å…¶ä¸­ä¸€ä¸ªå¤æ‚ç‚¹ï¼šå¯¹æ¥çš„åå°æ•°æ®ï¼Œä¼šæœ‰å¾ˆå¤šç§è¯·æ±‚æ•°æ®ç»“æ„ï¼Œä½ éƒ½éœ€è¦å°†è¿™äº›ä¸åŒçš„æ•°æ®ç»„è£…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å±•ç¤ºï¼Œä¾‹å¦‚ï¼š"><a href="#é—®é¢˜ï¼š-æ”¶é“¶å°å…¶ä¸­ä¸€ä¸ªå¤æ‚ç‚¹ï¼šå¯¹æ¥çš„åå°æ•°æ®ï¼Œä¼šæœ‰å¾ˆå¤šç§è¯·æ±‚æ•°æ®ç»“æ„ï¼Œä½ éƒ½éœ€è¦å°†è¿™äº›ä¸åŒçš„æ•°æ®ç»„è£…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å±•ç¤ºï¼Œä¾‹å¦‚ï¼š" class="headerlink" title="é—®é¢˜ï¼š æ”¶é“¶å°å…¶ä¸­ä¸€ä¸ªå¤æ‚ç‚¹ï¼šå¯¹æ¥çš„åå°æ•°æ®ï¼Œä¼šæœ‰å¾ˆå¤šç§è¯·æ±‚æ•°æ®ç»“æ„ï¼Œä½ éƒ½éœ€è¦å°†è¿™äº›ä¸åŒçš„æ•°æ®ç»„è£…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å±•ç¤ºï¼Œä¾‹å¦‚ï¼š"></a>é—®é¢˜ï¼š æ”¶é“¶å°å…¶ä¸­ä¸€ä¸ªå¤æ‚ç‚¹ï¼šå¯¹æ¥çš„åå°æ•°æ®ï¼Œä¼šæœ‰å¾ˆå¤šç§è¯·æ±‚æ•°æ®ç»“æ„ï¼Œä½ éƒ½éœ€è¦å°†è¿™äº›ä¸åŒçš„æ•°æ®ç»„è£…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å±•ç¤ºï¼Œä¾‹å¦‚ï¼š</h3><ul><li>ä¾‹å¦‚å¯ç”¨æ”¯ä»˜æ–¹å¼çš„å±•ç¤ºï¼ˆå±•ç¤ºå„ä¸ªå¯ç”¨é“¶è¡Œå¡å‚¨è“„å¡ã€ä¿¡ç”¨å¡ã€ç§¯åˆ†ç­‰ç­‰ï¼‰</li><li>ä¾‹å¦‚è®¢å•æ˜ç»†çš„å±•ç¤ºï¼ˆå±•ç¤ºå„ä¸ªå¯ç”¨é“¶è¡Œå¡å‚¨è“„å¡ã€ä¿¡ç”¨å¡ã€ç§¯åˆ†ç­‰ç­‰ä¸åŒæ¸ é“æ¥æºæ•°æ®ï¼‰</li></ul><a id="more"></a><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><ul><li>è¿™é‡Œå°±éœ€è¦ç”¨åˆ°è¿­ä»£å™¨çš„è®¾è®¡æ¨¡å¼</li></ul><h3 id="è§’è‰²"><a href="#è§’è‰²" class="headerlink" title="è§’è‰²"></a>è§’è‰²</h3><ul><li>è¿­ä»£å™¨æ¥å£ (æ–¹æ³•ï¼š<code>func hasNext() -&gt; Bool</code>ã€ <code>func next() -&gt; BaseModelProtocol?</code>)</li><li>éµå¾ªè¿­ä»£å™¨æ¥å£çš„å®ä½“ç±»(<code>DefaultIteratorConcrete</code>-&gt; çˆ¶ç±»ï¼Œå…¶ä»–çš„å­ç±»å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°)</li><li>å®¹å™¨æ¥å£ <code>ContainerProtocol</code></li><li>éµå¾ªå®¹å™¨æ¥å£çš„å®ä½“ç±» <code>AliPayContainer</code>ã€<code>WeChatContainer</code></li></ul><h3 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h3><ul><li>æ•°æ®æ¨¡å‹å±‚æ¥å£çš„è®¾è®¡<code>BaseModelProtocol</code>:</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*-----æ¨¡å‹å±‚æ¥å£çš„å®šä¹‰------*/</span></span><br><span class="line">protocol BaseModelProtocol &#123;</span><br><span class="line">    <span class="keyword">var</span> uid: String &#123; <span class="keyword">set</span> <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*------æ¨¡å‹å±‚çš„ä¸¤ä¸ªå®ä½“ç±»AliPayModelã€WeChatModel----------*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AliPayModel</span>: <span class="type">NSObject</span>, <span class="type">BaseModelProtocol &#123;</span></span></span><br><span class="line">    <span class="keyword">var</span> uid: String</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(aliPayID: String) &#123;</span><br><span class="line">        self.uid = aliPayID</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeChatModel</span>: <span class="type">NSObject</span>, <span class="type">BaseModelProtocol &#123;</span></span></span><br><span class="line">    <span class="keyword">var</span> uid: String</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(weChatID: String) &#123;</span><br><span class="line">        self.uid = weChatID</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿­ä»£å™¨æ¥å£çš„å®šä¹‰ï¼š</li></ul><blockquote><p>è¿™é‡ŒDefaultIteratorConcreteï¼Œå¯ä»¥é€šè¿‡Protocol Extensionçš„åŠŸèƒ½ï¼Œå¯¹åè®®IteratorProtocolå®ç°é»˜è®¤çš„ï¼Œä½†æ˜¯è¿™é‡Œä¸ºäº†åœ¨Javaç­‰å…¶ä»–å¹³å°éƒ½èƒ½è¿ç”¨åŒä¸€å¥—æ¶æ„æ¨¡å¼ï¼Œæ‰€ä»¥é€‰ç”¨äº†åŸºç±»çš„å®ç°æ–¹å¼ã€‚</p></blockquote><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*----è¿­ä»£å™¨æ¥å£çš„å®šä¹‰-------*/</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">IteratorProtocol</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hasNext</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">BaseModelProtocol</span>?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*------éµå¾ªè¿­ä»£å™¨æ¥å£çš„åŸºç±»å®ç°-------*/</span></span><br><span class="line"><span class="comment">/*--------è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªæ³›å‹---------*/</span></span><br><span class="line"><span class="comment">/*--æ³¨æ„ï¼šè¿™é‡Œå¯ä»¥é€šè¿‡Protcol Extension, è€Œä¸éœ€è¦ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼å»å®ç°ï¼Œè¿™æ ·çš„è¯å°±ä¸è¦è¿™ä¸ªDefaultIteratorConcreteç±»äº†--*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultIteratorConcrete</span>&lt;<span class="title">T</span>&gt;: <span class="title">IteratorProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> obj: <span class="type">T</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(obj: <span class="type">T</span>) &#123; <span class="keyword">self</span>.obj = obj &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hasNext</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">BaseModelProtocol</span>? &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*--AliPayçš„è¿­ä»£å™¨ï¼Œè¿™é‡Œçš„æ•°æ®ç»“æ„ç»Ÿä¸€æ”¾å…¥åˆ°æ•°ç»„ä¸­å»å®ç°ï¼Œå…·ä½“çš„å®ç°é€šè¿‡è¦†å†™å­ç±»çš„æ–¹å¼--*/</span></span><br><span class="line"><span class="comment">/*--å¦‚æœç”¨äº†ä¸Šé¢Protocol Extensionçš„æ–¹å¼å»å®ç°ï¼Œå°±ä¸éœ€è¦è¦†å†™çš„æ–¹å¼å»å®ç°äº†--*/</span></span><br><span class="line"><span class="comment">/*--æ³¨æ„ï¼šå› ä¸ºä¸Šé¢åŸºç±»é‡Œé¢æˆ‘éœ€è¦ç”¨åˆ°çš„æ˜¯ä¸€ä¸ªé›†åˆçš„æ•°æ®ç±»å‹ï¼Œå› ä¸ºç”¨åˆ°äº†æ³›å‹ï¼Œè¿™é‡Œæˆ‘å°±ç”¨åˆ°äº†åµŒå¥—çš„æ³›å‹æ•°æ®é›†åˆ--*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AliPayIterator</span>: <span class="title">DefaultIteratorConcrete</span>&lt;<span class="title">Array</span>&lt;<span class="title">AliPayModel</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> datas: <span class="type">Array</span>&lt;<span class="type">AliPayModel</span>&gt; = <span class="type">Array</span>&lt;<span class="type">AliPayModel</span>&gt;()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> index = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(obj: <span class="type">Array</span>&lt;<span class="type">AliPayModel</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(obj: obj)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">BaseModelProtocol</span>? &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.hasNext() &#123;</span><br><span class="line">            <span class="keyword">let</span> result = <span class="keyword">self</span>.obj[<span class="keyword">self</span>.index]</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hasNext</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.index != <span class="keyword">self</span>.obj.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*--WeChatçš„è¿­ä»£å™¨å’Œä¸Šé¢çš„åŸºæœ¬ä¸€è‡´ï¼Œå”¯ä¸€çš„åŒºåˆ«è¿™é‡Œä½¿ç”¨çš„æ˜¯Setçš„æ•°æ®ç»“æ„--*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeChatItrator</span>: <span class="title">DefaultIteratorConcrete</span>&lt;<span class="title">Set</span>&lt;<span class="title">WeChatModel</span>&gt;&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> datas: <span class="type">Set</span>&lt;<span class="type">WeChatModel</span>&gt; = <span class="type">Set</span>&lt;<span class="type">WeChatModel</span>&gt;()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> iterator: <span class="type">SetIterator</span>&lt;<span class="type">WeChatModel</span>&gt;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> index: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(obj: <span class="type">Set</span>&lt;<span class="type">WeChatModel</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.iterator = obj.makeIterator()</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(obj: obj)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">BaseModelProtocol</span>? &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.hasNext() &#123;</span><br><span class="line">            <span class="keyword">let</span> result = <span class="keyword">self</span>.iterator.next()</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hasNext</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> index != <span class="keyword">self</span>.obj.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®¹å™¨æ¥å£çš„å®šä¹‰ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ContainerProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">DataType</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(obj: DataType)</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(obj: DataType)</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getIterator</span><span class="params">()</span></span> -&gt; <span class="type">IteratorProtocol</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">forEach</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>éµå¾ªå®¹å™¨æ¥å£çš„å®ä½“ç±»çš„å®ç°ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*--AliPayContainer--*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AliPayContainer</span>&lt;<span class="title">T</span>: <span class="title">BaseModelProtocol</span>&gt;: <span class="title">ContainerProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> data: <span class="type">Array</span>&lt;<span class="type">T</span>&gt; = <span class="type">Array</span>&lt;<span class="type">T</span>&gt;()</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> it = <span class="type">AliPayIterator</span>(obj: <span class="keyword">self</span>.data <span class="keyword">as</span>! <span class="type">Array</span>&lt;<span class="type">AliPayModel</span>&gt;)</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">DataType</span> = <span class="type">T</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(obj: DataType)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.data.append(obj)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(obj: DataType)</span></span> &#123;  &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getIterator</span><span class="params">()</span></span> -&gt; <span class="type">IteratorProtocol</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.it</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">forEach</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> data &#123;</span><br><span class="line">            <span class="built_in">print</span>(item)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*--WeChatContainer--*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeChatContainer</span>&lt;<span class="title">T</span>: <span class="title">WeChatModel</span>&gt;: <span class="title">ContainerProtocol</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> data: <span class="type">Set</span>&lt;<span class="type">T</span>&gt; = <span class="type">Set</span>&lt;<span class="type">T</span>&gt;()</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> it = <span class="type">WeChatItrator</span>(obj: <span class="keyword">self</span>.data)</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">DataType</span> = <span class="type">T</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(obj: DataType)</span></span> &#123; <span class="keyword">self</span>.data.insert(obj) &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(obj: DataType)</span></span> &#123;  &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getIterator</span><span class="params">()</span></span> -&gt; <span class="type">IteratorProtocol</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.it</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">forEach</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> data &#123;</span><br><span class="line">            <span class="built_in">print</span>(item)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘è‡ªå·±åˆå®šä¹‰äº†ä¸€ä¸ª<code>Container</code>çš„å®¹å™¨ç±»ï¼Œä¸ºäº†å°±æ˜¯æ–¹ä¾¿è°ƒç”¨ï¼Œéšè—å®ç°ç»†èŠ‚ï¼š</li></ul><blockquote><p>è¿™é‡Œæˆ‘è§‰å¾—å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œä»£ç å°±æœ‰ç‚¹å†™æ­»äº†ï¼Œå› ä¸ºåœ¨addä¸­éœ€è¦å…·ä½“æ ¹æ®ç±»å‹å»åˆ¤æ–­ï¼Œè¿™é‡Œæˆ‘è¿˜æ²¡æœ‰æƒ³å¥½ï¼ï¼</p></blockquote><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> aliPayContainer = <span class="type">AliPayContainer</span>&lt;<span class="type">AliPayModel</span>&gt;()</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> weChatContainer = <span class="type">WeChatContainer</span>&lt;<span class="type">WeChatModel</span>&gt;()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(<span class="number">_</span> item: BaseModelProtocol)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> item <span class="keyword">is</span> <span class="type">AliPayModel</span> &#123;</span><br><span class="line">            aliPayContainer.add(obj: item <span class="keyword">as</span>! <span class="type">AliPayModel</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> item <span class="keyword">is</span> <span class="type">WeChatModel</span> &#123;</span><br><span class="line">            weChatContainer.add(obj: item <span class="keyword">as</span>! <span class="type">WeChatModel</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">allObjects</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (aliPayContainer.getIterator().hasNext()) &#123; aliPayContainer.forEach() &#125;</span><br><span class="line">        <span class="keyword">if</span> (weChatContainer.getIterator().hasNext()) &#123; weChatContainer.forEach() &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…·ä½“å®ç°ï¼š</li></ul><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let <span class="keyword">container</span> = Container()</span><br><span class="line"><span class="keyword">container</span>.add(AliPayModel(aliPayID: <span class="string">"a2"</span>))</span><br><span class="line"><span class="keyword">container</span>.add(WeChatModel(weChatID: <span class="string">"w3"</span>))</span><br><span class="line"><span class="keyword">container</span>.allObjects()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;é—®é¢˜ï¼š-æ”¶é“¶å°å…¶ä¸­ä¸€ä¸ªå¤æ‚ç‚¹ï¼šå¯¹æ¥çš„åå°æ•°æ®ï¼Œä¼šæœ‰å¾ˆå¤šç§è¯·æ±‚æ•°æ®ç»“æ„ï¼Œä½ éƒ½éœ€è¦å°†è¿™äº›ä¸åŒçš„æ•°æ®ç»„è£…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å±•ç¤ºï¼Œä¾‹å¦‚ï¼š&quot;&gt;&lt;a href=&quot;#é—®é¢˜ï¼š-æ”¶é“¶å°å…¶ä¸­ä¸€ä¸ªå¤æ‚ç‚¹ï¼šå¯¹æ¥çš„åå°æ•°æ®ï¼Œä¼šæœ‰å¾ˆå¤šç§è¯·æ±‚æ•°æ®ç»“æ„ï¼Œä½ éƒ½éœ€è¦å°†è¿™äº›ä¸åŒçš„æ•°æ®ç»„è£…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å±•ç¤ºï¼Œä¾‹å¦‚ï¼š&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜ï¼š æ”¶é“¶å°å…¶ä¸­ä¸€ä¸ªå¤æ‚ç‚¹ï¼šå¯¹æ¥çš„åå°æ•°æ®ï¼Œä¼šæœ‰å¾ˆå¤šç§è¯·æ±‚æ•°æ®ç»“æ„ï¼Œä½ éƒ½éœ€è¦å°†è¿™äº›ä¸åŒçš„æ•°æ®ç»„è£…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å±•ç¤ºï¼Œä¾‹å¦‚ï¼š&quot;&gt;&lt;/a&gt;é—®é¢˜ï¼š æ”¶é“¶å°å…¶ä¸­ä¸€ä¸ªå¤æ‚ç‚¹ï¼šå¯¹æ¥çš„åå°æ•°æ®ï¼Œä¼šæœ‰å¾ˆå¤šç§è¯·æ±‚æ•°æ®ç»“æ„ï¼Œä½ éƒ½éœ€è¦å°†è¿™äº›ä¸åŒçš„æ•°æ®ç»„è£…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å±•ç¤ºï¼Œä¾‹å¦‚ï¼š&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚å¯ç”¨æ”¯ä»˜æ–¹å¼çš„å±•ç¤ºï¼ˆå±•ç¤ºå„ä¸ªå¯ç”¨é“¶è¡Œå¡å‚¨è“„å¡ã€ä¿¡ç”¨å¡ã€ç§¯åˆ†ç­‰ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚è®¢å•æ˜ç»†çš„å±•ç¤ºï¼ˆå±•ç¤ºå„ä¸ªå¯ç”¨é“¶è¡Œå¡å‚¨è“„å¡ã€ä¿¡ç”¨å¡ã€ç§¯åˆ†ç­‰ç­‰ä¸åŒæ¸ é“æ¥æºæ•°æ®ï¼‰&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swiftã€è®¾è®¡æ¨¡å¼" scheme="http://www.ghcoder.com/tags/Swift%E3%80%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ”¶é“¶å°å¼€å‘-è´£ä»»é“¾æ¨¡å¼-è®¾è®¡æ¨¡å¼(1)</title>
    <link href="http://www.ghcoder.com/2018/12/13/20181213/"/>
    <id>http://www.ghcoder.com/2018/12/13/20181213/</id>
    <published>2018-12-13T08:48:12.000Z</published>
    <updated>2018-12-12T09:32:17.735Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¸»è¦ç‹¬è‡ªå¼€å‘ä¸€ä¸ªæ”¶é“¶å°çš„æ¨¡å—ã€è¿™ä¸ªæ¨¡å—è®¾è®¡åˆ°çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥è‡ªå·±ä¹ŸèŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå»ç ”ç©¶è®¾è®¡æ¨¡å¼ï¼ŒæŠŠä»£ç å†™å¥½ï¼Œä¸‹é¢å°±ä¼šåˆ†å‡ ä¸ªç« èŠ‚åˆ†äº«ä¸€ä¸‹æˆ‘çš„å‡ ä¸ªå¿ƒå¾—"><a href="#åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¸»è¦ç‹¬è‡ªå¼€å‘ä¸€ä¸ªæ”¶é“¶å°çš„æ¨¡å—ã€è¿™ä¸ªæ¨¡å—è®¾è®¡åˆ°çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥è‡ªå·±ä¹ŸèŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå»ç ”ç©¶è®¾è®¡æ¨¡å¼ï¼ŒæŠŠä»£ç å†™å¥½ï¼Œä¸‹é¢å°±ä¼šåˆ†å‡ ä¸ªç« èŠ‚åˆ†äº«ä¸€ä¸‹æˆ‘çš„å‡ ä¸ªå¿ƒå¾—" class="headerlink" title="åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¸»è¦ç‹¬è‡ªå¼€å‘ä¸€ä¸ªæ”¶é“¶å°çš„æ¨¡å—ã€è¿™ä¸ªæ¨¡å—è®¾è®¡åˆ°çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥è‡ªå·±ä¹ŸèŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå»ç ”ç©¶è®¾è®¡æ¨¡å¼ï¼ŒæŠŠä»£ç å†™å¥½ï¼Œä¸‹é¢å°±ä¼šåˆ†å‡ ä¸ªç« èŠ‚åˆ†äº«ä¸€ä¸‹æˆ‘çš„å‡ ä¸ªå¿ƒå¾—"></a>åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¸»è¦ç‹¬è‡ªå¼€å‘ä¸€ä¸ªæ”¶é“¶å°çš„æ¨¡å—ã€è¿™ä¸ªæ¨¡å—è®¾è®¡åˆ°çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥è‡ªå·±ä¹ŸèŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå»ç ”ç©¶è®¾è®¡æ¨¡å¼ï¼ŒæŠŠä»£ç å†™å¥½ï¼Œä¸‹é¢å°±ä¼šåˆ†å‡ ä¸ªç« èŠ‚åˆ†äº«ä¸€ä¸‹æˆ‘çš„å‡ ä¸ªå¿ƒå¾—</h3><a id="more"></a><h3 id="é‡åˆ°æƒ…å†µï¼š"><a href="#é‡åˆ°æƒ…å†µï¼š" class="headerlink" title="é‡åˆ°æƒ…å†µï¼š"></a>é‡åˆ°æƒ…å†µï¼š</h3><ul><li>åŠ¨æ€çš„å»å†³å®šæ”¯ä»˜çš„æ–¹å¼(ç±»ä¼¼æ”¯ä»˜åŒ…åŠ¨æ€æ”¯ä»˜ï¼Œå¯èƒ½åœ¨ä¸åŒåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¼šèµ°ä¸åŒæ”¯ä»˜æ–¹å¼ï¼Œå¯ä»¥æ˜¯ä½™é¢ï¼Œå¯ä»¥æ˜¯æŸé“¶è¡Œã€å¯ä»¥æ˜¯ä½™é¢å®ã€å¯ä»¥æ˜¯èŠ±å‘—ï¼Œé‚£è¿™æ ·çš„è¯ï¼Œå¯èƒ½ä¼šæ ¹æ®å¤šä¸ªå› ç´ ç»¼åˆå»åˆ¤æ–­ï¼Œåˆ°åº•æ˜¯èµ°ä»€ä¹ˆæ”¯ä»˜)ã€‚</li><li>æˆ‘ä»¬è¿™é‡Œä¸ºäº†è¯´æ˜æƒ…å†µï¼Œå°±å•ä¸€åªä»é‡‘é¢å»åˆ¤æ–­ï¼ˆè¿™é‡Œå‡è®¾ä½ çš„å‡ ç§æ”¯ä»˜æ¸ é“éƒ½æ˜¯å­˜åœ¨é’±çš„ï¼â€“&gt; ä½†æ˜¯å…¶å®è¿™é‡Œçš„æœ‰æ²¡æœ‰é’±ï¼Œå…¶å®ä½ è¿˜æ˜¯è¦èµ°æœåŠ¡å™¨å»æŸ¥è¯¢çš„ï¼‰</li></ul><h3 id="è§£å†³é—®é¢˜ï¼š"><a href="#è§£å†³é—®é¢˜ï¼š" class="headerlink" title="è§£å†³é—®é¢˜ï¼š"></a>è§£å†³é—®é¢˜ï¼š</h3><h4 id="å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªè§’è‰²"><a href="#å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªè§’è‰²" class="headerlink" title="å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªè§’è‰²"></a>å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªè§’è‰²</h4><ol><li>æŠ½è±¡AbsPayWayç±»ï¼šï¼ˆ1. ä¸‹ä¸€èŠ‚ç‚¹çš„å±æ€§  2. chooseToPayçš„æ–¹æ³•ï¼‰</li><li>å…·ä½“çš„PayWayç±»ï¼šï¼ˆ1. ä½™é¢ï¼ˆBalancePayWayï¼‰2. èŠ±å‘—ï¼ˆHuaPayWayï¼‰3. é“¶è¡Œï¼ˆBankPayWayï¼‰ï¼‰</li><li>PayWayParamtersç±» ï¼ˆ1. æ”¯ä»˜é‡‘é¢ï¼ˆpayMentAmountï¼‰ï¼‰</li></ol><h4 id="å…·ä½“ä»£ç "><a href="#å…·ä½“ä»£ç " class="headerlink" title="å…·ä½“ä»£ç "></a>å…·ä½“ä»£ç </h4><ul><li>AbsPayWayç±»</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbsPayWay</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> nextPayWay: <span class="type">AbsPayWay</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±é¡¹ç›®çš„æƒ…å†µæ¥é…ç½®ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œæ˜¯å¯ä»¥æœ‰è‡ªå·±æ¥æ”¯ä»˜çš„ï¼Œä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦äº¤ç”±ä¸‹ä¸€çº§æ¥æ”¯ä»˜</span></span><br><span class="line">    <span class="keyword">final</span> <span class="function"><span class="keyword">func</span> <span class="title">chooseToPay</span><span class="params">(paywayParamters: PayWayParamters)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> paywayParamters.payMentAmount &lt;= <span class="keyword">self</span>.configPayAmount() &#123;</span><br><span class="line">            <span class="keyword">self</span>.configAndToPay(paywayParamters: paywayParamters)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> <span class="number">_</span> = <span class="keyword">self</span>.nextPayWay &#123;</span><br><span class="line">            <span class="keyword">self</span>.nextPayWay?.chooseToPay(paywayParamters: paywayParamters)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"å·²ç»è¶…å‡ºæœ€å¤§é™é¢äº†ï¼ï¼ï¼"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">configPayAmount</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">0</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">configAndToPay</span><span class="params">(paywayParamters: PayWayParamters)</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>PayWayParamtersç±»ç»“æ„</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayWayParamters</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> payMentAmount: <span class="built_in">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(payMentAmount: <span class="built_in">Int</span>) &#123;</span><br><span class="line">        self.payMentAmount = payMentAmount</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ”¯ä»˜çš„å…·ä½“å‡ ç§æ–¹å¼ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*----1.BalancePayWayï¼ˆä½™é¢ï¼‰------*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BalancePayWay</span>: <span class="title">AbsPayWay</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä½™é¢çš„æ”¯ä»˜é¢åº¦åªæœ‰10å…ƒ</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">configPayAmount</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœä½™é¢æ”¯ä»˜äº†ï¼Œæˆ‘è¿™é‡Œéœ€è¦æ ¹æ®è¿™ç§æƒ…å†µå®Œæˆè‡ªå·±çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">configAndToPay</span><span class="params">(paywayParamters: PayWayParamters)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"ä½™é¢æ”¯ä»˜äº†\(paywayParamters.payMentAmount)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*----2.HuaPayWayï¼ˆèŠ±å‘—ï¼‰------*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HuaPayWay</span>: <span class="title">AbsPayWay</span> </span>&#123;</span><br><span class="line">    <span class="comment">// èŠ±å‘—çš„æ”¯ä»˜é¢åº¦åªæœ‰100å…ƒ</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">configPayAmount</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœèŠ±å‘—æ”¯ä»˜äº†ï¼Œæˆ‘è¿™é‡Œéœ€è¦æ ¹æ®è¿™ç§æƒ…å†µå®Œæˆè‡ªå·±çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">configAndToPay</span><span class="params">(paywayParamters: PayWayParamters)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"èŠ±å‘—æ”¯ä»˜äº†\(paywayParamters.payMentAmount)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*----3.BankPayWayï¼ˆé“¶è¡Œæ”¯ä»˜ï¼‰------*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankPayWay</span>: <span class="title">AbsPayWay</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é“¶è¡Œçš„æ”¯ä»˜é¢åº¦åªæœ‰10000å…ƒ</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">configPayAmount</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10000</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœé“¶è¡Œæ”¯ä»˜äº†ï¼Œæˆ‘è¿™é‡Œéœ€è¦æ ¹æ®è¿™ç§æƒ…å†µå®Œæˆè‡ªå·±çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">configAndToPay</span><span class="params">(paywayParamters: PayWayParamters)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"é“¶è¡Œæ”¯ä»˜äº†\(paywayParamters.payMentAmount)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…·ä½“ä½¿ç”¨ï¼Œè¿™é‡Œä¸ºäº†æ”¶æ‹¢ï¼Œéšè—å®ç°ç»†èŠ‚ï¼Œåˆ›å»ºä¸€ä¸ªæ”¯ä»˜çš„ç±»Pay</li></ul><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">PayObject</span> &#123;</span></span><br><span class="line"><span class="class">    </span></span><br><span class="line"><span class="class">    <span class="keyword">class</span> func pay(<span class="title">amount</span>: <span class="type">Int</span>) &#123;</span></span><br><span class="line"><span class="class">        let balancePayWay = <span class="type">BalancePayWay</span>()</span></span><br><span class="line"><span class="class">        let huaPayWay = <span class="type">HuaPayWay</span>()</span></span><br><span class="line"><span class="class">        let bankPayWay = <span class="type">BankPayWay</span>()</span></span><br><span class="line"><span class="class">        balancePayWay.nextPayWay = huaPayWay</span></span><br><span class="line"><span class="class">        huaPayWay.nextPayWay = bankPayWay</span></span><br><span class="line"><span class="class">        </span></span><br><span class="line"><span class="class">        let payparamters = <span class="type">PayWayParamters</span>(<span class="title">payMentAmount</span>: <span class="title">amount</span>)</span></span><br><span class="line"><span class="class">        balancePayWay.chooseToPay(<span class="title">paywayParamters</span>: <span class="title">payparamters</span>)</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    </span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">/*<span class="comment">----Final: å…·ä½“ä½¿ç”¨-----*/ </span></span></span><br><span class="line"><span class="class"><span class="type">PayObject</span>.pay(<span class="title">amount</span>: 1)</span></span><br><span class="line"><span class="class">// ç»ˆç«¯æ˜¾ç¤º ä½™é¢æ”¯ä»˜äº†1</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="type">PayObject</span>.pay(<span class="title">amount</span>: 11)</span></span><br><span class="line"><span class="class">// ç»ˆç«¯æ˜¾ç¤º èŠ±å‘—æ”¯ä»˜äº†11</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="type">PayObject</span>.pay(<span class="title">amount</span>: 101)</span></span><br><span class="line"><span class="class">// ç»ˆç«¯æ˜¾ç¤º é“¶è¡Œæ”¯ä»˜äº†101</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="type">PayObject</span>.pay(<span class="title">amount</span>: 100000001)</span></span><br><span class="line"><span class="class">// ç»ˆç«¯æ˜¾ç¤º å·²ç»è¶…å‡ºæœ€å¤§é™é¢äº†ï¼ï¼ï¼</span></span><br></pre></td></tr></table></figure><h3 id="å­˜åœ¨é—®é¢˜ï¼š"><a href="#å­˜åœ¨é—®é¢˜ï¼š" class="headerlink" title="å­˜åœ¨é—®é¢˜ï¼š"></a>å­˜åœ¨é—®é¢˜ï¼š</h3><ol><li>è¿™é‡Œä½¿ç”¨çš„åœºæ™¯æ˜¯ä¼šå­˜åœ¨ç­‰çº§ã€æˆ–è€…å…ˆåé¡ºåºçš„ï¼Œéœ€è¦å…·ä½“è€ƒè™‘ã€‚</li><li>è¿™é‡Œçš„PayWayParamtersï¼Œæ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œä¹Ÿå¯ä»¥å£°æ˜æˆä¸€ä¸ªæŠ½è±¡çš„ç±»ï¼Œç„¶ååœ¨ç”¨ä¸åŒçš„å®ä½“PayWayParamtersæ¥ä½¿ç”¨ã€‚</li><li>è¿™é‡Œå¯ä»¥è€ƒè™‘ä¸ç”¨ç»§æ‰¿æ¢åšåè®®å¯ä»¥è¯•è¯•ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¸»è¦ç‹¬è‡ªå¼€å‘ä¸€ä¸ªæ”¶é“¶å°çš„æ¨¡å—ã€è¿™ä¸ªæ¨¡å—è®¾è®¡åˆ°çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥è‡ªå·±ä¹ŸèŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå»ç ”ç©¶è®¾è®¡æ¨¡å¼ï¼ŒæŠŠä»£ç å†™å¥½ï¼Œä¸‹é¢å°±ä¼šåˆ†å‡ ä¸ªç« èŠ‚åˆ†äº«ä¸€ä¸‹æˆ‘çš„å‡ ä¸ªå¿ƒå¾—&quot;&gt;&lt;a href=&quot;#åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¸»è¦ç‹¬è‡ªå¼€å‘ä¸€ä¸ªæ”¶é“¶å°çš„æ¨¡å—ã€è¿™ä¸ªæ¨¡å—è®¾è®¡åˆ°çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥è‡ªå·±ä¹ŸèŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå»ç ”ç©¶è®¾è®¡æ¨¡å¼ï¼ŒæŠŠä»£ç å†™å¥½ï¼Œä¸‹é¢å°±ä¼šåˆ†å‡ ä¸ªç« èŠ‚åˆ†äº«ä¸€ä¸‹æˆ‘çš„å‡ ä¸ªå¿ƒå¾—&quot; class=&quot;headerlink&quot; title=&quot;åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¸»è¦ç‹¬è‡ªå¼€å‘ä¸€ä¸ªæ”¶é“¶å°çš„æ¨¡å—ã€è¿™ä¸ªæ¨¡å—è®¾è®¡åˆ°çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥è‡ªå·±ä¹ŸèŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå»ç ”ç©¶è®¾è®¡æ¨¡å¼ï¼ŒæŠŠä»£ç å†™å¥½ï¼Œä¸‹é¢å°±ä¼šåˆ†å‡ ä¸ªç« èŠ‚åˆ†äº«ä¸€ä¸‹æˆ‘çš„å‡ ä¸ªå¿ƒå¾—&quot;&gt;&lt;/a&gt;åœ¨ä¸Šä¸€å®¶å…¬å¸ï¼Œä¸»è¦ç‹¬è‡ªå¼€å‘ä¸€ä¸ªæ”¶é“¶å°çš„æ¨¡å—ã€è¿™ä¸ªæ¨¡å—è®¾è®¡åˆ°çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥è‡ªå·±ä¹ŸèŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå»ç ”ç©¶è®¾è®¡æ¨¡å¼ï¼ŒæŠŠä»£ç å†™å¥½ï¼Œä¸‹é¢å°±ä¼šåˆ†å‡ ä¸ªç« èŠ‚åˆ†äº«ä¸€ä¸‹æˆ‘çš„å‡ ä¸ªå¿ƒå¾—&lt;/h3&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swiftã€è®¾è®¡æ¨¡å¼" scheme="http://www.ghcoder.com/tags/Swift%E3%80%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>éè¶Šç‹±æ‰‹æœºæ¤å…¥åŠ¨æ€åº“</title>
    <link href="http://www.ghcoder.com/2018/12/12/20181212/"/>
    <id>http://www.ghcoder.com/2018/12/12/20181212/</id>
    <published>2018-12-12T01:48:12.000Z</published>
    <updated>2018-12-12T02:13:00.825Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç›®æ ‡ï¼š"><a href="#ç›®æ ‡ï¼š" class="headerlink" title="ç›®æ ‡ï¼š"></a>ç›®æ ‡ï¼š</h3><p>1.ä¿®æ”¹çˆ±å¥‡è‰ºApp<br>2.å°†è¿™ä¸ªä¿®æ”¹è¿‡çš„Appé‡ç­¾å<br>3.å®‰è£…åœ¨æœªè¶Šç‹±æ‰‹æœºä¸Š</p><h3 id="å‡†å¤‡ï¼š"><a href="#å‡†å¤‡ï¼š" class="headerlink" title="å‡†å¤‡ï¼š"></a>å‡†å¤‡ï¼š</h3><p>1.è¶Šç‹±æ‰‹æœºå’Œä¸€å°æœªè¶Šç‹±æ‰‹æœº<br>2.Macç”µè„‘</p><a id="more"></a><h4 id="1-ä¿®æ”¹çˆ±å¥‡è‰ºApp"><a href="#1-ä¿®æ”¹çˆ±å¥‡è‰ºApp" class="headerlink" title="1. ä¿®æ”¹çˆ±å¥‡è‰ºApp"></a>1. ä¿®æ”¹çˆ±å¥‡è‰ºApp</h4><ul><li>æ­¥éª¤1. åœ¨è¶Šç‹±æ‰‹æœºAppStoreä¸Šä¸‹è½½çˆ±å¥‡è‰ºApp.</li><li>æ­¥éª¤2. åœ¨è¶Šç‹±æ‰‹æœºä¸Šæ‰¾åˆ°çˆ±å¥‡è‰ºçš„AppID, è¿™é‡Œå¯ä»¥é€šè¿‡<a href="https://github.com/CoderMJLee/MJAppTools" target="_blank" rel="noopener">MJAppTools</a>, å¿«é€ŸæŸ¥è¯¢(è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡<a href="http://www.cycript.org/" target="_blank" rel="noopener">Cycript</a>æ¥æ‰¾åˆ°)ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»ˆç«¯</span></span><br><span class="line">MJAppTools -l</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤º</span></span><br><span class="line">ã€çˆ±å¥‡è‰ºã€‘ &lt;com.qiyi.iphone&gt;</span><br><span class="line"><span class="regexp">/private/</span>var<span class="regexp">/mobile/</span>Containers<span class="regexp">/Bundle/</span>Application<span class="regexp">/C8575DD1-889E-4E70-AF66-4E4CC920F6AC/</span>iQiYiPhoneVideo.app</span><br><span class="line"><span class="regexp">/private/</span>var<span class="regexp">/mobile/</span>Containers<span class="regexp">/Data/</span>Application/CD9280DD-C4C3<span class="number">-4</span>CF2<span class="number">-84E0</span><span class="number">-5</span>F484596E211</span><br><span class="line">  arm_64 åŠ å£³</span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤3. åˆ›å»ºä¸€ä¸ªåå«<strong>libReveal.plist</strong>çš„æ–‡ä»¶ï¼Œå°†åˆšæ‰çš„AppIDcopyè¿›plistä¸­ï¼Œå¦‚ä¸‹:</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="built_in">Filter </span>= &#123;</span><br><span class="line">Bundles = (</span><br><span class="line"><span class="string">"com.qiyi.iphone"</span></span><br><span class="line">);</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤4. æ‰“å¼€Reveal</li></ul><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. æ‰¾åˆ°</span></span><br><span class="line">H<span class="function"><span class="title">elpe</span> -&gt;</span> S<span class="function"><span class="title">how</span> Reveal Library <span class="built_in">in</span> Finder -&gt;</span> iOS Library</span><br><span class="line"><span class="comment">//2. é‡å‘½å</span></span><br><span class="line">R<span class="function"><span class="title">evealServer</span> -&gt;</span> libReveal</span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤5. å°†libReveal.plist å’Œ libReveal.dylib åŒæ—¶ä¸Šä¼ åˆ°è¶Šç‹±æœºå™¨ä»¥ä¸‹è·¯å¾„ï¼ˆå¯ä»¥é€šè¿‡iFunBoxï¼‰ï¼š</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Device<span class="regexp">/Library/</span>MobileSubStrate<span class="regexp">/DynamicLibraries</span></span><br></pre></td></tr></table></figure><ul><li><p>æ­¥éª¤6. æ­¤æ—¶æ‰“å¼€Revealå’Œè¶Šç‹±æœºå™¨ä¸Šçš„çˆ±å¥‡è‰ºAppï¼Œç»“åˆ<a href="http://www.cycript.org/" target="_blank" rel="noopener">Cycript</a>æˆ–è€…<a href="https://github.com/CoderMJLee/mjcript" target="_blank" rel="noopener">mjcript</a>, å¯ä»¥æ‰¾åˆ°ä½ æƒ³è¦ä¿®æ”¹çš„ä¸œè¥¿æ‰€å±çš„ç±»ï¼Œè¿™é‡Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¿®æ”¹æ’­æ”¾çš„å¹¿å‘Šã€‚</p></li><li><p>æ­¥éª¤7. é€šè¿‡Revealå¯ä»¥æ‰¾åˆ°å¯åŠ¨é¡µé¢ç›¸å…³çš„å¹¿å‘ŠViewæ˜¯<code>QYStartADView</code>, å®ƒæ‰€å±çš„ç±»æ˜¯<code>QYStartADViewController</code></p></li><li><p>æ­¥éª¤8. é€šè¿‡<a href="https://github.com/KJCracks/Clutch" target="_blank" rel="noopener">Clutch</a>æˆ–<a href="https://github.com/stefanesser/dumpdecrypted" target="_blank" rel="noopener">dumpdecrypted</a>è„±å£³ï¼Œå¾—åˆ°è„±å£³åçš„æ–°Appã€‚æˆ‘ç”¨çš„æ˜¯Clutch,ä»£ç å¦‚ä¸‹:</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// ç½—åˆ—æ‰‹æœºä¸Šå¯ä»¥è„±å£³çš„App</span><br><span class="line">Clutch -i</span><br><span class="line">// è„±å£³æŒ‡å®šApp</span><br><span class="line">Clutch -d x(çˆ±å¥‡å¼‚çš„å‰é¢çš„æ•°å­—)</span><br><span class="line">// è¿”å›</span><br><span class="line">com.qiyi.iphone contains watchOS 2 compatible application. It's not possible to dump watchOS 2 apps <span class="keyword">with</span> Clutch <span class="number">2.0</span><span class="number">.4</span> <span class="keyword">at</span> this moment.</span><br><span class="line">Zipping iQiYiPhoneVideo.app</span><br><span class="line">ASLR slide: <span class="number">0x100004000</span></span><br><span class="line">Dumping &lt;QiYiUserNotification&gt; (arm64)</span><br><span class="line">Patched cryptid (<span class="number">64</span><span class="built_in">bit</span> <span class="keyword">segment</span>)</span><br><span class="line">ASLR slide: <span class="number">0x1000dc000</span></span><br><span class="line">Dumping &lt;QYToday&gt; (arm64)</span><br><span class="line">Patched cryptid (<span class="number">64</span><span class="built_in">bit</span> <span class="keyword">segment</span>)</span><br><span class="line">ASLR slide: <span class="number">0x1000bc000</span></span><br><span class="line">Dumping &lt;QYSiriShortCuts&gt; (arm64)</span><br><span class="line">Patched cryptid (<span class="number">64</span><span class="built_in">bit</span> <span class="keyword">segment</span>)</span><br><span class="line">Writing <span class="keyword">new</span> <span class="keyword">checksum</span></span><br><span class="line">Writing <span class="keyword">new</span> <span class="keyword">checksum</span></span><br><span class="line">Writing <span class="keyword">new</span> <span class="keyword">checksum</span></span><br><span class="line">objc[<span class="number">4015</span>]: <span class="keyword">Class</span> ZipArchive <span class="keyword">is</span> implemented <span class="keyword">in</span> <span class="keyword">both</span> /<span class="keyword">var</span>/tmp/clutch/<span class="number">1</span>C8BA028<span class="number">-6</span>FC4<span class="number">-4975</span>-B4E9<span class="number">-644</span>D2935FB55/clutch <span class="keyword">and</span> /<span class="keyword">private</span>/<span class="keyword">var</span>/mobile/Containers/Bundle/Application/C8575DD1<span class="number">-889E-4</span>E70-AF66<span class="number">-4E4</span>CC920F6AC/iQiYiPhoneVideo.app/Frameworks/QYUniversalFramework.framework/QYUniversalFramework. One <span class="keyword">of</span> the two will be used. Which one <span class="keyword">is</span> undefined.</span><br><span class="line">Dumping &lt;QYUniversalFramework&gt; arm64</span><br><span class="line">ASLR slide: <span class="number">0x100054000</span></span><br><span class="line">Dumping &lt;iQiYiPhoneVideo&gt; (arm64)</span><br><span class="line">Patched cryptid (<span class="number">64</span><span class="built_in">bit</span> <span class="keyword">segment</span>)</span><br><span class="line">Successfully dumped framework QYUniversalFramework!</span><br><span class="line"><span class="keyword">Child</span> exited <span class="keyword">with</span> <span class="keyword">status</span> <span class="number">0</span></span><br><span class="line">Zipping QYUniversalFramework.framework</span><br><span class="line">Zipping QYSiriShortCuts.appex</span><br><span class="line">Zipping QYToday.appex</span><br><span class="line">Zipping QiYiUserNotification.appex</span><br><span class="line">Writing <span class="keyword">new</span> <span class="keyword">checksum</span></span><br><span class="line">DONE: /<span class="keyword">private</span>/<span class="keyword">var</span>/mobile/Documents/Dumped/com.qiyi.iphone-iOS9<span class="number">.0</span>-(Clutch<span class="number">-2.0</span><span class="number">.4</span>).ipa</span><br><span class="line">Finished dumping com.qiyi.iphone <span class="keyword">in</span> <span class="number">38.5</span> seconds</span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤9. copyå‡ºæ¥å·²ç»è„±å£³äº†çš„App,ç„¶åæ‰¾åˆ°åŒ…ä¸­çš„Mach-Oæ–‡ä»¶ï¼Œæœ€åè¿ç”¨<a href="http://stevenygard.com/projects/class-dump/" target="_blank" rel="noopener">class-dump</a>, æ‰§è¡Œä»¥ä¸‹çš„å‘½ä»¤å¾—åˆ°ç›¸åº”çš„å¤´æ–‡ä»¶ï¼š</li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>-<span class="title">dump</span> -<span class="title">H</span> -<span class="title">o</span> <span class="title">iqiHeaders</span> <span class="title">iQiYiPhoneVideo</span>.<span class="title">app</span></span></span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤10. é€šè¿‡æŸ¥çœ‹ç±»<code>QYStartADView</code>çš„ç›¸å…³å¤´æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹:</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     Generated by class-dump 3.5 (64 bit).</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     class-dump is Copyright (C) 1997-1998, 2000-2001, 2004-2013 by Steve Nygard.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"QYStartADViewControllerDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"QYStartAdPlayerControllerDelegate.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">AdsClient</span>, <span class="title">CupidAd</span>, <span class="title">NSString</span>, <span class="title">NSTimer</span>, <span class="title">QYStartADViewController</span>, <span class="title">QYStartAdPlayerController</span>, <span class="title">QYWebContainer</span>, <span class="title">UILabel</span>, <span class="title">UIWindow</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">QYStartADView</span> : <span class="title">UIView</span> &lt;<span class="title">QYStartAdPlayerControllerDelegate</span>, <span class="title">QYStartADViewControllerDelegate</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIWindow</span> *_window;</span><br><span class="line">    <span class="built_in">NSTimer</span> *_adTimer;</span><br><span class="line">    <span class="keyword">float</span> _iAdTime;</span><br><span class="line">    _Bool _shouldRun;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> _addedTime;</span><br><span class="line">    <span class="keyword">float</span> _adShowTime;</span><br><span class="line">    _Bool _isFullScreenAd;</span><br><span class="line">    <span class="keyword">int</span> _type;</span><br><span class="line">    <span class="keyword">id</span> &lt;QYPhoneStartADViewDelegate&gt; _delegate;</span><br><span class="line">    <span class="built_in">UILabel</span> *_secords;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> _duration;</span><br><span class="line">    <span class="keyword">double</span> _logoBackHeight;</span><br><span class="line">    <span class="keyword">double</span> _needToCut;</span><br><span class="line">    <span class="built_in">UIView</span> *_adImageView;</span><br><span class="line">    QYWebContainer *_webView;</span><br><span class="line">    AdsClient *_adClient;</span><br><span class="line">    CupidAd *_adCupid;</span><br><span class="line">    QYStartAdPlayerController *_player;</span><br><span class="line">    QYStartADViewController *_startAdViewController;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">retain</span>, <span class="keyword">nonatomic</span>) QYStartADViewController *startAdViewController; <span class="comment">// @synthesize startAdViewController=_startAdViewController;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">retain</span>, <span class="keyword">nonatomic</span>) QYStartAdPlayerController *player; <span class="comment">// @synthesize player=_player;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="keyword">int</span> type; <span class="comment">// @synthesize type=_type;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">retain</span>, <span class="keyword">nonatomic</span>) CupidAd *adCupid; <span class="comment">// @synthesize adCupid=_adCupid;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">retain</span>, <span class="keyword">nonatomic</span>) AdsClient *adClient; <span class="comment">// @synthesize adClient=_adClient;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">retain</span>, <span class="keyword">nonatomic</span>) QYWebContainer *webView; <span class="comment">// @synthesize webView=_webView;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">retain</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIView</span> *adImageView; <span class="comment">// @synthesize adImageView=_adImageView;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="keyword">double</span> needToCut; <span class="comment">// @synthesize needToCut=_needToCut;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="keyword">double</span> logoBackHeight; <span class="comment">// @synthesize logoBackHeight=_logoBackHeight;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="keyword">long</span> <span class="keyword">long</span> duration; <span class="comment">// @synthesize duration=_duration;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">retain</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UILabel</span> *secords; <span class="comment">// @synthesize secords=_secords;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) _Bool isFullScreenAd; <span class="comment">// @synthesize isFullScreenAd=_isFullScreenAd;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) __<span class="keyword">weak</span> <span class="keyword">id</span> &lt;QYPhoneStartADViewDelegate&gt; delegate; <span class="comment">// @synthesize delegate=_delegate;</span></span><br><span class="line">- (<span class="keyword">void</span>).cxx_destruct;</span><br><span class="line">- (<span class="keyword">id</span>)imageFromImage:(<span class="keyword">id</span>)arg1 inRect:(<span class="keyword">struct</span> <span class="built_in">CGRect</span>)arg2;</span><br><span class="line">- (<span class="keyword">void</span>)playToEnd;</span><br><span class="line">- (<span class="keyword">void</span>)playError;</span><br><span class="line">- (<span class="keyword">void</span>)h5WillJumpToPage;</span><br><span class="line">- (<span class="keyword">void</span>)userInteractWithHtml;</span><br><span class="line">- (<span class="keyword">void</span>)sendH5AdClickPingback;</span><br><span class="line">- (<span class="keyword">void</span>)finishDisplayHtml;</span><br><span class="line">- (<span class="keyword">void</span>)keyboardDidHide;</span><br><span class="line">- (<span class="keyword">id</span>)labelWithFrame:(<span class="keyword">struct</span> <span class="built_in">CGRect</span>)arg1 backgroundColor:(<span class="keyword">id</span>)arg2 textColor:(<span class="keyword">id</span>)arg3 font:(<span class="keyword">id</span>)arg4 text:(<span class="keyword">id</span>)arg5 textAlignment:(<span class="keyword">long</span> <span class="keyword">long</span>)arg6;</span><br><span class="line">- (<span class="keyword">id</span>)imageViewWithFrame:(<span class="keyword">struct</span> <span class="built_in">CGRect</span>)arg1 image:(<span class="keyword">id</span>)arg2;</span><br><span class="line">- (<span class="keyword">void</span>)delegateCallStartADViewDidEnd;</span><br><span class="line">- (<span class="keyword">void</span>)showEnds;</span><br><span class="line">- (<span class="keyword">void</span>)updateTime;</span><br><span class="line">- (<span class="keyword">void</span>)updateUI:(<span class="keyword">id</span>)arg1;</span><br><span class="line">- (<span class="keyword">void</span>)finishAdShowForHtml;</span><br><span class="line">- (<span class="keyword">void</span>)prepareForEndAd;</span><br><span class="line">- (<span class="keyword">void</span>)secondChange;</span><br><span class="line">- (<span class="keyword">void</span>)timerStart;</span><br><span class="line">- (<span class="keyword">void</span>)showAdDetail;</span><br><span class="line">- (<span class="keyword">void</span>)skipAd;</span><br><span class="line">- (<span class="keyword">id</span>)createTouchScreenPromptView;</span><br><span class="line">- (<span class="keyword">id</span>)createViewWithType:(<span class="keyword">int</span>)arg1 withURL:(<span class="keyword">id</span>)arg2;</span><br><span class="line">- (<span class="keyword">void</span>)addBottomView;</span><br><span class="line">- (<span class="keyword">void</span>)addTimeBg;</span><br><span class="line">- (<span class="keyword">id</span>)initWithType:(<span class="keyword">int</span>)arg1 withURL:(<span class="keyword">id</span>)arg2 withDur:(<span class="keyword">long</span> <span class="keyword">long</span>)arg3 withAdData:(<span class="keyword">id</span>)arg4 withADCupid:(<span class="keyword">id</span>)arg5;</span><br><span class="line">- (<span class="keyword">void</span>)dealloc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remaining properties</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *debugDescription;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *description;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>) <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> hash;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>) Class superclass;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„ä»£ç é‡ä¸æ˜¯å¾ˆå¤šï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™ä¸ª<code>- (id)initWithType:(int)arg1 withURL:(id)arg2 withDur:(long long)arg3 withAdData:(id)arg4 withADCupid:(id)arg5;</code>æœ‰å¯èƒ½å°±æ˜¯ä¸€ä¸ªå®ä¾‹åŒ–æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¦†å†™è¿™ä¸ªæ–¹æ³•æ¥è¾¾åˆ°å–æ¶ˆå¯åŠ¨å¹¿å‘Šçš„æ•ˆæœï¼ˆè¿™é‡Œåªæ˜¯ä¸€ä¸ªçŒœæµ‹ï¼ï¼‰</p></blockquote><ul><li>æ­¥éª¤11. ä¸‹é¢é€šè¿‡ç¼–å†™<a href="https://github.com/theos/theos/wiki/Installation-iOS" target="_blank" rel="noopener">theos</a>, æ¥è¦†å†™è¿™ä¸ªå®ä¾‹åŒ–æ–¹æ³•ï¼Œå‡è®¾ä½ å·²ç»æŒ‰ç…§githubä¸Šçš„æ•™ç¨‹å®‰è£…å¥½äº†ï¼Œæ­¤æ—¶å°±å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æµç¨‹å¼€å§‹ï¼š</li><li>xxx.xmçš„ç›¸å…³è¯­æ³•çš„ç¼–å†™å¯ä»¥å‚è€ƒ<a href="http://iphonedevwiki.net/index.php/Logos#File_Extensions_for_Logos" target="_blank" rel="noopener">è¯­æ³•</a></li></ul><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*------1-------*/</span></span><br><span class="line"><span class="comment">// åœ¨åˆé€‚çš„ä½ç½®æ‰§è¡Œï¼Œä¸‹é¢çš„å‘½ä»¤</span></span><br><span class="line">nic.pl</span><br><span class="line"></span><br><span class="line"><span class="comment">/*------2-------*/</span></span><br><span class="line"><span class="comment">// ç»ˆç«¯çš„æ˜¾ç¤º</span></span><br><span class="line">NIC <span class="number">2.0</span> - New Instance Creator</span><br><span class="line">------------------------------</span><br><span class="line">  [<span class="meta">1.</span>] iphone/activator_event</span><br><span class="line">  [<span class="meta">2.</span>] iphone/application_modern</span><br><span class="line">  [<span class="meta">3.</span>] iphone/application_swift</span><br><span class="line">  [<span class="meta">4.</span>] iphone/cydget</span><br><span class="line">  [<span class="meta">5.</span>] iphone/flipswitch_switch</span><br><span class="line">  [<span class="meta">6.</span>] iphone/framework</span><br><span class="line">  [<span class="meta">7.</span>] iphone/ios7_notification_center_widget</span><br><span class="line">  [<span class="meta">8.</span>] iphone/library</span><br><span class="line">  [<span class="meta">9.</span>] iphone/notification_center_widget</span><br><span class="line">  [<span class="meta">10.</span>] iphone/preference_bundle_modern</span><br><span class="line">  [<span class="meta">11.</span>] iphone/tool</span><br><span class="line">  [<span class="meta">12.</span>] iphone/tool_swift</span><br><span class="line">  [<span class="meta">13.</span>] iphone/tweak</span><br><span class="line">  [<span class="meta">14.</span>] iphone/xpc_service</span><br><span class="line"><span class="function">Choose a <span class="title">Template</span> (<span class="params">required</span>):</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">/*------3-------*/</span></span></span><br><span class="line"><span class="function"><span class="comment">// è¿™é‡Œæˆ‘ä»¬é€‰æ‹©13ï¼Œç„¶åå›è½¦, è¿™é‡Œå”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯è¿™ä¸ªAppID,å¿…é¡»è¦å¡«å†™çˆ±å¥‡è‰ºçš„AppID, å…¶ä»–çš„å¯ä»¥éšä¾¿å¡«å†™ã€æˆ–è€…ç›´æ¥å›è½¦</span></span></span><br><span class="line"><span class="function">Choose a <span class="title">Template</span> (<span class="params">required</span>): 13</span></span><br><span class="line"><span class="function">Project <span class="title">Name</span> (<span class="params">required</span>): ghiqyTest</span></span><br><span class="line"><span class="function">Package Name [com.yourcompany.ghiqytest]: com.ghcoder.ghiqyTest</span></span><br><span class="line"><span class="function">Author/Maintainer Name [é¾šæ¬¢]:</span></span><br><span class="line"><span class="function">[iphone/tweak] MobileSubstrate Bundle filter [com.apple.springboard]: com.qiyi.iphone</span></span><br><span class="line"><span class="function">[iphone/tweak] List of applications to terminate upon <span class="title">installation</span> (<span class="params">space-separated, <span class="string">'-'</span> <span class="keyword">for</span> none</span>) [SpringBoard]:</span></span><br><span class="line"><span class="function">Instantiating iphone/tweak <span class="keyword">in</span> ghiqytest/...</span></span><br><span class="line"><span class="function">Done.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">/*------4-------*/</span></span></span><br><span class="line"><span class="function"><span class="comment">// åˆ›å»ºå®Œæˆä¹‹åï¼Œä¼šå‘ç°è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªåå«ghiqytestçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜åœ¨å››ä¸ªæ–‡ä»¶ï¼Œä¾æ¬¡æ˜¯:control(ç›¸å…³çš„é…ç½®ä¿¡æ¯)ã€ghiqyTest.plist(ä½ éœ€è¦ä¿®æ”¹çš„åº”ç”¨çš„AppID)ã€Makefile(é…ç½®æ–‡ä»¶)ã€Tweak.xm(éœ€è¦ä¿®æ”¹çš„ç›¸å…³ç±»)</span></span></span><br><span class="line"><span class="function"><span class="comment">// ä¸‹é¢æ˜¯æˆ‘å¯¹Tweak.xmä¿®æ”¹çš„å†…å®¹å¦‚ä¸‹ï¼š</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">%hook QYStartADView</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">- (<span class="params">id</span>)initWithType:(<span class="params"><span class="keyword">int</span></span>)arg1 withURL:(<span class="params">id</span>)arg2 withDur:(<span class="params"><span class="keyword">long</span> <span class="keyword">long</span></span>)arg3 withAdData:(<span class="params">id</span>)arg4 withADCupid:(<span class="params">id</span>)arg5</span> &#123;</span><br><span class="line"><span class="keyword">return</span> nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line"><span class="comment">/*------5-------*/</span></span><br><span class="line"><span class="comment">// sshåˆ°è¶Šç‹±æ‰‹æœºï¼Œå¹¶ä¸”è¦åœ¨Makefileçš„å¼€å¤´åŠ ä¸Šä¸‹é¢ä¸¤è¡Œé…ç½®</span></span><br><span class="line">export THEOS_DEVICE_IP=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">export THEOS_DEVICE_PORT=<span class="number">10010</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*------6-------*/</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œæ‰§è¡Œå®Œæˆä¹‹åï¼Œè¶Šç‹±æœºå™¨å°±ä¼šè‡ªåŠ¨é‡å¯äº†</span></span><br><span class="line">make clean &amp;&amp;  make package &amp;&amp; make install</span><br></pre></td></tr></table></figure><h4 id="2-å°†è¿™ä¸ªä¿®æ”¹è¿‡çš„Appé‡ç­¾å"><a href="#2-å°†è¿™ä¸ªä¿®æ”¹è¿‡çš„Appé‡ç­¾å" class="headerlink" title="2. å°†è¿™ä¸ªä¿®æ”¹è¿‡çš„Appé‡ç­¾å"></a>2. å°†è¿™ä¸ªä¿®æ”¹è¿‡çš„Appé‡ç­¾å</h4><ul><li>æ­¥éª¤1. è¦å®Œæˆè¿™ä¸ªé‡ç­¾åï¼Œæˆ‘ä»¬éœ€è¦æœ‰å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ </li></ul><ol><li>æˆ‘ä»¬åˆšæ‰ç¼–å†™çš„xxx.xmæ–‡ä»¶ï¼Œå…¶å®åˆšæ‰åœ¨æˆ‘ä»¬é‡å¯ä¹‹åï¼Œå®ƒå°±ç”Ÿæˆä¸€ä¸ªåŠ¨æ€åº“æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å­˜æ”¾åœ¨è¶Šç‹±æœºçš„å¦‚ä¸‹è·¯å¾„ä¸­ï¼š(Device-&gt;Library-&gt;MobileSubstrate-&gt;DynamicLibraries-&gt;ghiqyTest.dylib).</li><li>åœ¨è¶Šç‹±æœºå™¨ä¸­åŠ è½½è¿™ä¸ªåŠ¨æ€åº“çš„Frameworkï¼ˆCydiaSubstrate) [è·¯å¾„å¦‚ä¸‹Device-&gt;Library-&gt;Frameworks-&gt;CydiaSubstrate.framework-&gt;CydiaSubstrate]</li><li>å·²ç»è„±å£³äº†çš„App</li><li>xxx.mobileprovisionæ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯éœ€è¦ä¸€å¹´99ç¾é‡‘æ‰å¯ä»¥ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªç©ºçš„Xcodeé¡¹ç›®ï¼Œç¼–è¯‘ä¹‹ååœ¨Targetçš„Appä¸­æ‰¾åˆ°è¿™ä¸ªxxx.mobileprovisionæ–‡ä»¶ï¼ˆæˆ–è€…å¯ä»¥å»apple.developer.comåå°å»ä¸‹è½½ï¼‰</li></ol><ul><li><p>æ­¥éª¤2. ç„¶åå°†ä¸Šé¢æåˆ°ä¸‰ä¸ªæ–‡ä»¶<em>ghiqyTest.dylib</em>ã€<em>CydiaSubstrate</em>ã€<em>xxx.mobileprovision</em>ä¸€èµ·æ‹·è´åˆ°å·²ç»è„±å£³äº†çš„Appä¸­ã€‚</p></li><li><p>æ­¥éª¤3. åœ¨è„±å£³äº†çš„Appä¸­æ‰¾åˆ°<strong>info.plist</strong>æ–‡ä»¶ï¼ŒæŠŠé‡Œé¢çš„<strong>UISupportedDevices</strong>è¿™ä¸€æ ç»Ÿä¸€åˆ é™¤æ‰ã€‚</p></li><li>æ­¥éª¤4. æ­¤æ—¶æˆ‘ä»¬éœ€è¦æŸ¥çœ‹ä¸€äº›åŠ¨æ€åº“ï¼Œä»¥åŠæˆ‘ä»¬çš„Mach-Oæ–‡ä»¶ä¾èµ–çš„åº“æ˜¯å¦é…ç½®æ­£ç¡®:</li></ul><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">/*------<span class="number">1</span>-------*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ æŸ¥çœ‹çˆ±å¥‡è‰ºMach-Oä¾èµ–çš„åŠ¨æ€åº“</span></span><br><span class="line"><span class="regexp">otool -L iQiYiPhoneVideo</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ç»ˆç«¯æ˜¾ç¤º</span></span><br><span class="line"><span class="regexp">/usr</span><span class="regexp">/lib/libc</span>++.<span class="number">1</span>.dylib (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">400.9</span>.<span class="number">4</span>)</span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libresolv</span>.9.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 1.0.0)</span></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libsqlite3</span>.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 9.0.0, <span class="title">current</span> <span class="title">version</span> 274.20.0)</span></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libxml2</span>.2.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 10.0.0, <span class="title">current</span> <span class="title">version</span> 10.9.0)</span></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libz</span>.1.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 1.2.11)</span></span><br><span class="line">/System/Library/Frameworks/AVFoundation.framework/AVFoundation (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">2.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/Accelerate.framework/Accelerate (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">4.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/AdSupport.framework/AdSupport (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/AssetsLibrary.framework/AssetsLibrary (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/CFNetwork.framework/CFNetwork (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">974.2</span>.<span class="number">1</span>)</span><br><span class="line">/System/Library/Frameworks/CoreFoundation.framework/CoreFoundation (compatibility version <span class="number">150.0</span>.<span class="number">0</span>, current version <span class="number">1556.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/CoreGraphics.framework/CoreGraphics (compatibility version <span class="number">64.0</span>.<span class="number">0</span>, current version <span class="number">1245.8</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/CoreLocation.framework/CoreLocation (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">2245.4</span>.<span class="number">104</span>)</span><br><span class="line">/System/Library/Frameworks/CoreMotion.framework/CoreMotion (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">2245.4</span>.<span class="number">104</span>)</span><br><span class="line">/System/Library/Frameworks/CoreTelephony.framework/CoreTelephony (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">0.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/Foundation.framework/Foundation (compatibility version <span class="number">300.0</span>.<span class="number">0</span>, current version <span class="number">1556.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/ImageIO.framework/ImageIO (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">0.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/MapKit.framework/MapKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">14.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/MobileCoreServices.framework/MobileCoreServices (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">932.2</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/OpenAL.framework/OpenAL (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">@rpath/QYUniversalFramework.framework/QYUniversalFramework (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/QuartzCore.framework/QuartzCore (compatibility version <span class="number">1.2</span>.<span class="number">0</span>, current version <span class="number">1.11</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/SceneKit.framework/SceneKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">470.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/Security.framework/Security (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">58286.202</span>.<span class="number">3</span>)</span><br><span class="line">/System/Library/Frameworks/StoreKit.framework/StoreKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/SystemConfiguration.framework/SystemConfiguration (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">963.200</span>.<span class="number">27</span>)</span><br><span class="line">/System/Library/Frameworks/UIKit.framework/UIKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">61000.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/WebKit.framework/WebKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">606.1</span>.<span class="number">36</span>)</span><br><span class="line">/System/Library/Frameworks/Intents.framework/Intents (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/IntentsUI.framework/IntentsUI (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/ReplayKit.framework/ReplayKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/UserNotifications.framework/UserNotifications (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/Speech.framework/Speech (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/CoreData.framework/CoreData (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">865.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/EventKit.framework/EventKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">100.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/WatchConnectivity.framework/WatchConnectivity (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">175.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/PassKit.framework/PassKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/GLKit.framework/GLKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">103.2</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/Photos.framework/Photos (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/CoreSpotlight.framework/CoreSpotlight (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/LocalAuthentication.framework/LocalAuthentication (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">425.202</span>.<span class="number">1</span>)</span><br><span class="line">/System/Library/Frameworks/VideoToolbox.framework/VideoToolbox (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/AVKit.framework/AVKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/MessageUI.framework/MessageUI (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">3445.100</span>.<span class="number">35</span>)</span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libiconv</span>.2.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 7.0.0, <span class="title">current</span> <span class="title">version</span> 7.0.0)</span></span><br><span class="line">/System/Library/Frameworks/CoreText.framework/CoreText (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libbz2</span>.1.0.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 1.0.5)</span></span><br><span class="line">/System/Library/Frameworks/CoreMedia.framework/CoreMedia (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/MediaPlayer.framework/MediaPlayer (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/AudioToolbox.framework/AudioToolbox (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">492.0</span>.<span class="number">0</span>)</span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libicucore</span>.<span class="title">A</span>.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 62.1.0)</span></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libobjc</span>.<span class="title">A</span>.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 228.0.0)</span></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libSystem</span>.<span class="title">B</span>.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 1252.200.5)</span></span><br><span class="line">/System/Library/Frameworks/CoreImage.framework/CoreImage (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">5.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/CoreML.framework/CoreML (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/CoreVideo.framework/CoreVideo (compatibility version <span class="number">1.2</span>.<span class="number">0</span>, current version <span class="number">1.5</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/JavaScriptCore.framework/JavaScriptCore (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">606.1</span>.<span class="number">36</span>)</span><br><span class="line">/System/Library/Frameworks/OpenGLES.framework/OpenGLES (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/SpriteKit.framework/SpriteKit (compatibility version <span class="number">1.0</span>.<span class="number">0</span>, current version <span class="number">2.0</span>.<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">/*------<span class="number">2</span>-------*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ éœ€è¦æŠŠæˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„åŠ¨æ€åº“é“¾æ¥è¿›æ¥ï¼Œæ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤</span></span><br><span class="line"><span class="regexp">insert_dylib @executable_path/ghiqy</span>Test.dylib iQiYiPhoneVideo iQiYiPhoneVideo --all-yes</span><br><span class="line"></span><br><span class="line">/*------<span class="number">3</span>-------*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ å†æ¬¡æ‰§è¡Œç¬¬ä¸€æ­¥çš„å‘½ä»¤ï¼Œä¼šå‘ç°æœ€ä¸‹å¤šäº†ä¸€è¡Œï¼Œå°±ä»£è¡¨é“¾æ¥æˆåŠŸ</span></span><br><span class="line"><span class="regexp">@executable_path/ghiqy</span>Test.dylib (compatibility version <span class="number">0.0</span>.<span class="number">0</span>, current version <span class="number">0.0</span>.<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">/*------<span class="number">4</span>-------*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ æ­¤æ—¶æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ghiqyTest.dylib, è¿™ä¸ªåŠ¨æ€åº“æœ‰æ²¡æœ‰ä¾èµ–çš„å…¶ä»–åŠ¨æ€åº“</span></span><br><span class="line"><span class="regexp">otool -L ghiqyTest.dylib</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ç»ˆç«¯æ˜¾ç¤º</span></span><br><span class="line"><span class="regexp">ghiqyTest.dylib (architecture arm64):</span></span><br><span class="line"><span class="regexp">/</span>Library/MobileSubstrate/DynamicLibraries/ghiqyTest.dylib (compatibility version <span class="number">0.0</span>.<span class="number">0</span>, current version <span class="number">0.0</span>.<span class="number">0</span>)</span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libobjc</span>.<span class="title">A</span>.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 228.0.0)</span></span><br><span class="line">/System/Library/Frameworks/Foundation.framework/Foundation (compatibility version <span class="number">300.0</span>.<span class="number">0</span>, current version <span class="number">1560.10</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/CoreFoundation.framework/CoreFoundation (compatibility version <span class="number">150.0</span>.<span class="number">0</span>, current version <span class="number">1560.10</span>.<span class="number">0</span>)</span><br><span class="line">/Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate (compatibility version <span class="number">0.0</span>.<span class="number">0</span>, current version <span class="number">0.0</span>.<span class="number">0</span>)</span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libc</span>++.1.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 400.9.4)</span></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libSystem</span>.<span class="title">B</span>.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 1252.200.5)</span></span><br><span class="line"></span><br><span class="line">/*------<span class="number">5</span>-------*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ è¿™é‡Œéœ€è¦ä¿®æ”¹/</span>Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrateè·¯å¾„ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥ä¿®æ”¹äº†</span><br><span class="line">install_name_tool -change /Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate @loader_path/CydiaSubstrate ghiqyTest.dylib</span><br><span class="line"></span><br><span class="line">/<span class="regexp">/ å†æ¬¡æ‰§è¡Œç¬¬å››éƒ¨ï¼šå°±ä¼šå‘ç°ä¹‹å‰è·¯å¾„ä¿®æ”¹äº†</span></span><br><span class="line"><span class="regexp">ghiqyTest.dylib (architecture arm64):</span></span><br><span class="line"><span class="regexp">/</span>Library/MobileSubstrate/DynamicLibraries/ghiqyTest.dylib (compatibility version <span class="number">0.0</span>.<span class="number">0</span>, current version <span class="number">0.0</span>.<span class="number">0</span>)</span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libobjc</span>.<span class="title">A</span>.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 228.0.0)</span></span><br><span class="line">/System/Library/Frameworks/Foundation.framework/Foundation (compatibility version <span class="number">300.0</span>.<span class="number">0</span>, current version <span class="number">1560.10</span>.<span class="number">0</span>)</span><br><span class="line">/System/Library/Frameworks/CoreFoundation.framework/CoreFoundation (compatibility version <span class="number">150.0</span>.<span class="number">0</span>, current version <span class="number">1560.10</span>.<span class="number">0</span>)</span><br><span class="line">@loader_path/CydiaSubstrate (compatibility version <span class="number">0.0</span>.<span class="number">0</span>, current version <span class="number">0.0</span>.<span class="number">0</span>)</span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libc</span>++.1.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 400.9.4)</span></span><br><span class="line">/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libSystem</span>.<span class="title">B</span>.<span class="title">dylib</span> (<span class="title">compatibility</span> <span class="title">version</span> 1.0.0, <span class="title">current</span> <span class="title">version</span> 1252.200.5)</span></span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤5. æˆ‘ä»¬è¦å…ˆæ‰¾åˆ°æˆ‘ä»¬ç­¾åè¯ä¹¦çš„Identity,é€šè¿‡å¦‚ä¸‹çš„å‘½ä»¤å¯ä»¥æ‰¾åˆ°</li></ul><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">security find-identity -v -p codesigning</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»ˆç«¯æ˜¾ç¤º</span></span><br><span class="line"><span class="number">1</span>) E797391C5ABBC9FB40EE04252C5679A6FEC1B351 <span class="string">"iPhone Developer: ******"</span></span><br><span class="line"><span class="number">2</span>) EF3725BCB7AB3C3F12AFC9C3A82C16B84A2925EC <span class="string">"iPhone Developer: *******"</span> (CSSMERR_TP_CERT_REVOKED)</span><br><span class="line">     <span class="number">2</span> valid identities found</span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤6. å¼€å§‹ç­¾åï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  iQiYiPhoneVideo<span class="selector-class">.app</span> codesign -fs E797391C5ABBC9FB40EE04252C5679A6FEC1B351 ghiqyTest.dylib</span><br><span class="line">ghiqyTest<span class="selector-class">.dylib</span>: replacing existing signature</span><br><span class="line">âœ  iQiYiPhoneVideo<span class="selector-class">.app</span> codesign -fs E797391C5ABBC9FB40EE04252C5679A6FEC1B351 CydiaSubstrate</span><br><span class="line">CydiaSubstrate: replacing existing signature</span><br></pre></td></tr></table></figure><ul><li>æ­¥éª¤7. æœ€åæˆ‘ä»¬å¯¹Appæ•´ä½“ç­¾åï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–¹ä¾¿å·¥å…·<a href="https://github.com/DanTheMan827/ios-app-signer" target="_blank" rel="noopener">iOSAppSinger</a></li><li>æ­¥éª¤7.1 ä¹Ÿå¯ä»¥é€šè¿‡codesignï¼Œæ¥å®Œæˆå¯¹Appçš„æ•´ä½“ç­¾å:</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*------1-------*/</span></span><br><span class="line"><span class="comment">// å…ˆä»xxx.mobileprovisionå¯¼å‡ºxxx.entitlements</span></span><br><span class="line">security cms -D -<span class="selector-tag">i</span> embedded<span class="selector-class">.mobileprovision</span> &gt; temp.plist</span><br><span class="line">/usr/libexec/PlistBuddy -x -c <span class="string">'Print:Entitlements'</span> temp<span class="selector-class">.plist</span> &gt; entitlements.plist</span><br><span class="line"></span><br><span class="line"><span class="comment">/*------2-------*/</span></span><br><span class="line"><span class="comment">// ç”Ÿæˆå®Œæˆä¹‹åçš„entitlements.plistï¼Œé…åˆcodeSignè¿›è¡Œé‡ç­¾å</span></span><br><span class="line">codesign -fs E797391C5ABBC9FB40EE04252C5679A6FEC1B351 --entitlements entitlements<span class="selector-class">.plist</span> xxx.app</span><br><span class="line"></span><br><span class="line"><span class="comment">/*------3-------*/</span></span><br><span class="line"><span class="comment">// ç”Ÿæˆä¹‹åçš„xxx.app,æ”¾åˆ°Payloadçš„æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åè¿›è¡Œå‹ç¼©ï¼Œç„¶åå†ä¿®æ”¹åç¼€åä¸º.ipa</span></span><br></pre></td></tr></table></figure><h3 id="3-å®‰è£…åœ¨æœªè¶Šç‹±æ‰‹æœºä¸Š"><a href="#3-å®‰è£…åœ¨æœªè¶Šç‹±æ‰‹æœºä¸Š" class="headerlink" title="3. å®‰è£…åœ¨æœªè¶Šç‹±æ‰‹æœºä¸Š"></a>3. å®‰è£…åœ¨æœªè¶Šç‹±æ‰‹æœºä¸Š</h3><ul><li>ç›´æ¥é€šè¿‡iFunboxå®‰è£…åœ¨éè¶Šç‹±æœºå™¨ä¸Šã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç›®æ ‡ï¼š&quot;&gt;&lt;a href=&quot;#ç›®æ ‡ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç›®æ ‡ï¼š&quot;&gt;&lt;/a&gt;ç›®æ ‡ï¼š&lt;/h3&gt;&lt;p&gt;1.ä¿®æ”¹çˆ±å¥‡è‰ºApp&lt;br&gt;2.å°†è¿™ä¸ªä¿®æ”¹è¿‡çš„Appé‡ç­¾å&lt;br&gt;3.å®‰è£…åœ¨æœªè¶Šç‹±æ‰‹æœºä¸Š&lt;/p&gt;
&lt;h3 id=&quot;å‡†å¤‡ï¼š&quot;&gt;&lt;a href=&quot;#å‡†å¤‡ï¼š&quot; class=&quot;headerlink&quot; title=&quot;å‡†å¤‡ï¼š&quot;&gt;&lt;/a&gt;å‡†å¤‡ï¼š&lt;/h3&gt;&lt;p&gt;1.è¶Šç‹±æ‰‹æœºå’Œä¸€å°æœªè¶Šç‹±æ‰‹æœº&lt;br&gt;2.Macç”µè„‘&lt;/p&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Object-Cã€åŠ å¯†" scheme="http://www.ghcoder.com/tags/Object-C%E3%80%81%E5%8A%A0%E5%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>Swiftè¯­æ³•å¤‡å¿˜å½•</title>
    <link href="http://www.ghcoder.com/2018/11/03/20181103/"/>
    <id>http://www.ghcoder.com/2018/11/03/20181103/</id>
    <published>2018-11-03T08:29:12.000Z</published>
    <updated>2018-11-04T02:38:12.915Z</updated>
    
    <content type="html"><![CDATA[<h2 id="for-xx-xx-xx-åœ¨swiftä¸­çš„å†™æ³•ï¼š-gt-stride-from-to-by-ä»èµ·å§‹ä½ç½®å¼€å§‹ï¼Œæ¯æ¬¡å¢åŠ æˆ–è€…å‡å°‘ç¡®å®šçš„æ•°é‡ï¼Œåˆ°ç»ˆç‚¹ä¸ºæ­¢ï¼ˆä¸åŒ…å«ç»ˆç‚¹ä¸ºæ­¢ï¼‰"><a href="#for-xx-xx-xx-åœ¨swiftä¸­çš„å†™æ³•ï¼š-gt-stride-from-to-by-ä»èµ·å§‹ä½ç½®å¼€å§‹ï¼Œæ¯æ¬¡å¢åŠ æˆ–è€…å‡å°‘ç¡®å®šçš„æ•°é‡ï¼Œåˆ°ç»ˆç‚¹ä¸ºæ­¢ï¼ˆä¸åŒ…å«ç»ˆç‚¹ä¸ºæ­¢ï¼‰" class="headerlink" title="for(xx;xx;xx) åœ¨swiftä¸­çš„å†™æ³•ï¼š-&gt; stride(from:to:by:) ä»èµ·å§‹ä½ç½®å¼€å§‹ï¼Œæ¯æ¬¡å¢åŠ æˆ–è€…å‡å°‘ç¡®å®šçš„æ•°é‡ï¼Œåˆ°ç»ˆç‚¹ä¸ºæ­¢ï¼ˆä¸åŒ…å«ç»ˆç‚¹ä¸ºæ­¢ï¼‰"></a>for(xx;xx;xx) åœ¨swiftä¸­çš„å†™æ³•ï¼š-&gt; stride(from:to:by:) ä»èµ·å§‹ä½ç½®å¼€å§‹ï¼Œæ¯æ¬¡å¢åŠ æˆ–è€…å‡å°‘ç¡®å®šçš„æ•°é‡ï¼Œåˆ°ç»ˆç‚¹ä¸ºæ­¢ï¼ˆä¸åŒ…å«ç»ˆç‚¹ä¸ºæ­¢ï¼‰</h2><blockquote><p>Returns a sequence from a starting value to, but not including, an end value, stepping by the specified amount.</p></blockquote><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> stride(<span class="string">from:</span> <span class="number">10</span>, <span class="string">to:</span> <span class="number">1</span>, <span class="string">by:</span> <span class="number">-1</span>) &#123;</span><br><span class="line">    print(<span class="string">"index:\(index)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»ˆç«¯æ‰“å°</span></span><br><span class="line"><span class="string">index:</span><span class="number">10</span></span><br><span class="line"><span class="string">index:</span><span class="number">9</span></span><br><span class="line"><span class="string">index:</span><span class="number">8</span></span><br><span class="line"><span class="string">index:</span><span class="number">7</span></span><br><span class="line"><span class="string">index:</span><span class="number">6</span></span><br><span class="line"><span class="string">index:</span><span class="number">5</span></span><br><span class="line"><span class="string">index:</span><span class="number">4</span></span><br><span class="line"><span class="string">index:</span><span class="number">3</span></span><br><span class="line"><span class="string">index:</span><span class="number">2</span></span><br></pre></td></tr></table></figure><h2 id="å°†ä¸€ä¸ªStringç”¨ä¸€ä¸ªCharacter-Stringåˆ†éš”ï¼š"><a href="#å°†ä¸€ä¸ªStringç”¨ä¸€ä¸ªCharacter-Stringåˆ†éš”ï¼š" class="headerlink" title="å°†ä¸€ä¸ªStringç”¨ä¸€ä¸ªCharacter/Stringåˆ†éš”ï¼š"></a>å°†ä¸€ä¸ªStringç”¨ä¸€ä¸ªCharacter/Stringåˆ†éš”ï¼š</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> stringArray = <span class="built_in">string</span>.<span class="built_in">components</span>(separatedBy: <span class="string">"xx"</span>)</span><br></pre></td></tr></table></figure><h2 id="æ‰¾åˆ°æŸä¸ªsubStringï¼Œå¹¶ä¸”removeæ‰-ps-è¿™é‡Œåªèƒ½æ‰¾åˆ°ä¸€å¤„å¹¶ä¸”åˆ é™¤æ‰-ï¼š"><a href="#æ‰¾åˆ°æŸä¸ªsubStringï¼Œå¹¶ä¸”removeæ‰-ps-è¿™é‡Œåªèƒ½æ‰¾åˆ°ä¸€å¤„å¹¶ä¸”åˆ é™¤æ‰-ï¼š" class="headerlink" title="æ‰¾åˆ°æŸä¸ªsubStringï¼Œå¹¶ä¸”removeæ‰(ps: è¿™é‡Œåªèƒ½æ‰¾åˆ°ä¸€å¤„å¹¶ä¸”åˆ é™¤æ‰)ï¼š"></a>æ‰¾åˆ°æŸä¸ªsubStringï¼Œå¹¶ä¸”removeæ‰(ps: è¿™é‡Œåªèƒ½æ‰¾åˆ°ä¸€å¤„å¹¶ä¸”åˆ é™¤æ‰)ï¼š</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var conetent = <span class="string">"Hello World"</span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">range</span> = conetent.<span class="built_in">range</span>(of: <span class="string">" "</span>)!</span><br><span class="line"><span class="keyword">let</span> <span class="built_in">index</span> = conetent.distance(from: conetent.startIndex, <span class="keyword">to</span>: <span class="built_in">range</span>.lowerBound)</span><br><span class="line">conetent = String(conetent[..&lt;conetent.<span class="built_in">index</span>(conetent.startIndex, offsetBy: <span class="built_in">index</span>)]) + String(conetent[conetent.<span class="built_in">index</span>(conetent.startIndex, offsetBy: <span class="built_in">index</span>+<span class="number">1</span>)..&lt;conetent.endIndex])</span><br></pre></td></tr></table></figure><h2 id="æ›¿æ¢æŸä¸ªå­—ç¬¦"><a href="#æ›¿æ¢æŸä¸ªå­—ç¬¦" class="headerlink" title="æ›¿æ¢æŸä¸ªå­—ç¬¦"></a>æ›¿æ¢æŸä¸ªå­—ç¬¦</h2><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">conetent</span> = <span class="string">"Hello World"</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">newContent</span> = conetent.replacingOccurrences(of: <span class="string">" "</span>, <span class="keyword">with</span>: <span class="string">"&amp;"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;for-xx-xx-xx-åœ¨swiftä¸­çš„å†™æ³•ï¼š-gt-stride-from-to-by-ä»èµ·å§‹ä½ç½®å¼€å§‹ï¼Œæ¯æ¬¡å¢åŠ æˆ–è€…å‡å°‘ç¡®å®šçš„æ•°é‡ï¼Œåˆ°ç»ˆç‚¹ä¸ºæ­¢ï¼ˆä¸åŒ…å«ç»ˆç‚¹ä¸ºæ­¢ï¼‰&quot;&gt;&lt;a href=&quot;#for-xx-xx-xx-åœ¨swiftä¸­çš„å†™æ³•ï¼š-gt-stride-fro
      
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swift" scheme="http://www.ghcoder.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>æ¯æ—¥ä¸€åˆ·LeetCodeç®—æ³•</title>
    <link href="http://www.ghcoder.com/2018/02/23/20180223/"/>
    <id>http://www.ghcoder.com/2018/02/23/20180223/</id>
    <published>2018-02-23T03:22:12.000Z</published>
    <updated>2018-02-23T03:37:11.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li>è¿™é“é¢˜æ˜¯LeetCodeä¸Šçš„ç¬¬2é¢˜ï¼Œéš¾åº¦ä¸ºMideaçš„ä¸€åˆ°é¢˜ç›®ï¼Œè¿™æ˜¯ä¸€é“å…³äºé“¾è¡¨çš„é¢˜ç›®ï¼ŒåŸé¢˜å¦‚ä¸‹ï¼š</li></ul><blockquote><p>You are given two non-empty linked lists representing two non-negative integers. The digits are stored in reverse order and each of their nodes contain a single digit. Add the two numbers and return it as a linked list.<br>You may assume the two numbers do not contain any leading zero, except the number 0 itself.</p></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Example</span></span><br><span class="line"></span><br><span class="line">Input: (<span class="number">2</span> -&gt; <span class="number">4</span> -&gt; <span class="number">3</span>) + (<span class="number">5</span> -&gt; <span class="number">6</span> -&gt; <span class="number">4</span>)</span><br><span class="line">Output: <span class="number">7</span> -&gt; <span class="number">0</span> -&gt; <span class="number">8</span></span><br><span class="line">Explanation: <span class="number">342</span> + <span class="number">465</span> = <span class="number">807.</span></span><br></pre></td></tr></table></figure><a id="more"></a><ol><li>çœ‹åˆ°è¿™é“é¢˜ç›®æˆ‘ä¸»è¦çš„æƒ³æ³•å°±æ˜¯åˆ©ç”¨é€’å½’å¾ªç¯å»éå†é“¾è¡¨ï¼Œå¹¶ä¸”å°†æ•°å€¼ç›¸åŠ èµ·æ¥ï¼Œå¦‚æœè¶…å¤šæ•°å€¼9ï¼Œç›¸åº”ä½ç½®ä¸Šçš„æ•°å€¼å‡10ï¼Œå¹¶ä¸”è¿›ä¸€ä½</li><li>å¾ªç¯çš„éå†æ¡ä»¶æ˜¯Inputä¸­ä¸¤ä¸ªNodeListåªè¦æœ‰ä¸€ä¸ªå­˜åœ¨å€¼ï¼Œå°±ä¼šç»§ç»­é€’å½’ã€‚</li></ol><h3 id="å¦‚ä½•åˆ›å»ºé“¾è¡¨"><a href="#å¦‚ä½•åˆ›å»ºé“¾è¡¨" class="headerlink" title="å¦‚ä½•åˆ›å»ºé“¾è¡¨"></a>å¦‚ä½•åˆ›å»ºé“¾è¡¨</h3><ul><li>è¿™ä¸ªé—®é¢˜æˆ‘æƒ³äº†ä¸€ä¼šï¼Œæœ€å¥½çš„åˆ›å»ºæ–¹å¼ï¼Œå°±æ˜¯å…¥å‚å°±æ˜¯å°±æ˜¯ä¸€ä¸ªArrayçš„æ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿè¿”å›ä¸€ä¸ªListNode?å€¼ï¼Œå‡½æ•°å¦‚ä¸‹ï¼š</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">func createList(_ values: [Int]) -&gt; ListNode? &#123;</span><br><span class="line">    var head: ListNode? = nil</span><br><span class="line">    var trail: ListNode? = nil</span><br><span class="line">    values.forEach &#123; (value) <span class="keyword">in</span></span><br><span class="line">        let <span class="keyword">node</span> <span class="title">= ListNode</span>(value)</span><br><span class="line">        if head == nil &#123;</span><br><span class="line">            head = <span class="keyword">node</span><span class="title"></span></span><br><span class="line"><span class="title">        &#125; else</span> &#123;</span><br><span class="line">            trail!.next = <span class="keyword">node</span><span class="title"></span></span><br><span class="line"><span class="title">        &#125;</span></span><br><span class="line"><span class="title">        trail</span> = <span class="keyword">node</span><span class="title"></span></span><br><span class="line"><span class="title">    &#125;</span></span><br><span class="line"><span class="title">    return</span> head</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•é€’å½’ï¼š"><a href="#å¦‚ä½•é€’å½’ï¼š" class="headerlink" title="å¦‚ä½•é€’å½’ï¼š"></a>å¦‚ä½•é€’å½’ï¼š</h3><ul><li>è¿™é‡Œå¼€å§‹ç¬¬ä¸€æ¬¡æäº¤çš„æ—¶å€™ï¼Œé”™è¯¯äº†ï¼Œå°±æ˜¯å…¥å‚åœ¨<code>[5][5]</code>çš„æ—¶å€™ï¼Œæˆ‘çš„è¿”å›å€¼æ˜¯<code>[0]</code>,ä½†æ˜¯åº”è¯¥æ˜¯<code>[0,1]</code>,æ˜¯å› ä¸ºæˆ‘çš„å¾ªç¯æ¡ä»¶å¿½ç•¥äº†<code>resultNode</code>å€¼çš„åˆ¤æ–­ã€‚</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">func addTwoNumbers(_ l1: ListNode?, _ l2: ListNode?) -&gt; ListNode? &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> n1 = l1</span><br><span class="line">    <span class="keyword">var</span> n2 = l2</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> resultNode: ListNode?</span><br><span class="line">    <span class="keyword">var</span> arr: [<span class="built_in">Int</span>] = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> n1?.<span class="keyword">val</span> != nil || n2?.<span class="keyword">val</span> != nil || resultNode?.<span class="keyword">val</span> != nil &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> temp1: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">var</span> temp2: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> let v1 = n1?.<span class="keyword">val</span> &#123; temp1 = v1 &#125;</span><br><span class="line">        <span class="keyword">if</span> let v2 = n2?.<span class="keyword">val</span> &#123; temp2 = v2 &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> last: <span class="built_in">Int</span> = temp1 + temp2</span><br><span class="line">        <span class="keyword">if</span> let resultNode = resultNode &#123;</span><br><span class="line">            last += resultNode.<span class="keyword">val</span></span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">if</span> (last &gt; <span class="number">9</span>) &#123;</span><br><span class="line">            resultNode = ListNode(last - <span class="number">10</span>)</span><br><span class="line">            resultNode?.next = ListNode(<span class="number">1</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resultNode = ListNode(last)</span><br><span class="line">        &#125;</span><br><span class="line">        arr.append(resultNode!.<span class="keyword">val</span>)</span><br><span class="line">        n1 = n1?.next</span><br><span class="line">        n2 = n2?.next</span><br><span class="line">        resultNode = resultNode?.next</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> createList(arr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;è¿™é“é¢˜æ˜¯LeetCodeä¸Šçš„ç¬¬2é¢˜ï¼Œéš¾åº¦ä¸ºMideaçš„ä¸€åˆ°é¢˜ç›®ï¼Œè¿™æ˜¯ä¸€é“å…³äºé“¾è¡¨çš„é¢˜ç›®ï¼ŒåŸé¢˜å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;You are given two non-empty linked lists representing two non-negative integers. The digits are stored in reverse order and each of their nodes contain a single digit. Add the two numbers and return it as a linked list.&lt;br&gt;You may assume the two numbers do not contain any leading zero, except the number 0 itself.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight clean&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//Example&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Input: (&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; -&amp;gt; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt; -&amp;gt; &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;) + (&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt; -&amp;gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt; -&amp;gt; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Output: &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt; -&amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; -&amp;gt; &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Explanation: &lt;span class=&quot;number&quot;&gt;342&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;465&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;807.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swiftã€Algorithm" scheme="http://www.ghcoder.com/tags/Swift%E3%80%81Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªå®šä¹‰åˆ›å»ºUIViewController Transitionçš„åŠ¨ç”»æ•ˆæœ</title>
    <link href="http://www.ghcoder.com/2017/12/20/20171221/"/>
    <id>http://www.ghcoder.com/2017/12/20/20171221/</id>
    <published>2017-12-20T02:58:12.000Z</published>
    <updated>2017-12-21T04:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è¿™ç¯‡æ–‡ç« ç¿»è¯‘è‡ªraywenderlichä¸Šçš„æœ€æ–°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸé“¾æ¥è¿™é‡Œ-https-www-raywenderlich-com-167198-make-uiviewcontroller-transition-animation-like-ping-app"><a href="#è¿™ç¯‡æ–‡ç« ç¿»è¯‘è‡ªraywenderlichä¸Šçš„æœ€æ–°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸé“¾æ¥è¿™é‡Œ-https-www-raywenderlich-com-167198-make-uiviewcontroller-transition-animation-like-ping-app" class="headerlink" title="è¿™ç¯‡æ–‡ç« ç¿»è¯‘è‡ªraywenderlichä¸Šçš„æœ€æ–°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸé“¾æ¥è¿™é‡Œ[https://www.raywenderlich.com/167198/make-uiviewcontroller-transition-animation-like-ping-app]"></a>è¿™ç¯‡æ–‡ç« ç¿»è¯‘è‡ªraywenderlichä¸Šçš„æœ€æ–°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸé“¾æ¥è¿™é‡Œ[<a href="https://www.raywenderlich.com/167198/make-uiviewcontroller-transition-animation-like-ping-app]" target="_blank" rel="noopener">https://www.raywenderlich.com/167198/make-uiviewcontroller-transition-animation-like-ping-app]</a></h3><a id="more"></a><ul><li>ä½œè€…çš„ç›®æ ‡å°±æ˜¯å¼€å‘ä¸€ä¸ªè¿™æ ·çš„åˆ‡æ¢æ ·å¼ï¼Œä¸»è¦æ˜¯å®ç°çš„æ˜¯<strong>ä¸»é¡µé¢</strong>ä¸ <strong>menué¡µé¢</strong>åˆ‡æ¢ã€‚</li></ul><p><img src="https://koenig-media.raywenderlich.com/uploads/2017/10/BasicPushPop.gif" alt="ping"></p><ul><li>è¿™ä¸ªæ•™ç¨‹ä¸­ä¸»è¦æ˜¯ç”¨<strong>UIViewController transition animation</strong>æ¥å®Œæˆè¿™ä¸ªåŠ¨ç”»æ•ˆæœï¼Œåœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ä½ ä¼šå­¦åˆ°ä¸‹é¢çš„çŸ¥è¯†ç‚¹ï¼š</li></ul><ol><li><strong>shape layer</strong></li><li><strong>masking</strong></li><li><strong>UIViewControllerAnimatedTransitioning protocol</strong></li><li><strong>UIPercentDrivenInteractiveTransition class</strong> </li><li>â€¦</li></ol><h3 id="åˆå§‹é¡¹ç›®"><a href="#åˆå§‹é¡¹ç›®" class="headerlink" title="åˆå§‹é¡¹ç›®"></a>åˆå§‹é¡¹ç›®</h3><ul><li>é¡¹ç›®çš„èµ·å§‹ä»£ç åœ¨è¿™é‡Œ[<a href="https://www.raywenderlich.com/170144/custom-uiviewcontroller-transitions-getting-started]" target="_blank" rel="noopener">https://www.raywenderlich.com/170144/custom-uiviewcontroller-transitions-getting-started]</a></li></ul><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><h4 id="1-æƒ…å†µä»‹ç»"><a href="#1-æƒ…å†µä»‹ç»" class="headerlink" title="1.æƒ…å†µä»‹ç»"></a>1.æƒ…å†µä»‹ç»</h4><ol><li>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“æˆ‘ä»¬è¦åšçš„è¿™ä¸ªåŠ¨ç”»æ•ˆæœä¸»è¦æ˜¯ç”¨åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š ä»ä¸€ä¸ªVCåˆ‡æ¢åˆ°å…¶ä»–çš„VCæ—¶å€™æ‰€å‘ç”Ÿçš„åŠ¨ç”»[è¿™é‡Œçš„VCæŒ‡çš„å°±æ˜¯ViewController]ã€‚</li><li>åœ¨iOSä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ä¸€ç³»åˆ—çš„VCç»Ÿä¸€éƒ½æ”¾å…¥åˆ°ä¸€ä¸ª<code>UINavigationController</code>ä¸­ï¼Œé€šè¿‡éµå¾ª<code>UIViewControllerAnimatedTransitioning</code>çš„ä»£ç†æ¥å®ç°è‡ªå®šä¹‰çš„åŠ¨ç”»ã€‚</li><li>å…¶å®è¿™é‡Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>UIView</code>/<code>UIKit Dynamics</code> æˆ–è€…æ˜¯ä¸€äº›æ›´åº•å±‚<code>Core Animation API</code>æ¥å®ç°ä¸Šè¿°çš„åŠ¨ç”»æ•ˆæœï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸»è¦ä½¿ç”¨çš„æ˜¯<code>UIView</code>å’Œ<code>Core Animation APIS</code>æ¥å®ç°è¿™äº›æ•ˆæœã€‚</li></ol><h4 id="2-è¡¨è±¡"><a href="#2-è¡¨è±¡" class="headerlink" title="2.è¡¨è±¡"></a>2.è¡¨è±¡</h4><ol><li>è¿™é‡Œçš„åŠ¨ç”»æ˜¯ä»å³ä¸Šè§’å¼€å§‹ï¼Œæ…¢æ…¢æ‰©å¤§ï¼Œç›´åˆ°æ•´ä¸ªç•Œé¢å®Œæ•´å‡ºç°ã€‚</li><li>æ¶ˆå¤±VCä¸Šçš„æ–‡å­—æ˜¯ä»å·¦è¾¹æ¶ˆå¤±çš„ã€‚</li><li>å‡ºç°çš„VCä¸Šçš„æ–‡å­—æ˜¯ä»å³è¾¹æ˜¾ç¤ºå‡ºæ¥</li></ol><h4 id="3-å¼€å§‹æ"><a href="#3-å¼€å§‹æ" class="headerlink" title="3.å¼€å§‹æ"></a>3.å¼€å§‹æ</h4><ol><li>è¿è¡Œå¼€å§‹çš„ä»£ç ï¼Œå°±ä¼šå‘ç°ï¼Œç°åœ¨æ˜¯æœ€ç®€å•çš„æ ·å¼ï¼Œä¸¤ä¸ªVCé€šè¿‡<code>UINavigationController</code>æ¥<code>push</code>å’Œ<code>pop</code>ã€‚</li><li>åœ¨<code>UINavigationController</code>çš„å®ä¾‹å˜é‡æœ‰ä¸€ä¸ª<code>UINavigationControllerDelegate</code>çš„åè®®ï¼Œè¿™ä¸ªåè®®æœ‰å››ä¸ªæ–¹æ³•ï¼Œèƒ½å¤Ÿç¡®å®šVCä»¥åŠVCçš„æ»‘åŠ¨æ–¹å‘ã€‚</li></ol><ul><li>æ–°å»ºä¸€ä¸ª<code>TransitionCoordinator</code>ç±»çš„æ–‡ä»¶ï¼Œç»§æ‰¿è‡ª<code>NSObject</code>,å¹¶ä¸”éµå¾ª<code>UINavigationControllerDelegate</code>çš„åè®®ï¼š</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TransitionCoordinator</span>: <span class="type">NSObject</span>, <span class="type">UINavigationControllerDelegate &#123;&#125;</span></span></span><br></pre></td></tr></table></figure><ul><li>ç„¶åç»™è¿™ä¸ªç±»é‡Œé¢æ·»åŠ ä¸€ä¸ªåè®®æ–¹æ³•ï¼Œæ–¹æ³•åå¦‚ä¸‹, ç›®å‰å…ˆè¿”å›<code>nil</code>ï¼Œåé¢ä¼šæ¥è¡¥å……è¿›å»ï¼š</li><li>è¿™ä¸ªæ–¹æ³•ä¸»è¦ç¡®å®šäº†è¿›å…¥çš„VC/ç¦»å¼€çš„VC,å¹¶ä¸”è¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª<code>animation</code>çš„å¯¹è±¡ã€‚</li><li>å½“<code>navigationController</code>æƒ³è¦çŸ¥é“è¿™ä¸ª<code>animation</code>çš„å¯¹è±¡çš„æ—¶å€™ï¼Œè€Œè¿™é‡Œä½ å´è¿”å›äº†ä¸€ä¸ª<code>nil</code>çš„å¯¹è±¡ï¼Œè¿™æ ·çš„è¯ï¼Œç³»ç»Ÿå°±ä¼šç”¨é»˜è®¤çš„<code>push</code>ã€<code>pop</code>çš„åŠ¨ç”»æ•ˆæœã€‚</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">navigationController</span><span class="params">(<span class="number">_</span> navigationController: UINavigationController,</span></span></span><br><span class="line"><span class="function"><span class="params">                      animationControllerFor operation: UINavigationControllerOperation,</span></span></span><br><span class="line"><span class="function"><span class="params">                      from fromVC: UIViewController,</span></span></span><br><span class="line"><span class="function"><span class="params">                      to toVC: UIViewController)</span></span> -&gt; <span class="type">UIViewControllerAnimatedTransitioning</span>? &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€“</p><ul><li>è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸º<code>UINavigationController</code>çš„ä»£ç†æŒ‡å®šä¸€ä¸‹ï¼Œå›åˆ°<code>Appdelegate</code>çš„æ–‡ä»¶é‡Œé¢ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨æ–‡ä»¶çš„Appdelegate.swiftçš„æ–‡ä»¶å¤´ä¸Šå£°æ˜ä¸€ä¸ªå˜é‡</span></span><br><span class="line">let transitionCoordinator = TransitionCoordinator()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹¶ä¸”åœ¨didFinishLaunch...</span></span><br><span class="line"><span class="selector-tag">nav</span><span class="selector-class">.isNavigationBarHidden</span> = true</span><br><span class="line"><span class="selector-tag">nav</span><span class="selector-class">.delegate</span> = transitionCoordinator</span><br></pre></td></tr></table></figure><ul><li>åœ¨<code>TransitionCoordinator</code>è¿™ä¸ªç±»é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›çš„æ˜¯ä¸€ä¸ªéµå¾ª<code>UIViewControllerAnimatedTransitioning</code>åè®®çš„å¯¹è±¡ã€‚éµå¾ªè¿™ä¸ªåè®®ä¹Ÿæ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…ã€‚éµå¾ªè¿™ä¸ªåè®®éœ€è¦ç¡®å®šä¸¤ä¸ªå‡½æ•°ï¼š</li></ul><ol><li>ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ï¼šè¿”å›äº†åŠ¨ç”»éœ€è¦æ‰§è¡Œçš„æ—¶é—´ã€‚</li><li>ç¬¬äºŒä¸ªå‡½æ•°æ˜¯ï¼šè¿™ä¸ªå‡½æ•°é‡Œé¢å…¥å‚æ˜¯ä¸€ä¸ª<code>context</code>çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†åœ¨æ‰§è¡Œè¿™ä¸ªåŠ¨ç”»æ—¶å€™éœ€è¦çš„ä¿¡æ¯ã€‚</li></ol><p>â€“</p><ul><li>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åå­—ä¸º<code>CircularTransition</code>,ç»§æ‰¿è‡ª<code>NSObject</code>ï¼ŒåŒäº‹è¿˜éœ€è¦ç»§æ‰¿<code>UIViewControllerAnimatedTransitioning</code>åè®®çš„å¯¹è±¡ï¼Œå®ç°ä¸‹é¢çš„ä¸¤ä¸ªæ–¹æ³•ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">transitionDuration</span><span class="params">(using transitionContext: UIViewControllerContextTransitioning?)</span></span> </span><br><span class="line">  -&gt; <span class="type">TimeInterval</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0.5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œå…ˆç©ºç€ï¼Œåé¢ä¼šé‡ç‚¹æ¥å†™è¿™é‡Œçš„ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">animateTransition</span><span class="params">(using transitionContext: UIViewControllerContextTransitioning)</span></span> &#123;</span><br><span class="line">  <span class="comment">//make some magic happen</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¹¶ä¸”å°†ä¹‹å‰çš„<code>TransitionCoordinator.swift</code>æ–‡ä»¶é‡Œé¢è¿”å›<code>nil</code>çš„ä¿®æ”¹ä¸ºï¼š</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> CircularTransition()</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·ä½ å°±å·²ç»å®Œæˆäº†ä¸€ä»¶äº‹æƒ…ï¼Œå‘Šè¯‰<code>UINavigationController</code>,ç°åœ¨æ‰€æœ‰<code>VC</code>ä¹‹å‰çš„åˆ‡æ¢éƒ½éœ€è¦å»è¯¢é—®<code>UIViewControllerAnimatedTransitioning object</code>,è¿™é‡Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ–°å»ºçš„é‚£ä¸ªå¯¹è±¡<code>CircularTransition</code></li></ul><ul><li>é¦–å…ˆåœ¨<code>CircularTransition.swift</code>çš„å¼€å¤´ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªåè®®ï¼Œåè®®å¦‚ä¸‹ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">CircleTransitionable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> triggerButton: <span class="type">UIButton</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> contentTextView: <span class="type">UITextView</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> mainView: <span class="type">UIView</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª<code>triggerButton</code>,è¿™å°†æ˜¯æˆ‘ä»¬VCä¸­éœ€è¦ç‚¹å‡»åˆ‡æ¢çš„æŒ‰é’®ã€‚</li><li>å®šä¹‰äº†ä¸€ä¸ª<code>contentTextView</code>æˆ‘ä»¬éœ€è¦åŠ¨ç”»ç§»å…¥ç§»é™¤çš„Viewã€‚</li><li><p><code>mainView</code>æ˜¯æ˜¾ç¤ºçš„ä¸»å†…å®¹ã€‚</p></li><li><p>ä¸‹é¢æˆ‘ä»¬åˆ‡æ¢åˆ°<code>ColoredViewController.swift</code>,è¿™ä¸ª<code>ColoredViewController.swift</code>æ˜¯<code>BlackViewController</code> <code>WhiteViewController</code>çš„çˆ¶ç±»,è®©è¿™ä¸ªVCçš„éµå¾ªè¿™ä¸ªåè®®ï¼Œå¹¶ä¸”è¿™ä¸ªVCé‡Œé¢å·²ç»å­˜åœ¨<code>triggerButton</code>å’Œ<code>contentTextView</code>ï¼Œåªéœ€è¦æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼š</p></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mainView: UIView &#123;</span><br><span class="line">  <span class="keyword">return</span> view</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€“</p><ul><li>ä¸‹é¢çœŸæ­£å¼€å§‹åŠ¨æ‰‹å†™åŠ¨ç”»çš„ä»£ç ,åˆ‡æ¢åˆ°<code>CircularTransition.swift</code>é‡Œçš„<code>animateTransition(transitionContext:)</code>çš„å‡½æ•°ï¼Œæ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">guard <span class="keyword">let</span> fromVC = transitionContext.viewController(forKey: .<span class="keyword">from</span>) <span class="keyword">as</span>? CircleTransitionable,</span><br><span class="line">  <span class="keyword">let</span> toVC = transitionContext.viewController(forKey: .to) <span class="keyword">as</span>? CircleTransitionable,</span><br><span class="line">  <span class="keyword">let</span> snapshot = fromVC.mainView.snapshotView(afterScreenUpdates: <span class="literal">false</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">    transitionContext.completeTransition(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œè¦ç¡®ä¿ä½ èƒ½è·å¾—æ‰€æœ‰çš„ä¸œè¥¿ï¼Œé€šè¿‡<code>transitionContext</code>çš„å¯¹è±¡ï¼Œå¯ä»¥è·å–åˆ°åˆ‡æ¢çš„<code>viewcontrollers</code>,å¹¶ä¸”å°†è¿™äº›vcä¿®é¥°ä¸º<code>CircleTransitionable</code>,è¿™æ ·ä½ å°±å¯ä»¥è·å¾—<code>main views</code>ä»¥åŠ<code>text views</code>.</li><li><code>snapshotView(afterScreenUpdates:)</code>èƒ½å¤Ÿç›´æ¥è¿”å›<code>fromVC</code>çš„æš‚å­˜äºŒè¿›åˆ¶ç…§ç‰‡ã€‚è¿™æ˜¯ä¸€ä¸ªè§†å›¾çš„å‰¯æœ¬æ‹·è´ã€‚</li><li>åœ¨<code>else</code>çš„æƒ…å†µä¸‹ï¼Œä½ è°ƒç”¨äº†<code>transitionContext.completeTransition(false)</code>,ä½ è¿™é‡Œä¼ é€’ç»™<code>UIKit</code>ä¸€ä¸ªfalseå°±æ˜¯è¦å‘Šè¯‰ä½ æ²¡æœ‰å®ŒæˆåŠ¨ç”»ï¼Œä¹Ÿä¸åº”è¯¥åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªVC</li><li>é€šè¿‡<code>context</code>æ¥è·å–åˆ‡æ¢çš„å®¹å™¨è§†å›¾å†…å®¹ï¼š<code>let containerView = transitionContext.containerView</code>,è¿™ä¸ªviewï¼Œå°±æ˜¯åœ¨VCåˆ‡æ¢ä¸­çš„ä¸»å†…å®¹è§†å›¾ã€‚[1. å½“ä½ åšåŠ¨ç”»çš„æ—¶å€™ï¼Œå…¶å®æ“ä½œçš„å°±æ˜¯è¿™ä¸ªcontainerViewå¯¹è±¡ã€‚2. ä»è¿™ä¸ªcontainerViewä¸­ç§»é™¤fromVC çš„view, 3. åœ¨containerViewä¸­æ·»åŠ toVCçš„view]</li></ul><p>â€“</p><ul><li><strong>ä¸ºäº†ç§»åŠ¨ä¹‹å‰é¡µé¢ï¼Œè€Œä¸ä¼šæ‰“ä¹±ä¹‹å‰çš„å¸ƒå±€ï¼Œè¿™è¿™é‡Œæˆ‘ä»¬å®é™…åŠ¨ç”»æ“ä½œçš„æ˜¯ä¹‹å‰é¡µé¢çš„å‰¯æœ¬</strong>åœ¨å‡½æ•°<code>animateTransition(transitionContext:):</code>çš„ç»“å°¾æ·»åŠ å¦‚ä¸‹çš„æ–¹æ³•ï¼š</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">containerView</span><span class="selector-class">.addSubview</span>(<span class="selector-tag">snapshot</span>)</span><br></pre></td></tr></table></figure><ul><li>è€Œä½ çœŸæ­£éœ€è¦ç§»é™¤çš„å½“å‰çš„viewï¼Œéœ€è¦åœ¨ä¸‹é¢è°ƒç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fromVC<span class="selector-class">.mainView</span><span class="selector-class">.removeFromSuperview</span>()</span><br></pre></td></tr></table></figure><p>â€“</p><ul><li>åœ¨ä¸‹é¢æ·»åŠ å¦‚ä¸‹çš„æ–¹æ³•:</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func animateOldTextOffscreen(fromView: UIView) &#123;</span><br><span class="line">  <span class="comment">// 1</span></span><br><span class="line">  UIView.animate(withDuration: <span class="number">0.25</span>, </span><br><span class="line">                 delay: <span class="number">0.0</span>, </span><br><span class="line">                 options: [.curveEaseIn], </span><br><span class="line">                 animations: &#123;</span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    fromView<span class="selector-class">.center</span> = CGPoint(x: fromView<span class="selector-class">.center</span><span class="selector-class">.x</span> - <span class="number">1300</span>,</span><br><span class="line">                              y: fromView<span class="selector-class">.center</span><span class="selector-class">.y</span> + <span class="number">1500</span>)</span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    fromView<span class="selector-class">.transform</span> = CGAffineTransform(scaleX: <span class="number">5.0</span>, y: <span class="number">5.0</span>)</span><br><span class="line">  &#125;, completion: nil)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®šä¹‰äº†ä¸€ä¸ª0.25ç§’æ—¶é—´é—´éš”çš„åŠ¨ç”»ã€‚</li><li>ç§»åŠ¨viewçš„centerçš„åæ ‡ã€‚</li><li>å¹¶ä¸”å°†viewçš„å°ºå¯¸æ”¾å¤§5å€ã€‚</li><li>è¿™å°†ä¼šå¯¼è‡´textçš„è§†å›¾æ”¾å¤§ã€å¹¶ä¸”åŒæ—¶ç§»é™¤ç•Œé¢ã€‚</li></ul><p>â€“</p><ul><li>åœ¨<code>animateTransition(transitionContext:):</code>çš„åº•éƒ¨æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">animateOldTextOffscreen</span><span class="params">(fromView: snapshot)</span></span></span><br></pre></td></tr></table></figure><p>â€“</p><ul><li>æ­¤æ—¶è¿è¡Œä»£ç çš„æ—¶å€™ï¼Œä¼šå‘ç°å¯ä»¥æ­£å¸¸ç§»åŠ¨äº†ï¼Œä½†æ˜¯åœ¨ä»¥åçš„æ—¶å€™èƒŒæ™¯è‰²ä¸€ç›´æ˜¯ä¸ªé»‘è‰²èƒŒæ™¯ã€‚</li><li>è¿™ä¸ªé»‘è‰²çš„èƒŒæ™¯å…¶å®å°±æ˜¯<code>containerView</code>çš„èƒŒæ™¯è‰²ï¼Œå…¶å®è¿™é‡Œä½œè€…æƒ³åŠ¨ç”»çš„ä¸œè¥¿æ˜¯æ–‡æœ¬ï¼Œè€Œä¸æ˜¯æ•´ä¸ªviewçš„åŠ¨ç”»ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„èƒŒæ™¯ï¼Œå¹¶ä¸”è¿™ä¸ªæ–°çš„èƒŒæ™¯æˆ‘ä»¬ä¸éœ€è¦æ·»åŠ åŠ¨ç”»ã€‚åˆ‡æ¢åˆ°<code>CircularTransition.swift</code>é‡Œçš„<code>animateTransition(using:)</code>ï¼Œåœ¨æ·»åŠ <code>snapshotView</code>ä½œä¸ºå­è§†å›¾ä¹‹å‰æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let backgroundView = UIView()</span><br><span class="line">backgroundView<span class="selector-class">.frame</span> = toVC<span class="selector-class">.mainView</span><span class="selector-class">.frame</span></span><br><span class="line">backgroundView<span class="selector-class">.backgroundColor</span> = fromVC<span class="selector-class">.mainView</span><span class="selector-class">.backgroundColor</span></span><br><span class="line">containerView.addSubview(backgroundView)</span><br></pre></td></tr></table></figure><p>â€“</p><ul><li>ä»¥æ­¤åœ¨ä¸‹é¢æ·»åŠ å¦‚ä¸‹çš„ä»£ç ,è¿™ä¸ªå‡½æ•°ä¸»è¦å®Œæˆåœ†çš„åŠ¨ç”»æ•ˆæœ:</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">animate</span><span class="params">(toView: UIView, fromTriggerButton triggerButton: UIButton)</span></span> &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¹¶ä¸”åœ¨<code>animateTransition(using:)</code>ä¸­ï¼Œåœ¨æ–¹æ³•<code>animateOldTextOffscreen(fromView:snapshot):</code>ä¹‹åæ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">containerView.addSubview(<span class="keyword">to</span>VC.mainView)</span><br><span class="line">animate(<span class="keyword">to</span>View: <span class="keyword">to</span>VC.mainView, <span class="keyword">from</span>TriggerButton: <span class="keyword">from</span>VC.triggerButton)</span><br></pre></td></tr></table></figure><p>â€“</p><ul><li>è¿™é‡Œå…¶å®ä½ å·²ç»å¤§æ¦‚çš„äº†è§£äº†åŠ¨ç”»çš„å¤§ä½“æƒ³æ³•äº†ï¼Œä½†æ˜¯å…·ä½“è¿™ä¸ªåŠ¨ç”»ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç”¨åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯<code>CAShapeLayer</code>,<code>CAShapeLayer</code>æ˜¯<code>CALayer</code>çš„ä¸€ä¸ªç‰¹æ®Šç±»ï¼Œä»–ä¸ä»…ä»…æ€»æ˜¯å‘ˆç°æ­£æ–¹å½¢çš„å›¾å½¢ï¼Œè€Œæ˜¯å¯ä»¥é€šè¿‡å®šä¹‰è´èµ›å°”æ›²çº¿è·¯å¾„ï¼Œç„¶åå°†è·¯å¾„ä¸¢ç»™å›¾å±‚çš„è·¯å¾„ï¼Œå°±å¯ä»¥å®ç°è‡ªå®šä¹‰çš„å›¾æ¡ˆäº†ã€‚</li><li>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸¤ç§ä¸åŒçš„è´èµ›å°”æ›²çº¿è·¯å¾„ã€‚</li><li>åœ¨å‡½æ•°<code>animate(toView:triggerButton:):</code>é‡Œé¢æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line">let <span class="built_in">rect</span> = CGRect(x: triggerButton.frame.origin.x,</span><br><span class="line">                  y: triggerButton.frame.origin.y,</span><br><span class="line">                  <span class="built_in">width</span>: triggerButton.frame.<span class="built_in">width</span>,</span><br><span class="line">                  <span class="built_in">height</span>: triggerButton.frame.<span class="built_in">width</span>)</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line">let circleMaskPathInitial = UIBezierPath(ovalIn: <span class="built_in">rect</span>)</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è´èµ›å°”æ›²çº¿ï¼Œåˆ›å»ºçš„æ˜¯ä¸€ä¸ªå°å°çš„åœ†ï¼Œèµ·å§‹çš„ä½ç½®ï¼Œèµ·å§‹å°±æ˜¯<code>triggerButton</code>çš„åæ ‡ã€‚è¿™ä¹Ÿå°±æ˜¯èµ·å§‹åŠ¨ç”»çš„åœ†çš„çŠ¶æ€ã€‚</li><li>ä¸‹é¢åœ¨åˆ›å»ºç›¸åº”çš„åŠ¨ç”»ç»“æŸçŠ¶æ€ï¼Œç”±äºä½ çœ‹åˆ°åªæ˜¯ä¸€ä¸ªåœˆåœˆå†…çš„ä¸œè¥¿ï¼Œåœˆåœˆè¾¹ç¼˜ä»¥åŠå¤–éƒ¨çš„ä¸œè¥¿éƒ½æ˜¯çœ‹ä¸åˆ°çš„ï¼Œå› æ­¤æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line">let fullHeight = toView<span class="selector-class">.bounds</span><span class="selector-class">.height</span></span><br><span class="line">let extremePoint = CGPoint(x: triggerButton<span class="selector-class">.center</span><span class="selector-class">.x</span>,</span><br><span class="line">                           y: triggerButton<span class="selector-class">.center</span><span class="selector-class">.y</span> - fullHeight)</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line">let radius = sqrt((extremePoint.x*extremePoint.x) +</span><br><span class="line">                  (extremePoint.y*extremePoint.y))</span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line">let circleMaskPathFinal = UIBezierPath(ovalIn: triggerButton<span class="selector-class">.frame</span><span class="selector-class">.insetBy</span>(dx: -radius,</span><br><span class="line">                                                                           dy: -radius))</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆå®šä¹‰äº†ç•Œé¢çš„æ€»é«˜åº¦ã€‚</li><li>é€šè¿‡å‹¾è‚¡å®šç†æ¥è®¡ç®—åœ†çš„åŠå¾„ã€‚</li><li>ç„¶åå®šä¹‰å‡ºæ–°çš„è´èµ›å°”æ›²çº¿è·¯å¾„ã€‚<strong>è¿™é‡Œè¿˜ç”¨åˆ°ä¸€ä¸ªæ–°çš„apiå«åšinsetByï¼Œè¿™é‡Œçš„ä½œç”¨å°±æ˜¯è®¾ç½®è¾¹æ¡†çš„å¤§å°ï¼Œå½“è®¾ç½®çš„å€¼ä¸ºè´Ÿå€¼çš„æ—¶å€™ï¼ŒåŸæ¥çš„frameå€¼å°±ä¼šå˜å¤§</strong></li></ul><p>â€“</p><ul><li>ç°åœ¨å·²ç»è·å¾—äº†èµ·å§‹ã€ç»ˆç‚¹çš„çŠ¶æ€çš„è´å¡å°”æ›²çº¿è·¯å¾„ï¼Œæ‰€ä»¥åœ¨å‡½æ•°<code>animate(toView:triggerButton:)</code>ä¸­æ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let maskLayer = CAShapeLayer()</span><br><span class="line">maskLayer<span class="selector-class">.path</span> = circleMaskPathFinal.cgPath</span><br><span class="line">toView<span class="selector-class">.layer</span><span class="selector-class">.mask</span> = maskLayer</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª<code>CAShapeLayer</code>çš„å¯¹è±¡ï¼Œå¹¶ä¸”å°†å®ƒçš„<code>path</code>çš„å±æ€§å€¼è®¾ç½®ä¸ºæˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„æœ€ç»ˆçŠ¶æ€çš„è´å¡å°”æ›²çº¿å€¼ï¼Œå¹¶ä¸”å°†è¿™ä¸ª<code>mask</code>çš„å€¼èµ‹å€¼ç»™<code>toView.layer.mask</code>ã€‚</li></ul><p>â€“</p><h4 id="CALayer-Maskingæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿ"><a href="#CALayer-Maskingæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿ" class="headerlink" title="CALayer Maskingæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿ"></a>CALayer Maskingæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿ</h4><ul><li>å½“ä¸€ä¸ªviewçš„alphaä¸º1çš„æ—¶å€™ï¼Œå°†ä¼šæ˜¾ç¤ºmaskå›¾å±‚ä¸‹çš„ä¸œè¥¿ã€‚</li><li>è€Œå½“alphaä¸º0çš„æ—¶å€™ï¼Œå°±ä¼šéšè—maskä¸‹é¢çš„ä¸œè¥¿ï¼Œè¿™ä¸ªå°±æ˜¯å›¾è¡¨è§£é‡Šï¼š</li></ul><p><img src="https://koenig-media.raywenderlich.com/uploads/2014/10/mask-diagram-700x381.png" alt=""></p><p>â€“</p><ul><li>åœ¨å‡½æ•°<code>animate(toView:triggerButton:)</code>é‡Œåˆ›å»ºäº†ä¸€ä¸ª<code>CABasicAnimation</code>çš„å¯¹è±¡,å¹¶ä¸”å‘Šè¯‰å®ƒanimationä¿®æ”¹<code>path</code>çš„å±æ€§:</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let maskLayerAnimation = CABasicAnimation(keyPath: <span class="string">"path"</span>)</span><br><span class="line">maskLayerAnimation<span class="selector-class">.fromValue</span> = circleMaskPathInitial.cgPath</span><br><span class="line">maskLayerAnimation<span class="selector-class">.toValue</span> = circleMaskPathFinal.cgPath</span><br><span class="line">maskLayerAnimation<span class="selector-class">.duration</span> = <span class="number">0.15</span></span><br><span class="line">maskLayerAnimation<span class="selector-class">.delegate</span> = self</span><br></pre></td></tr></table></figure><ul><li>ç„¶ååˆ°æ–‡ä»¶çš„æœ€åº•ä¸‹ï¼Œåˆ›å»ºå¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CircularTransition</span>: <span class="title">CAAnimationDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">animationDidStop</span><span class="params">(<span class="number">_</span> anim: CAAnimation, finished flag: Bool)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å½“å›è°ƒåˆ°è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå°±ä»£è¡¨è¿™ä¸ªåŠ¨ç”»å·²ç»è¿è¡ŒæˆåŠŸï¼Œå¹¶ä¸”ç»“æŸäº†ã€‚åœ¨è¿™ä¸ªå›è°ƒä¸­ï¼Œä½ éœ€è¦ç»™è¿™ä¸ª<code>context</code>è°ƒç”¨<code>completeTransition()</code>çš„æ–¹æ³•<code>,éœ€è¦åœ¨è¿™ä¸ªå›è°ƒçš„æ–¹æ³•ä¸­è·å¾—</code>context<code>çš„å¯¹è±¡ï¼Œä½ éœ€è¦å°†è¿™ä¸ªå¯¹è±¡è®¾ç½®ä¸ºå…¨å±€çš„ï¼Œåœ¨</code>CircularTransition`å¤´éƒ¨ï¼Œæ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">weak</span> <span class="keyword">var</span> <span class="keyword">context</span>: UIViewControllerContextTransitioning?</span><br></pre></td></tr></table></figure><ul><li>å¹¶ä¸”åœ¨å‡½æ•°<code>animateTransition(transitionContext:)</code>ä¸­çš„guardä¹‹åæ·»åŠ å¦‚ä¸‹çš„ä»£ç ï¼š</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">context</span> = transitionContext</span><br></pre></td></tr></table></figure><ul><li>æœ€åè¿˜éœ€è¦å°†è¿™ä¸ªåŠ¨ç”»æ•ˆæœæ·»åŠ è¿™ä¸ª<code>Layer</code>ä¸Šï¼š</li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">maskLayer</span><span class="selector-class">.add</span>(maskLayerAnimation, <span class="attribute">forKey</span>: <span class="string">"path"</span>)</span><br></pre></td></tr></table></figure><p>â€“</p><h4 id="æ•ˆæœçš„å®Œå–„"><a href="#æ•ˆæœçš„å®Œå–„" class="headerlink" title="æ•ˆæœçš„å®Œå–„"></a>æ•ˆæœçš„å®Œå–„</h4><ul><li>åœ¨<code>CircularTransition</code>ç±»é‡Œæ·»åŠ å¦‚ä¸‹çš„æ–¹æ³•ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func animateToTextView(toTextView: UIView, fromTriggerButton: UIButton) &#123;</span><br><span class="line">  let originalCenter = toTextView.center</span><br><span class="line">toTextView<span class="selector-class">.alpha</span> = <span class="number">0.0</span></span><br><span class="line">toTextView<span class="selector-class">.center</span> = fromTriggerButton.center</span><br><span class="line">toTextView<span class="selector-class">.transform</span> = CGAffineTransform(scaleX: <span class="number">0.1</span>, y: <span class="number">0.1</span>)</span><br><span class="line">UIView.animate(withDuration: <span class="number">0.25</span>, delay: <span class="number">0.1</span>, options: [.curveEaseOut], animations: &#123;</span><br><span class="line">  toTextView<span class="selector-class">.transform</span> = CGAffineTransform(scaleX: <span class="number">1.0</span>, y: <span class="number">1.0</span>)</span><br><span class="line">  toTextView<span class="selector-class">.center</span> = originalCenter</span><br><span class="line">  toTextView<span class="selector-class">.alpha</span> = <span class="number">1.0</span></span><br><span class="line">&#125;, completion: nil)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ€åå†<code>animateTransition(transitionContext:).</code>æ–¹æ³•ä¸­æ·»åŠ å¦‚ä¸‹çš„æŒ‰é’®ï¼š</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">animateToTextView(<span class="keyword">to</span>TextView: <span class="keyword">to</span>VC.contentTextView, <span class="keyword">from</span>TriggerButton: <span class="keyword">from</span>VC.triggerButton)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;è¿™ç¯‡æ–‡ç« ç¿»è¯‘è‡ªraywenderlichä¸Šçš„æœ€æ–°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸé“¾æ¥è¿™é‡Œ-https-www-raywenderlich-com-167198-make-uiviewcontroller-transition-animation-like-ping-app&quot;&gt;&lt;a href=&quot;#è¿™ç¯‡æ–‡ç« ç¿»è¯‘è‡ªraywenderlichä¸Šçš„æœ€æ–°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸé“¾æ¥è¿™é‡Œ-https-www-raywenderlich-com-167198-make-uiviewcontroller-transition-animation-like-ping-app&quot; class=&quot;headerlink&quot; title=&quot;è¿™ç¯‡æ–‡ç« ç¿»è¯‘è‡ªraywenderlichä¸Šçš„æœ€æ–°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸé“¾æ¥è¿™é‡Œ[https://www.raywenderlich.com/167198/make-uiviewcontroller-transition-animation-like-ping-app]&quot;&gt;&lt;/a&gt;è¿™ç¯‡æ–‡ç« ç¿»è¯‘è‡ªraywenderlichä¸Šçš„æœ€æ–°ä¸€ç¯‡æ–‡ç« ï¼ŒåŸé“¾æ¥è¿™é‡Œ[&lt;a href=&quot;https://www.raywenderlich.com/167198/make-uiviewcontroller-transition-animation-like-ping-app]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.raywenderlich.com/167198/make-uiviewcontroller-transition-animation-like-ping-app]&lt;/a&gt;&lt;/h3&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swiftã€Animation" scheme="http://www.ghcoder.com/tags/Swift%E3%80%81Animation/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºRxSwiftä¿¡æ¯é‡çš„ä¸€äº›é—®é¢˜(äºŒ)</title>
    <link href="http://www.ghcoder.com/2017/10/11/20171011/"/>
    <id>http://www.ghcoder.com/2017/10/11/20171011/</id>
    <published>2017-10-11T08:50:12.000Z</published>
    <updated>2017-11-09T02:19:26.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œå·²ç»ä»‹ç»äº†ä¸€äº›ï¼Œè¿‡æ»¤ã€ç­›é€‰ä¿¡å·é‡çš„æ“ä½œç¬¦ï¼Œç°åœ¨åˆ—ä¸¾ä¸€äº›å¤æ‚æ“ä½œç¬¦ã€‚</li></ul><hr><ul><li>é¦–å…ˆè¦è¯´çš„ä¸€ä¸ªæ“ä½œç¬¦å«åš<code>Scan</code>ï¼Œçœ‹åˆ°åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œ<code>Scan</code>æ˜¯å±äºåœ¨<code>Transforming</code>ï¼Œä¹Ÿå°±å¯ä»¥çŒœåˆ°ï¼Œè¿™ä¸ªæ“ä½œç¬¦ï¼Œå…¶å®ä¹Ÿæ˜¯ä¿¡å·è½¬æ¢çš„éƒ¨åˆ†ã€‚</li></ul><a id="more"></a><ul><li>å…ˆçœ‹ä¸€ä¸‹å®˜æ–¹çš„ä»‹ç»</li></ul><blockquote><p>The Scan operator applies a function to the first item emitted by the source Observable and then emits the result of that function as its own first emission. It also feeds the result of the function back into the function along with the second item emitted by the source Observable in order to generate its second emission. It continues to feed back its own subsequent emissions along with the subsequent emissions from the source Observable in order to create the rest of its sequence.</p></blockquote><ul><li>åœ¨çœ‹ä¸€ä¸‹githubä¸Šä»£ç çš„ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">scan</span>&lt;A&gt;<span class="params">(<span class="number">_</span> seed: A, accumulator: @escaping <span class="params">(A, E)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">A</span>)</span><br><span class="line">    -&gt; <span class="type">Observable</span>&lt;<span class="type">A</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Scan</span>(source: <span class="keyword">self</span>.asObservable(), seed: seed, accumulator: accumulator)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">fileprivate</span> <span class="class"><span class="keyword">class</span> <span class="title">Scan</span>&lt;<span class="title">Element</span>, <span class="title">Accumulate</span>&gt;: <span class="title">Producer</span>&lt;<span class="title">Accumulate</span>&gt; </span>&#123;</span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Accumulator</span> = (<span class="type">Accumulate</span>, <span class="type">Element</span>) <span class="keyword">throws</span> -&gt; <span class="type">Accumulate</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">let</span> _source: <span class="type">Observable</span>&lt;<span class="type">Element</span>&gt;</span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">let</span> _seed: <span class="type">Accumulate</span></span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">let</span> _accumulator: <span class="type">Accumulator</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">init</span>(source: <span class="type">Observable</span>&lt;<span class="type">Element</span>&gt;, seed: <span class="type">Accumulate</span>, accumulator: @escaping <span class="type">Accumulator</span>) &#123;</span><br><span class="line">    _source = source</span><br><span class="line">    _seed = seed</span><br><span class="line">    _accumulator = accumulator</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™å°±å¯ä»¥æ ¹æ®å®˜æ–¹çš„ä»‹ç»å¯ä»¥çŸ¥é“ï¼Œä»€ä¹ˆæ˜¯<code>Scan</code></li><li><code>Scan</code>æ“ä½œç¬¦ï¼Œéœ€è¦æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå‚æ•°æ˜¯æ³›å‹A, ç¬¬äºŒä¸ªå‚æ•°æ˜¯<code>block</code>ï¼Œ<code>block</code>çš„å‚æ•°ç±»å‹ä»¥åŠè¿”å›å€¼çš„ç±»å‹æ˜¯<code>(A, Element) -&gt; A</code>.</li><li>è¿™é‡Œçš„<code>Element</code>ï¼Œæ˜¯åœ¨ä¹Ÿä¸æ˜¯éšç¼–çš„æ³›å‹ï¼Œå¯ä»¥çœ‹æºç ä¸­çŸ¥é“ï¼Œ<code>Scan</code>åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå‡ºå…¥äº†ä¸‰ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯è®²è‡ªå·±è½¬åŒ–ä¸ºå¯è®¢é˜…çš„å¯¹è±¡<code>self.asObservable()</code>,åœ¨å…¥å‚ä¸­<code>Observable&lt;Element&gt;</code>,è¿™å°±è¯´æ˜äº†ï¼Œè¿™ä¸ª<code>Element</code>çš„ç±»å‹ï¼Œå’Œä½ èµ·åˆçš„è®¢é˜…çš„å¯¹è±¡çš„è®¢é˜…ç±»å‹æ˜¯åŒä¸€ä¸ªç±»å‹ã€‚</li><li>çœ‹ä¸€ä¸‹demoï¼š</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">è¿™é‡Œåªæ˜¯å°†å­—ç¬¦æ‰“å°å‡ºæ¥</span></span><br><span class="line"><span class="string">let</span> <span class="string">bag</span> <span class="string">=</span> <span class="string">DisposeBag()</span></span><br><span class="line"><span class="string">let</span> <span class="string">subject</span> <span class="string">=</span> <span class="string">PublishSubject&lt;String&gt;()</span></span><br><span class="line">    </span><br><span class="line"><span class="string">_</span> <span class="string">=</span> <span class="string">subject</span></span><br><span class="line">    <span class="string">.subscribe(onNext:</span> <span class="string">&#123;print($0)&#125;)</span></span><br><span class="line">    <span class="string">.addDisposableTo(bag)</span></span><br><span class="line">    </span><br><span class="line"><span class="string">subject.onNext("gong")</span></span><br><span class="line"><span class="string">subject.onNext("h")</span></span><br><span class="line"></span><br><span class="line"><span class="string">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="string">gong</span></span><br><span class="line"><span class="string">h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">è¿™é‡Œæ˜¯ç”¨æ¥è®¡ç®—æˆ‘è¾“å…¥å­—ç¬¦é•¿åº¦çš„ç´¯åŠ </span></span><br><span class="line"><span class="string">let</span> <span class="string">bag</span> <span class="string">=</span> <span class="string">DisposeBag()</span></span><br><span class="line"><span class="string">let</span> <span class="string">subject</span> <span class="string">=</span> <span class="string">PublishSubject&lt;String&gt;()</span></span><br><span class="line">    </span><br><span class="line"><span class="string">_</span> <span class="string">=</span> <span class="string">subject</span></span><br><span class="line">    <span class="string">.scan(0)</span> <span class="string">&#123;(count:</span> <span class="string">Int,</span> <span class="attr">content:</span> <span class="string">String)</span> <span class="string">in</span></span><br><span class="line">        <span class="string">return</span> <span class="string">count</span> <span class="string">+</span> <span class="string">content.characters.count</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">.subscribe(onNext:</span> <span class="string">&#123;print($0)&#125;)</span></span><br><span class="line">    <span class="string">.addDisposableTo(bag)</span></span><br><span class="line">    </span><br><span class="line"><span class="string">subject.onNext("gong")</span></span><br><span class="line"><span class="string">subject.onNext("h")</span></span><br><span class="line"><span class="string">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><ul><li>ä½ å¯ä»¥è¯•è¯•ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å°†Contentçš„ç±»å‹ä¿®æ”¹ä»»æ„ç±»å‹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šä¸è¡Œçš„ï¼Œä¹‹å‰åœ¨çœ‹æºç çš„æ—¶å€™ï¼Œæˆ‘å·²ç»è§£é‡Šè¿‡ä¸ºä»€ä¹ˆäº†ï¼Œè¿™é‡Œçš„<code>content</code>çš„ç±»å‹å¿…é¡»è¦å’Œæˆ‘ä»¬åˆ¶å®šå®šä¹‰<code>subject</code>çš„ç±»å‹ç›¸åŒã€‚</li></ul><hr><ul><li><code>skpiWhile</code>ä¹‹å‰ä¸€ç›´æ²¡æœ‰ç»•æ¸…æ¥šï¼Œä»Šå¤©è¿˜æ˜¯æ‰“ç®—çœ‹ä¸€ä¸‹æºç ï¼Œè¿™åªæˆ‘å·²ç»è¯´äº†ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥ç­›é€‰ä¿¡å·çš„æ—¶å€™ç”¨çš„ï¼Œä¹‹å‰ä¸€ç›´ä¸æ¸…æ¥šä¸ºä»€ä¹ˆä¸ºtrueçš„æ—¶å€™ï¼Œå°±ä¼šè¿‡æ»¤ä¿¡å·å‘¢ï¼Ÿ</li><li>æŸ¥çœ‹githubä¸Šä»£ç ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ï¼Œå…³é”®çš„ä»£ç ï¼š</li></ul><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">func <span class="title">on</span>(<span class="params">_ <span class="keyword">event</span>: Event&lt;Element&gt;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">event</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> .next(<span class="keyword">let</span> <span class="keyword">value</span>):</span><br><span class="line">        <span class="keyword">if</span> !_running &#123;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                _running = <span class="keyword">try</span> !_parent._predicate(<span class="keyword">value</span>)</span><br><span class="line">            &#125; <span class="keyword">catch</span> <span class="keyword">let</span> e &#123;</span><br><span class="line">                forwardOn(.error(e))</span><br><span class="line">                dispose()</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> _running &#123;</span><br><span class="line">            forwardOn(.next(<span class="keyword">value</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">case</span> .error, .completed:</span><br><span class="line">        forwardOn(<span class="keyword">event</span>)</span><br><span class="line">        dispose()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>çœ‹åˆ°ä»£ç å°±çŸ¥é“ï¼Œé™¤éæ˜¯<code>.onError()/onCompleted()</code>äº‹ä»¶ï¼Œå…¶ä»–<code>.onNext()</code>çš„æ—¶é—´ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œï¼Œä½ ä¼ å…¥çš„<code>block</code>,çœ‹çœ‹ä½ çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœæ˜¯trueçš„è¯ï¼Œå°±ä¼šæ‰§è¡Œ<code>forwardOn()</code>çš„å‡½æ•°ï¼š</li></ul><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">final func <span class="title">forwardOn</span>(<span class="params">_ <span class="keyword">event</span>: Event&lt;O.E&gt;</span>)</span> &#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></span><br><span class="line">        <span class="function"><span class="keyword">if</span> <span class="title">AtomicIncrement</span>(<span class="params">&amp;_numberOfConcurrentCalls</span>) &gt; 1</span> &#123;</span><br><span class="line">            rxFatalError(<span class="string">"Warning: Recursive call or synchronization error!"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        defer &#123;</span><br><span class="line">            _ = AtomicDecrement(&amp;_numberOfConcurrentCalls)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span> _disposed &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    _observer.<span class="keyword">on</span>(<span class="keyword">event</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä»–è®²ä¸‹ä¸€ä¸ªå€¼æœ‰é€’å½’ä¼ åˆ°åŒä¸€ä¸ªå‡½æ•°ä¸­äº†ï¼Œè¿™æ ·å°±èµ·åˆ°äº†è¿‡æ»¤çš„æ•ˆæœã€‚</li></ul><hr><ul><li>è¿˜æœ‰ä¸€äº›å…³äºä¿¡å·è½¬æ¢çš„é—®é¢˜ï¼Œå¦‚ä½•è½¬åŒ–ä¸ºæ•°ç»„ç±»å‹,è¿™é‡Œæˆ‘ç”¨åˆ°<code>toArray()</code>,Demo:</li><li>è¿™ç§è½¬åŒ–æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå¹¶å½“ä½ ä¸‹æ¬¡å‘é€<code>.onNext()</code>çš„æ—¶å€™ï¼Œä»–æ˜¯ä¸ä¼šè½¬åŒ–ï¼Œä¹Ÿå°±ä¸ä¼šæ¥å—åˆ°<code>.onNext()</code>çš„å›è°ƒ.</li><li>å¦‚æœåœ¨è°ƒç”¨<code>.onNext()</code>å€¼ä¹‹å‰ï¼Œä½ å·²ç»è½¬åŒ–ä¸ºArrayï¼Œåœ¨ä½ ä¸‹æ¬¡è½¬åŒ–çš„æ—¶å€™ï¼Œå°±æ— æ³•å†è½¬åŒ–äº†ã€‚</li></ul><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Observable.of(1,2,3,4)</span><br><span class="line">.toArray()</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        dump(type(of: $0))</span><br><span class="line">        dump($0)</span><br><span class="line">    &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment"> //ç»ˆç«¯è¾“å‡º</span></span><br><span class="line">-<span class="ruby"> Swift.Array&lt;Swift.Int&gt; <span class="comment">#0</span></span></span><br><span class="line"><span class="ruby">â–¿ <span class="number">4</span> elements</span></span><br><span class="line"><span class="ruby">- <span class="number">1</span></span></span><br><span class="line"><span class="ruby">- <span class="number">2</span></span></span><br><span class="line"><span class="ruby">- <span class="number">3</span></span></span><br><span class="line"><span class="ruby">- <span class="number">4</span></span></span><br></pre></td></tr></table></figure><hr><ul><li>æ“ä½œç¬¦<code>map</code>çš„æ“ä½œï¼Œä¹Ÿæ˜¯æ¥å—ä¸€ä¸ªblockï¼Œè¿™é‡Œç›´æ¥ä¸Šä»£ç ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(<span class="number">_</span> event: Event&lt;SourceType&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> event &#123;</span><br><span class="line">    <span class="keyword">case</span> .next(<span class="keyword">let</span> element):</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> mappedElement = <span class="keyword">try</span> _transform(element)</span><br><span class="line">            forwardOn(.next(mappedElement))</span><br><span class="line">        &#125;</span><br><span class="line">        ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å‡ºå…¥çš„block å°±åƒä¸€ä¸ªåŠ å·¥å‚ä¸€æ ·ï¼Œä¼šå°†æ¥å—åˆ°çš„<code>element</code>çš„å‚æ•°ï¼Œç»è¿‡æˆ‘ä»¬ä¼ å…¥çš„blockåŠ å·¥åï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„å€¼ï¼Œç„¶ååˆä¼šå›ä¼ ç»™è‡ªå·±ã€‚è¿™æ ·æ¯æ¬¡æ¥å—åˆ°çš„å°±æ˜¯æ–°å€¼äº†ã€‚</li></ul><hr><ul><li>è€Œæ“ä½œç¬¦<code>mapWithIndexä¼šå›ä¼ å›æ¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªvalueå€¼ï¼Œä¸€ä¸ªæ˜¯indexå€¼</code>ï¼Œè¿™é‡Œåˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿçœ‹ä¸€ä¸‹æºä»£ç ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> _index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(<span class="number">_</span> event: Event&lt;SourceType&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> event &#123;</span><br><span class="line">    <span class="keyword">case</span> .next(<span class="keyword">let</span> element):</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> mappedElement = <span class="keyword">try</span> _selector(element, <span class="keyword">try</span> incrementChecked(&amp;_index))</span><br><span class="line">            forwardOn(.next(mappedElement))</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">incrementChecked</span><span class="params">(<span class="number">_</span> i: <span class="keyword">inout</span> Int)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line"><span class="keyword">if</span> i == <span class="type">Int</span>.<span class="built_in">max</span> &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="type">RxError</span>.overflow</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> &#123; i += <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><ul><li>å¾ˆæ˜æ˜¾äº†ï¼Œindexåˆå§‹å€¼æ˜¯ä»0å¼€å§‹ï¼Œæ¯æ¬¡éƒ½ä¼šæ‹¿åˆ°æŒ‡é’ˆï¼Œè¿›è¡Œç´¯åŠ ï¼Œç„¶åå›ä¼ å›å»ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„indexäº†ã€‚</li></ul><hr><ul><li>ä¸‹é¢ä¸€ä¸ªæ¯”è¾ƒéš¾ç†è§£çš„æ“ä½œç¬¦å«åš<code>flatMap</code>,çœ‹å®˜ç½‘ä¸Šçš„ä»‹ç»ä¸ºæ˜¯è¿™æ ·çš„ï¼š</li></ul><blockquote><p>transform the items emitted by an Observable into Observables, then flatten the emissions from those into a single Observable</p></blockquote><ul><li>è¿™å¥è¯å…¶å®éå¸¸ç»•ï¼Œå¯èƒ½ä¸ç†è§£çš„äººå¯èƒ½ä¸€ç›´è¯»ä¸æ‡‚ã€‚é¦–å…ˆç†è§£ç¬¬ä¸€å¥è¯ï¼Œ<code>transform the items emitted by an Observable into Observables</code>: æˆ‘çš„ç†è§£æ˜¯ï¼Œç”±<em>ä¸€ä¸ª</em><code>å¯è¢«è®¢é˜…çš„å¯¹è±¡</code>å‘å‡ºçš„å¤šä¸ªå€¼ï¼Œé€šè¿‡æˆ‘ä»¬ä¼ å…¥çš„<code>block</code>,æ¥å˜æ¢ä¸ºå¤šä¸ª<code>å¯è®¢é˜…çš„å¯¹è±¡</code></li></ul><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bag = DisposeBag()</span><br><span class="line"><span class="keyword">let</span> subject = PublishSubject&lt;GHObject&gt;()</span><br><span class="line">    </span><br><span class="line"><span class="number">_</span> = subject</span><br><span class="line">    .flatMap&#123;</span><br><span class="line">        <span class="number">$0</span>.gh<span class="number">_</span><span class="keyword">value</span>.asObservable()</span><br><span class="line">    &#125;</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        print(type(<span class="keyword">of</span>: <span class="number">$0</span>))</span><br><span class="line">        dump(<span class="number">$0</span>)</span><br><span class="line">    &#125;).addDisposableTo(bag)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> gh<span class="number">1</span> = GHObject(gh<span class="number">_</span><span class="keyword">value</span>: Variable(<span class="number">10</span>))</span><br><span class="line">    </span><br><span class="line">subject.onNext(gh<span class="number">1</span>)</span><br><span class="line">gh<span class="number">1</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">struct GHObject &#123;</span><br><span class="line">    var gh<span class="number">_</span><span class="keyword">value</span>: Variable&lt;Int&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line">- <span class="number">10</span></span><br><span class="line">- <span class="number">11</span></span><br></pre></td></tr></table></figure><ul><li>é‚£ç¬¬äºŒå¥è¯æ€ä¹ˆç†è§£å‘¢ï¼Ÿ<code>then flatten the emissions from those into a single Observable</code>,é€šè¿‡ä¸Šé¢çš„ä»£ç å·²ç»çŸ¥é“äº†ï¼Œæˆ‘ä»¬é€šè¿‡<code>flatMap</code>æ“ä½œç¬¦ï¼Œå·²ç»å°†<code>GHObject</code>-&gt;<code>Int</code>ï¼Œå¦‚æœæˆ‘å­˜åœ¨å¤šä¸ª<code>GHObject</code>çš„å¯¹è±¡ï¼ŒåŒäº‹å‘å‡ºå€¼ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥çœ‹åšæ˜¯å°†å¤šä¸ª<code>Int</code>çš„å€¼å‘é€äº†å‡ºæ¥ï¼Œè‡³äºæ˜¯å“ªä¸ª<code>GHObject</code>å‘é€å‡ºæ¥çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒï¼š</li></ul><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bag = DisposeBag()</span><br><span class="line"><span class="keyword">let</span> subject = PublishSubject&lt;GHObject&gt;()</span><br><span class="line">    </span><br><span class="line"><span class="number">_</span> = subject</span><br><span class="line">    .flatMap&#123;</span><br><span class="line">        <span class="number">$0</span>.gh<span class="number">_</span><span class="keyword">value</span>.asObservable()</span><br><span class="line">    &#125;</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        dump(<span class="number">$0</span>)</span><br><span class="line">    &#125;).addDisposableTo(bag)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> gh<span class="number">1</span> = GHObject(gh<span class="number">_</span><span class="keyword">value</span>: Variable(<span class="number">10</span>))</span><br><span class="line">    </span><br><span class="line">subject.onNext(gh<span class="number">1</span>)</span><br><span class="line">gh<span class="number">1</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">11</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> gh<span class="number">2</span> = GHObject(gh<span class="number">_</span><span class="keyword">value</span>: Variable(<span class="number">100</span>))</span><br><span class="line">subject.onNext(gh<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">gh<span class="number">1</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">12</span></span><br><span class="line">gh<span class="number">2</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">101</span></span><br><span class="line">gh<span class="number">2</span>.gh<span class="number">_</span><span class="keyword">value</span>.<span class="keyword">value</span> = <span class="number">102</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line">- <span class="number">10</span></span><br><span class="line">- <span class="number">11</span></span><br><span class="line">- <span class="number">100</span></span><br><span class="line">- <span class="number">12</span></span><br><span class="line">- <span class="number">101</span></span><br><span class="line">- <span class="number">102</span></span><br></pre></td></tr></table></figure><ul><li>è‡³äºå’Œ<code>flatMap</code>ç±»ä¼¼çš„ä¸€ä¸ªæ“ä½œç¬¦,æˆ‘ä»¬å«åš<code>flatMapLatest</code>,æˆ‘æ˜¯è¿™ä¹ˆææ“æ“ä½œç¬¦çš„ï¼š<code>ä¸€ç‚¹æ¥å—äº†ä¸€ä¸ªæ–°çš„GHObjectå‘çš„gh_valueå€¼ä¹‹åï¼Œä¹‹å‰æ—§çš„GHObject_valueå‘å‡ºçš„gh_valueæˆ‘ä»¬éƒ½ä¼šç»Ÿç»Ÿè¿‡æ»¤æ‰</code>ï¼ŒDemo:</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">let bag = DisposeBag()</span><br><span class="line">let subject = PublishSubject&lt;GHObject&gt;()</span><br><span class="line">    </span><br><span class="line">_ = subject</span><br><span class="line">    .flatMapLatest&#123;</span><br><span class="line">        $<span class="number">0</span><span class="selector-class">.gh_value</span><span class="selector-class">.asObservable</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        dump($<span class="number">0</span>)</span><br><span class="line">    &#125;).addDisposableTo(bag)</span><br><span class="line">    </span><br><span class="line">let gh1 = GHObject(gh_value: Variable(<span class="number">10</span>))</span><br><span class="line">    </span><br><span class="line">subject.onNext(gh1)</span><br><span class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">11</span></span><br><span class="line">    </span><br><span class="line">let gh2 = GHObject(gh_value: Variable(<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line">subject.onNext(gh2)</span><br><span class="line">    </span><br><span class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">12</span></span><br><span class="line">gh2<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">101</span></span><br><span class="line">gh2<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">102</span></span><br><span class="line">    </span><br><span class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">13</span></span><br><span class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">14</span></span><br><span class="line">gh1<span class="selector-class">.gh_value</span><span class="selector-class">.value</span> = <span class="number">15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line">- <span class="number">10</span></span><br><span class="line">- <span class="number">11</span></span><br><span class="line">- <span class="number">100</span></span><br><span class="line">- <span class="number">101</span></span><br><span class="line">- <span class="number">102</span></span><br></pre></td></tr></table></figure><ul><li>è¿™ä¸ª<code>flatMapLatest</code>å¬ä¸Šå»æ¯”è¾ƒç»•ï¼Œä½†æ˜¯ä¸€æ—¦æ‹¿èµ·ç¬”ç”»ç”»ï¼Œå°±ä¼šå¾ˆæ¸…æ™°äº†ã€‚</li></ul><hr><ul><li>åœ¨è·å–æŸäº›ä¿¡å·é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ­¤ä¹‹å‰è·å–å…¶ä»–çš„ä¿¡å·ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨åˆ°<code>.startWith(_ elements: E ...)</code>ï¼Œçœ‹ä¸€ä¸‹githubä¸­çš„æºç ï¼Œå°±ä¼šå‘ç°äº†ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">startWith</span><span class="params">(<span class="number">_</span> elements: E ...)</span></span></span><br><span class="line">    -&gt; <span class="type">Observable</span>&lt;<span class="type">E</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">StartWith</span>(source: <span class="keyword">self</span>.asObservable(), elements: elements)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">run</span>&lt;O : ObserverType&gt;<span class="params">(<span class="number">_</span> observer: O, cancel: Cancelable)</span></span> -&gt; (sink: <span class="type">Disposable</span>, subscription: <span class="type">Disposable</span>) <span class="keyword">where</span> <span class="type">O</span>.<span class="type">E</span> == <span class="type">Element</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> elements &#123;</span><br><span class="line">        observer.on(.next(e))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (sink: <span class="type">Disposables</span>.create(), subscription: source.subscribe(observer))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥ä¹Ÿå°±çŸ¥é“äº†ï¼Œè¿™ä¸ªstartWithæ¥å—çš„æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œåœ¨æ­£åœ¨è®¢é˜…åˆ°è‡ªå·±æƒ³è¦çš„æ•°æ®ä¹‹å‰ï¼Œä¼šå…ˆéå†æ‰“å°ä¹‹å‰çš„ä¿¡å·ã€‚çœ‹ä¸€ä¸‹Demo:</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bag = DisposeBag()</span><br><span class="line"><span class="keyword">let</span> subject = PublishSubject&lt;<span class="keyword">String</span>&gt;()</span><br><span class="line">    </span><br><span class="line">subject</span><br><span class="line">    .startWith(<span class="string">"Step1"</span>, <span class="string">"Step2"</span>, <span class="string">"Step3"</span>)</span><br><span class="line">    .subscribe(onNext: &#123;</span><br><span class="line">        <span class="keyword">print</span>($<span class="number">0</span>)</span><br><span class="line">    &#125;).addDisposableTo(bag)</span><br><span class="line">    </span><br><span class="line">subject.onNext(<span class="string">"Do somethingA"</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">"----"</span>)</span><br><span class="line">subject.onNext(<span class="string">"Do somethingB"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line">Step1</span><br><span class="line">Step2</span><br><span class="line">Step3</span><br><span class="line"><span class="keyword">Do</span> somethingA</span><br><span class="line">----</span><br><span class="line"><span class="keyword">Do</span> somethingB</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹å‡ºï¼Œä»–ä¸æ˜¯æ¯æ¬¡è®¢é˜…çš„æ—¶å€™ï¼Œéƒ½ä¼šå°†startWithä¸­çš„å€¼æ‰“å°ä¸€éï¼Œåªä¼šæ‰“å°ä¸€æ¬¡ã€‚</li></ul><hr><ul><li>ä¸²è”é“¾æ¥å¤šä¸ªäº‹ä»¶çš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>concat</code>,è°ƒç”¨æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œçœ‹ä¸€ä¸‹æºç ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ObservableType</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     Concatenates the second observable sequence to `self` upon successful termination of `self`.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     - seealso: [concat operator on reactivex.io](http://reactivex.io/documentation/operators/concat.html)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     - parameter second: Second observable sequence.</span></span><br><span class="line"><span class="comment">     - returns: An observable sequence that contains the elements of `self`, followed by those of the second sequence.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">concat</span>&lt;O: ObservableConvertibleType&gt;<span class="params">(<span class="number">_</span> second: O)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">E</span>&gt; <span class="keyword">where</span> <span class="type">O</span>.<span class="type">E</span> == <span class="type">E</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Observable</span>.concat([<span class="keyword">self</span>.asObservable(), second.asObservable()])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>çœ‹è¿™ç§å®šä¹‰çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°<code>concat</code>:</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">let</span> <span class="keyword">bag </span>= DisposeBag()</span><br><span class="line">    </span><br><span class="line"><span class="symbol">let</span> <span class="keyword">subjectA </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword">let </span><span class="keyword">subjectB </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword">let </span><span class="keyword">subjectC </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line">_ = <span class="keyword">subjectA.concat(subjectB.concat(subjectC)).subscribe(onNext: </span>&#123;</span><br><span class="line">    print(<span class="number">$0</span>)</span><br><span class="line">&#125;).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="keyword">subjectA.onNext("A1")</span></span><br><span class="line"><span class="keyword">subjectA.onCompleted()</span></span><br><span class="line"><span class="keyword">subjectB.onNext("B1")</span></span><br><span class="line"><span class="keyword">subjectB.onCompleted()</span></span><br><span class="line"><span class="keyword">subjectC.onNext("C1")</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">//ç»ˆç«¯çš„è¾“å‡º</span></span><br><span class="line"><span class="keyword">A1</span></span><br><span class="line"><span class="keyword">B1</span></span><br><span class="line"><span class="keyword">C1</span></span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œä½ å¯ä»¥å°†<code>subjectA.onCompleted()</code>æ³¨é‡Šæ‰ï¼Œä½ ä¼šå‘ç°ç»ˆç«¯çš„è¾“å‡ºåªæœ‰<code>A1</code>,è¿™ä¹Ÿå°±è§£é‡Šäº†<code>ä¸²è¡Œé˜Ÿåˆ—</code>ï¼Œåªæœ‰åœ¨<code>subjectA</code>å®Œæˆçš„æ—¶å€™ï¼Œä»–æ‰ä¼šè®¢é˜…ä¸‹ä¸€ä¸ªæ—¶é—´ã€‚</li><li>ç³»ç»Ÿè¿˜ç»™<code>Observable</code>å†™äº†ä¸ª<code>extension</code>ï¼Œè¿™æ ·åœ¨æ­£åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œæ›´åŠ æ–¹ä¾¿ã€ç›´è§‚ã€‚çœ‹æºç ï¼š</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">extension Observable &#123;</span><br><span class="line">    /**</span><br><span class="line">     Concatenates <span class="keyword">all</span> observable sequences in the given sequence, <span class="keyword">as</span> long <span class="keyword">as</span> the <span class="keyword">previous</span> observable sequence terminated successfully.</span><br><span class="line"></span><br><span class="line">     This operator <span class="built_in">has</span> tail recursive optimizations that will prevent stack overflow.</span><br><span class="line"></span><br><span class="line">     Optimizations will <span class="keyword">be</span> performed in cases equivalent <span class="keyword">to</span> followin<span class="variable">g:</span></span><br><span class="line"></span><br><span class="line">     [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, .....].concat()].concat].concat()</span><br><span class="line"></span><br><span class="line">     - seealso: [concat operator <span class="keyword">on</span> reactivex.io](http://reactivex.io/documentation/operators/concat.html)</span><br><span class="line"></span><br><span class="line">     - <span class="keyword">return</span><span class="variable">s:</span> An observable sequence that contains the elements of each given sequence, in sequential order.</span><br><span class="line">     */</span><br><span class="line">    public static func concat&lt;S: Sequence &gt;(_ sequence: S) -&gt; Observable<span class="symbol">&lt;Element&gt;</span></span><br><span class="line">        where S.Iterator.Element == Observable<span class="symbol">&lt;Element&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Concat(<span class="keyword">source</span><span class="variable">s:</span> sequence, coun<span class="variable">t:</span> nil)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     Concatenates <span class="keyword">all</span> observable sequences in the given collection, <span class="keyword">as</span> long <span class="keyword">as</span> the <span class="keyword">previous</span> observable sequence terminated successfully.</span><br><span class="line"></span><br><span class="line">     This operator <span class="built_in">has</span> tail recursive optimizations that will prevent stack overflow.</span><br><span class="line"></span><br><span class="line">     Optimizations will <span class="keyword">be</span> performed in cases equivalent <span class="keyword">to</span> followin<span class="variable">g:</span></span><br><span class="line"></span><br><span class="line">     [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, .....].concat()].concat].concat()</span><br><span class="line"></span><br><span class="line">     - seealso: [concat operator <span class="keyword">on</span> reactivex.io](http://reactivex.io/documentation/operators/concat.html)</span><br><span class="line"></span><br><span class="line">     - <span class="keyword">return</span><span class="variable">s:</span> An observable sequence that contains the elements of each given sequence, in sequential order.</span><br><span class="line">     */</span><br><span class="line">    public static func concat&lt;S: Collection &gt;(_ collection: S) -&gt; Observable<span class="symbol">&lt;Element&gt;</span></span><br><span class="line">        where S.Iterator.Element == Observable<span class="symbol">&lt;Element&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Concat(<span class="keyword">source</span><span class="variable">s:</span> collection, coun<span class="variable">t:</span> collection.<span class="built_in">count</span>.toIntMax())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     Concatenates <span class="keyword">all</span> observable sequences in the given collection, <span class="keyword">as</span> long <span class="keyword">as</span> the <span class="keyword">previous</span> observable sequence terminated successfully.</span><br><span class="line"></span><br><span class="line">     This operator <span class="built_in">has</span> tail recursive optimizations that will prevent stack overflow.</span><br><span class="line"></span><br><span class="line">     Optimizations will <span class="keyword">be</span> performed in cases equivalent <span class="keyword">to</span> followin<span class="variable">g:</span></span><br><span class="line"></span><br><span class="line">     [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, .....].concat()].concat].concat()</span><br><span class="line"></span><br><span class="line">     - seealso: [concat operator <span class="keyword">on</span> reactivex.io](http://reactivex.io/documentation/operators/concat.html)</span><br><span class="line"></span><br><span class="line">     - <span class="keyword">return</span><span class="variable">s:</span> An observable sequence that contains the elements of each given sequence, in sequential order.</span><br><span class="line">     */</span><br><span class="line">    public static func concat(_ <span class="keyword">source</span><span class="variable">s:</span> Observable<span class="symbol">&lt;Element&gt;</span> ...) -&gt; Observable<span class="symbol">&lt;Element&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Concat(<span class="keyword">source</span><span class="variable">s:</span> sources, coun<span class="variable">t:</span> sources.<span class="built_in">count</span>.toIntMax())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œå¯ä»¥æ¥å—è‡ªå®šä¹‰çš„ã€ç³»ç»Ÿçš„é›†åˆç±»å‹ï¼Œä»¥åŠä¸€ä¸ªå¯å˜çš„ç±»å‹ï¼Œéƒ½æ˜¯å¯ä»¥è¿™æ ·ä½¿ç”¨çš„ã€‚ä¸Šé¢çš„ä»£ç å°±å¯ä»¥æŒ‰ç…§Demoæ‰€å†™çš„é‚£æ ·å®Œæˆ:</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Observable.concat</span>([<span class="keyword">subjectA, </span><span class="keyword">subjectB, </span><span class="keyword">subjectC])</span></span><br><span class="line"><span class="keyword"> </span>       .<span class="keyword">subscribe(onNext: </span>&#123;</span><br><span class="line">            print(<span class="number">$0</span>)</span><br><span class="line">        &#125;).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>       </span><br><span class="line"><span class="symbol">Observable.concat</span>(<span class="keyword">subjectA, </span><span class="keyword">subjectB, </span><span class="keyword">subjectC)</span></span><br><span class="line"><span class="keyword"> </span>   .<span class="keyword">subscribe(onNext: </span>&#123;print(<span class="number">$0</span>)&#125;)</span><br><span class="line">    .<span class="keyword">addDisposableTo(bag)</span></span><br></pre></td></tr></table></figure><hr><ul><li>å¦‚æœæ˜¯å¹¶è¡Œæ“ä½œæ—¶é—´çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨<code>.merge()</code>çš„æ“ä½œç¬¦:</li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.merge</span>(subjectA, subjectB, subjectC)</span><br><span class="line">    <span class="selector-class">.subscribe</span>(<span class="attribute">onNext</span>: &#123;<span class="selector-tag">print</span>($<span class="number">0</span>)&#125;)</span><br><span class="line">    <span class="selector-class">.addDisposableTo</span>(bag)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="selector-tag">subjectA</span><span class="selector-class">.onNext</span>(<span class="string">"A1"</span>)</span><br><span class="line"><span class="comment">//subjectA.onCompleted()</span></span><br><span class="line"><span class="selector-tag">subjectB</span><span class="selector-class">.onNext</span>(<span class="string">"B1"</span>)</span><br><span class="line"><span class="comment">//subjectB.onCompleted()</span></span><br><span class="line"><span class="selector-tag">subjectC</span><span class="selector-class">.onNext</span>(<span class="string">"C1"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="selector-tag">A1</span></span><br><span class="line"><span class="selector-tag">B1</span></span><br><span class="line"><span class="selector-tag">C1</span></span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·å¯ä»¥çœ‹å‡ºæ¥ï¼ŒåŠæ—¶åœ¨ä¹‹å‰çš„æ—¶é—´ä¸å®Œæˆçš„æƒ…å†µä¸‹ï¼Œäº‹ä»¶çš„æ‰“å°ä¾æ—§ã€‚</li></ul><hr><ul><li>ä¸ºäº†æ–¹ä¾¿æ§åˆ¶å¹¶è¡Œçš„ä¸ªæ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·ä½¿ç”¨</li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.of</span>(subjectA, subjectB, subjectC)</span><br><span class="line">       <span class="selector-class">.merge</span>(<span class="attribute">maxConcurrent</span>: <span class="number">2</span>)</span><br><span class="line">       <span class="selector-class">.subscribe</span>(<span class="attribute">onNext</span>: &#123;<span class="selector-tag">print</span>($<span class="number">0</span>)&#125;)</span><br><span class="line">       <span class="selector-class">.addDisposableTo</span>(bag)</span><br></pre></td></tr></table></figure><hr><ul><li>åˆå¹¶å¤šä¸ªäº‹ä»¶çš„æ“ä½œç¬¦æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>combineLatest</code>,Demoï¼š</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">let</span> <span class="keyword">subjectA </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword">let </span><span class="keyword">subjectB </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="symbol">Observable.combineLatest</span>(<span class="keyword">subjectA, </span><span class="keyword">subjectB) </span>&#123;</span><br><span class="line">    a, <span class="keyword">b </span>in</span><br><span class="line">    </span><br><span class="line">    a + <span class="string">","</span> + <span class="keyword">b</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line">&#125;.<span class="keyword">subscribe(onNext: </span>&#123;</span><br><span class="line">    dump(<span class="number">$0</span>)</span><br><span class="line">&#125;).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="keyword">subjectA.onNext("A1")</span></span><br><span class="line"><span class="keyword">subjectB.onNext("B1")</span></span><br><span class="line"><span class="keyword">subjectA.onNext("A2")</span></span><br><span class="line"><span class="keyword">subjectB.onNext("B2")</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="keyword">- </span><span class="string">"A1,B1"</span></span><br><span class="line">- <span class="string">"A2,B1"</span></span><br><span class="line">- <span class="string">"A2,B2"</span></span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ˜¯ä¸ªæ—¶é—´çš„åˆå¹¶ã€‚ç±»ä¼¼ä¸‹é¢ï¼š</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">let</span> <span class="keyword">subjectA </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword">let </span><span class="keyword">subjectB </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword">let </span><span class="keyword">subjectC </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="symbol">Observable.combineLatest</span>([<span class="keyword">subjectA, </span><span class="keyword">subjectB, </span><span class="keyword">subjectC]) </span>&#123;</span><br><span class="line">    events in</span><br><span class="line">    </span><br><span class="line">    events.joined(separator: <span class="string">"--"</span>)</span><br><span class="line">    </span><br><span class="line">&#125;.<span class="keyword">subscribe(onNext: </span>&#123;</span><br><span class="line">    dump(<span class="number">$0</span>)</span><br><span class="line">&#125;).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="keyword">subjectA.onNext("A1")</span></span><br><span class="line"><span class="keyword">subjectB.onNext("B1")</span></span><br><span class="line"><span class="keyword">subjectA.onNext("A2")</span></span><br><span class="line"><span class="keyword">subjectB.onNext("B2")</span></span><br><span class="line"><span class="keyword">subjectC.onNext("C1")</span></span><br><span class="line"><span class="keyword">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="keyword">- </span><span class="string">"A2--B2--C1"</span></span><br></pre></td></tr></table></figure><ul><li><code>combineLatest</code>åˆå¹¶çš„æ—¶é—´ä¸­ï¼Œå¿…é¡»è‡³å°‘éƒ½å‘ç”Ÿäº†ä¸€æ¬¡äº‹ä»¶å‘é€ã€‚</li><li>ä»»ä¸€ä¸€ä¸ªæ—¶é—´å‘ç”Ÿæ›´æ–°çš„æ—¶å€™ï¼Œéƒ½ä¼šå‘ç”Ÿå›è°ƒã€‚</li><li>æ¯æ¬¡è·å–çš„å€¼ï¼Œéƒ½æ˜¯å½“å‰äº‹ä»¶çš„æœ€æ–°çš„å€¼ã€‚</li><li><code>combineLatest</code>æ¥å—çš„åˆå¹¶äº‹ä»¶ä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„å€¼ç±»å‹ ä¾‹å¦‚ä¸‹é¢ï¼š</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">let</span> <span class="keyword">bag </span>= DisposeBag()</span><br><span class="line">    </span><br><span class="line"><span class="symbol">let</span> <span class="keyword">subjectA </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword">let </span><span class="keyword">subjectB </span>= PublishSubject&lt;Int&gt;()</span><br><span class="line">    </span><br><span class="line"><span class="symbol">Observable.combineLatest</span>(<span class="keyword">subjectA, </span><span class="keyword">subjectB) </span>&#123;</span><br><span class="line">    a, <span class="keyword">b </span>in</span><br><span class="line">    </span><br><span class="line">    a + <span class="string">","</span> + <span class="string">"\(b)"</span></span><br><span class="line">    </span><br><span class="line">&#125;.<span class="keyword">subscribe(onNext: </span>&#123;</span><br><span class="line">    dump(<span class="number">$0</span>)</span><br><span class="line">&#125;).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="keyword">subjectA.onNext("A1")</span></span><br><span class="line"><span class="keyword">subjectB.onNext(11)</span></span><br><span class="line"><span class="keyword">subjectA.onNext("A2")</span></span><br><span class="line"><span class="keyword">subjectB.onNext(22)</span></span><br><span class="line"><span class="keyword">/ã€ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="keyword">- </span><span class="string">"A1,11"</span></span><br><span class="line">- <span class="string">"A2,11"</span></span><br><span class="line">- <span class="string">"A2,22"</span></span><br></pre></td></tr></table></figure><hr><ul><li>æ¯æ¬¡åªä¼šåˆå¹¶å¤šä¸ªæœ€æ–°çš„æ—¶é—´è¯ï¼Œè¿™é‡Œæˆ‘å¯ä»¥ä½¿ç”¨<code>.zip()</code>çš„æ“ä½œç¬¦:</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">let</span> <span class="keyword">bag </span>= DisposeBag()</span><br><span class="line">    </span><br><span class="line"><span class="symbol">let</span> <span class="keyword">subjectA </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword">let </span><span class="keyword">subjectB </span>= PublishSubject&lt;Int&gt;()</span><br><span class="line">//let <span class="keyword">subjectC </span>= PublishSubject&lt;<span class="keyword">String&gt;()</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="symbol">Observable.zip</span>(<span class="keyword">subjectA, </span><span class="keyword">subjectB) </span>&#123;</span><br><span class="line">    a, <span class="keyword">b </span>in</span><br><span class="line">    </span><br><span class="line">    a + <span class="string">","</span> + <span class="string">"\(b)"</span></span><br><span class="line">    </span><br><span class="line">&#125;.<span class="keyword">subscribe(onNext: </span>&#123;</span><br><span class="line">    dump(<span class="number">$0</span>)</span><br><span class="line">&#125;).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="keyword">subjectA.onNext("A1")</span></span><br><span class="line"><span class="keyword">subjectB.onNext(11)</span></span><br><span class="line"><span class="keyword">subjectA.onNext("A2")</span></span><br><span class="line"><span class="keyword">subjectB.onNext(22)</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">//ç»ˆç«¯çš„è¾“å‡º</span></span><br><span class="line"><span class="keyword">- </span><span class="string">"A1,11"</span></span><br><span class="line">- <span class="string">"A2,22"</span></span><br></pre></td></tr></table></figure><ul><li>å¦‚æœå­˜åœ¨å¤šä¸ª<code>observable</code>,å¹¶ä¸”å­˜åœ¨ä¸€å®šçš„ä¾èµ–å…³ç³»ï¼Œåœ¨æŸä»¶äº‹æƒ…å‘é€çš„æ—¶å€™ï¼Œä¼šå»è·å–å¦ä¸€æ—¶é—´çš„æœ€æ–°å€¼:</li></ul><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">bag</span> = DisposeBag()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> <span class="attr">triggerSubject</span> = PublishSubject&lt;Void&gt;()</span><br><span class="line"><span class="keyword">let</span> <span class="attr">contentSubject</span> = BehaviorSubject&lt;String&gt;(value: <span class="string">"Default value"</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="attr">_</span> = triggerSubject.withLatestFrom(contentSubject)</span><br><span class="line">.subscribe(onNext: &#123;</span><br><span class="line">    print($<span class="number">0</span>)</span><br><span class="line">&#125;).addDisposableTo(bag)</span><br><span class="line">    </span><br><span class="line">triggerSubject.onNext(())</span><br><span class="line">contentSubject.onNext(<span class="string">"Input Extra Content"</span>)</span><br><span class="line">triggerSubject.onNext(())</span><br><span class="line"></span><br><span class="line">//ç»ˆç«¯è¾“å‡º</span><br><span class="line">Default value</span><br><span class="line">Input Extra Content</span><br></pre></td></tr></table></figure><ul><li>åœ¨ä¸åŒçš„<code>observable</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„åˆ‡æ¢ä»»æ„çš„æ—¶é—´ï¼Œä½¿ç”¨æ“ä½œç¬¦<code>.switchLatest()</code>,è¿™æ ·åªèƒ½åœ¨æŒ‡å®šçš„æ¨¡å¼ä¸‹ï¼ŒåšæŒ‡å®šçš„äº‹ä»¶ï¼š</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">let bag = DisposeBag()</span><br><span class="line">    </span><br><span class="line">let reading = PublishSubject<span class="variable">&lt;String&gt;</span>()</span><br><span class="line">let writing = PublishSubject<span class="variable">&lt;String&gt;</span>()</span><br><span class="line">    </span><br><span class="line">let work = PublishSubject<span class="variable">&lt;Observable&lt;String&gt;</span>&gt;()</span><br><span class="line"></span><br><span class="line">work.switchLatest()</span><br><span class="line">    .subscribe(<span class="keyword">on</span>Next: &#123;</span><br><span class="line">        print(<span class="variable">$0</span>)</span><br><span class="line">    &#125;).addDisposableTo(bag)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">work.<span class="keyword">on</span>Next(reading)</span><br><span class="line">reading.<span class="keyword">on</span>Next(<span class="string">"Read 1"</span>)</span><br><span class="line">    </span><br><span class="line">work.<span class="keyword">on</span>Next(writing)</span><br><span class="line">writing.<span class="keyword">on</span>Next(<span class="string">"Write 1"</span>)</span><br><span class="line">    </span><br><span class="line">reading.<span class="keyword">on</span>Next(<span class="string">"Read Extra"</span>)</span><br><span class="line">    </span><br><span class="line">work.<span class="keyword">on</span>Next(reading)</span><br><span class="line">reading.<span class="keyword">on</span>Next(<span class="string">"Read 2"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œå·²ç»ä»‹ç»äº†ä¸€äº›ï¼Œè¿‡æ»¤ã€ç­›é€‰ä¿¡å·é‡çš„æ“ä½œç¬¦ï¼Œç°åœ¨åˆ—ä¸¾ä¸€äº›å¤æ‚æ“ä½œç¬¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆè¦è¯´çš„ä¸€ä¸ªæ“ä½œç¬¦å«åš&lt;code&gt;Scan&lt;/code&gt;ï¼Œçœ‹åˆ°åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œ&lt;code&gt;Scan&lt;/code&gt;æ˜¯å±äºåœ¨&lt;code&gt;Transforming&lt;/code&gt;ï¼Œä¹Ÿå°±å¯ä»¥çŒœåˆ°ï¼Œè¿™ä¸ªæ“ä½œç¬¦ï¼Œå…¶å®ä¹Ÿæ˜¯ä¿¡å·è½¬æ¢çš„éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swift" scheme="http://www.ghcoder.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºRxSwiftä¿¡æ¯é‡çš„ä¸€äº›é—®é¢˜</title>
    <link href="http://www.ghcoder.com/2017/10/08/20171007/"/>
    <id>http://www.ghcoder.com/2017/10/08/20171007/</id>
    <published>2017-10-08T08:12:12.000Z</published>
    <updated>2017-10-08T10:59:24.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li>ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œä»‹ç»äº†RxSwiftä¸­ï¼Œå°†ä¹‹å‰ä¼ ç»Ÿçš„æ¨¡å¼ä¿®æ”¹ä¸ºæ›´<code>Rx</code>çš„æ¨¡å¼ï¼Œåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå…¶å®<code>RxSwift</code>åªæ˜¯å°†ä¹‹å‰åˆ†æ•£å¤„ç†çš„æ­å–œï¼Œæ”¶æ‹¢èµ·æ¥ï¼Œä¹‹å‰æˆ‘ä»¬æˆ–è®¸å…³å¿ƒçš„æ˜¯<code>blockçš„å›è°ƒ</code>ã€<code>ä»£ç†æ–¹æ³•</code>ã€<code>function()è°ƒç”¨</code>ï¼Œè€Œç°åœ¨æˆ‘ä»¬æˆ–è®¸åªéœ€è¦å…³å¿ƒä¸€ä»¶äº‹æƒ…<code>ä¿¡å·é‡</code>ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œä¼´éšç€é¡¹ç›®çš„åºå¤§ã€åŠŸèƒ½çš„å¤æ‚ï¼Œæ•´ä¸ªé¡¹ç›®ä¸­å……æ–¥ç€çš„éƒ½æ˜¯è¿™äº›ä¿¡å·ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±è¦å­¦ä¼šåˆ†æã€è¿‡æ»¤ã€è½¬åŒ–ä¿¡å·ã€‚</li></ul><a id="more"></a><ul><li>å…ˆä¸å»æ·±ç©¶ä¸‹é¢åˆ—ä¸¾çš„æ¯ä¸ªæ“ä½œç¬¦çš„æºä»£ç ï¼Œåœ¨ç¢°åˆ°ä¸€äº›ç‰¹åˆ«éš¾ä»¥ç†è§£çš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å†å»æŸ¥çœ‹ä¸€ä¸‹æºä»£ç </li></ul><hr><ul><li>å¿½ç•¥ä¿¡å·çš„æ“ä½œï¼š</li><li>1.å…ˆæ¥çœ‹ä¸€ä¸‹æœ€æœ€æ™®é€šçš„è®¢é˜…æ¨¡å¼ï¼š</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">let</span> <span class="keyword">subject </span>= PublishSubject&lt;Int&gt;()</span><br><span class="line"><span class="symbol">let</span> <span class="keyword">bag </span>= DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = <span class="keyword">subject.subscribe(</span></span><br><span class="line"><span class="keyword"> </span>   onNext: &#123; print(<span class="number">$0</span>) &#125;,</span><br><span class="line"><span class="symbol">    onCompleted:</span> &#123; print(<span class="string">"Completed"</span>) &#125;</span><br><span class="line">).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="keyword">subject.onNext(1)</span></span><br><span class="line"><span class="keyword">subject.onNext(2)</span></span><br><span class="line"><span class="keyword">subject.onNext(3)</span></span><br><span class="line"><span class="keyword">subject.onNext(4)</span></span><br><span class="line"><span class="keyword">subject.onCompleted()</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">// </span>ç»ˆç«¯è¾“å…¥</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="symbol">Completed</span></span><br></pre></td></tr></table></figure><ul><li><ol start="2"><li>å¦‚æœæˆ‘ä»¬éœ€è¦å¿½ç•¥æ‰€æœ‰çš„<code>.onNext()</code>çš„æ—¶é—´è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>.ignoreElements()</code>æ“ä½œç¬¦</li></ol></li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">let</span> <span class="keyword">subject </span>= PublishSubject&lt;Int&gt;()</span><br><span class="line"><span class="symbol">let</span> <span class="keyword">bag </span>= DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = <span class="keyword">subject</span></span><br><span class="line"><span class="keyword"> </span>   .ignoreElements()</span><br><span class="line">    .<span class="keyword">subscribe(</span></span><br><span class="line"><span class="keyword"> </span>       onNext: &#123; print(<span class="number">$0</span>) &#125;,</span><br><span class="line"><span class="symbol">        onCompleted:</span> &#123; print(<span class="string">"Completed"</span>) &#125;</span><br><span class="line">    ).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="keyword">subject.onNext(1)</span></span><br><span class="line"><span class="keyword">subject.onNext(2)</span></span><br><span class="line"><span class="keyword">subject.onNext(3)</span></span><br><span class="line"><span class="keyword">subject.onNext(4)</span></span><br><span class="line"><span class="keyword">subject.onCompleted()</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="keyword">Completed</span></span><br></pre></td></tr></table></figure><ul><li><ol start="3"><li>å¦‚æœå¿½ç•¥å‰å‡ ä¸ª<code>.onNext()</code>äº‹ä»¶ä¿¡å·é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>.skip()</code>æ“ä½œç¬¦,ä¾‹å¦‚<code>.skip(2)</code>å¦‚æœä¸è¶³2ä¸ªçš„è¯ï¼Œé‚£å°±éƒ½è·³è¿‡,ç›´æ¥<code>.onCompleted()</code>æˆ–è€…<code>.onError()</code>:</li></ol></li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">_ = <span class="keyword">subject</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">.skip</span>(<span class="number">2</span>)</span><br><span class="line">    .<span class="keyword">subscribe(</span></span><br><span class="line"><span class="keyword"> </span>       onNext: &#123; print(<span class="number">$0</span>) &#125;,</span><br><span class="line"><span class="symbol">        onCompleted:</span> &#123; print(<span class="string">"Completed"</span>) &#125;</span><br><span class="line">    ).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="keyword">subject.onNext(1)</span></span><br><span class="line"><span class="keyword">subject.onNext(2)</span></span><br><span class="line"><span class="keyword">subject.onNext(3)</span></span><br><span class="line"><span class="keyword">subject.onNext(4)</span></span><br><span class="line"><span class="keyword">subject.onCompleted()</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="keyword">3</span></span><br><span class="line"><span class="keyword">4</span></span><br><span class="line"><span class="keyword">Completed</span></span><br></pre></td></tr></table></figure><ul><li>æŒ‡å®šæ¡ä»¶è¿‡æ»¤æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨<code>.skipWhile()</code>ï¼Œè¿™é‡Œ<code>.skipWhile()</code>æ¥å—çš„æ˜¯ä¸€ä¸ª<code>block</code>ï¼Œç†è§£èµ·æ¥å¯èƒ½ä¼šæ¯”è¾ƒç»•ï¼Œä½†æ˜¯çœ‹ä¸€ä¸‹githubä¸Šçš„è§£é‡Šï¼š</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> Bypasses elements in </span>an<span class="markdown"> observable sequence as long as </span>a<span class="markdown"> specified condition is true and then returns </span>the<span class="markdown"> remaining elements.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> - seealso: [<span class="string">skipWhile operator on reactivex.io</span>](<span class="link">http://reactivex.io/documentation/operators/skipwhile.html</span>)</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> - parameter predicate: A function to test each element for </span>a<span class="markdown"> condition.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> - returns: An observable sequence that contains </span>the<span class="markdown"> elements from </span>the<span class="markdown"> input sequence starting at </span>the<span class="markdown"> first element in </span>the<span class="markdown"> linear series that does not pass </span>the<span class="markdown"> test specified by predicate.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> */</span></span></span><br><span class="line">public func skipWhile(_ predicate: <span class="meta">@escaping</span> (E) throws -&gt; Bool) -&gt; Observable&lt;E&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> SkipWhile(source: asObservable(), predicate: predicate)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åªè¦æ¡ä»¶ä¸º<code>true</code>ï¼Œæˆ‘ä»¬å°±ä¼šç»•è¿‡å‘å‡ºçš„ä¿¡å·ï¼Œçœ‹ä¸€ä¸‹Demoï¼š</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = PublishSubject&lt;Int&gt;()</span><br><span class="line"><span class="keyword">let</span> bag = DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = subject</span><br><span class="line">    .skipWhile<span class="function"><span class="params">(&#123; (item) -&gt; Bool <span class="keyword">in</span></span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">return</span> item != <span class="number">3</span></span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;)</span></span></span><br><span class="line"><span class="function">    .<span class="title">subscribe</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">        onCompleted: &#123; <span class="built_in">print</span>(<span class="string">"Completed"</span>) &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span>.<span class="title">addDisposableTo</span><span class="params">(bag)</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">2</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">3</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">4</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onCompleted</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="function">3</span></span><br><span class="line"><span class="function">4</span></span><br><span class="line"><span class="function"><span class="title">Completed</span></span></span><br></pre></td></tr></table></figure><ul><li>ä¾èµ–æŸä¸ªä¿¡å·é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨<code>.skipUntil()</code>,è¿™é‡Œçš„å…¥å‚æ˜¯ä¾‹å¤–ä¸€ä¸ªä¿¡å·é‡ï¼š</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">let subject = PublishSubject<span class="variable">&lt;Int&gt;</span>()</span><br><span class="line">let dependOnSubject = PublishSubject<span class="variable">&lt;Void&gt;</span>()</span><br><span class="line">let bag = DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = subject</span><br><span class="line">    .<span class="keyword">skip</span>Until(dependOnSubject)</span><br><span class="line">    .subscribe(</span><br><span class="line">        <span class="keyword">on</span>Next: &#123; print(<span class="variable">$0</span>) &#125;,</span><br><span class="line">        <span class="keyword">on</span>Completed: &#123; print(<span class="string">"Completed"</span>) &#125;</span><br><span class="line">    ).addDisposableTo(bag)</span><br><span class="line">    </span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">1</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">2</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">3</span>)</span><br><span class="line">dependOnSubject.<span class="keyword">on</span>Next(())</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">4</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Completed()</span><br><span class="line"></span><br><span class="line">//ç»ˆç«¯è¾“å‡º</span><br><span class="line"><span class="number">4</span></span><br><span class="line">Completed</span><br></pre></td></tr></table></figure><ul><li>å¿½ç•¥é‡å¤å‡ºç°çš„ç›¸é‚»çš„ä¿¡å·é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>.distinctUntilChanged()</code>, demo:</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">let</span> <span class="keyword">subject </span>= PublishSubject&lt;Int&gt;()</span><br><span class="line"><span class="symbol">let</span> <span class="keyword">bag </span>= DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = <span class="keyword">subject</span></span><br><span class="line"><span class="keyword"> </span>   .distinctUntilChanged()</span><br><span class="line">    .<span class="keyword">subscribe(</span></span><br><span class="line"><span class="keyword"> </span>       onNext: &#123; print(<span class="number">$0</span>) &#125;,</span><br><span class="line"><span class="symbol">        onCompleted:</span> &#123; print(<span class="string">"Completed"</span>) &#125;</span><br><span class="line">    ).<span class="keyword">addDisposableTo(bag)</span></span><br><span class="line"><span class="keyword"> </span>   </span><br><span class="line"><span class="keyword">subject.onNext(1)</span></span><br><span class="line"><span class="keyword">subject.onNext(2)</span></span><br><span class="line"><span class="keyword">subject.onNext(2)</span></span><br><span class="line"><span class="keyword">subject.onNext(3)</span></span><br><span class="line"><span class="keyword">subject.onNext(3)</span></span><br><span class="line"><span class="keyword">subject.onNext(3)</span></span><br><span class="line"><span class="keyword">subject.onNext(4)</span></span><br><span class="line"><span class="keyword">subject.onNext(2)</span></span><br><span class="line"><span class="keyword">subject.onNext(3)</span></span><br><span class="line"><span class="keyword">subject.onCompleted()</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="keyword">1</span></span><br><span class="line"><span class="keyword">2</span></span><br><span class="line"><span class="keyword">3</span></span><br><span class="line"><span class="keyword">4</span></span><br><span class="line"><span class="keyword">2</span></span><br><span class="line"><span class="keyword">3</span></span><br><span class="line"><span class="keyword">Completed</span></span><br></pre></td></tr></table></figure><hr><ul><li>é€‰æ‹©ä¿¡å·çš„æ“ä½œ</li><li>é€‰æ‹©æŒ‡å®šç¬¬å‡ ä¸ªä¿¡å·é‡çš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨<code>.elementAt()</code>,å½“é€‰æ‹©çš„ä¸ªæ•°è¶…è¿‡äº†å­˜åœ¨çš„ä¿¡å·é‡ï¼Œæ­¤æ—¶å°±ä¼šæŠ¥<code>.onError()</code>çš„é”™è¯¯ï¼ŒDemoï¼š</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">let subject = PublishSubject<span class="variable">&lt;Int&gt;</span>()</span><br><span class="line">let bag = DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = subject</span><br><span class="line">    .elementAt(<span class="number">2</span>)</span><br><span class="line">    .subscribe(</span><br><span class="line">        <span class="keyword">on</span>Next: &#123; print(<span class="variable">$0</span>) &#125;,</span><br><span class="line">        <span class="keyword">on</span>Error: &#123;_ <span class="keyword">in</span> print(<span class="string">"Error"</span>) &#125;,</span><br><span class="line">        <span class="keyword">on</span>Completed: &#123; print(<span class="string">"Completed"</span>) &#125;</span><br><span class="line">    ).addDisposableTo(bag)</span><br><span class="line">    </span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">1</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">2</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">3</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">4</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Completed()</span><br><span class="line">//ç»ˆç«¯çš„è¾“å‡º</span><br><span class="line"><span class="number">3</span></span><br><span class="line">Completed</span><br></pre></td></tr></table></figure><ul><li>æ ¹æ®æŸäº›æ¡ä»¶ï¼Œç­›é€‰è¿‡æ»¤å‡ºè‡ªå·±æƒ³è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨<code>.filter()</code>çš„æ“ä½œç¬¦ï¼š</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = PublishSubject&lt;Int&gt;()</span><br><span class="line"><span class="keyword">let</span> bag = DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = subject</span><br><span class="line">    .filter<span class="function"><span class="params">(&#123; (item) -&gt; Bool <span class="keyword">in</span></span></span></span><br><span class="line"><span class="function"><span class="params">        item == <span class="number">2</span></span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;)</span></span></span><br><span class="line"><span class="function">    .<span class="title">subscribe</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">        onError: &#123;_ <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">"Error"</span>) &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">        onCompleted: &#123; <span class="built_in">print</span>(<span class="string">"Completed"</span>) &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span>.<span class="title">addDisposableTo</span><span class="params">(bag)</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">2</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">3</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">4</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onCompleted</span><span class="params">()</span></span></span><br><span class="line"><span class="function">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="function">2</span></span><br><span class="line"><span class="function"><span class="title">Completed</span></span></span><br></pre></td></tr></table></figure><ul><li>è·å–æŒ‡å®šæ•°é‡çš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰ç”¨<code>.take()</code>,å½“å…¥å‚çš„æ•°å­—å¤§äºå·²æœ‰çš„æ•°æ®ï¼Œå°±ä¼šæŠŠæ‰€æœ‰çš„<code>.onNext()</code>äº‹ä»¶éƒ½æ‰“å°å‡ºæ¥:</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let subject = PublishSubject<span class="variable">&lt;Int&gt;</span>()</span><br><span class="line">let bag = DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = subject</span><br><span class="line">    .take(<span class="number">2</span>)</span><br><span class="line">    .subscribe(</span><br><span class="line">        <span class="keyword">on</span>Next: &#123; print(<span class="variable">$0</span>) &#125;,</span><br><span class="line">        <span class="keyword">on</span>Error: &#123;_ <span class="keyword">in</span> print(<span class="string">"Error"</span>) &#125;,</span><br><span class="line">        <span class="keyword">on</span>Completed: &#123; print(<span class="string">"Completed"</span>) &#125;</span><br><span class="line">    ).addDisposableTo(bag)</span><br><span class="line">    </span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">1</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">2</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">3</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">4</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Completed()</span><br><span class="line">//ç»ˆç«¯è¾“å‡º</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">Completed</span><br></pre></td></tr></table></figure><ul><li>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒç»•çš„æ“ä½œç¬¦ï¼Œå«åš<code>takeWhile()</code>,å’Œ<code>skipWhile()</code>ç±»ä¼¼ï¼Œåªè¦<code>block</code>ä¸­è¿”å›çš„æ˜¯<code>true</code>çš„è¯ï¼Œå°±ä¼šé€‰å–è¿™å„¿å…ƒç´ ï¼Œä¸€æ—¦falseå°±ç»“æŸ</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = PublishSubject&lt;Int&gt;()</span><br><span class="line"><span class="keyword">let</span> bag = DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = subject</span><br><span class="line">    .takeWhile<span class="function"><span class="params">(&#123; (item) -&gt; Bool <span class="keyword">in</span></span></span></span><br><span class="line"><span class="function"><span class="params">        item != <span class="number">2</span></span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;)</span></span></span><br><span class="line"><span class="function">    .<span class="title">subscribe</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">        onError: &#123;_ <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">"Error"</span>) &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">        onCompleted: &#123; <span class="built_in">print</span>(<span class="string">"Completed"</span>) &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span>.<span class="title">addDisposableTo</span><span class="params">(bag)</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">2</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">3</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">4</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onCompleted</span><span class="params">()</span></span></span><br><span class="line"><span class="function">//ç»ˆç«¯è¾“å…¥</span></span><br><span class="line"><span class="function">1</span></span><br><span class="line"><span class="function"><span class="title">Completed</span></span></span><br></pre></td></tr></table></figure><ul><li>å‡†å¤‡å®šä½åˆ°ç¬¬å‡ ä¸ªçš„è¯ï¼Œå¯ä»¥é€‰ç”¨ä¸‹é¢çš„æ“ä½œç¬¦<code>takeWhileWithIndex</code>, å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªindex,ä¸€ä¸ªvalue,åŒæ ·ä¸ºtrueï¼Œå°±ä¼šé€‰å–ï¼Œä¸ºfalseï¼Œå°±ç«‹åˆ»ç»“æŸ</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = PublishSubject&lt;Int&gt;()</span><br><span class="line"><span class="keyword">let</span> bag = DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = subject</span><br><span class="line">    .takeWhileWithIndex<span class="function"><span class="params">(&#123; (item, index) -&gt; Bool <span class="keyword">in</span></span></span></span><br><span class="line"><span class="function"><span class="params">        item != <span class="number">2</span> &amp;&amp; index != <span class="number">3</span></span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;)</span></span></span><br><span class="line"><span class="function">    .<span class="title">subscribe</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        onNext: &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">        onError: &#123;_ <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">"Error"</span>) &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">        onCompleted: &#123; <span class="built_in">print</span>(<span class="string">"Completed"</span>) &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span>.<span class="title">addDisposableTo</span><span class="params">(bag)</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">2</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">3</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onNext</span><span class="params">(<span class="number">4</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">subject</span>.<span class="title">onCompleted</span><span class="params">()</span></span></span><br><span class="line"><span class="function">//ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="function">1</span></span><br><span class="line"><span class="function"><span class="title">Completed</span></span></span><br></pre></td></tr></table></figure><ul><li>ä¾èµ–äºæŸä¸ªä¿¡å·ï¼Œæ¥è·å–ä¿¡å·é‡ï¼Œå¯ä»¥é€‰ç”¨<code>.takeUntil()</code>,Demo</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">let subject = PublishSubject<span class="variable">&lt;Int&gt;</span>()</span><br><span class="line">let dependOnSubject = PublishSubject<span class="variable">&lt;Void&gt;</span>()</span><br><span class="line">let bag = DisposeBag()</span><br><span class="line">    </span><br><span class="line">_ = subject</span><br><span class="line">    .takeUntil(dependOnSubject)</span><br><span class="line">    .subscribe(</span><br><span class="line">        <span class="keyword">on</span>Next: &#123; print(<span class="variable">$0</span>) &#125;,</span><br><span class="line">        <span class="keyword">on</span>Error: &#123;_ <span class="keyword">in</span> print(<span class="string">"Error"</span>) &#125;,</span><br><span class="line">        <span class="keyword">on</span>Completed: &#123; print(<span class="string">"Completed"</span>) &#125;</span><br><span class="line">    ).addDisposableTo(bag)</span><br><span class="line">    </span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">1</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">2</span>)</span><br><span class="line">dependOnSubject.<span class="keyword">on</span>Next(())</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">3</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="number">4</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Completed()</span><br><span class="line">//ç»ˆç«¯è¾“å‡º</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">Completed</span><br></pre></td></tr></table></figure><hr><ul><li>ä¸ºäº†åŒæ—¶è®¢é˜…åŒä¸ªæ•°æ®çš„ä¸åŒä¿¡å·é‡ï¼ŒèŠ‚çº¦å¼€é”€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª<code>.share()</code></li></ul><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let object = Observable.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>).share()</span><br><span class="line"></span><br><span class="line">_ = object.subscribe(&#123; print($<span class="number">0</span> )&#125;)</span><br><span class="line">_ = object.subscribe(&#123; print($<span class="number">0</span> )&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œä»‹ç»äº†RxSwiftä¸­ï¼Œå°†ä¹‹å‰ä¼ ç»Ÿçš„æ¨¡å¼ä¿®æ”¹ä¸ºæ›´&lt;code&gt;Rx&lt;/code&gt;çš„æ¨¡å¼ï¼Œåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå…¶å®&lt;code&gt;RxSwift&lt;/code&gt;åªæ˜¯å°†ä¹‹å‰åˆ†æ•£å¤„ç†çš„æ­å–œï¼Œæ”¶æ‹¢èµ·æ¥ï¼Œä¹‹å‰æˆ‘ä»¬æˆ–è®¸å…³å¿ƒçš„æ˜¯&lt;code&gt;blockçš„å›è°ƒ&lt;/code&gt;ã€&lt;code&gt;ä»£ç†æ–¹æ³•&lt;/code&gt;ã€&lt;code&gt;function()è°ƒç”¨&lt;/code&gt;ï¼Œè€Œç°åœ¨æˆ‘ä»¬æˆ–è®¸åªéœ€è¦å…³å¿ƒä¸€ä»¶äº‹æƒ…&lt;code&gt;ä¿¡å·é‡&lt;/code&gt;ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œä¼´éšç€é¡¹ç›®çš„åºå¤§ã€åŠŸèƒ½çš„å¤æ‚ï¼Œæ•´ä¸ªé¡¹ç›®ä¸­å……æ–¥ç€çš„éƒ½æ˜¯è¿™äº›ä¿¡å·ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±è¦å­¦ä¼šåˆ†æã€è¿‡æ»¤ã€è½¬åŒ–ä¿¡å·ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swift" scheme="http://www.ghcoder.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å®é™…é¡¹ç›®ä¸­ä»ä¼ ç»Ÿæ¨¡å¼åˆ‡æ¢ä¸ºRxSwiftæ¨¡å¼</title>
    <link href="http://www.ghcoder.com/2017/10/05/20171005/"/>
    <id>http://www.ghcoder.com/2017/10/05/20171005/</id>
    <published>2017-10-05T05:57:12.000Z</published>
    <updated>2017-10-05T10:51:56.081Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥å®ç°RxSwiftçš„åŠŸèƒ½ï¼š</p></li><li><p>åˆ—è¡¨Controlleré‡Œé¢çš„ä»£ç :</p></li></ul><a id="more"></a><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestRxSwiftViewController</span>: <span class="title">UIViewController</span>, <span class="title">UITableViewDataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> datas = [<span class="type">TestRxSwiftItemObject</span>]()</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> <span class="type">ItemTableview</span>: <span class="type">UITableView</span>!</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: -- Life Cycle</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        loadDatas()</span><br><span class="line">        <span class="type">ItemTableview</span>.reloadData()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">(<span class="keyword">for</span> segue: UIStoryboardSegue, sender: <span class="keyword">Any</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> segue.identifier == <span class="string">"testRx"</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> detail: <span class="type">TestRxSwiftDetailViewController</span> = segue.destination <span class="keyword">as</span>! <span class="type">TestRxSwiftDetailViewController</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> index = <span class="type">ItemTableview</span>.indexPath(<span class="keyword">for</span>: sender <span class="keyword">as</span>! <span class="type">UITableViewCell</span>) &#123;</span><br><span class="line">                detail.<span class="type">Item</span> = datas[index.row]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: -- Private Methods</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadDatas</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>..&lt;<span class="number">10</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> itemObject = <span class="type">TestRxSwiftItemObject</span>(name: <span class="string">"Index-\(i)"</span>, isClicked: i % <span class="number">2</span> == <span class="number">0</span> ? <span class="literal">true</span> : <span class="literal">false</span>)</span><br><span class="line">            datas.append(itemObject)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: -- UITableView DataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, numberOfRowsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> datas.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UITableViewCell</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="string">"cell"</span>, <span class="keyword">for</span>: indexPath)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> itemObject = datas[indexPath.row]</span><br><span class="line">        cell.textLabel?.text = itemObject.name</span><br><span class="line">        cell.accessoryType   = itemObject.isClicked ? .checkmark : .<span class="keyword">none</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cell</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>è¯¦æƒ…Controlleré‡Œé¢çš„ä»£ç ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestRxSwiftDetailViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> content: <span class="type">UITextField</span>!</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> isOn: <span class="type">UISwitch</span>!</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="type">Item</span>: <span class="type">TestRxSwiftItemObject</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="type">Item</span> = <span class="type">Item</span> &#123;</span><br><span class="line">            content.text = <span class="type">Item</span>.name</span><br><span class="line">            isOn.isOn    = <span class="type">Item</span>.isClicked</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>åˆ‡æ¢ä¸ºRxSwiftçš„æ¨¡å¼</li><li><ol><li>é¦–å…ˆæˆ‘ä»¬å°†æˆ‘ä»¬åœ¨åˆ—è¡¨æ§åˆ¶å™¨é‡Œé¢çš„<code>Array</code>, æ›´æ¢ä¸ºå¯ä»¥è®¢é˜…çš„å˜é‡ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨<code>Variable</code>æ¥ä»£æ›¿:</li></ol></li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//ä¹‹å‰</span><br><span class="line">var datas = [<span class="string">TestRxSwiftItemObject</span>](<span class="link"></span>)</span><br><span class="line">//ä¹‹å</span><br><span class="line">var datas = Variable<span class="xml"><span class="tag">&lt;<span class="name">[TestRxSwiftItemObject]</span>&gt;</span></span>([])</span><br></pre></td></tr></table></figure><ul><li>å¹¶ä¸”å°†æ‰€æœ‰çš„å»æ•°æ®ä¸­çš„å¯¹è±¡çš„æ–¹æ³•åˆ‡æ¢ä¸€ä¸‹ï¼š</li></ul><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¹‹å‰</span></span><br><span class="line"><span class="keyword">let</span> itemObject = datas[indexPath.row]</span><br><span class="line"><span class="comment">//ä¹‹å</span></span><br><span class="line"><span class="keyword">let</span> itemObject = datas.<span class="keyword">value</span>[indexPath.row]</span><br></pre></td></tr></table></figure><ul><li>ç„¶åæˆ‘ä»¬åªéœ€è¦æ›´åŠ ã€åˆ é™¤æ•°æ®ï¼Œå…³äºUIçš„åˆ‡æ¢ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€åšå¤„ç†ï¼Œå¦‚ä¸‹ï¼š</li><li>ä»¥ä¸ºä¹‹å‰æˆ‘ä»¬å·²ç»å°†<code>data</code>ï¼Œåˆ‡æ¢ä¸º<code>Variable</code>äº†ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨<code>asObservable()</code>å°±å¯ä»¥æ”¹ä¸ºå¯å®šäºçš„è®¢é˜…çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥æ¥å—åˆ°å›è°ƒã€‚</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">_</span> = datas.asObservable().subscribe(</span><br><span class="line">    onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] todos <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span>?.updateUI(todos: todos)</span><br><span class="line">    &#125;</span><br><span class="line">).addDisposableTo(bag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateUI</span><span class="params">(todos: [TestRxSwiftItemObject])</span></span> &#123;</span><br><span class="line">    title = todos.isEmpty ? <span class="string">"Todos"</span> : <span class="string">"\(todos.count) Todos"</span></span><br><span class="line">    addBtn.isEnabled = todos.<span class="built_in">filter</span> &#123; !$<span class="number">0</span>.isClicked &#125;.<span class="built_in">count</span> &lt; <span class="number">6</span></span><br><span class="line"></span><br><span class="line">    <span class="type">ItemTableview</span>.reloadData()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…³äºçš„æ•°æ®çš„ä¼ é€’ï¼Œæ¶‰åŠåˆ°ä¸¤ç‚¹ï¼Œç¬¬ä¸€ä¸ªï¼šæˆ‘ä»¬å¦‚ä½•ä»é¦–é¡µæ•°æ®ä¼ é€’ç»™ç¬¬äºŒä¸ªæ§åˆ¶å™¨å‘¢ï¼Ÿ<code>é€šè¿‡å…¬å¼€çš„å±æ€§ä¼ é€’</code>ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let detail: TestRxSwiftDetailViewController = segue<span class="selector-class">.destination</span> as! TestRxSwiftDetailViewController</span><br><span class="line"><span class="keyword">if</span> let index = ItemTableview.indexPath(<span class="keyword">for</span>: sender as! UITableViewCell) &#123;</span><br><span class="line">detail<span class="selector-class">.Item</span> = datas<span class="selector-class">.value</span>[index.row]</span><br></pre></td></tr></table></figure><ul><li>ç¬¬äºŒç‚¹æˆ‘ä»¬å¦‚ä½•å°†ç¬¬äºŒä¸ªæ§åˆ¶å™¨é‡Œé¢çš„å±æ€§å›ä¼ ç»™é¦–é¡µæ§åˆ¶å™¨å‘¢ï¼Ÿï¼Œæˆ‘ä»¬åœ¨ç¬¬äºŒé¡µæ§åˆ¶å™¨é‡Œå…¬å¼€å‡ºä¸€ä¸ªå¯ä»¥è®¢é˜…çš„å¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬åªè¦åœ¨ç¬¬äºŒä¸ªæ§åˆ¶å‰é‡Œé¢ä¿®æ”¹æ•°æ®å€¼ï¼Œå¹¶ä¸”ä¼ é€’ï¼Œå°±èƒ½å†ç¬¬ä¸€ä¸ªæ§åˆ¶å™¨é‡Œé¢æ¥æ”¶åˆ°å›è°ƒäº†ã€‚è¿™é‡Œæœ‰ä¸ªä¸¤ç‚¹ï¼š</li></ul><figure class="highlight golo"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fileprivate <span class="keyword">var</span> itemSubject = PublishSubject&lt;TestRxSwiftItemObject&gt;()</span><br><span class="line"><span class="keyword">var</span> item: <span class="keyword">Observable</span>&lt;TestRxSwiftItemObject&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> itemSubject.asObservable()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆå®šä¹‰çš„<code>fileprivate</code>,é˜»æ­¢äº†å¤–éƒ¨ç»™è¿™ä¸ªå˜é‡å‘é€æ•°æ®ã€‚è€Œä»…ä»…åªæ˜¯ç»™å¤–éƒ¨æš´éœ²äº†ä¸€ä¸ª<code>item</code>çš„å¯¹åƒã€‚</li><li>è€Œåœ¨å¯¹è±¡å†…éƒ¨ï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥é€šè¿‡<code>itemSubject</code>æ¥å‘é€æ•°æ®ï¼Œå¹¶ä¸”å¤–éƒ¨ä¹Ÿèƒ½å¤Ÿæ¥å—åˆ°å›è°ƒã€‚</li><li>ç‚¹å‡»ä¿å­˜ï¼Œç¬¬äºŒä¸ªé¡µé¢<code>dismissä¹‹å‰</code>ï¼Œæˆ‘æ‰§è¡Œå¦‚ä¸‹çš„ä¿å­˜æ“ä½œï¼š</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> let <span class="built_in">item</span> = Item &#123;</span><br><span class="line">    <span class="built_in">item</span>.<span class="built_in">name</span> = content.<span class="built_in">text</span>!</span><br><span class="line">    <span class="built_in">item</span>.isClicked = isOn.isOn</span><br><span class="line"></span><br><span class="line">    itemSubject.onNext(<span class="built_in">item</span>)</span><br><span class="line">    itemSubject.onCompleted()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·åœ¨é¦–é¡µæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·æ¥å—åˆ°å›è°ƒäº†ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> detail: <span class="type">TestRxSwiftDetailViewController</span> = segue.destination <span class="keyword">as</span>! <span class="type">TestRxSwiftDetailViewController</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> index = <span class="type">ItemTableview</span>.indexPath(<span class="keyword">for</span>: sender <span class="keyword">as</span>! <span class="type">UITableViewCell</span>) &#123;</span><br><span class="line">    detail.<span class="type">Item</span> = datas.value[index.row]</span><br><span class="line">    <span class="number">_</span> = detail.item.subscribe(</span><br><span class="line">        onNext: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] newTodo <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>?.datas.value[index.row] = newTodo</span><br><span class="line">        &#125;,</span><br><span class="line">        onDisposed: &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Finishing changing item content"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…³äºæœ€åä¸€ç‚¹å¼‚æ­¥çš„å›è°ƒæ“ä½œï¼Œç®€å•çš„æ¥è¯´ï¼Œæˆ‘ä»¬å°†ä¹‹å‰è¿”å›å€¼<code>Void</code>-&gt;<code>Observable&lt;Void&gt;</code>æˆ–è€…<code>URL</code>-&gt;<code>Observable&lt;URL&gt;</code>,Demo:</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CustomError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> someOptionErrors</span><br><span class="line">    <span class="keyword">case</span> urlIsNullError</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">syncToSaveDatas</span><span class="params">()</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">URL</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">Observable</span>.create &#123; observer <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> testURL: <span class="type">URL</span>?</span><br><span class="line">        <span class="keyword">var</span> someOptions: <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">        testURL     = <span class="type">URL</span>(string: <span class="string">""</span>)</span><br><span class="line">        someOptions = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Error 1</span></span><br><span class="line">        <span class="keyword">guard</span> someOptions <span class="keyword">else</span> &#123;</span><br><span class="line">            observer.onError(<span class="type">CustomError</span>.someOptionErrors)</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Disposables</span>.create()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> testURL = testURL &#123;</span><br><span class="line">            <span class="comment">// success</span></span><br><span class="line">            observer.onNext(testURL)</span><br><span class="line">            observer.onCompleted()</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Error 2</span></span><br><span class="line">            observer.onError(<span class="type">CustomError</span>.urlIsNullError)</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Disposables</span>.create()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="type">Disposables</span>.create()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">saveDatas</span><span class="params">(<span class="number">_</span> sender: <span class="keyword">Any</span>)</span></span> &#123;</span><br><span class="line">    <span class="number">_</span> = syncToSaveDatas().subscribe(</span><br><span class="line">        onNext: &#123; url <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">        &#125;,</span><br><span class="line">        onError: &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"error is \($0)"</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        onCompleted: &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Success"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;p&gt;ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥å®ç°RxSwiftçš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;åˆ—è¡¨Controlleré‡Œé¢çš„ä»£ç :&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swift" scheme="http://www.ghcoder.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä¹ RxSwift</title>
    <link href="http://www.ghcoder.com/2017/10/03/20171003/"/>
    <id>http://www.ghcoder.com/2017/10/03/20171003/</id>
    <published>2017-10-03T03:57:12.000Z</published>
    <updated>2017-10-03T13:06:48.967Z</updated>
    
    <content type="html"><![CDATA[<ul><li>åˆ›å»ºå¯ä»¥è®¢é˜…çš„å¯¹è±¡ï¼Œåœ¨RxSwiftä¸­ç§°ä¹‹ä¸º<code>Observable</code>,æˆ‘ä»¬å¯ä»¥é€šè¿‡ç³»ç»Ÿä»‹ç»ç»™æˆ‘çš„æ–¹æ³•æ¥åˆ›å»º(æˆ‘ä»¬ç§°ä¹‹ä¸ºOperators)ã€‚</li></ul><a id="more"></a><hr><ul><li>è¿™é‡Œæˆ‘ä»¬é€šè¿‡<code>Create</code>çš„<code>Operators</code>çš„æ–¹æ³•æ¥åˆ›å»ºï¼Œå…ˆçœ‹ä¸€ä¸‹å®˜ç½‘[<a href="http://reactivex.io/documentation/operators/create.html]" target="_blank" rel="noopener">http://reactivex.io/documentation/operators/create.html]</a> çš„ä»‹ç»:</li></ul><blockquote><p>You can create an Observable from scratch by using the Create operator. You pass this operator a function that accepts the observer as its parameter. Write this function so that it behaves as an Observable â€” by calling the observerâ€™s onNext, onError, and onCompleted methods appropriately.<br>A well-formed finite Observable must attempt to call either the observerâ€™s onCompleted method exactly once or its onError method exactly once, and must not thereafter attempt to call any of the observerâ€™s other methods.</p></blockquote><ul><li>å†çœ‹ä¸€ä¸‹<code>github</code>ä¸Šæºç ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// MARK: create</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     Creates an observable sequence from a specified subscribe method implementation.</span></span><br><span class="line"><span class="comment">     - seealso: [create operator on reactivex.io](http://reactivex.io/documentation/operators/create.html)</span></span><br><span class="line"><span class="comment">     - parameter subscribe: Implementation of the resulting observable sequence's `subscribe` method.</span></span><br><span class="line"><span class="comment">     - returns: The observable sequence with the specified implementation for the `subscribe` method.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">create</span><span class="params">(<span class="number">_</span> subscribe: @escaping <span class="params">(AnyObserver&lt;E&gt;)</span></span></span> -&gt; <span class="type">Disposable</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">E</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AnonymousObservable</span>(subscribe)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŒ‰ç…§å®˜ç½‘çš„ä»‹ç»ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>Create</code>æ¥åˆ›å»ºä¸€ä¸ªå¯è¢«è®¢é˜…çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„å…¥å‚æ˜¯ä¸€ä¸ªblockï¼Œä»»æ„å¯¹è±¡çš„<code>Observer</code>,ä»–å¯ä»¥å‘é€<code>.onNext()/.onComplete()/.onError()</code></li><li>ç¬¬äºŒæ®µçš„æ³¨é‡Šçš„æ„æ€ï¼Œå°±æ˜¯è¿™ä¸ª<code>Observer</code>å¯ä»¥å‘é€<code>.onNext()</code>,ä½†æ˜¯è¿™ä¸ªå¯¹è±¡ä¸€æ—¦å‘é€äº†ä¸€æ¬¡<code>.onComplete()</code>æˆ–è€…<code>.onError()</code>,ç„¶åå°±ä¸èƒ½å°è¯•è°ƒç”¨ä»»ä½•è§‚å¯Ÿè€…çš„å…¶ä»–æ–¹æ³•äº†ã€‚çœ‹ä¸€ä¸‹Demoï¼š</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">enum CustomeError: Error &#123;</span><br><span class="line">    case somethingError</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let customOB = Observable<span class="variable">&lt;Int&gt;</span>.create &#123; observer <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">observer.<span class="keyword">on</span>Next(<span class="number">1</span>)</span><br><span class="line">observer.<span class="keyword">on</span>Next(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">//observer.<span class="keyword">on</span>Error(CustomeError.somethingError)</span><br><span class="line"></span><br><span class="line">observer.<span class="keyword">on</span>Completed()</span><br><span class="line"></span><br><span class="line">return  Disposables.create()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let disposeBag1 = DisposeBag()</span><br><span class="line">customOB.subscribe(</span><br><span class="line">    <span class="keyword">on</span>Next: &#123; print(<span class="variable">$0</span>) &#125;,</span><br><span class="line">    <span class="keyword">on</span>Error: &#123; print(<span class="variable">$0</span>) &#125;,</span><br><span class="line">    <span class="keyword">on</span>Completed: &#123; print(<span class="string">"onCompleted"</span>) &#125;,</span><br><span class="line">    <span class="keyword">on</span>Disposed: &#123; print(<span class="string">"onDisposed"</span>) &#125;</span><br><span class="line">).addDisposableTo(disposeBag1)</span><br></pre></td></tr></table></figure><ul><li>è¿™åˆ›å»ºçš„ä¾æ—§æ˜¯ä¸€ä¸ª<code>Observer</code>çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨å…¶ä»–çš„<code>Operator</code>,è¿™é‡Œä¸ºäº†æ–¹ä¾¿çš„è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>.debug()</code>ã€‚ä½¿ç”¨å¦‚ä¸‹ï¼š</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag1 = DisposeBag()</span><br><span class="line">customOB</span><br><span class="line">.<span class="keyword">debug</span>()</span><br><span class="line">.subscribe(</span><br><span class="line">    onNex<span class="variable">t:</span> &#123; <span class="keyword">print</span>($<span class="number">0</span>) &#125;,</span><br><span class="line">    onError: &#123; <span class="keyword">print</span>($<span class="number">0</span>) &#125;,</span><br><span class="line">    onCompleted: &#123; <span class="keyword">print</span>(<span class="string">"onCompleted"</span>) &#125;,</span><br><span class="line">    onDisposed: &#123; <span class="keyword">print</span>(<span class="string">"onDisposed"</span>) &#125;</span><br><span class="line">).addDisposableTo(disposeBag1)</span><br><span class="line"></span><br><span class="line">// æ§åˆ¶å°çš„æ‰“å°ä¿¡æ¯å¦‚ä¸‹ï¼š</span><br><span class="line"><span class="number">2017</span>-<span class="number">10</span>-<span class="number">03</span> <span class="number">13</span>:<span class="number">58</span>:<span class="number">23.488</span>: ViewController.swif<span class="variable">t:35</span> (viewDidLoad()) -&gt; subscribed</span><br><span class="line"><span class="number">2017</span>-<span class="number">10</span>-<span class="number">03</span> <span class="number">13</span>:<span class="number">58</span>:<span class="number">23.493</span>: ViewController.swif<span class="variable">t:35</span> (viewDidLoad()) -&gt; Event <span class="keyword">next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2017</span>-<span class="number">10</span>-<span class="number">03</span> <span class="number">13</span>:<span class="number">58</span>:<span class="number">23.493</span>: ViewController.swif<span class="variable">t:35</span> (viewDidLoad()) -&gt; Event <span class="keyword">next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">2017</span>-<span class="number">10</span>-<span class="number">03</span> <span class="number">13</span>:<span class="number">58</span>:<span class="number">23.493</span>: ViewController.swif<span class="variable">t:35</span> (viewDidLoad()) -&gt; Event completed</span><br><span class="line">onCompleted</span><br><span class="line">onDisposed</span><br><span class="line"><span class="number">2017</span>-<span class="number">10</span>-<span class="number">03</span> <span class="number">13</span>:<span class="number">58</span>:<span class="number">23.493</span>: ViewController.swif<span class="variable">t:35</span> (viewDidLoad()) -&gt; isDisposed</span><br></pre></td></tr></table></figure><ul><li>åœ¨æˆ‘ä»¬çœŸæ˜¯çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè®¢é˜…è€…æˆ–è€…å‘å¸ƒè€…ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªä¸ä»…å¯ä»¥è®¢é˜…ã€ä¹Ÿå¯ä»¥å‘å¸ƒçš„å¯¹è±¡ï¼Œåœ¨<code>RxSwift</code>ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<code>Subjects</code>:</li></ul><hr><ul><li>é¦–é€‰æˆ‘ä»¬è¦è¯´çš„<code>Subjects</code>å¯¹è±¡å«åš<code>PublishSubject</code>,çœ‹ä¸€ä¸‹githubä¸Šçš„æºç ï¼š</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Represents an object that is both an observable sequence as well as an observer.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Each notification is broadcasted to all subscribed observers.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PublishSubject</span>&lt;<span class="type">Element</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å†çœ‹å®˜ç½‘ä¸Šå¯¹<code>PublishSubject</code>å¯¹è±¡çš„ä»‹ç»ï¼š</li></ul><blockquote><p>PublishSubject emits to an observer only those items that are emitted by the source Observable(s) subsequent to the time of the subscription.</p></blockquote><blockquote><p>Note that a PublishSubject may begin emitting items immediately upon creation (unless you have taken steps to prevent this), and so there is a risk that one or more items may be lost between the time the Subject is created and the observer subscribes to it. If you need to guarantee delivery of all items from the source Observable, youâ€™ll need either to form that Observable with Create so that you can manually reintroduce â€œcoldâ€ Observable behavior (checking to see that all observers have subscribed before beginning to emit items), or switch to using a ReplaySubject instead.</p></blockquote><blockquote><p>If the source Observable terminates with an error, the PublishSubject will not emit any items to subsequent observers, but will simply pass along the error notification from the source Observable.</p></blockquote><ul><li><em>åªæœ‰å…ˆè®¢é˜…æ¶ˆæ¯ï¼Œå†å‘é€æ¶ˆæ¯ï¼Œæ‰èƒ½æ¥å—åˆ°æ¶ˆæ¯</em></li><li>é¦–å…ˆå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯<code>Cold Sign</code>,è¿™é‡Œæ‰€è°“çš„<code>Cold</code>ï¼Œå°±ä»£è¡¨ï¼Œå½“åˆ›å»ºå®Œè¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šç«‹åˆ»å‘é€æ•°æ®ï¼Œè€Œåªæœ‰åœ¨æœ‰è®¢é˜…è€…è®¢é˜…å®ƒçš„æ—¶å€™ï¼Œå®ƒæ‰ä¼šå‘é€æ•°æ®ã€‚</li><li>è€Œè¿™é‡Œè¿˜æœ‰ä¸€ç‚¹å¾ˆé‡è¦çš„æ˜¯ï¼Œ<em>PublishSubjectåªèƒ½å¤Ÿè®¢é˜…åœ¨å®ƒä¹‹åå‘é€çš„æ•°æ®</em>ï¼Œè¿™ä¸€ç‚¹ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ä¸ªè®¢é˜…æ¶ˆæ¯ä¹‹å‰ï¼Œä¸ç®¡æˆ‘ä»¬å‘é€äº†å¤šå°‘æ•°æ®ï¼Œåœ¨çœŸæ­£è®¢é˜…ä¹‹åï¼Œè¿™äº›ä¹‹å‰è®¢é˜…çš„æ•°æ®æ˜¯ä¸ä¼šå‘é€çš„ã€‚</li><li>å¹¶ä¸”åœ¨çº¦åˆ°å¤±è´¥çš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡å°±å°†è¢«ç»ˆæ­¢ï¼Œé™¤äº†åœ¨å›è°ƒçš„<code>.onError()</code>æ–¹æ³•ä¹‹å¤–ï¼Œä»¥åæ‰€æœ‰çš„æ•°æ®éƒ½å°†æ— æ³•æ¥å—ã€‚çœ‹ä¸€ä¸‹Demoï¼š</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">let subject = PublishSubject<span class="variable">&lt;String&gt;</span>()</span><br><span class="line"></span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="string">"Test1"</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="string">"Test2"</span>)</span><br><span class="line"></span><br><span class="line">let sub1 = subject.subscribe(</span><br><span class="line">    <span class="keyword">on</span>Next: &#123; print(<span class="string">"1:) \($0)"</span>)&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="string">"Test3"</span>)</span><br><span class="line"></span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="string">"Test4"</span>)</span><br><span class="line"></span><br><span class="line">sub1.dispose()</span><br><span class="line"></span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="string">"Test5"</span>)</span><br><span class="line"></span><br><span class="line">let sub2 = subject.subscribe(</span><br><span class="line">    <span class="keyword">on</span>Next: &#123; print(<span class="string">"2:) \($0)"</span>)&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="string">"Test6"</span>)</span><br><span class="line">subject.<span class="keyword">on</span>Next(<span class="string">"Test7"</span>)</span><br><span class="line"></span><br><span class="line">sub2.dispose()</span><br><span class="line"></span><br><span class="line">// ç»ˆç«¯è¾“å‡ºä¸º</span><br><span class="line"><span class="number">1</span>:) Test3</span><br><span class="line"><span class="number">1</span>:) Test4</span><br><span class="line"><span class="number">2</span>:) Test6</span><br><span class="line"><span class="number">2</span>:) Test7</span><br></pre></td></tr></table></figure><hr><ul><li>ç¬¬äºŒç§åŒæ—¶å³å¯ä»¥è®¢é˜…ï¼Œä¹Ÿå¯ä»¥å‘é€æ¶ˆæ¯çš„å¯¹è±¡ï¼Œæˆ‘ä»¬è¿™é‡Œå«åš<code>BehaviorSubject</code>ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹githubä¸­ä»£ç :</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Represents a value that changes over time.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Observers can subscribe to the subject to receive the last (or initial) value and all subsequent notifications.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BehaviorSubject</span>&lt;<span class="type">Element</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å†çœ‹ä¸€ä¸‹å®˜ç½‘ä¸Šçš„ä»‹ç»ï¼š</li></ul><blockquote><p>When an observer subscribes to a BehaviorSubject, it begins by emitting the item most recently emitted by the source Observable (or a seed/default value if none has yet been emitted) and then continues to emit any other items emitted later by the source Observable(s).</p><p>However, if the source Observable terminates with an error, the BehaviorSubject will not emit any items to subsequent observers, but will simply pass along the error notification from the source Observable.</p></blockquote><ul><li>çœ‹åˆ°æ³¨é‡Šä»¥åŠä»£ç çš„æ„æ€ï¼Œè¿™ç§<code>Subject</code>çš„å¯¹è±¡çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œ<em>è®¢é˜…è¿™ç§å¯¹è±¡ï¼Œå®ƒå°±å¯ä»¥æ¥æ”¶åˆ°æœ€è¿‘çš„ä¸€æ¬¡å€¼æˆ–è€…æ˜¯åˆå§‹åŒ–çš„é»˜è®¤å€¼</em></li><li>åŒæ ·ï¼Œè¿™ä¸ª<code>Subject</code>çš„å¯¹è±¡ï¼Œï¼Œä¸€æ—¦æ¥å—åˆ°<code>.onError()</code>æˆ–è€…<code>.onComplete()</code>, è¿™ä¸ªå¯¹è±¡å°†ä¸ä¼šå†å‘é€ä»»ä½•å€¼äº†ã€‚çœ‹ä¸€ä¸‹Demoï¼š</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">let</span> <span class="string">subject</span> <span class="string">=</span> <span class="string">BehaviorSubject&lt;String&gt;(value:</span> <span class="string">"Default Value"</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">let</span> <span class="string">sub1</span> <span class="string">=</span> <span class="string">subject.subscribe(</span></span><br><span class="line"><span class="attr">    onNext:</span> <span class="string">&#123;</span> <span class="string">print("From1:\($0)")</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">subject.onNext("Test1")</span></span><br><span class="line"></span><br><span class="line"><span class="string">sub1.dispose()</span></span><br><span class="line"></span><br><span class="line"><span class="string">let</span> <span class="string">sub2</span> <span class="string">=</span> <span class="string">subject.subscribe(</span></span><br><span class="line"><span class="attr">    onNext:</span> <span class="string">&#123;print("From2:\($0)")&#125;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">subject.onNext("Test2")</span></span><br><span class="line"><span class="string">subject.onNext("Test3")</span></span><br><span class="line"></span><br><span class="line"><span class="string">sub2.dispose()</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="attr">From1:</span><span class="string">Default</span> <span class="string">Value</span></span><br><span class="line"><span class="attr">From1:</span><span class="string">Test1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">From2:</span><span class="string">Test1</span></span><br><span class="line"><span class="attr">From2:</span><span class="string">Test2</span></span><br><span class="line"><span class="attr">From2:</span><span class="string">Test3</span></span><br></pre></td></tr></table></figure><hr><ul><li>è¿™é‡Œå¯ä»¥é€šè¿‡<code>BehaviorSubject</code>å¯ä»¥æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡å‘é€æ•°æ®ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼Œå°±ä¼šæ¥å—åˆ°é»˜è®¤çš„æ•°æ®ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦æ¥å—æŒ‡å®šæ•°ç›®çš„å†å²æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ç§subjectï¼Œæˆ‘ä»¬å«åšï¼š<code>ReplaySubject</code>.</li><li>çœ‹ä¸€ä¸‹githubä¸Šä»£ç çš„ï¼š</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/// Each notification <span class="keyword">is</span> broadcasted <span class="keyword">to</span> <span class="keyword">all</span> subscribed <span class="built_in">and</span> future observers, subject <span class="keyword">to</span> <span class="keyword">buffer</span> trimming policies.</span><br><span class="line">public class ReplaySubject<span class="symbol">&lt;Element&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ReplaySubject emits to any observer all of the items that were emitted by the source Observable(s), regardless of when the observer subscribes.</p></blockquote><blockquote><p>There are also versions of ReplaySubject that will throw away old items once the replay buffer threatens to grow beyond a certain size, or when a specified timespan has passed since the items were originally emitted.</p></blockquote><blockquote><p>If you use a ReplaySubject as an observer, take care not to call its onNext method (or its other on methods) from multiple threads, as this could lead to coincident (non-sequential) calls, which violates the Observable contract and creates an ambiguity in the resulting Subject as to which item or notification should be replayed first.</p></blockquote><ul><li><em>ReplaySubjectå¯¹è±¡ä¸èƒ½åˆå§‹åŒ–é»˜è®¤å€¼ã€å¹¶ä¸”æ¯æ¬¡æ‰“å°å†å²æ•°æ®çš„å€¼æ˜¯å¯ä»¥æ§åˆ¶çš„</em>ï¼Œçœ‹ä¸€ä¸‹Demoï¼š</li></ul><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = ReplaySubject&lt;String&gt;.create(bufferSize: <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sub1 = subject.subscribe(</span><br><span class="line">    onNext: &#123; print(<span class="string">"From 1:| \($0)"</span>)&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">subject.onNext(<span class="string">"Test1"</span>)</span><br><span class="line">subject.onNext(<span class="string">"Test2"</span>)</span><br><span class="line">subject.onNext(<span class="string">"Test3"</span>)</span><br><span class="line"></span><br><span class="line">sub1.dispose()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sub2 = subject.subscribe(</span><br><span class="line">    onNext: &#123; print(<span class="string">"From 2:| \($0)"</span>)&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">subject.onNext(<span class="string">"Test4"</span>)</span><br><span class="line"></span><br><span class="line">sub2.dispose()</span><br><span class="line"></span><br><span class="line">// ç»ˆç«¯è¾“å‡º</span><br><span class="line"><span class="keyword">From</span> <span class="number">1</span>:| <span class="type">Test1</span></span><br><span class="line"><span class="keyword">From</span> <span class="number">1</span>:| <span class="type">Test2</span></span><br><span class="line"><span class="keyword">From</span> <span class="number">1</span>:| <span class="type">Test3</span></span><br><span class="line"><span class="keyword">From</span> <span class="number">2</span>:| <span class="type">Test2</span></span><br><span class="line"><span class="keyword">From</span> <span class="number">2</span>:| <span class="type">Test3</span></span><br><span class="line"><span class="keyword">From</span> <span class="number">2</span>:| <span class="type">Test4</span></span><br></pre></td></tr></table></figure><hr><ul><li>ç¬¬ä¸‰ç§<code>Subjects</code>, æˆ‘ä»¬å«åš<code>Variable</code>, çœ‹ä¸€ä¸‹githubä¸Šçš„æ³¨é‡Š:</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/// Variable is a wrapper for `BehaviorSubject`.</span><br><span class="line">///</span><br><span class="line">/// Unlike `BehaviorSubject` it can't terminate <span class="keyword">with</span> <span class="keyword">error</span>, <span class="keyword">and</span> <span class="keyword">when</span> <span class="keyword">variable</span> <span class="keyword">is</span> deallocated</span><br><span class="line">/// it will <span class="keyword">complete</span> its observable <span class="keyword">sequence</span> (<span class="string">`asObservable`</span>).</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="keyword">Variable</span>&lt;<span class="keyword">Element</span>&gt; &#123;</span><br></pre></td></tr></table></figure><ul><li>ç‰¹ç‚¹ï¼š<em>1.è¿™ä¸ªå¯¹è±¡æ˜¯å¯¹BehaviorSubjectçš„ä¸Šå±‚å°è£…ã€‚2.å¯¹è±¡ä¸èƒ½é€šè¿‡å‘é€Errorè€Œç»ˆæ­¢å¯¹è±¡å‘é€æ•°æ®ã€‚3.é€šè¿‡è°ƒç”¨asObservableï¼Œå¯ä»¥è½¬åŒ–ä¸ºObserverå¯¹è±¡ã€‚</em> Demo:</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">let subject = Variable(<span class="string">"Test1"</span>)</span><br><span class="line"></span><br><span class="line">let _ = subject.asObservable().subscribe(</span><br><span class="line">    onNext: &#123;print(<span class="string">"1:\($0)"</span>)&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">subject<span class="selector-class">.value</span> = <span class="string">"Changed"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(subject.value)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»ˆç«¯è¾“å‡º</span></span><br><span class="line"><span class="number">1</span>:Test1</span><br><span class="line"><span class="number">1</span>:Changed</span><br><span class="line">Changed</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;åˆ›å»ºå¯ä»¥è®¢é˜…çš„å¯¹è±¡ï¼Œåœ¨RxSwiftä¸­ç§°ä¹‹ä¸º&lt;code&gt;Observable&lt;/code&gt;,æˆ‘ä»¬å¯ä»¥é€šè¿‡ç³»ç»Ÿä»‹ç»ç»™æˆ‘çš„æ–¹æ³•æ¥åˆ›å»º(æˆ‘ä»¬ç§°ä¹‹ä¸ºOperators)ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swift" scheme="http://www.ghcoder.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä¹ Swift Tips(ä¸‰)</title>
    <link href="http://www.ghcoder.com/2017/09/14/20170914/"/>
    <id>http://www.ghcoder.com/2017/09/14/20170914/</id>
    <published>2017-09-14T06:51:12.000Z</published>
    <updated>2017-09-15T08:09:45.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li><code>final</code>ä¿®é¥°çš„<code>class</code>/<code>func</code>/<code>var</code>,è¡¨ç¤ºå†…å®¹ä¸å…è®¸è¿›è¡Œç»§æ‰¿æˆ–è€…é‡å†™</li></ul><hr><ul><li><code>lazy</code>ç®€å•èµ‹å€¼ï¼š<code>lazy var str1: String = &quot;Hello&quot;</code></li><li><code>lazy</code>è®¡ç®—èµ‹å€¼ï¼š</li></ul><a id="more"></a><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lazy var <span class="built_in">str</span>: <span class="keyword">String</span> = &#123;</span><br><span class="line"></span><br><span class="line">      let <span class="built_in">str</span> = <span class="string">"Hello"</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"åªæœ‰é¦–æ¬¡è®¿é—®è¾“å‡º"</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line">  &#125;()</span><br></pre></td></tr></table></figure><ul><li><code>lazy</code>ç”¨åœ¨ä¸€äº›<code>map</code>/<code>filter</code>ï¼š</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = data.lazy.map &#123;</span><br><span class="line">    <span class="function"><span class="params">(i: Int)</span> -&gt;</span> Int <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"æ­£åœ¨å¤„ç† \(i)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> i * <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>Swift ä¸­çš„é•œåƒä»¥åŠåå°„çš„é—®é¢˜ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Mirror</code>æ¥å®ç°ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = <span class="type">Person</span>(name: <span class="string">"XiaoMing"</span>, age: <span class="number">16</span>)</span><br><span class="line"><span class="keyword">let</span> r = <span class="type">Mirror</span>(reflecting: xiaoming)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> name = valueFrom(xiaoming, key: <span class="string">"name"</span>) <span class="keyword">as</span>? <span class="type">String</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"é€šè¿‡key å¾—åˆ°å€¼:\(name)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">dump</span>(xiaoming)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"xiaoming æ˜¯\(r.displayStyle!)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"å±æ€§ä¸ªæ•°:\(r.children.count)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> child <span class="keyword">in</span> r.children &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"å±æ€§å:\(String(describing: child.label)),å€¼:\(child.value)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">valueFrom</span><span class="params">(<span class="number">_</span> object: <span class="keyword">Any</span>, key: String)</span></span> -&gt; <span class="type">Any</span>? &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> mirror = <span class="type">Mirror</span>(reflecting: object)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> child <span class="keyword">in</span> mirror.children &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> (targetKey, targetMirror) = (child.label, child.value)</span><br><span class="line">        <span class="keyword">if</span> key == targetKey &#123;</span><br><span class="line">            <span class="keyword">return</span> targetMirror</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>éšå¼è§£åŒ…å¹¶ä¸èƒ½ç¡®ä¿å±æ€§ä¸€å®šæœ‰å€¼ï¼Œæˆ–è€…ä¸€å®šå®‰å…¨ï¼Œè€Œæ˜¯åœ¨è·å–å±æ€§å€¼çš„æ—¶å€™ï¼Œè‡ªåŠ¨å¼ºåˆ¶è§£åŒ…ï¼Œå¦‚æœè¯¥å€¼æ˜¯<code>nil</code>çš„è¯ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä¼šcrashçš„ã€‚</li></ul><hr><ul><li>optionalå®šä¹‰å…¶å®å°±æ˜¯ä¸ªæšä¸¾ï¼š</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> aNil: <span class="keyword">String</span>? = nil</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> anotherNil: <span class="keyword">String</span>?? = aNil</span><br><span class="line"><span class="keyword">let</span> literalNil: <span class="keyword">String</span>?? = nil</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> _ = anotherNil &#123;</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">"anotherNil"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> _ = literalNil &#123;</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">"literalNil"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ‰“å°<code>optional</code>å¯ä»¥é€šè¿‡<code>fr v -R xxx</code></li></ul><hr><ul><li><code>map</code>çš„ä½¿ç”¨ï¼Œæˆ‘è§çš„æœ€å¤šçš„å°±æ˜¯åœ¨æ•°ç»„ç­‰é›†åˆä¸­çš„<code>map</code>ä½¿ç”¨ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹<code>map</code>çš„å®šä¹‰:</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Returns an array containing the results of mapping the given closure</span></span><br><span class="line"><span class="comment">/// over the sequence's elements.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// In this example, `map` is used first to convert the names in the array</span></span><br><span class="line"><span class="comment">/// to lowercase strings and then to count their characters.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     let cast = ["Vivien", "Marlon", "Kim", "Karl"]</span></span><br><span class="line"><span class="comment">///     let lowercaseNames = cast.map &#123; $0.lowercaseString &#125;</span></span><br><span class="line"><span class="comment">///     // 'lowercaseNames' == ["vivien", "marlon", "kim", "karl"]</span></span><br><span class="line"><span class="comment">///     let letterCounts = cast.map &#123; $0.characters.count &#125;</span></span><br><span class="line"><span class="comment">///     // 'letterCounts' == [6, 6, 3, 4]</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Parameter transform: A mapping closure. `transform` accepts an</span></span><br><span class="line"><span class="comment">///   element of this sequence as its parameter and returns a transformed</span></span><br><span class="line"><span class="comment">///   value of the same or of a different type.</span></span><br><span class="line"><span class="comment">/// - Returns: An array containing the transformed elements of this</span></span><br><span class="line"><span class="comment">///   sequence.</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;T&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; [<span class="type">T</span>]</span><br></pre></td></tr></table></figure><ul><li>æ¸…æ™°æ˜äº†ï¼Œè¿™é‡Œå®šä¹‰çš„æ³›å‹ä¸ºT, å‡½æ•°å†…éƒ¨çš„blockï¼Œå°†å¦å¤–ä¸€ç§æ³›å‹Elementè½¬åŒ–ä¸ºTï¼Œæœ€åè¿˜æ˜¯ç”Ÿæˆä¸€ä¸ª[T]ç±»å‹çš„æ•°ç»„ã€‚</li><li>é™¤äº†æ•°ç»„çš„mapå¤–ï¼Œè¿™é‡Œä½œè€…è¿˜è¯´äº†ä¸€ä¸‹<code>Optional</code>çš„<code>map</code>è¡Œæ•°ï¼Œæ•ˆæœä¸€æ ·ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Evaluates the given closure when this `Optional` instance is not `nil`,</span></span><br><span class="line"><span class="comment">/// passing the unwrapped value as a parameter.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Use the `map` method with a closure that returns a nonoptional value.</span></span><br><span class="line"><span class="comment">/// This example performs an arithmetic operation on an</span></span><br><span class="line"><span class="comment">/// optional integer.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     let possibleNumber: Int? = Int("42")</span></span><br><span class="line"><span class="comment">///     let possibleSquare = possibleNumber.map &#123; $0 * $0 &#125;</span></span><br><span class="line"><span class="comment">///     print(possibleSquare)</span></span><br><span class="line"><span class="comment">///     // Prints "Optional(1746)"</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     let noNumber: Int? = nil</span></span><br><span class="line"><span class="comment">///     let noSquare = noNumber.map &#123; $0 * $0 &#125;</span></span><br><span class="line"><span class="comment">///     print(noSquare)</span></span><br><span class="line"><span class="comment">///     // Prints "nil"</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Parameter transform: A closure that takes the unwrapped value</span></span><br><span class="line"><span class="comment">///   of the instance.</span></span><br><span class="line"><span class="comment">/// - Returns: The result of the given closure. If this instance is `nil`,</span></span><br><span class="line"><span class="comment">///   returns `nil`.</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;U&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(Wrapped)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">U</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">U</span>?</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾‹å­å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="keyword">let</span> num: <span class="type">Int</span>? = <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> result = num.<span class="built_in">map</span> &#123;</span><br><span class="line">    $<span class="number">0</span> * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result) <span class="comment">// Optional(6)</span></span><br></pre></td></tr></table></figure><hr><ul><li><code>protocol</code>çš„<code>extension</code>çš„åŠŸèƒ½ï¼Œä¸ºåè®®å®Œæˆäº†æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚è¿™ä¹Ÿï¼Œå³ä½¿éµå¾ªäº†åè®®ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ç”¨å†™ä»»ä½•å®ç°çš„ä»£ç ã€‚</li><li>å¦‚æœç±»å‹æ¨æ–­æ˜¯å®é™…çš„ç±»å‹ï¼š å¦‚æœç±»å‹ä¸­æ²¡æœ‰å®ç°ï¼Œå°±ä¼šè°ƒç”¨æ‹“å±•ä¸­çš„æ–¹æ³•å®ç°ã€‚</li><li>å¦‚æœç±»å‹æ¨æ–­çš„æ˜¯åè®®ï¼š1. å¦‚æœåœ¨åè®®ä¸­å®šä¹‰è¿‡ï¼Œå¦‚æœç±»å‹ä¸­æ²¡æœ‰å®ç°ï¼Œé‚£å°±è°ƒç”¨æ‹“å±•ä¸­çš„å®ç°ã€‚ 2.å¦‚æœåœ¨åè®®ä¸­æ²¡ç”¨å®šä¹‰è¿‡çš„è¯ï¼Œæ‹“å±•ä¸­çš„æ–¹æ³•é»˜è®¤ä¼šè¢«è°ƒç”¨ã€‚</li></ul><hr><ul><li><code>where</code>å­—æ®µçš„ä½¿ç”¨ï¼Œç›®å‰å·²ç»ä¸èƒ½å†<code>if</code>/<code>guard</code>ä¸­ä½¿ç”¨<code>where</code>,ä½†æ˜¯åœ¨<code>swich</code>/<code>foreach</code>/<code>for</code>å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚</li></ul><hr><ul><li><p>å¯¹äºå¦‚æœéœ€è¦åœ¨<code>enum</code>ä¸­å¾ªç¯éœ€è¦åµŒå¥—å®šä¹‰çš„è¯ï¼Œè¿™é‡Œæˆ‘éœ€è¦ç”¨çš„<code>indirect</code>,ä¾‹å¦‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å®šä¹‰ä¸€ä¸ªå•å‘è¿è¾¹çš„ç»“æ„äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">indirect</span> <span class="class"><span class="keyword">enum</span> <span class="title">LinkedList</span>&lt;<span class="title">Element</span>: <span class="title">Comparable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">case</span> empty</span><br><span class="line">   <span class="keyword">case</span> node(<span class="type">Element</span>, <span class="type">LinkedList</span>&lt;<span class="type">Element</span>&gt;)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åˆ é™¤é“¾è¡¨ä¸­æŸä¸ªå…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removing</span><span class="params">(<span class="number">_</span> element: Element)</span></span> -&gt; <span class="type">LinkedList</span>&lt;<span class="type">Element</span>&gt; &#123;</span><br><span class="line">   <span class="keyword">guard</span> <span class="keyword">case</span> <span class="keyword">let</span> .node(value, next) = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> .empty &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> value == element ? next : <span class="type">LinkedList</span>.node(value, next.removing(element))</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> linkedList = <span class="type">LinkedList</span>.node(<span class="number">1</span>, .node(<span class="number">2</span>, .node(<span class="number">3</span>, .node(<span class="number">4</span>, .empty))))</span><br><span class="line">  <span class="keyword">let</span> result = linkedList.removing(<span class="number">2</span>)</span><br><span class="line">  <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure></li></ul><hr><ul><li><p>åœ¨<code>Object-c</code>ä¸­ï¼Œè¿”å›<code>SEL</code>ï¼Œæˆ‘ä»¬ä¼šç›´æ¥è°ƒç”¨<code>@selector</code>ï¼Œä½†æ˜¯åœ¨<code>Swift</code>ä¸­æˆ‘ä»¬å·²ç»ä¸èƒ½è¿™æ ·è°ƒç”¨äº†ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªå­—æ®µ<code>#selector</code>,ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">callMe</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">callMeWithParam</span><span class="params">(obj: AnyObject!)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">turn</span><span class="params">(by angle: Int, speed: Int)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> someMethod = #selector(callMe)</span><br><span class="line"><span class="keyword">let</span> anotherMethod = #selector(callMeWithParam)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> method = #selector(turn)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœåå­—ç›¸åŒï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦å®šä¹‰ç±»å‹ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> method11 = #selector(comonFunc <span class="keyword">as</span> () -&gt;())</span><br><span class="line"><span class="keyword">let</span> method22 = #selector(commonFunc(input:) <span class="keyword">as</span> (<span class="type">Int</span>) -&gt; <span class="type">Int</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">comonFunc</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">commonFunc</span><span class="params">(input: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> input</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li></ul><hr><ul><li>å®ä¾‹åŒ–æ–¹æ³•çš„åŠ¨æ€è°ƒç”¨ï¼š1.é€šè¿‡ç±»è·å–æ–¹æ³•ï¼Œ2.å†ä¼ å…¥å®ä¾‹å¾—åˆ°æ–¹æ³•ï¼Œ3.åœ¨æ ¹æ®æƒ…å†µä¼ å…¥å‚æ•°</li></ul><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> MyClass <span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    func method(number: Int) -&gt; Int &#123;</span></span><br><span class="line"><span class="comment">        return number + 1</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> func <span class="function"><span class="keyword">method</span><span class="params">(number: Int)</span> -&gt; <span class="title">Int</span> <span class="comment">&#123;</span></span></span><br><span class="line"><span class="function"><span class="comment">        return number</span></span></span><br><span class="line"><span class="function"><span class="comment">    &#125;</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">f</span> = <span class="title">MyClass</span>.<span class="title">method</span></span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">object</span> = <span class="title">MyClass</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">let</span> <span class="title">result</span> = <span class="title">f</span><span class="params">(object)</span><span class="params">(1)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="keyword">result</span>)</span></span></span><br></pre></td></tr></table></figure><ul><li>å¦‚æœå­˜åœ¨ç›¸åŒåå­—çš„å‡½æ•°ï¼Œå¯ä»¥æ˜¾ç¤ºå®šä¹‰ç±»å‹æ¥åŒºåˆ†:</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f1 = MyClass.method</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f2: <span class="function"><span class="params">(Int)</span> -&gt;</span> Int = MyClass.method</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f3: <span class="function"><span class="params">(MyClass)</span> -&gt;</span> <span class="function"><span class="params">(Int)</span> -&gt;</span> Int = MyClass.method</span><br></pre></td></tr></table></figure><hr><ul><li>å•ä¾‹ï¼š</li></ul><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Manager</span> &#123;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">let</span> shared = Manager()</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">init</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>è‡ªå®šä¹‰ç¼–è¯‘ç¬¦å·ï¼Œåœ¨<code>Build Settings</code>ä¸­ï¼Œæ‰¾åˆ°<code>Swift Compiler - Custom Flag</code>,å¹¶ä¸”åœ¨<code>Other Swift Flags</code>ä¸­åŠ ä¸Š<code>-D FREE_VERSION</code></li></ul><hr><ul><li>ç¼–è¯‘ç¬¦å·ï¼š <code>// MARK:</code>ã€<code>// TODO:</code>ã€<code>// FIXME:</code></li></ul><hr><ul><li>appå…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œé»˜è®¤åˆ›å»ºappçš„æ—¶å€™ï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºmainçš„æ–‡ä»¶ï¼Œåœ¨<code>swift</code>ä¸­ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ›å»º<code>@UIApplicationMain</code>,ä»£è¡¨ç³»ç»Ÿä¼šè‡ªåŠ¨å°†è¿™ä¸ªç±»æ ‡è®°ä¸ºå¯åŠ¨æ–‡ä»¶ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹æ³•ï¼Œå¯ä»¥å°†å¯åŠ¨çš„æ–‡ä»¶æŒ‡å®šä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ï¼Œä¹Ÿå¯ä»¥å°†äº‹ä»¶çš„æ¥å—è€…æŒ‡å®šä¸ºæˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶ç±»ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªmain.swift çš„æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span>: <span class="title">UIApplication</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">sendEvent</span><span class="params">(<span class="number">_</span> event: UIEvent)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.sendEvent(event)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Event sent: \(event)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">UIApplicationMain</span>(</span><br><span class="line">    <span class="type">CommandLine</span>.argc,</span><br><span class="line">    <span class="type">UnsafeMutableRawPointer</span>(<span class="type">CommandLine</span>.unsafeArgv)</span><br><span class="line">        .bindMemory(</span><br><span class="line">            to: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;.<span class="keyword">self</span>,</span><br><span class="line">            capacity: <span class="type">Int</span>(<span class="type">CommandLine</span>.argc)),</span><br><span class="line">    <span class="literal">nil</span>,</span><br><span class="line">    <span class="type">NSStringFromClass</span>(<span class="type">AppDelegate</span>.<span class="keyword">self</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><ul><li>åœ¨<code>Swift</code>ä¸­çš„åè®®é»˜è®¤éƒ½æ˜¯å¿…é¡»è¦å®ç°çš„ï¼Œä½†æ˜¯å¦‚æœç”¨åœ¨<code>Object-c</code>ä¸­ï¼Œåè®®çš„æ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span> <span class="class"><span class="keyword">protocol</span> <span class="title">OptionalProtocol</span> </span>&#123;</span><br><span class="line">    <span class="meta">@objc</span> <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">optionalMethod</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½†æ˜¯æœ‰äº†<code>Protocol Extension</code>ï¼Œæˆ‘ä¹Ÿå¯ä»¥ä»¥<code>Swift</code>çš„æ–¹å¼æ¥å®ç°,å¯¹äº<code>OC</code>ä¸­å¯é€‰çš„åè®®æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å†™protocol extension æ¥å®ç°å¯é€‰çš„åŠŸèƒ½ã€‚</li></ul><hr><ul><li><code>Swift</code>ä¸­çš„<code>unowned</code>å’Œä»¥å‰çš„<code>unsafe_unretained</code>: å³ä½¿å®ƒåŸæ¥å¼•ç”¨çš„å†…å®¹å·²ç»è¢«é‡Šæ”¾äº†ï¼Œå®ƒä»ç„¶ä¼šä¿æŒå¯¹è¢«é‡Šæ”¾å¯¹è±¡çš„ä¸€ä¸ªæ— æ•ˆå¼•ç”¨ï¼Œå®ƒä¸æ˜¯optionalå€¼ï¼Œä¹Ÿä¸èƒ½è¢«æŒ‡å‘nil,å¦‚æœè°ƒç”¨å±æ€§æˆ–è€…æ–¹æ³•çš„æ—¶å€™å°±ä¼šcrashã€‚ä½œè€…å»ºè®®:</li><li>å¦‚æœç¡®å®šåœ¨è®¿é—®çš„æ—¶å€™ï¼Œä¸ä¼šè¢«é‡Šæ”¾çš„è¯ï¼Œå°±ä½¿ç”¨<code>unowned</code>ï¼Œå¦‚æœå­˜åœ¨é‡Šæ”¾çš„å¯èƒ½ï¼Œé‚£å°±ç”¨<code>weak</code></li></ul><hr><ul><li>åœ¨<code>swift</code>ä¸­ï¼Œ<code>Int</code>/<code>Bool</code>/<code>String</code>/<code>Array</code>/<code>Dictionary</code>éƒ½æ˜¯å€¼ç±»å‹ã€‚</li><li>è¿™äº›ç±»å‹åªæ˜¯åœ¨ç®€å•çš„èµ‹å€¼çš„æ—¶å€™ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸Šéƒ½æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚</li><li>è€Œå½“å‘ç”Ÿä¸€ä¸ªæ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œä»–ä»¬çš„å†…å­˜åœ°å€æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚</li><li>å€¼ç±»å‹åœ¨èµ‹å€¼çš„æ—¶å€™ï¼Œä¼šå°†å‚¨å­˜å…¶ä¸­çš„å€¼ç±»å‹ä¸€å¹¶è¿›è¡Œå¤åˆ¶ï¼Œè€Œå¯¹å…¶ä¸­çš„å¼•ç”¨ç±»å‹ï¼Œåˆ™åªæ˜¯å¤åˆ¶äº†ä¸€ä»½å¼•ç”¨ã€‚</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let myObject = MyObject()</span><br><span class="line">let <span class="selector-tag">a</span> = [myObject]</span><br><span class="line"><span class="selector-tag">var</span> <span class="selector-tag">b</span> = a</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">b</span>.append(myObject)</span><br><span class="line"></span><br><span class="line">myObject<span class="selector-class">.number</span> = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(b[<span class="number">0</span>].number)</span></span> <span class="comment">//100</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(b[<span class="number">1</span>].number)</span></span> <span class="comment">//100</span></span><br></pre></td></tr></table></figure><ul><li>å¤„ç†å¤§é‡æ•°æ®å¹¶ä¸”é¢‘ç¹æ“ä½œå…¶ä¸­çš„å…ƒç´ çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>NSMutableArray</code>ã€<code>NSMutableDictionary</code>ä¼šæ›´å¥½ã€‚</li><li>å¯¹äºå®¹å™¨å†…æ¡ç›®å°‘ã€å®¹å™¨æœ¬èº«æ•°ç›®å¤šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>Array</code>ã€<code>Dictionary</code></li></ul><hr><ul><li><code>swift</code>ç‰ˆæœ¬é…åˆ<code>range</code>çš„ä½¿ç”¨ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let levels = <span class="string">"ABCDE"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let nsRange = NSMakeRange(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">((levels as NSString)</span></span>.replacingCharacters(<span class="keyword">in</span>: nsRange, with: <span class="string">"AAAA"</span>))</span><br><span class="line"></span><br><span class="line">let indexPositionOne = levels<span class="selector-class">.characters</span><span class="selector-class">.index</span>(levels<span class="selector-class">.startIndex</span>, offsetBy: <span class="number">1</span>)</span><br><span class="line">let swiftRange = indexPositionOne ..&lt; levels<span class="selector-class">.characters</span><span class="selector-class">.index</span>(levels<span class="selector-class">.startIndex</span>, offsetBy: <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(levels.replacingCharacters(in: swiftRange, with: <span class="string">"AAAA"</span>)</span></span>)</span><br></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;code&gt;final&lt;/code&gt;ä¿®é¥°çš„&lt;code&gt;class&lt;/code&gt;/&lt;code&gt;func&lt;/code&gt;/&lt;code&gt;var&lt;/code&gt;,è¡¨ç¤ºå†…å®¹ä¸å…è®¸è¿›è¡Œç»§æ‰¿æˆ–è€…é‡å†™&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;lazy&lt;/code&gt;ç®€å•èµ‹å€¼ï¼š&lt;code&gt;lazy var str1: String = &amp;quot;Hello&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lazy&lt;/code&gt;è®¡ç®—èµ‹å€¼ï¼š&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swift" scheme="http://www.ghcoder.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä¹ Swift Tips(äºŒ)</title>
    <link href="http://www.ghcoder.com/2017/09/08/20170908/"/>
    <id>http://www.ghcoder.com/2017/09/08/20170908/</id>
    <published>2017-09-08T02:53:12.000Z</published>
    <updated>2017-09-13T06:47:06.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li>åœ¨ä»‹ç»ï¼ˆTupleï¼‰çš„æ—¶å€™ï¼Œè¯´äº†äº¤æ¢è¾“å…¥çš„æ–¹æ³•ä¹¦å†™ï¼Œåœ¨Object-Cä¸­ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæˆ‘ä»¬ä¼ å…¥çš„æ˜¯æŒ‡é’ˆï¼Œè¿™ä¸ªé—®é¢˜ä¸»è¦çš„æ¥æºå°±æ˜¯å› ä¸ºå—åˆ¶çº¦Cè¯­è¨€ï¼Œå•ä¸€è¿”å›ï¼Œæœ‰äº†Tupleçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿çš„è°ƒç”¨äº†ã€‚</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let rect = CGRect(<span class="string">x:</span> <span class="number">0</span>, <span class="string">y:</span> <span class="number">0</span>, <span class="string">width:</span> <span class="number">100</span>, <span class="string">height:</span> <span class="number">100</span>)</span><br><span class="line">let (small, large) = rect.divided(<span class="string">atDistance:</span> <span class="number">20</span>, <span class="string">from:</span> .minXEdge)</span><br></pre></td></tr></table></figure><a id="more"></a><hr><ul><li>åœ¨å†™swiftçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å’ŒOptionalæ‰“äº¤é“ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¸¸å¸¸ç”¨åˆ°è§£åŒ…ï¼Œè¿™é‡Œå°±æåˆ°äº†ä¸€ä¸ªå¿«é€Ÿè§£åŒ…çš„æ–¹å¼<code>??</code>,é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ï¼š</li></ul><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> lev<span class="symbol">el:</span> <span class="built_in">Int</span>?</span><br><span class="line"><span class="built_in">var</span> startLevel = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">var</span> currentLevel = level ?? startLevel</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œå¾ˆç®€å•ï¼Œä½†æ˜¯è¿˜æ˜¯è¦è¯´ä¸€ä¸‹ï¼Œè¿™é‡Œçš„<code>??</code>åˆ¤æ–­å·¦è¾¹çš„å€¼ï¼Œå¦‚æœæ˜¯énilçš„<code>optional</code>çš„å€¼ï¼Œé‚£å°±ç›´æ¥è¿”å›å·¦è¾¹çš„valueå€¼ï¼Œå¦åˆ™å°±è¿”å›å³è¾¹çš„å€¼,ä½†æ˜¯ç»†ç»†å¾€ä¸‹çœ‹ä¸€ä¸‹æºç çš„å®šä¹‰ä¼šå‘ç°ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> ??&lt;T&gt;<span class="params">(<span class="keyword">optional</span>: T?, defaultValue: @autoclosure <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> ??&lt;T&gt;<span class="params">(<span class="keyword">optional</span>: T?, defaultValue: @autoclosure <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>?) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span>?</span><br></pre></td></tr></table></figure><ul><li>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘å°±æœ‰ç‚¹ç–‘æƒ‘äº†ï¼Œè¿™ä¸ª<code>??</code>å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<code>å‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸ºä»€ä¹ˆé‚£ä¹ˆå¦ç±»å‘¢ï¼Ÿ</code>,æŒ‰ç…§æˆ‘ä»¬çš„ç†è§£ï¼Œè¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸åº”è¯¥æ˜¯è¿™æ ·çš„å—ï¼Ÿ<code>??(optional, xxx)</code>,ä½†æ˜¯å‘ç°è¿™æ ·å†™ï¼Œä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å°±å†³å®šæŠŠå‡½æ•°çš„å®šä¹‰ç›´æ¥copyä¸‹æ¥ï¼Œç„¶åè‡ªå·±å»å®ç°ï¼Œå¸¦å…¥å¦‚ä¸‹ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">th</span>&lt;T&gt;<span class="params">(<span class="number">_</span> <span class="keyword">optional</span>: T?, <span class="number">_</span> defaultValue: @autoclosure <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="keyword">optional</span> = <span class="keyword">optional</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">optional</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> defaultValue()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> level: <span class="type">Int</span>?</span><br><span class="line"><span class="keyword">var</span> startLevel = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test = th(level, startLevel)</span><br></pre></td></tr></table></figure><ul><li>çœ‹åˆ°è¿™é‡Œæˆ‘å°±å¼€å§‹çŒœæµ‹äº†ï¼Œè¿™æˆ–è®¸æ˜¯<code>swift</code>ä¸ºäº†æ–¹ä¾¿çš„æˆ‘ä»¬çš„è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒåˆå®šä¹‰äº†ä¸€ä¸ªè¯­æ³•ç³–å§ï¼</li></ul><hr><ul><li>@autoclosure ç¬¦å·çš„æ„æ€ï¼Œå°±æ˜¯ç›´æ¥å°†ï¼šå…¥å‚T è½¬åŒ–ä¸º ()-&gt;T</li></ul><hr><ul><li>@escaping ç¬¦å·çš„æ„æ€å°±æ˜¯è¯´æ˜ï¼Œè¿™ä¸ªå‚æ•°æ˜¯å¼‚æ­¥çš„ï¼Œä¸æ˜¯å±äºè¿™ä¸ªå±€éƒ¨çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åå†æ‰§è¡Œè¿™é‡Œçš„å›è°ƒï¼Œä¸åŠ ä»»ä½•å‚æ•°çš„blocké»˜è®¤å°±æ˜¯åŒæ­¥çš„ï¼Œå‡½æ•°æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œè¿™ä¸ªblockå°±ä¼šè¢«æ”¶å›ã€‚</li></ul><hr><ul><li>optional Chaining å¦‚æœæŸä¸ªå±æ€§æ˜¯nilçš„è¯ï¼Œä¼šæå‰è¿”å›å›æ¥ã€‚</li></ul><hr><ul><li>é‡è½½ç¬¦å·çš„åšæ³•ï¼Œç”¨çš„æ¯”è¾ƒå°‘ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">precedencegroup <span class="type">DotProductPrecedence</span> &#123;</span><br><span class="line">    <span class="keyword">associativity</span>: <span class="keyword">none</span></span><br><span class="line">    higherThan: <span class="type">MultiplicationPrecedence</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">infix</span> <span class="keyword">operator</span> +*: <span class="type">DotProductPrecedence</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> +*<span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">left</span>.x * <span class="keyword">right</span>.x + <span class="keyword">left</span>.y * <span class="keyword">right</span>.y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>å¤–éƒ¨ä¼ å…¥çš„å‚æ•°ï¼Œå¦‚æœéœ€è¦åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹çš„è¯ï¼Œéœ€è¦åœ¨å‚æ•°å‰é¢åŠ ä¸Š<code>inout</code>ï¼Œè¿™æ ·ä¼ å…¥å‚æ•°çš„æ—¶å€™ï¼Œå°±éœ€è¦å°†ä¹‹å‰ä¼ å…¥çš„å€¼æ”¹ä¸ºåœ°å€ï¼Œç±»ä¼¼:</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">incrementor</span><span class="params">(variable: <span class="keyword">inout</span> Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">       variable += <span class="number">1</span></span><br><span class="line">       <span class="keyword">return</span> variable</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><hr><ul><li>å­—é¢é‡çš„ä½œç”¨ï¼Œæˆ‘å°±è§‰å¾—å¾ˆé¸¡è‚‹ï¼Œä½†æ˜¯è¿˜æ˜¯çœ‹ä¸€ä¸‹ï¼Œè¯´ç™½äº†ï¼Œå­—é¢é‡çš„æ„æ€å°±æ˜¯è¯´ï¼š<code>å¯åŒç›´æ¥å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œä¼ å…¥ä¸€ä¸ªStringã€Intã€Bool, è€Œè¿”å›çš„ç¡®å®æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹</code>ï¼Œä¾‹å¦‚ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">ExpressibleByStringLiteral</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(name value: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(stringLiteral value: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name: value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(extendedGraphemeClusterLiteral value: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name: value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(unicodeScalarLiteral value: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name: value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> p: <span class="type">Person</span> = <span class="string">"xiaoming"</span></span><br><span class="line"> <span class="built_in">print</span>(p.name)</span><br></pre></td></tr></table></figure><hr><ul><li>æ•°ç»„ä¸‹æ ‡è¯´å®è¯ï¼Œè¿˜æ˜¯è›®ä¸é”™çš„å†…å®¹ï¼Œç”¨çš„å¥½çš„è¯ï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šçš„æ—¶é—´ï¼Œé€šè¿‡å¯¹ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•å†™ä¸€ä¸‹æ‹“å±•ï¼Œå°±å¯ä»¥å®ç°è‡ªå®šä¹‰çš„ä¸‹æ ‡åŠŸèƒ½ï¼š</li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> subscript(<span class="built_in">index</span>: <span class="built_in">Int</span>) -&gt; Element</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> subscript(bounds: <span class="built_in">Range</span>&lt;<span class="built_in">Int</span>&gt;) -&gt; ArraySlice&lt;Element&gt;</span><br></pre></td></tr></table></figure><ul><li>onvcate çš„ä¾‹å­ä¸­ä¸¾å‡ºäº†ä¸‹é¢çš„ä¾‹å­ï¼Œæ–¹ä¾¿æˆ‘ä»¬é€šè¿‡ä¸‹æ ‡æ¥è·å–æ•°ç»„çš„æ•°æ®ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(arr[[<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>]])</span></span></span><br><span class="line">arr[[<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>]] = [-<span class="number">1</span>, -<span class="number">3</span>, -<span class="number">4</span>]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(arr)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extension Array &#123;</span><br><span class="line"></span><br><span class="line">    subscript(<span class="selector-tag">input</span>: [Int]) -&gt; ArraySlice&lt;Element&gt; &#123;</span><br><span class="line">        get&#123;</span><br><span class="line">            <span class="selector-tag">var</span> result = ArraySlice&lt;Element&gt;()</span><br><span class="line">            <span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">                assert(<span class="selector-tag">i</span> &lt; self<span class="selector-class">.count</span>, <span class="string">"Index out of range"</span>)</span><br><span class="line">                result.append(self[i])</span><br><span class="line">            &#125;</span><br><span class="line">            return result</span><br><span class="line">        &#125;</span><br><span class="line">        set&#123;</span><br><span class="line">            <span class="keyword">for</span>(index,i) <span class="keyword">in</span> <span class="selector-tag">input</span>.enumerated() &#123;</span><br><span class="line">                assert(<span class="selector-tag">i</span> &lt; self<span class="selector-class">.count</span>, <span class="string">"Index out of range"</span>)</span><br><span class="line">                self[i] = newValue[index]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸‹é¢ä½œè€…ä¹Ÿè¯´äº†ï¼Œè¿™ä¸ªæ–¹å¼è°ƒç”¨èµ·æ¥ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œç„¶åå°±æœ‰äº†ä¸‹é¢çš„æ‹“å±•ï¼Œæ˜¯æˆ‘è‡ªå·±å†™çš„ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">subscript</span>(first: <span class="type">Int</span>, second: <span class="type">Int</span>, other: <span class="type">Int</span>...) -&gt; <span class="type">ArraySlice</span>&lt;<span class="type">Element</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="type">ArraySlice</span>&lt;<span class="type">Element</span>&gt;()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> first &lt; <span class="keyword">self</span>.<span class="built_in">count</span> &#123;</span><br><span class="line">                result.append(<span class="keyword">self</span>[first])</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> second &lt; <span class="keyword">self</span>.<span class="built_in">count</span> &#123;</span><br><span class="line">                result.append(<span class="keyword">self</span>[second])</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> other &#123;</span><br><span class="line">                <span class="built_in">assert</span>(i &lt; <span class="keyword">self</span>.<span class="built_in">count</span>, <span class="string">"Index out of range"</span>)</span><br><span class="line">                result.append(<span class="keyword">self</span>[i])</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> tempDatas = other.<span class="built_in">count</span> &gt; <span class="number">0</span> ? other : [<span class="type">Int</span>]()</span><br><span class="line">            <span class="keyword">if</span> (first &lt; <span class="keyword">self</span>.<span class="built_in">count</span>) &#123;</span><br><span class="line">                tempDatas.append(first)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (second &lt; <span class="keyword">self</span>.<span class="built_in">count</span>) &#123;</span><br><span class="line">                tempDatas.append(second)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(index,i) <span class="keyword">in</span> tempDatas.enumerated() &#123;</span><br><span class="line">                <span class="built_in">assert</span>(i &lt; <span class="keyword">self</span>.<span class="built_in">count</span>, <span class="string">"Index out of range"</span>)</span><br><span class="line">                <span class="keyword">self</span>[i] = newValue[index]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="built_in">print</span>( t[<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">t[<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>] = [<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>]</span><br><span class="line"><span class="built_in">print</span>(t)</span><br></pre></td></tr></table></figure><hr><ul><li>å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘ï¼Œå°±æ˜¯ä½ å¯ä»¥æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›å€¼ï¼Œæˆ–è€…å¯ä»¥åœ¨å‡½æ•°ä¸­å®šä¹‰ä»»æ„å¤šä¸ªå‡½æ•°ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ§åˆ¶ä»£ç çš„è®¿é—®æƒé™çš„é—®é¢˜ã€‚</li></ul><hr><ul><li>åœ¨ä¸åŒçš„target(ä¸€ä¸ªå«<code>GG</code>,ä¸€ä¸ªå«<code>HH</code>)ä¸­ï¼Œè°ƒç”¨åŒä¸€ä¸ªç±»çš„ï¼ŒåŒä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>My</code>çš„ç±»ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€ä¸ª<code>hello</code>çš„ç±»æ–¹æ³•:</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GG<span class="selector-class">.My</span><span class="selector-class">.hello</span>()</span><br><span class="line">HH<span class="selector-class">.My</span><span class="selector-class">.hello</span>()</span><br></pre></td></tr></table></figure><hr><ul><li>typealias é™¤äº†ç”¨åœ¨ç»™å˜é‡ã€å®ä¾‹ã€å±æ€§å®šä¹‰åˆ«åå¤–ï¼Œè¿˜å¯ä»¥ç”¨åœ¨åè®®ä¸Šï¼Œæˆ‘è®¤ä¸ºè¿™æ ·çš„ç”¨æˆ·å¾ˆå¤§:</li></ul><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">protocol <span class="keyword">Cat</span> &#123;&#125;</span><br><span class="line"><span class="keyword">protocol</span> <span class="keyword">Dog</span> &#123;&#125;</span><br><span class="line"><span class="keyword">typealias</span> <span class="keyword">Pat</span> = Cat &amp; Dog</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">Pat</span> &#123;&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>å¦‚æœæƒ³å¯¹åè®®æ·»åŠ é™å®šçš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ª<code>associatedtype xx</code>,è¿™æ ·åœ¨éµå¾ªäº†åè®®çš„æ—¶å€™ï¼Œå°±éœ€è¦åˆ¶å®šæˆ‘ä»¬typeçš„ç±»å‹ï¼Œè¿™å°±å’Œä¹‹å‰çœ‹å®˜æ–¹<code>Array</code>å®šä¹‰çš„æ•ˆæœåŒ»é™¢ï¼Œéœ€è¦æˆ‘ä»¬åˆ¶å®šç±»å‹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæ›´å¥½çš„é™åˆ¶éµå¾ªåè®®çš„å¯¹è±¡ã€‚</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">F</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">eat</span><span class="params">(<span class="number">_</span> food: F)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Meat</span>: <span class="title">Food</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Crass</span>: <span class="title">Food</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tiger</span>: <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">F</span> = <span class="type">Meat</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">eat</span><span class="params">(<span class="number">_</span> food: Meat)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"eat \(food)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬è¿™æ ·é™åˆ¶äº†åè®®ä¹‹åï¼Œåœ¨è¿›è¡Œç‹¬ç«‹åˆ¤æ–­çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¸èƒ½åƒä¹‹å‰é‚£æ ·ç›´æ¥è¿›è¡Œåˆ¤æ–­äº†ï¼Œä¾‹å¦‚ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isDangerous</span><span class="params">(animal: Animal)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> animal <span class="keyword">is</span> <span class="type">Tiger</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œé”™è¯¯çš„åŸå› ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œé™åˆ¶åè®®ä¸­çš„typeç±»å‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æŒ‰ç…§æ³›å‹çš„ç±»å‹æ¥ä¹¦å†™äº†ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isDangerous</span>&lt;T: Animal&gt;<span class="params">(animal: T)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> animal <span class="keyword">is</span> <span class="type">Tiger</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>å¯å˜å‚æ•°çš„è°ƒç”¨ï¼Œä¸é™åˆ¶åœ¨æŒ‡å®šå“ªä¸ªä½ç½®ï¼Œæ¥å—å¯å˜å‚æ•°çš„å‡½æ•°å†…éƒ¨ï¼ŒæŠŠå¯å˜å‚æ•°çœ‹ä½œæ˜¯å¯¹åº”æ•°æ®çš„æ•°ç»„ï¼Œä½†æ˜¯æ¯ä¸ªå‡½æ•°åªèƒ½æ¥å—ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œå¹¶ä¸”å¯å˜å‚æ•°çš„ç±»å‹å¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚</li></ul><hr><ul><li>æ–¹æ³•çš„è°ƒç”¨é¡ºåºé—®é¢˜:</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: String</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        name = <span class="string">"cat"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tiger</span>: <span class="type">Cat &#123;</span></span></span><br><span class="line">    let power: <span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        power = <span class="number">10</span></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        name = <span class="string">"gh"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç±»åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¿…é¡»è¦ä¿è¯è¯¥ç±»çš„æ‰€æœ‰æˆå‘˜éƒ½å®Œæˆäº†åˆå§‹åŒ–ã€‚</li><li>å­˜åœ¨ç»§æ‰¿å…³ç³»çš„ç±»ï¼Œå¿…é¡»è¦ç¡®ä¿å½“å‰å­ç±»å®ä¾‹çš„æ‰€æœ‰æˆå‘˜å®Œæˆåˆå§‹åŒ–åæ‰ä¼šè°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</li><li>å¯ä»¥æ˜¾ç¤ºçš„è°ƒç”¨<code>super.init()</code>ï¼Œå¦‚æœä¸æ˜¾ç¤ºçš„è°ƒç”¨çš„<code>super.init()</code>çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬å®Œæˆå­ç±»çš„å®ä¾‹åŒ–æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªå·±è°ƒç”¨<code>super.init()</code>,å½“ç„¶å¦‚æœå­˜åœ¨å¤å†™çš„æƒ…å†µçš„è¯ï¼Œè¿˜æ˜¯éœ€è¦æ˜¾ç¤ºçš„è°ƒç”¨çš„ã€‚</li></ul><hr><ul><li>Designatedã€Convenienceã€Required ä½¿ç”¨æ³¨æ„ç‚¹ï¼š</li></ul><ol><li>Swiftçš„<code>init</code>åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè€Œä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥å¯¹letå±æ€§å˜é‡è¿›è¡Œèµ‹å€¼ã€‚</li><li>åœ¨<code>init</code>å‰é¢åŠ äº†<code>convenience</code>çš„åˆå§‹åŒ–æ–¹æ³•å¿…é¡»è°ƒç”¨åŒä¸€ä¸ªç±»çš„<code>init</code>çš„æ–¹æ³•ã€‚</li><li><code>convenience</code>çš„å®ä¾‹åŒ–æ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼Œå¹¶ä¸”ä¹Ÿä¸èƒ½å¤Ÿè¢«å­ç±»é€šè¿‡<code>super</code>çš„æ–¹å¼è°ƒç”¨ã€‚</li><li>åªè¦å­ç±»é‡å†™äº†<code>convenience</code>æ–¹æ³•æ‰€éœ€çš„<code>init</code>çš„æ–¹æ³•åï¼Œå­ç±»å°±å¯ä»¥ä½¿ç”¨<code>convenience</code>çš„åˆå§‹åŒ–æ–¹æ³•ã€‚</li><li>å½“å­ç±»å«æœ‰å¼‚äºçˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•æ—¶ï¼ˆåˆå§‹åŒ–æ–¹æ³•å‚æ•°ç±»å‹å’Œæ•°é‡å¼‚äºçˆ¶ç±»ï¼‰ï¼Œå­ç±»å¿…é¡»è¦å®ç°çˆ¶ç±»çš„requiredåˆå§‹åŒ–æ–¹æ³•ï¼Œå¹¶ä¸”ä¹Ÿè¦ä½¿ç”¨requiredä¿®é¥°ç¬¦è€Œä¸æ˜¯overrideã€‚</li><li>å½“å­ç±»æ²¡æœ‰åˆå§‹åŒ–æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä¸ç”¨å®ç°çˆ¶ç±»çš„requiredåˆå§‹åŒ–æ–¹æ³•ã€‚</li></ol><hr><ul><li>å¯¹äºå¯ä»¥è¿”å›nilçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>init?(xxx)</code>ï¼ŒåŠ å…¥<code>?</code></li></ul><hr><ul><li>å¦‚æœæƒ³åœ¨protocol é‡Œå®šä¹‰ä¸€ä¸ªç±»å‹åŸŸä¸Šçš„æ–¹æ³•æˆ–è€…è®¡ç®—å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®šä¹‰çš„æ—¶å€™ç”¨<code>static</code>è¿›è¡Œå®šä¹‰ã€‚</li></ul><hr><ul><li>åœ¨Swiftä¸­çš„é›†åˆç±»å‹ï¼Œåœ¨å®šä¹‰ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å°†åŒä¸€ç§ç±»å‹çš„æ•°æ®å­˜æ”¾åœ¨é›†åˆä¸­ï¼Œä½†æ˜¯å¦‚æœç±»å‹ä¸åŒå‘¢ï¼Ÿæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Any ç±»å‹å¯ä»¥éšå¼è½¬åŒ–</span></span><br><span class="line"><span class="keyword">let</span> mixed: [CustomStringConvertible] = [<span class="number">1</span>, <span class="string">"two"</span>, <span class="literal">false</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬åŒ–ä¸º[NSObject]</span></span><br><span class="line"><span class="keyword">let</span> objectArray = [<span class="number">1</span> <span class="keyword">as</span> NSObject, <span class="string">"two"</span> <span class="keyword">as</span> NSObject, <span class="literal">false</span> <span class="keyword">as</span> NSObject]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">any</span> = mixed[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nsObject = objectArray[<span class="number">2</span>]</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·å­˜å‚¨æ˜¯æ²¡å•¥é—®é¢˜çš„ï¼Œä½†æ˜¯ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¯èƒ½æ•°æ®ä¼šéƒ¨åˆ†ä¸¢å¤±ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸å»ºè®®çš„ï¼Œå› ä¸ºæ—¢ç„¶ä½ èƒ½å­˜æ”¾åœ¨åŒä¸€ä¸ªé›†åˆä¸­ï¼Œé‚£è¿™äº›å…ƒç´ ï¼Œå°±åº”è¯¥å­˜åœ¨ä¸€å®šçš„å…±åŒç‚¹ã€‚</li></ul><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">IntOrString</span> &#123;</span></span><br><span class="line">    <span class="keyword">case</span> IntValue(Int)</span><br><span class="line">    <span class="keyword">case</span> StringValue(String)</span><br><span class="line">    <span class="keyword">case</span> BoolValue(Bool)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let mixed = [IntOrString.IntValue(<span class="number">1</span>), IntOrString.StringValue(<span class="string">"two"</span>), IntOrString.BoolValue(<span class="literal">false</span>)]</span><br></pre></td></tr></table></figure><hr><ul><li>é»˜è®¤å‚æ•°å¯ä»¥åœ¨ä»»æ„çš„ä½ç½®:</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">func</span> sayHello1(<span class="keyword">str1: </span><span class="keyword">String </span>= <span class="string">"Hello"</span>, <span class="keyword">str2: </span><span class="keyword">String, </span><span class="keyword">str3: </span><span class="keyword">String) </span>&#123;</span><br><span class="line">    print(<span class="keyword">str1 </span>+ <span class="keyword">str2 </span>+ <span class="keyword">str3)</span></span><br><span class="line"><span class="keyword">&#125;</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">func </span>sayHello2(<span class="keyword">str1: </span><span class="keyword">String, </span><span class="keyword">str2: </span><span class="keyword">String, </span><span class="keyword">str3: </span><span class="keyword">String </span>= <span class="string">"World"</span>) &#123;</span><br><span class="line">    print(<span class="keyword">str1 </span>+ <span class="keyword">str2 </span>+ <span class="keyword">str3)</span></span><br><span class="line"><span class="keyword">&#125;</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">sayHello1(str2: </span><span class="string">" "</span>, <span class="keyword">str3: </span><span class="string">"World"</span>)</span><br><span class="line"><span class="symbol">sayHello2</span>(<span class="keyword">str1: </span><span class="string">"Hello"</span>, <span class="keyword">str2: </span><span class="string">" "</span>)</span><br></pre></td></tr></table></figure><hr><ul><li>swift ä¸­æ²¡æœ‰ä¸“é—¨çš„ç”¨æ¥æ­£åˆ™åŒ¹é…çš„ä¸œè¥¿ï¼Œä½†æ˜¯å›´ç»•<code>NSRegularExpression</code>ä¹Ÿæ˜¯å¯ä»¥åœ¨swiftä¸Šåšä¸€ä¸‹æ‹“å±•:</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RegexHelper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> regex: <span class="type">NSRegularExpression</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> pattern: <span class="type">String</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> regex = <span class="type">NSRegularExpression</span>(pattern: pattern, options: .caseInsensitive)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">match</span><span class="params">(<span class="number">_</span> input: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> matches = regex.matches(<span class="keyword">in</span>: input,</span><br><span class="line">                                    options: [],</span><br><span class="line">                                    range: <span class="type">NSMakeRange</span>(<span class="number">0</span>, input.utf16.<span class="built_in">count</span>))</span><br><span class="line">        <span class="keyword">return</span> matches.<span class="built_in">count</span> &gt; <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mailPattern = <span class="string">"^([a-z0-9\\.-]+)@([\\da-z\\.-]+)\\.([a-z\\.]&#123;2,6&#125;)$"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> matcher: <span class="type">RegexHelper</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    matcher = <span class="keyword">try</span> <span class="type">RegexHelper</span>(mailPattern)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> maybeMailAddress = <span class="string">"onev@onevcat.com"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> matcher.match(maybeMailAddress) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"æœ‰æ•ˆçš„é‚®ç®±åœ°å€"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><code>...</code>(é—­åŒºé—´)å’Œ<code>..&lt;</code>(å¼€åŒºé—´)ï¼Œé™¤äº†å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ•°å­—ç±»å‹çš„èŒƒå›´å¤–ï¼Œè¿˜æ˜¯å¯ä»¥ç”Ÿæˆå­—ç¬¦ä¸²å’ŒASCIIç¼–ç ï¼š</li></ul><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> interval = <span class="string">"a"</span>...<span class="string">"z"</span></span><br><span class="line"><span class="keyword">let</span> xx = \<span class="number">0.</span>..~</span><br></pre></td></tr></table></figure><hr><ul><li>ä»»æ„çš„ç±»å‹æœ‰ï¼š<code>Any/AnyObject/AnyClass</code>, è€Œ <code>typealias AnyClass = AnyObject.Type</code>, <code>.self</code>ç”¨åœ¨ç±»å‹åé¢å–å¾—ç±»å‹æœ¬èº«ï¼Œç”¨åœ¨æŸå®ä¾‹åé¢è¡¨ç¤ºå–å¾—å®ä¾‹æœ¬äº‹</li><li>é€šè¿‡<code>AnyObject.Type</code>è·å–å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå…ƒç±»å‹ï¼Œ ä¹Ÿå°±æ˜¯<code>AnyClass</code>,è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦è°ƒç”¨<code>.self</code>æ¥è·å–å…ƒç±»ã€‚</li></ul><hr><ul><li>åœ¨åè®®ä¸­è¿”å›å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›<code>Self</code>,è¿™ä¸ªç±»å‹çš„æ„æ€æ˜¯ï¼Œéµå¾ªè¿™ä¸ªåè®®çš„ç±»è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªåŒæ ·éµå¾ªè¯¥åè®®å¹¶ä¸”ç›¸åŒçš„ç±»ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Copyable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">copy</span><span class="params">()</span></span> -&gt; <span class="type">Self</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>: <span class="title">Copyable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> num = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">copy</span><span class="params">()</span></span> -&gt; <span class="type">Self</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> result = type(of: <span class="keyword">self</span>).<span class="keyword">init</span>()</span><br><span class="line">        result.num = num</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·ä¹¦å†™ä¹‹åï¼Œä¸ç®¡æ˜¯<code>MyClass</code>è¿˜æ˜¯<code>MyClass</code>çš„å­ç±»éƒ½å¯ä»¥åŒæ ·é€‚ç”¨è¯¥åè®®æ–¹æ³•ã€‚</li><li>å¹¶ä¸”éœ€è¦ä½¿ç”¨<code>required</code>æ¥å®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼Œç¡®ä¿è¯¥ç±»åŠå…¶å­ç±»éƒ½èƒ½å“åº”è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•ã€‚</li></ul><hr><ul><li>swift æ˜¯ä¸æ”¯æŒåŠ¨æ€æ´¾å‘çš„ï¼Œæ‰€ä»¥ä»–ä¸ä¼šæ ¹æ®ç»§æ‰¿çš„å…³ç³»ï¼Œåœ¨è¿è¡Œæ—¶æ”¹å˜æ–¹æ³•çš„æ‰§è¡Œï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pet</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>: <span class="title">Pet</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>: <span class="title">Pet</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printPet</span><span class="params">(<span class="number">_</span> pet: Pet)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Pet"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printPet</span><span class="params">(<span class="number">_</span> cat: Cat)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Meow"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printPet</span><span class="params">(<span class="number">_</span> dog: Dog)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Bark"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printThem</span><span class="params">(<span class="number">_</span> pet: Pet, <span class="number">_</span> cat: Cat)</span></span> &#123;</span><br><span class="line">    printPet(pet) <span class="comment">// Pet</span></span><br><span class="line">    printPet(cat) <span class="comment">// Meow</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printThem(<span class="type">Dog</span>(), <span class="type">Cat</span>())</span><br></pre></td></tr></table></figure><ul><li>è™½ç„¶æˆ‘è¿™é‡Œä¼ å…¥çš„æ˜¯<code>Dog()</code>çš„å®ä¾‹ï¼Œä½†æ˜¯åœ¨å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å®šä¹‰çš„ç¡®å®å®ƒçš„çˆ¶ç±»ï¼Œæ‰€ä»¥åœ¨å®é™…è°ƒç”¨çš„æ—¶å€™ï¼Œä¸ç®¡ä½ ä¼ å…¥çš„æ˜¯ä»€ä¹ˆï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå°±å·²ç»å†³å®šäº†ï¼Œå‡½æ•°è°ƒç”¨çš„å…¥å‚æ˜¯<code>pet</code>ï¼Œå¦‚æœæƒ³è¦åŒºåˆ†çš„è¯ï¼Œåªèƒ½é€šè¿‡ç±»å‹çš„åˆ¤æ–­å»æ‰§è¡Œï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printThem</span><span class="params">(<span class="number">_</span> pet: Pet, <span class="number">_</span> cat: Cat)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> aCat = pet <span class="keyword">as</span>? <span class="type">Cat</span> &#123;</span><br><span class="line">        printPet(aCat)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> aDog = pet <span class="keyword">as</span>? <span class="type">Dog</span> &#123;</span><br><span class="line">        printPet(aDog)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printPet(cat)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li>å±æ€§çš„ç›‘å¬åœ¨<code>willSet</code>æ˜¯å°†<code>date</code>-&gt;<code>newValue</code>, è€Œ<code>didSet</code>æ˜¯ä»<code>oldValue</code>-&gt;<code>date</code>ã€‚</li><li>åŸºæœ¬ä¸Šåœ¨åŒä¸€ä¸ªç±»ä¸­å¯¹åŒä¸€ä¸ªå±æ€§å€¼ï¼Œä¸å¯èƒ½å­˜åœ¨<code>set</code>/<code>willSet</code>/<code>didSet</code>, ä½†æ˜¯å¦‚æœå¤å†™çˆ¶ç±»çš„å±æ€§å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶å®ç°ä¸‰ä¸ªå±æ€§å€¼ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> number: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"get"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"set"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>: <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> number: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123; <span class="built_in">print</span>(<span class="string">"willset"</span>) &#125;</span><br><span class="line">        <span class="keyword">didSet</span>  &#123; <span class="built_in">print</span>(<span class="string">"didSet"</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="type">B</span>()</span><br><span class="line">b.number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line"><span class="comment">// willSet</span></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line"><span class="comment">// didSet</span></span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œé¦–å…ˆæ‰“å°<code>get</code>,æ˜¯å› ä¸ºè¿™é‡Œå®ç°äº†<code>didSet</code>,åœ¨<code>didSet</code>ä¸­ç”¨åˆ°äº†<code>oldValue</code>, è€Œè¿™ä¸ªå€¼éœ€è¦åœ¨æ•´ä¸ªsetåŠ¨ä½œä¹‹å‰è¿›è¡Œè·å–å¹¶å­˜å‚¨ä»£ç”¨ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;åœ¨ä»‹ç»ï¼ˆTupleï¼‰çš„æ—¶å€™ï¼Œè¯´äº†äº¤æ¢è¾“å…¥çš„æ–¹æ³•ä¹¦å†™ï¼Œåœ¨Object-Cä¸­ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæˆ‘ä»¬ä¼ å…¥çš„æ˜¯æŒ‡é’ˆï¼Œè¿™ä¸ªé—®é¢˜ä¸»è¦çš„æ¥æºå°±æ˜¯å› ä¸ºå—åˆ¶çº¦Cè¯­è¨€ï¼Œå•ä¸€è¿”å›ï¼Œæœ‰äº†Tupleçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿çš„è°ƒç”¨äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;let rect = CGRect(&lt;span class=&quot;string&quot;&gt;x:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;y:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;width:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;height:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;let (small, large) = rect.divided(&lt;span class=&quot;string&quot;&gt;atDistance:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;from:&lt;/span&gt; .minXEdge)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swift" scheme="http://www.ghcoder.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä¹ Masonry Autolayoutå¸ƒå±€å®ä¾‹</title>
    <link href="http://www.ghcoder.com/2017/09/07/20170907/"/>
    <id>http://www.ghcoder.com/2017/09/07/20170907/</id>
    <published>2017-09-07T03:33:12.000Z</published>
    <updated>2017-09-07T08:04:51.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æœ€è¿‘çœ‹åˆ°å¾ˆå¤šäººéƒ½åœ¨è½¬ä¸€ç¯‡åšå®¢ï¼Œåšå®¢çš„é“¾æ¥ä¸ºï¼š-http-tutuge-me-2015-05-23-autolayout-example-with-masonry-å…¶å®æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œé‡ç‚¹å°±æ˜¯è®²å¦‚ä½•è¿ç”¨Masonryæ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ç¯‡æ–‡ç« å¾ˆä½¿ç”¨ï¼Œæˆ‘åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œå¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹ä»–çš„å››ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼š"><a href="#æœ€è¿‘çœ‹åˆ°å¾ˆå¤šäººéƒ½åœ¨è½¬ä¸€ç¯‡åšå®¢ï¼Œåšå®¢çš„é“¾æ¥ä¸ºï¼š-http-tutuge-me-2015-05-23-autolayout-example-with-masonry-å…¶å®æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œé‡ç‚¹å°±æ˜¯è®²å¦‚ä½•è¿ç”¨Masonryæ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ç¯‡æ–‡ç« å¾ˆä½¿ç”¨ï¼Œæˆ‘åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œå¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹ä»–çš„å››ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼š" class="headerlink" title="æœ€è¿‘çœ‹åˆ°å¾ˆå¤šäººéƒ½åœ¨è½¬ä¸€ç¯‡åšå®¢ï¼Œåšå®¢çš„é“¾æ¥ä¸ºï¼š[http://tutuge.me/2015/05/23/autolayout-example-with-masonry/], å…¶å®æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œé‡ç‚¹å°±æ˜¯è®²å¦‚ä½•è¿ç”¨Masonryæ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ç¯‡æ–‡ç« å¾ˆä½¿ç”¨ï¼Œæˆ‘åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œå¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹ä»–çš„å››ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼š"></a>æœ€è¿‘çœ‹åˆ°å¾ˆå¤šäººéƒ½åœ¨è½¬ä¸€ç¯‡åšå®¢ï¼Œåšå®¢çš„é“¾æ¥ä¸ºï¼š[<a href="http://tutuge.me/2015/05/23/autolayout-example-with-masonry/]" target="_blank" rel="noopener">http://tutuge.me/2015/05/23/autolayout-example-with-masonry/]</a>, å…¶å®æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œé‡ç‚¹å°±æ˜¯è®²å¦‚ä½•è¿ç”¨Masonryæ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ç¯‡æ–‡ç« å¾ˆä½¿ç”¨ï¼Œæˆ‘åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œå¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹ä»–çš„å››ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼š</h4><ul><li>ç¬¬ä¸€éƒ¨åˆ†é‡ç‚¹è®²çš„æ˜¯ä¸¤ä¸ªå±æ€§: <code>Content Compression Resistance</code>ã€<code>Content Hugging</code>,è¿™é‡Œæˆ‘è§‰å¾—ä½œè€…çš„è§£é‡Šè¿˜æ˜¯å½¢è±¡çš„ï¼š</li></ul><a id="more"></a><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Content Compression Resistance = ä¸è®¸æŒ¤æˆ‘</span><br><span class="line">å€¼è¶Šé«˜ï¼Œå†…å®¹è¶Šä¸å®¹æ˜“è¢«å‹ç¼©</span><br><span class="line">å½“å†…å®¹æ”¾ä¸ä¸‹çš„æ—¶å€™ï¼Œä¼˜å…ˆæŒ¤å‹é‚£äº›ä¼˜å…ˆçº§ä½çš„å…ƒç´ </span><br><span class="line"></span><br><span class="line">Content Hugging = æŠ±ç´§</span><br><span class="line">å­å…ƒç´ è®¾ç½®çš„å±æ€§å€¼è¶Šé«˜ï¼Œå­å…ƒç´ è¶Šä¸ä¼šéšç€çˆ¶è§†å›¾çš„å˜åŒ–è€Œå˜åŒ–</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®label1çš„content hugging ä¸º1000</span></span><br><span class="line">[_label1 setContentHuggingPriority:<span class="built_in">UILayoutPriorityRequired</span></span><br><span class="line">                               forAxis:<span class="built_in">UILayoutConstraintAxisHorizontal</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®label1çš„content compression ä¸º1000</span></span><br><span class="line">[_label1 setContentCompressionResistancePriority:<span class="built_in">UILayoutPriorityRequired</span></span><br><span class="line">                                             forAxis:<span class="built_in">UILayoutConstraintAxisHorizontal</span>];</span><br></pre></td></tr></table></figure><ul><li>å±…ä¸­æ˜¾ç¤ºå››ä¸ªå…ƒç´ :</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">UIView __block *lastView = nil;</span><br><span class="line"> MASConstraint __block *widthConstraint = nil;</span><br><span class="line"> NSUInteger arrayCount = _imageViews.count;</span><br><span class="line"> [_imageViews enumerateObjectsUsingBlock:^(UIView *<span class="built_in">view</span>, NSUInteger idx, <span class="keyword">BOOL</span> *<span class="keyword">stop</span>) &#123;</span><br><span class="line">     [<span class="built_in">view</span> mas_makeConstraints:^(MASConstraintMaker *<span class="built_in">make</span>) &#123;</span><br><span class="line">         <span class="comment">//å®½é«˜å›ºå®š</span></span><br><span class="line">         widthConstraint = <span class="built_in">make</span>.width.equalTo(<span class="comment">@(imageViewSize.width));</span></span><br><span class="line"><span class="comment">         make.height.equalTo(@</span>(imageViewSize.height));</span><br><span class="line">         <span class="comment">//å·¦è¾¹çº¦æŸ</span></span><br><span class="line">         <span class="built_in">make</span>.left.equalTo(lastView ? lastView.mas_right : <span class="built_in">view</span>.superview.mas_left);</span><br><span class="line">         <span class="comment">//å‚ç›´ä¸­å¿ƒå¯¹é½</span></span><br><span class="line">         <span class="built_in">make</span>.centerY.equalTo(<span class="built_in">view</span>.superview.mas_centerY);</span><br><span class="line">         <span class="comment">//è®¾ç½®æœ€å³è¾¹çš„imageViewçš„å³è¾¹ä¸çˆ¶viewçš„æœ€æœ‰å¯¹é½</span></span><br><span class="line">         <span class="keyword">if</span> (idx == arrayCount - <span class="number">1</span>) &#123;</span><br><span class="line">             <span class="built_in">make</span>.right.equalTo(<span class="built_in">view</span>.superview.mas_right);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         [_widthConstraints addObject:widthConstraint];</span><br><span class="line">         lastView = <span class="built_in">view</span>;</span><br><span class="line">     &#125;];</span><br><span class="line"> &#125;];</span><br><span class="line"></span><br><span class="line"> ...</span><br><span class="line"></span><br><span class="line"> <span class="comment">// éšè—å…ƒç´ çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥æ¥ä¿®æ”¹çº¦æŸ</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (sender.on) &#123;</span><br><span class="line">     width.equalTo(<span class="comment">@(IMAGE_SIZE));</span></span><br><span class="line"><span class="comment"> &#125; else &#123;</span></span><br><span class="line"><span class="comment">     width.equalTo(@</span><span class="number">0</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><ul><li>aè§†å›¾æ˜¯bè§†å›¾çš„å€æ•°å…³ç³»çš„ï¼š</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">make</span><span class="selector-class">.width</span><span class="selector-class">.equalTo</span>(_<span class="selector-tag">containerView</span><span class="selector-class">.mas_width</span>)<span class="selector-class">.multipliedBy</span>(0<span class="selector-class">.5</span>);</span><br></pre></td></tr></table></figure><ul><li><p><code>UITableViewCell</code>é«˜åº¦çš„é—®é¢˜ï¼š</p></li><li><p>é¦–å…ˆå¦‚æœæ˜¯åœ¨<code>iOS8ä»¥åŠä»¥åçš„ç‰ˆæœ¬çš„è¯</code>ï¼Œé‚£å°±ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜äº†ï¼Œç›´æ¥ä½¿ç”¨æ–°ç‰¹æ€§</p></li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">_tableView.estimatedRowHeight = <span class="number">80.0</span>f;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#ifdef IOS_8_NEW_FEATURE_SELF_SIZING</span></span><br><span class="line">    <span class="comment">// iOS 8 çš„Self-sizingç‰¹æ€§</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UITableViewAutomaticDimension</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ˜¯åœ¨æ—§ç‰ˆæœ¬<code>iOS7ä¸Šçš„è¯</code>:</li></ul> <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// æ ¹æ®å½“å‰æ•°æ®ï¼Œè®¡ç®—Cellçš„é«˜åº¦ï¼Œæ³¨æ„+1</span></span><br><span class="line">dataEntity.cellHeight = [_templateCell.contentView systemLayoutSizeFittingSize:UILayoutFittingCompressedSize].<span class="built_in">height</span> + <span class="number">0.5</span>f;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—UILabelçš„preferredMaxLayoutWidthå€¼ï¼Œå¤šè¡Œæ—¶å¿…é¡»è®¾ç½®è¿™ä¸ªå€¼ï¼Œå¦åˆ™ç³»ç»Ÿæ— æ³•å†³å®šLabelçš„å®½åº¦</span></span><br><span class="line">    CGFloat preferredMaxWidth = [UIScreen mainScreen].bounds.<span class="built_in">size</span>.<span class="built_in">width</span> - <span class="number">44</span> - <span class="number">4</span> * <span class="number">3</span>; <span class="comment">// 44 = avatarå®½åº¦ï¼Œ4 * 3ä¸ºpadding</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Content - å¤šè¡Œ</span></span><br><span class="line">    _contentLabel.preferredMaxLayoutWidth = preferredMaxWidth; <span class="comment">// å¤šè¡Œæ—¶å¿…é¡»è®¾ç½®</span></span><br></pre></td></tr></table></figure><ul><li><p>ä¸ºäº†é¿å…åœ¨è½¬å±çš„æ—¶å€™ï¼ŒHeaderã€Bottomå·®ä¸€æˆªçš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å¤´ï¼Œå°¾è§†å›¾ä¸éœ€è¦æ ¹æ®çˆ¶è§†å›¾æ¥è®¾å®šçº¦æŸï¼Œè€Œæ˜¯æ ¹æ®<code>topLayoutGuide</code>ã€<code>bottomLayoutGuide</code>æ¥è®¾å®š:</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> [_topView mas_updateConstraints:^(MASConstraintMaker *<span class="built_in">make</span>) &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥åˆ©ç”¨å…¶lengthå±æ€§ï¼Œé¿å…iOSã€SDKç‰ˆæœ¬å‡çº§åtopLayoutGuideä¸å†æ˜¯UIView</span></span><br><span class="line">    <span class="built_in">make</span>.top.equalTo(self.<span class="built_in">view</span>.mas_top).with.offset(self.topLayoutGuide.length);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®æ–°çš„lengthå€¼æ›´æ–°çº¦æŸ</span></span><br><span class="line">[_bottomView mas_updateConstraints:^(MASConstraintMaker *<span class="built_in">make</span>) &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥åˆ©ç”¨å…¶lengthå±æ€§ï¼Œé¿å…iOSã€SDKç‰ˆæœ¬å‡çº§åtopLayoutGuideä¸å†æ˜¯UIView</span></span><br><span class="line">    <span class="built_in">make</span>.bottom.equalTo(self.<span class="built_in">view</span>.mas_bottom).with.offset(-(self.bottomLayoutGuide.length));</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></li><li><p>è‡ªå®šä¹‰<code>baseline</code>çš„å±æ€§å€¼ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// è¿”å›è‡ªå®šä¹‰çš„baselineçš„view</span></span><br><span class="line">- (UIView *)viewForBaselineLayout &#123;</span><br><span class="line">    <span class="keyword">return</span> _baseView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¯æ‹‰ä¼¸çš„<code>UITableView</code></p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="variable">_tableView</span>.contentInset = UIEdgeInsetsMake(ParallaxHeaderHeight, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"> ...</span><br><span class="line"></span><br><span class="line"> - (void)initView &#123;</span><br><span class="line">    <span class="variable">_parallaxHeaderView</span> = [UIImageView new];</span><br><span class="line">    [self.view insertSubview:<span class="variable">_parallaxHeaderView</span> belowSubview:<span class="variable">_tableView</span>];</span><br><span class="line">    <span class="variable">_parallaxHeaderView</span>.contentMode = UIViewContentModeScaleAspectFill;</span><br><span class="line">    <span class="variable">_parallaxHeaderView</span>.<span class="built_in">image</span> = [UIImage imageNamed:@<span class="string">"parallax_header_back"</span>];</span><br><span class="line"></span><br><span class="line">    [<span class="variable">_parallaxHeaderView</span> mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.left.<span class="built_in">and</span>.right.equalTo(self.view);</span><br><span class="line">        make.top.equalTo(self.mas_topLayoutGuideBottom);</span><br><span class="line">        <span class="variable">_parallaxHeaderHeightConstraint</span> = make.height.equalTo(@(ParallaxHeaderHeight));</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add KVO</span></span><br><span class="line">    [<span class="variable">_tableView</span> addObserver:self forKeyPath:@<span class="string">"contentOffset"</span> options:NSKeyValueObservingOptionNew context:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li>KVOçš„å›è°ƒ</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•2ï¼šåˆ©ç”¨KVO</span></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object</span><br><span class="line">                        change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)change</span><br><span class="line">                       context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="keyword">if</span> ([keyPath isEqualToString:<span class="string">@"contentOffset"</span>]) &#123;</span><br><span class="line">        <span class="built_in">CGPoint</span> contentOffset = ((<span class="built_in">NSValue</span> *)change[<span class="built_in">NSKeyValueChangeNewKey</span>]).CGPointValue;</span><br><span class="line">        <span class="keyword">if</span> (contentOffset.y &lt; -ParallaxHeaderHeight) &#123;</span><br><span class="line">            _parallaxHeaderHeightConstraint.equalTo(@(-contentOffset.y));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;æœ€è¿‘çœ‹åˆ°å¾ˆå¤šäººéƒ½åœ¨è½¬ä¸€ç¯‡åšå®¢ï¼Œåšå®¢çš„é“¾æ¥ä¸ºï¼š-http-tutuge-me-2015-05-23-autolayout-example-with-masonry-å…¶å®æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œé‡ç‚¹å°±æ˜¯è®²å¦‚ä½•è¿ç”¨Masonryæ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ç¯‡æ–‡ç« å¾ˆä½¿ç”¨ï¼Œæˆ‘åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œå¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹ä»–çš„å››ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼š&quot;&gt;&lt;a href=&quot;#æœ€è¿‘çœ‹åˆ°å¾ˆå¤šäººéƒ½åœ¨è½¬ä¸€ç¯‡åšå®¢ï¼Œåšå®¢çš„é“¾æ¥ä¸ºï¼š-http-tutuge-me-2015-05-23-autolayout-example-with-masonry-å…¶å®æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œé‡ç‚¹å°±æ˜¯è®²å¦‚ä½•è¿ç”¨Masonryæ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ç¯‡æ–‡ç« å¾ˆä½¿ç”¨ï¼Œæˆ‘åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œå¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹ä»–çš„å››ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼š&quot; class=&quot;headerlink&quot; title=&quot;æœ€è¿‘çœ‹åˆ°å¾ˆå¤šäººéƒ½åœ¨è½¬ä¸€ç¯‡åšå®¢ï¼Œåšå®¢çš„é“¾æ¥ä¸ºï¼š[http://tutuge.me/2015/05/23/autolayout-example-with-masonry/], å…¶å®æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œé‡ç‚¹å°±æ˜¯è®²å¦‚ä½•è¿ç”¨Masonryæ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ç¯‡æ–‡ç« å¾ˆä½¿ç”¨ï¼Œæˆ‘åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œå¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹ä»–çš„å››ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼š&quot;&gt;&lt;/a&gt;æœ€è¿‘çœ‹åˆ°å¾ˆå¤šäººéƒ½åœ¨è½¬ä¸€ç¯‡åšå®¢ï¼Œåšå®¢çš„é“¾æ¥ä¸ºï¼š[&lt;a href=&quot;http://tutuge.me/2015/05/23/autolayout-example-with-masonry/]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://tutuge.me/2015/05/23/autolayout-example-with-masonry/]&lt;/a&gt;, å…¶å®æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œé‡ç‚¹å°±æ˜¯è®²å¦‚ä½•è¿ç”¨Masonryæ¥å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤è¿™ç¯‡æ–‡ç« å¾ˆä½¿ç”¨ï¼Œæˆ‘åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œå¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹ä»–çš„å››ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼š&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€éƒ¨åˆ†é‡ç‚¹è®²çš„æ˜¯ä¸¤ä¸ªå±æ€§: &lt;code&gt;Content Compression Resistance&lt;/code&gt;ã€&lt;code&gt;Content Hugging&lt;/code&gt;,è¿™é‡Œæˆ‘è§‰å¾—ä½œè€…çš„è§£é‡Šè¿˜æ˜¯å½¢è±¡çš„ï¼š&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Object-C" scheme="http://www.ghcoder.com/tags/Object-C/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä¹ Swift Tips</title>
    <link href="http://www.ghcoder.com/2017/09/01/20170901/"/>
    <id>http://www.ghcoder.com/2017/09/01/20170901/</id>
    <published>2017-09-01T06:11:12.000Z</published>
    <updated>2017-09-07T08:05:53.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="onvcateçš„ã€ŠSwiftå¼€å‘è€…å¿…å¤‡çš„Tipsã€‹ä¹‹å‰åˆšå‡ºçš„æ—¶å€™ï¼Œæˆ‘å°±ç¿»é˜…è¿‡ï¼Œåæ¥Swiftçš„ç‰ˆæœ¬ä¸€ç›´åœ¨æ”¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—å»çœ‹äº†-ç°åœ¨Swiftçš„ABIåŸºæœ¬éƒ½ç¨³å®šäº†ï¼Œæˆ‘åœ¨å›é¡¾å¤ä¹ ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹è¦ç‚¹ï¼š"><a href="#onvcateçš„ã€ŠSwiftå¼€å‘è€…å¿…å¤‡çš„Tipsã€‹ä¹‹å‰åˆšå‡ºçš„æ—¶å€™ï¼Œæˆ‘å°±ç¿»é˜…è¿‡ï¼Œåæ¥Swiftçš„ç‰ˆæœ¬ä¸€ç›´åœ¨æ”¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—å»çœ‹äº†-ç°åœ¨Swiftçš„ABIåŸºæœ¬éƒ½ç¨³å®šäº†ï¼Œæˆ‘åœ¨å›é¡¾å¤ä¹ ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹è¦ç‚¹ï¼š" class="headerlink" title="onvcateçš„ã€ŠSwiftå¼€å‘è€…å¿…å¤‡çš„Tipsã€‹ä¹‹å‰åˆšå‡ºçš„æ—¶å€™ï¼Œæˆ‘å°±ç¿»é˜…è¿‡ï¼Œåæ¥Swiftçš„ç‰ˆæœ¬ä¸€ç›´åœ¨æ”¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—å»çœ‹äº†,ç°åœ¨Swiftçš„ABIåŸºæœ¬éƒ½ç¨³å®šäº†ï¼Œæˆ‘åœ¨å›é¡¾å¤ä¹ ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹è¦ç‚¹ï¼š"></a>onvcateçš„ã€ŠSwiftå¼€å‘è€…å¿…å¤‡çš„Tipsã€‹ä¹‹å‰åˆšå‡ºçš„æ—¶å€™ï¼Œæˆ‘å°±ç¿»é˜…è¿‡ï¼Œåæ¥Swiftçš„ç‰ˆæœ¬ä¸€ç›´åœ¨æ”¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—å»çœ‹äº†,ç°åœ¨Swiftçš„ABIåŸºæœ¬éƒ½ç¨³å®šäº†ï¼Œæˆ‘åœ¨å›é¡¾å¤ä¹ ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹è¦ç‚¹ï¼š</h3><h4 id="åè®®ä¸­çš„read-onlyçš„å±æ€§å€¼ï¼š"><a href="#åè®®ä¸­çš„read-onlyçš„å±æ€§å€¼ï¼š" class="headerlink" title="åè®®ä¸­çš„read-onlyçš„å±æ€§å€¼ï¼š"></a>åè®®ä¸­çš„read-onlyçš„å±æ€§å€¼ï¼š</h4><ul><li>åœ¨protocolä¸­ç»™åœ¨æ–¹æ³•å‰é¢æ·»åŠ <code>mutating</code>ï¼Œå¯ä»¥ä¿®æ”¹<code>Struct</code>ã€<code>Enum</code>ä¸­çš„å±æ€§å€¼, åœ¨<code>Class</code>ä¸­æœ¬æ¥å°±å¯ä»¥ä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¿½è§†<code>mutating</code>ã€‚</li><li>é¦–å…ˆæˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹ï¼Œæ€ä¹ˆåœ¨<code>protocol</code>ä¸­å®šä¹‰ä¸€ä¸ªåªè¯»çš„å±æ€§å€¼:</li></ul><a id="more"></a><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">protocol Vehicle &#123;</span><br><span class="line">    <span class="selector-tag">var</span> number: Int &#123; get &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct MyCar: Vehicle &#123;</span><br><span class="line">    <span class="selector-tag">var</span> number: Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">var</span> car = MyCar(number: <span class="number">3</span>)</span><br><span class="line">car.number</span><br><span class="line"></span><br><span class="line">car<span class="selector-class">.number</span> = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">car.number</span><br></pre></td></tr></table></figure><ul><li>å½“æˆ‘å†™å®Œè¿™æ®µä»£ç çš„æ—¶å€™ï¼Œæˆ‘å‘ç°ï¼Œæˆ‘å®šä¹‰çš„åªè¯»å±æ€§<code>number</code>,ä½†æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆï¼Ÿæˆ‘è¿˜å¯ä»¥è®¾ç½®å‘¢ï¼Ÿæˆ‘googleäº†ä¸€ä¸‹ï¼š[<a href="https://stackoverflow.com/questions/31358518/read-only-properties-of-protocols-in-swift]" target="_blank" rel="noopener">https://stackoverflow.com/questions/31358518/read-only-properties-of-protocols-in-swift]</a></li></ul><blockquote><p>Thereâ€™s no way to specify in a protocol that you must have a read-only property. Your protocol asks for a car.number property, and allows but does not require a setter.</p></blockquote><ul><li>è¿™é‡Œæˆ‘çš„ç†è§£å°±æ˜¯ï¼Œå½“ä½ å®ä¾‹åŒ–ä¸€ä¸ª<code>car</code>çš„å¯¹è±¡ï¼Œå¹¶ä¸”è°ƒç”¨car.xxxæŸä¸ªå±æ€§å€¼çš„æ—¶å€™ï¼Œä½ å¹¶æ²¡æœ‰é™åˆ¶ä»–çš„xxxå±æ€§å€¼æ˜¯åªè¯»çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹carçš„é‚£è¡Œä»£ç ï¼š</li></ul><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">var </span><span class="string">car:</span> <span class="string">Vehicle </span>= <span class="string">MyCar(</span><span class="string">number:</span> 3)</span><br><span class="line"></span><br><span class="line"><span class="string">car.</span><span class="string">number</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">car.</span><span class="string">number </span>= <span class="string">10 </span>// <span class="string">error:</span>  <span class="string">'number'</span> <span class="string">is </span>a <span class="built_in">get-only</span> <span class="string">property</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">car.</span><span class="string">number</span></span><br></pre></td></tr></table></figure><hr><ul><li>é‚£ä¹ˆæˆ‘ç°åœ¨åœ¨åè®®ä¸­å®šä¹‰ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åšä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯ä¿®æ”¹åè®®é‡Œé¢çš„å˜é‡å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> number: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">changeNumber</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyCar</span>: <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> number: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">changeNumber</span><span class="params">()</span></span> &#123;</span><br><span class="line">        number = <span class="number">99</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> car: <span class="type">Vehicle</span> = <span class="type">MyCar</span>(number: <span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">car.number</span><br><span class="line"></span><br><span class="line">car.changeNumber()</span><br><span class="line"></span><br><span class="line">car.number</span><br></pre></td></tr></table></figure><ul><li>æƒŠå¥‡çš„å‘ç°ï¼Œå±…ç„¶å¯ä»¥ä¿®æ”¹è¿™ä¸ªåªè¯»çš„å±æ€§å€¼äº†ï¼Ÿï¼Ÿæˆ‘åˆæ‡µé€¼äº†ã€‚æŸ¥çœ‹äº†å®˜æ–¹çš„<code>Demo</code>[<a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Protocols.html]" target="_blank" rel="noopener">https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Protocols.html]</a></li><li>è¿™é‡Œçš„å±æ€§å€¼æˆ‘åªæ˜¯ç®€å•çš„å®šä¹‰äº†ä¸‹ï¼Œæ²¡æœ‰é€šè¿‡computed valueæ¥å®šä¹‰å€¼ï¼ŒæŒ‰ç…§å®˜æ–¹çš„demoï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> number: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">changeNumber</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyCar</span>: <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> customInt: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> number: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> customInt</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">changeNumber</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">//        number = 99</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> car: <span class="type">Vehicle</span> = <span class="type">MyCar</span>(customInt: <span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">car.number</span><br><span class="line"></span><br><span class="line">car.changeNumber()</span><br><span class="line"></span><br><span class="line">car.number</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·ä¸€æ—¦æˆ‘è°ƒç”¨ChangeNumberçš„æ–¹æ³•çš„æ—¶å€™ï¼Œä½ å°±ä¼šå‘ç°æŠ¥é”™äº†ã€‚</li></ul><hr><ul><li>ä¸‹é¢è¯´äº†<code>for in</code>çš„ä½¿ç”¨ï¼Œå¤§å®¶åº”è¯¥éƒ½çŸ¥é“ï¼Œ<code>for in</code>çš„å¾ªç¯ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨åœ¨é›†åˆç±»å‹çš„ä¸Šé¢ï¼Œä½†æ˜¯åœ¨swiftä¸­æˆ‘å…¶å®æ˜¯å¯ä»¥å°†<code>for in</code>ç”¨åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹ä¸Šé¢ã€‚åœ¨Appleçš„å®˜æ–¹æ–‡æ¡£ä¸Šä¹Ÿç»™äº†ä¸€ä¸ªè¯´æ˜ï¼š[<a href="https://developer.apple.com/documentation/swift/iteratorprotocol]" target="_blank" rel="noopener">https://developer.apple.com/documentation/swift/iteratorprotocol]</a></li><li>é¦–å…ˆèƒ½ä½¿ç”¨<code>for in</code>æ¥æšä¸¾çš„å¯¹è±¡ï¼Œå¿…é¡»éµå¾ª<code>Sequence</code>,çœ‹é‡Œé¢çš„æºç ä¼šå‘ç°é‡Œé¢é™¤äº†å¾ˆå¤šçš„æ–¹æ³•å°±åªå‰©ä¸¤ä¸ªå±æ€§å€¼çš„è®¾ç½®ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A type that provides the sequence's iteration interface and</span></span><br><span class="line"> <span class="comment">/// encapsulates its iteration state.</span></span><br><span class="line"> <span class="keyword">associatedtype</span> <span class="type">Iterator</span> : <span class="type">IteratorProtocol</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">/// A type that represents a subsequence of some of the sequence's elements.</span></span><br><span class="line"> <span class="keyword">associatedtype</span> <span class="type">SubSequence</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">/// Returns an iterator over the elements of this sequence.</span></span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">Self</span>.<span class="type">Iterator</span></span><br></pre></td></tr></table></figure><ul><li>æŒ‰ç…§å®˜æ–¹çš„æ„æ€ï¼Œæˆ‘ä»¬è¿™é‡Œå…¶ä»–ä¸éœ€è¦å»å®ç°ï¼Œè¿™é‡Œå°±å®ç°äº†ä¸€ä¸ª<code>public func makeIterator() -&gt; Self.Iterator</code>è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè€Œè¿™ä¸ªè¿­ä»£å™¨å¿…é¡»è¦å®ç°<code>IteratorProtocol</code>çš„åè®®ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">IteratorProtocol</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The type of element traversed by the iterator.</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Element</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Advances to the next element and returns it, or `nil` if no next element</span></span><br><span class="line">    <span class="comment">/// exists.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Repeatedly calling this method returns, in order, all the elements of the</span></span><br><span class="line">    <span class="comment">/// underlying sequence. As soon as the sequence has run out of elements, all</span></span><br><span class="line">    <span class="comment">/// subsequent calls return `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// You must not call this method if any other copy of this iterator has been</span></span><br><span class="line">    <span class="comment">/// advanced with a call to its `next()` method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The following example shows how an iterator can be used explicitly to</span></span><br><span class="line">    <span class="comment">/// emulate a `for`-`in` loop. First, retrieve a sequence's iterator, and</span></span><br><span class="line">    <span class="comment">/// then call the iterator's `next()` method until it returns `nil`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     let numbers = [2, 3, 5, 7]</span></span><br><span class="line">    <span class="comment">///     var numbersIterator = numbers.makeIterator()</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     while let num = numbersIterator.next() &#123;</span></span><br><span class="line">    <span class="comment">///         print(num)</span></span><br><span class="line">    <span class="comment">///     &#125;</span></span><br><span class="line">    <span class="comment">///     // Prints "2"</span></span><br><span class="line">    <span class="comment">///     // Prints "3"</span></span><br><span class="line">    <span class="comment">///     // Prints "5"</span></span><br><span class="line">    <span class="comment">///     // Prints "7"</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Returns: The next element in the underlying sequence, if a next element</span></span><br><span class="line">    <span class="comment">///   exists; otherwise, `nil`.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Self</span>.<span class="type">Element</span>?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸Šé¢çš„æ³¨é‡Šä¹Ÿè¯´æ˜äº†ä¸€äº›ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯ä¸€ä¸ª<code>è¿­ä»£å™¨æ¨¡å¼</code>ï¼Œä¸æ–­çš„è°ƒç”¨next()çš„æ–¹æ³•ï¼ŒçŸ¥é“è¿”å›nilï¼Œå®˜æ–¹çš„ä¾‹å­ä¸Šé¢æ²¡æœ‰ç”¨åˆ°<code>Element</code>,å°±åªæ˜¯å°†è¿”å›çš„ç±»å‹å®šä¹‰ä¸º<code>Int?</code>,åªæ˜¯ç”¨äº†<code>next</code>çš„æ–¹æ³•ï¼š</li><li>å¹¶ä¸”ä¹‹å‰æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†<code>CountdownIterator</code>çš„å®ä¾‹åŒ–æ–¹æ³•ï¼Œå°†è‡ªå·±è¿™ä¸ªç»“æ„ä½“ä¼ å…¥äº†è¿›å»,æ‰€ä»¥è¿™é‡Œå°±å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨å˜é‡<code>countdown</code>:</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Coundown</span>: <span class="title">Sequence</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> start: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">CoundownIterator</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">CoundownIterator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CoundownIterator</span>: <span class="title">IteratorProtocol</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> countdown: <span class="type">Coundown</span></span><br><span class="line">    <span class="keyword">var</span> times = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> countdown: <span class="type">Coundown</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.countdown = countdown</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> nextNumber = countdown.start - times</span><br><span class="line">        <span class="keyword">guard</span> nextNumber &gt; <span class="number">0</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line">        times += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> nextNumber</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> threeTwoOne = <span class="type">Coundown</span>(start: <span class="number">3</span>)</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">count</span> <span class="keyword">in</span> threeTwoOne &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\(count)..."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸Šé¢çš„ä¾‹å­è¿˜æ˜¯é€šä¿—æ˜“æ‡‚çš„ï¼Œä½†æ˜¯å”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯æœ‰äº›å±æ€§æ²¡ç”¨ï¼Œå¯èƒ½ä»–è§‰å¾—æ²¡å¿…è¦å§ï¼Œçœ‹ä¸€ä¸‹onevcateçš„ä¾‹å­ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ReverseSequence</span>&lt;<span class="title">T</span>&gt;: <span class="title">Sequence</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> array: [<span class="type">T</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(array: [<span class="type">T</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.array = array</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Iterator</span> = <span class="type">ReverseItrator</span>&lt;<span class="type">T</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">ReverseItrator</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">ReverseItrator</span>(array: <span class="keyword">self</span>.array)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ReverseItrator</span>&lt;<span class="title">T</span>&gt;: <span class="title">IteratorProtocol</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Element</span> = <span class="type">T</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> array: [<span class="type">Element</span>]</span><br><span class="line">    <span class="keyword">var</span> currentIndex = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(array: [<span class="type">T</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.array = array</span><br><span class="line">        currentIndex = array.<span class="built_in">count</span> - <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">T</span>? &#123;</span><br><span class="line">        <span class="keyword">if</span> currentIndex &lt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> element = <span class="keyword">self</span>.array[currentIndex]</span><br><span class="line">            currentIndex -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> element</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="type">ReverseSequence</span>(array: arr) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Index: \(i) is \(arr[i])"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…¶å®è¿™é‡Œä¼šå‘ç°<code>typealias Iterator = ReverseItrator&lt;T&gt;</code>, <code>typealias Element = T</code>å†™äº†è¿™äº›ä¹‹åï¼Œç›¸åº”åè®®ä¸­çš„è¿”å›å€¼å°±æ˜¯è‡ªåŠ¨ç”Ÿæˆï¼Œä½†æ˜¯å¦‚æœä½ æƒ³ä»£ç ç®€æ´ï¼Œå…¶å®å¯ä»¥å¿½ç•¥è¿™äº›å±æ€§å€¼ï¼Œç›´æ¥è®¾ç½®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;onvcateçš„ã€ŠSwiftå¼€å‘è€…å¿…å¤‡çš„Tipsã€‹ä¹‹å‰åˆšå‡ºçš„æ—¶å€™ï¼Œæˆ‘å°±ç¿»é˜…è¿‡ï¼Œåæ¥Swiftçš„ç‰ˆæœ¬ä¸€ç›´åœ¨æ”¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—å»çœ‹äº†-ç°åœ¨Swiftçš„ABIåŸºæœ¬éƒ½ç¨³å®šäº†ï¼Œæˆ‘åœ¨å›é¡¾å¤ä¹ ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹è¦ç‚¹ï¼š&quot;&gt;&lt;a href=&quot;#onvcateçš„ã€ŠSwiftå¼€å‘è€…å¿…å¤‡çš„Tipsã€‹ä¹‹å‰åˆšå‡ºçš„æ—¶å€™ï¼Œæˆ‘å°±ç¿»é˜…è¿‡ï¼Œåæ¥Swiftçš„ç‰ˆæœ¬ä¸€ç›´åœ¨æ”¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—å»çœ‹äº†-ç°åœ¨Swiftçš„ABIåŸºæœ¬éƒ½ç¨³å®šäº†ï¼Œæˆ‘åœ¨å›é¡¾å¤ä¹ ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹è¦ç‚¹ï¼š&quot; class=&quot;headerlink&quot; title=&quot;onvcateçš„ã€ŠSwiftå¼€å‘è€…å¿…å¤‡çš„Tipsã€‹ä¹‹å‰åˆšå‡ºçš„æ—¶å€™ï¼Œæˆ‘å°±ç¿»é˜…è¿‡ï¼Œåæ¥Swiftçš„ç‰ˆæœ¬ä¸€ç›´åœ¨æ”¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—å»çœ‹äº†,ç°åœ¨Swiftçš„ABIåŸºæœ¬éƒ½ç¨³å®šäº†ï¼Œæˆ‘åœ¨å›é¡¾å¤ä¹ ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹è¦ç‚¹ï¼š&quot;&gt;&lt;/a&gt;onvcateçš„ã€ŠSwiftå¼€å‘è€…å¿…å¤‡çš„Tipsã€‹ä¹‹å‰åˆšå‡ºçš„æ—¶å€™ï¼Œæˆ‘å°±ç¿»é˜…è¿‡ï¼Œåæ¥Swiftçš„ç‰ˆæœ¬ä¸€ç›´åœ¨æ”¹ï¼Œæˆ‘ä¹Ÿå°±æ‡’å¾—å»çœ‹äº†,ç°åœ¨Swiftçš„ABIåŸºæœ¬éƒ½ç¨³å®šäº†ï¼Œæˆ‘åœ¨å›é¡¾å¤ä¹ ä¸€ä¸‹è¿™æœ¬ä¹¦ï¼Œè®°å½•ä¸€ä¸‹è¦ç‚¹ï¼š&lt;/h3&gt;&lt;h4 id=&quot;åè®®ä¸­çš„read-onlyçš„å±æ€§å€¼ï¼š&quot;&gt;&lt;a href=&quot;#åè®®ä¸­çš„read-onlyçš„å±æ€§å€¼ï¼š&quot; class=&quot;headerlink&quot; title=&quot;åè®®ä¸­çš„read-onlyçš„å±æ€§å€¼ï¼š&quot;&gt;&lt;/a&gt;åè®®ä¸­çš„read-onlyçš„å±æ€§å€¼ï¼š&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;åœ¨protocolä¸­ç»™åœ¨æ–¹æ³•å‰é¢æ·»åŠ &lt;code&gt;mutating&lt;/code&gt;ï¼Œå¯ä»¥ä¿®æ”¹&lt;code&gt;Struct&lt;/code&gt;ã€&lt;code&gt;Enum&lt;/code&gt;ä¸­çš„å±æ€§å€¼, åœ¨&lt;code&gt;Class&lt;/code&gt;ä¸­æœ¬æ¥å°±å¯ä»¥ä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¿½è§†&lt;code&gt;mutating&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é¦–å…ˆæˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹ï¼Œæ€ä¹ˆåœ¨&lt;code&gt;protocol&lt;/code&gt;ä¸­å®šä¹‰ä¸€ä¸ªåªè¯»çš„å±æ€§å€¼:&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swift" scheme="http://www.ghcoder.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä¹ YYText(ä¸€)</title>
    <link href="http://www.ghcoder.com/2017/08/30/20170830/"/>
    <id>http://www.ghcoder.com/2017/08/30/20170830/</id>
    <published>2017-08-30T08:11:12.000Z</published>
    <updated>2017-09-01T10:05:33.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="YYç³»åˆ—çš„å¾ˆå¤šä»£ç éƒ½å†™çš„å¾ˆæ£’ï¼Œæœ€è¿‘å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥å†³å®šç”¨YYText-ç”¨ä¹‹å‰çœ‹äº†ä¸€ä¸‹é‡Œé¢çš„ä»£ç ï¼Œè§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹è¦å­¦ä¹ çš„ã€‚ä»£ç é‡éå¸¸å¤§ï¼Œæ‰€ä»¥å¯èƒ½è¦åˆ†å‡ ç¯‡åšå®¢åˆ†åˆ«å»å†™ï¼Œç®€å•çš„é€»è¾‘å°±ä¸å†™äº†ã€‚"><a href="#YYç³»åˆ—çš„å¾ˆå¤šä»£ç éƒ½å†™çš„å¾ˆæ£’ï¼Œæœ€è¿‘å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥å†³å®šç”¨YYText-ç”¨ä¹‹å‰çœ‹äº†ä¸€ä¸‹é‡Œé¢çš„ä»£ç ï¼Œè§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹è¦å­¦ä¹ çš„ã€‚ä»£ç é‡éå¸¸å¤§ï¼Œæ‰€ä»¥å¯èƒ½è¦åˆ†å‡ ç¯‡åšå®¢åˆ†åˆ«å»å†™ï¼Œç®€å•çš„é€»è¾‘å°±ä¸å†™äº†ã€‚" class="headerlink" title="YYç³»åˆ—çš„å¾ˆå¤šä»£ç éƒ½å†™çš„å¾ˆæ£’ï¼Œæœ€è¿‘å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥å†³å®šç”¨YYText,ç”¨ä¹‹å‰çœ‹äº†ä¸€ä¸‹é‡Œé¢çš„ä»£ç ï¼Œè§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹è¦å­¦ä¹ çš„ã€‚ä»£ç é‡éå¸¸å¤§ï¼Œæ‰€ä»¥å¯èƒ½è¦åˆ†å‡ ç¯‡åšå®¢åˆ†åˆ«å»å†™ï¼Œç®€å•çš„é€»è¾‘å°±ä¸å†™äº†ã€‚"></a>YYç³»åˆ—çš„å¾ˆå¤šä»£ç éƒ½å†™çš„å¾ˆæ£’ï¼Œæœ€è¿‘å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥å†³å®šç”¨<code>YYText</code>,ç”¨ä¹‹å‰çœ‹äº†ä¸€ä¸‹é‡Œé¢çš„ä»£ç ï¼Œè§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹è¦å­¦ä¹ çš„ã€‚ä»£ç é‡éå¸¸å¤§ï¼Œæ‰€ä»¥å¯èƒ½è¦åˆ†å‡ ç¯‡åšå®¢åˆ†åˆ«å»å†™ï¼Œç®€å•çš„é€»è¾‘å°±ä¸å†™äº†ã€‚</h4><ul><li>çœ‹<code>demo</code>é‡Œé¢ï¼Œç¬¬ä¸€è¡Œçš„ä»£ç ï¼Œå…³äºçš„æµ‹è¯•éƒ¨åˆ†å°±å†™çš„å¾ˆç®€å•ï¼Œä½†æ˜¯æ·±ç©¶ä¸‹å»ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹çš„ï¼š</li></ul><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œçš„selfåªæ˜¯ä¸€ä¸ªä¼ å…¥çš„ViewControllerçš„å®ä¾‹</span></span><br><span class="line">[<span class="meta">YYTextExampleHelper addDebugOptionToViewController:self</span>];</span><br></pre></td></tr></table></figure><a id="more"></a><ul><li>è¿™é‡Œä¼ å…¥çš„vcåªæ˜¯ç”¨æ¥è®¾ç½®navigationItemçš„ï¼Œè¿™é‡Œæ˜¯è®¾ç½®çš„ä¸€ä¸ªUISwicherçš„UIæ§ä»¶ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ–¹æ³•ï¼š</li></ul><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="name">switcher</span> addBlockForControlEvents:UIControlEventValueChanged block:^(<span class="name">UISwitch</span> *sender) &#123;</span><br><span class="line">      [<span class="name">self</span> setDebug:sender.isOn]<span class="comment">;</span></span><br><span class="line">  &#125;]<span class="comment">;</span></span><br></pre></td></tr></table></figure><ul><li>ä»”ç»†ä¸€çœ‹å°±ä¼šå‘ç°é—®é¢˜ï¼ŒUISwichçš„å®ä¾‹å˜é‡å¯ä»¥ç›´æ¥è°ƒç”¨<code>addBlockForControlEvents</code>çš„æ–¹æ³•ï¼Œä¼ å…¥äº†<code>Event</code>å’Œ<code>block</code>:</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIControl</span> (<span class="title">YYAdd</span>)</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addBlockForControlEvents:(<span class="built_in">UIControlEvents</span>)controlEvents</span><br><span class="line">                           block:(<span class="keyword">void</span> (^)(<span class="keyword">id</span> sender))block &#123;</span><br><span class="line">    _YYUIControlBlockTarget *target = [[_YYUIControlBlockTarget alloc]</span><br><span class="line">                                       initWithBlock:block events:controlEvents];</span><br><span class="line">    [<span class="keyword">self</span> addTarget:target action:<span class="keyword">@selector</span>(invoke:) forControlEvents:controlEvents];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *targets = [<span class="keyword">self</span> _yy_allUIControlBlockTargets];</span><br><span class="line">    [targets addObject:target];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)_yy_allUIControlBlockTargets &#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *targets = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;block_key);</span><br><span class="line">    <span class="keyword">if</span> (!targets) &#123;</span><br><span class="line">        targets = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        objc_setAssociatedObject(<span class="keyword">self</span>, &amp;block_key, targets, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> targets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">_YYUIControlBlockTarget</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="keyword">void</span> (^block)(<span class="keyword">id</span> sender);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">UIControlEvents</span> events;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithBlock:(<span class="keyword">void</span> (^)(<span class="keyword">id</span> sender))block events:(<span class="built_in">UIControlEvents</span>)events;</span><br><span class="line">- (<span class="keyword">void</span>)invoke:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">_YYUIControlBlockTarget</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithBlock:(<span class="keyword">void</span> (^)(<span class="keyword">id</span> sender))block events:(<span class="built_in">UIControlEvents</span>)events &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        _block = [block <span class="keyword">copy</span>];</span><br><span class="line">        _events = events;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)invoke:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="keyword">if</span> (_block) _block(sender);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œç‚¹åˆ°æºç é‡Œé¢å¯ä»¥çœ‹åˆ°ï¼ŒYYä½œè€…å†™äº†ä¸€ä¸ª<code>UIControl</code>çš„categoryï¼Œæ¥ä½œäº†æ‹“å±•ï¼Œæä¾›äº†<code>addBlockForControlEvents</code>è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸Šé¢å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</li><li>å‘ç°ä½œè€…æ‹¿åˆ°<code>UIControlEvents</code>å’Œ<code>block</code>ï¼Œç›´æ¥ç”Ÿæˆäº†ä¸€ä¸ª<code>_YYUIControlBlockTarget</code>å®ä¾‹ã€‚å‘ç°ç”Ÿæˆçš„è¿™ä¸ªå®ä¾‹ï¼Œä¹Ÿåšä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…ï¼Œå°±æ˜¯æŠŠblock copyä¿å­˜ä¸‹æ¥ï¼Œeventsä¹Ÿä¿å­˜ä¸‹æ¥ã€‚</li><li>ç„¶åå®ƒè¿˜æ˜¯è°ƒç”¨äº†ç³»ç»Ÿçš„<code>addTarget:action:forControlEvents</code>ï¼Œç›´æ¥è°ƒç”¨<code>invoke:</code>çš„æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨äº†æˆ‘ä¼ å…¥è¿›æ¥çš„<code>block</code>ã€‚</li><li>ä¸‹é¢å¯ä»¥çœ‹åˆ°ä½œè€…é€šè¿‡<code>runtime</code>ç»™è¿™ä¸ªcategoryç”Ÿæˆäº†ä¸€ä¸ª<code>NSMutableArry</code>çš„å±æ€§å€¼ï¼Œå¹¶ä¸”æŠŠæˆ‘çš„targetå¯¹è±¡ä¿å­˜èµ·æ¥ã€‚</li><li>å…¶å®é€šè¿‡çœ‹æºç å°±å¯ä»¥å‘ç°ä½œè€…è¿™ä¹ˆå†™è¿™ä¸ªcategoryï¼Œå°±åšäº†ä¸¤ä»¶äº‹æƒ…ï¼Œç¬¬ä¸€å¯ä»¥ç”¨block, ç¬¬äºŒå¯ä»¥æ–¹ä¾¿ç›´æ¥removeæ‰ç›¸å…³å¯¹è±¡ä¸Šäº‹ä»¶ã€‚</li></ul><hr><ul><li>åœ¨äº‹ä»¶æˆåŠŸè§¦å‘çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)<span class="string">setDebug:</span>(BOOL)debug &#123;</span><br><span class="line">    YYTextDebugOption *debugOptions = [YYTextDebugOption <span class="keyword">new</span>];</span><br><span class="line">    <span class="keyword">if</span> (debug) &#123;</span><br><span class="line">        debugOptions.baselineColor = [UIColor redColor];</span><br><span class="line">        debugOptions.CTFrameBorderColor = [UIColor redColor];</span><br><span class="line">        debugOptions.CTLineFillColor = [UIColor <span class="string">colorWithRed:</span><span class="number">0.000</span> <span class="string">green:</span><span class="number">0.463</span> <span class="string">blue:</span><span class="number">1.000</span> <span class="string">alpha:</span><span class="number">0.180</span>];</span><br><span class="line">        debugOptions.CGGlyphBorderColor = [UIColor <span class="string">colorWithRed:</span><span class="number">1.000</span> <span class="string">green:</span><span class="number">0.524</span> <span class="string">blue:</span><span class="number">0.000</span> <span class="string">alpha:</span><span class="number">0.200</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [debugOptions clear];</span><br><span class="line">    &#125;</span><br><span class="line">    [YYTextDebugOption <span class="string">setSharedDebugOption:</span>debugOptions];</span><br><span class="line">    DebugEnabled = debug;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@interface</span> <span class="string">YYTextDebugOption :</span> NSObject &lt;NSCopying&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> Set a debug option as shared debug option.</span></span><br><span class="line"><span class="comment"> This method must be called on main thread.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> <span class="doctag">@discussion</span> When call this method, the new option will set to all debug target</span></span><br><span class="line"><span class="comment"> which is added by `addDebugTarget:`.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> <span class="doctag">@param</span> option  A new debug option (nil is valid).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)<span class="string">setSharedDebugOption:</span>(nullable YYTextDebugOption *)option;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>åœ¨è¿™ä¸ªç±»æ–¹æ³•ä¸­ä¸»è¦æ¶‰åŠåˆ°çš„ä¸€ä¸ªå¯¹è±¡ä¸º<code>YYTextDebugOption</code>,è¿™ä¸ªå¯¹è±¡åªæ˜¯ä¸€ä¸ªç»§æ‰¿è‡ªNSObjectçš„å¯¹è±¡ï¼Œè¿™é‡Œæ²¡æ¯›ç—…ã€‚</li><li><p>ç”Ÿæˆå®ä¾‹å¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸åŒçš„å€¼ï¼Œç„¶åè¿˜æ˜¯é€šè¿‡è‡ªå·±çš„ç±»æ–¹æ³•ï¼Œå°†ä¸Šé¢çš„ç”Ÿæˆçš„è¿™ä¸ªå¯¹è±¡é€šè¿‡å‚æ•°å‡ºå…¥è¿›å»ã€‚</p></li><li><p>åœ¨<code>YYTextDebugOption</code>é‡Œé¢ï¼š</p></li></ul><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">+ (void)setSharedDebugOption:(YYTextDebugOption *)option &#123;</span><br><span class="line">    NSAssert([NSThread isMainThread], @<span class="string">"This method must be called on the main thread"</span>)<span class="comment">;</span></span><br><span class="line">    _setSharedDebugOption(option)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">static void _setSharedDebugOption(YYTextDebugOption *option) &#123;</span><br><span class="line">    _initSharedDebug()<span class="comment">;</span></span><br><span class="line">    pthread_mutex_lock(&amp;_sharedDebugLock)<span class="comment">;</span></span><br><span class="line">    _sharedDebugOption = option.copy<span class="comment">;</span></span><br><span class="line">    CFSetApplyFunction(_sharedDebugTargets, _sharedDebugSetFunction, NULL)<span class="comment">;</span></span><br><span class="line">    pthread_mutex_unlock(&amp;_sharedDebugLock)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">static void _initSharedDebug() &#123;</span><br><span class="line">    static <span class="keyword">dispatch_once_t </span>onceToken<span class="comment">;</span></span><br><span class="line">    <span class="keyword">dispatch_once(&amp;onceToken, </span>^&#123;</span><br><span class="line">        pthread_mutex_init(&amp;_sharedDebugLock, NULL)<span class="comment">;</span></span><br><span class="line">        CFSetCallBacks callbacks = kCFTypeSetCallBacks<span class="comment">;</span></span><br><span class="line">        callbacks.retain = _sharedDebugSetRetain<span class="comment">;</span></span><br><span class="line">        callbacks.release = _sharedDebugSetRelease<span class="comment">;</span></span><br><span class="line">        _sharedDebugTargets = CFSetCreateMutable(CFAllocatorGetDefault(), <span class="number">0</span>, &amp;callbacks)<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œé¦–é¡µç¡®ä¿äº†è®¾ç½®çš„çš„æ—¶å€™ï¼Œå¿…é¡»æ˜¯è¦ä¸»çº¿ç¨‹å»è°ƒç”¨ï¼Œå…¶å®è¿™é‡Œè¿™æ ·å†™ï¼Œå’Œåé¢é€šè¿‡é”æ¥å­˜å‚¨å¯¹è±¡æ•ˆæœæ˜¯ä¸€è‡´çš„ã€‚</li><li>è¿™é‡Œå‘ç°ä½œè€…éƒ½æ˜¯äº›çš„cå‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä¸å¤ªç¡®å®šï¼Œä¸ºä»€ä¹ˆä¸ç”¨ocå‘¢ï¼Ÿ</li><li>è¿™é‡Œä½œè€…å†™äº†ä¸€ä¸ªå•ä¾‹ï¼Œå¹¶ä¸”åˆå§‹åŒ–äº†<code>pthread_mutex_init(&amp;_sharedDebugLock, NULL);</code>é”çš„å€¼</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//1ï¼špthread_mutex_init(pthread_mutex_t * mutex,const pthread_mutexattr_t *attr);</span></span><br><span class="line">åˆå§‹åŒ–é”å˜é‡mutexã€‚atträ¸ºé”å±æ€§ï¼Œ<span class="literal">NULL</span>å€¼ä¸ºé»˜è®¤å±æ€§ã€‚</span><br><span class="line"><span class="comment">//2ï¼špthread_mutex_lock(pthread_mutex_t *mutex);åŠ é”</span></span><br><span class="line"><span class="comment">//3ï¼špthread_mutex_tylock(pthread_mutex_t *mutex);åŠ é”ï¼Œä½†æ˜¯ä¸2ä¸ä¸€æ ·çš„æ˜¯å½“é”å·²ç»åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿”å›ä¸ºEBUSYï¼Œè€Œä¸æ˜¯æŒ‚èµ·ç­‰å¾…ã€‚</span></span><br><span class="line"><span class="comment">//4ï¼špthread_mutex_unlock(pthread_mutex_t *mutex);é‡Šæ”¾é”</span></span><br><span class="line"><span class="comment">//5ï¼špthread_mutex_destroy(pthread_mutex_t *mutex);ä½¿ç”¨å®Œåé‡Šæ”¾</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">__OSX_AVAILABLE_STARTING(__MAC_10_4, __IPHONE_2_0)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutex_init</span><span class="params">(<span class="keyword">pthread_mutex_t</span> * __restrict,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">const</span> <span class="keyword">pthread_mutexattr_t</span> * _Nullable __restrict)</span></span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>çœ‹ä»£ç å¯ä»¥å‘ç°ï¼Œè¿™é‡Œéœ€è¦ä¼ å…¥ä¸¤ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªå€¼æ˜¯ç”¨æ¥è¡¨ç¤ºè¿™ä¸ªé”çš„æ ‡è®°ï¼ŒåŒæ ·ç¬¬äºŒåªé»˜è®¤ä¸ºNull</li></ul><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CFSetCallBacks callbacks = kCFTypeSetCallBacks<span class="comment">;</span></span><br><span class="line">   callbacks.retain = _sharedDebugSetRetain<span class="comment">;</span></span><br><span class="line">   callbacks.release = _sharedDebugSetRelease<span class="comment">;</span></span><br><span class="line">   _sharedDebugTargets = CFSetCreateMutable(CFAllocatorGetDefault(), <span class="number">0</span>, &amp;callbacks)<span class="comment">;</span></span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œçš„å‡ è¡Œä»£ç ï¼Œå…¶å®æ˜¯é€šè¿‡cçš„æ–¹æ³•æ˜¯ï¼Œæ¥ç”Ÿæˆä¸€ä¸ªå®¹å™¨å±æ€§ï¼Œç±»ä¼¼<code>NSArray,NSDictionary,NSSet</code>,é€šè¿‡æºç å°±å¯ä»¥å‘ç°å…¶å®å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç»“æ„ä½“é‡Œé¢å®šä¹‰çš„å±æ€§å€¼ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦å®šä¹‰è¿™ä¸ªå®¹å™¨å˜é‡çš„å€¼ï¼Œå¯ä»¥çŒœå‡ºæ¥ï¼Œ<code>release</code>/<code>retain</code>æ˜¯è®¾ç½®å¯¹è±¡çš„å†…å­˜ç®¡ç†çš„ï¼Œ<code>equal</code>/<code>hash</code>æ˜¯å¯¹è±¡å­˜å‚¨çš„æ–¹å¼ï¼Œå½“ç„¶å•¦ï¼Œé€šè¿‡cç”Ÿæˆçš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è½¬åŒ–ä¸º<code>Foundation</code>çš„å±æ€§å€¼,å¯ä»¥é€šè¿‡ç±»ä¼¼è¿™æ ·çš„æ–¹å¼æ¥ç”Ÿæˆ<code>return (NSMutableSet *)CFBridgingRelease(CFSetCreateMutable(0, 0, &amp;callbacks));</code></li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="built_in">CFIndex</span>version;</span><br><span class="line">    <span class="built_in">CFSetRetainCallBack</span><span class="keyword">retain</span>;</span><br><span class="line">    <span class="built_in">CFSetReleaseCallBack</span>release;</span><br><span class="line">    <span class="built_in">CFSetCopyDescriptionCallBack</span>copyDescription;</span><br><span class="line">    <span class="built_in">CFSetEqualCallBack</span>equal;</span><br><span class="line">    <span class="built_in">CFSetHashCallBack</span>hash;</span><br><span class="line">&#125; <span class="built_in">CFSetCallBacks</span>;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ä»£ç å¯ä»¥çœ‹å‡ºæ¥ï¼Œå…¶å®ä½œè€…å°±æ˜¯æƒ³ä¿è¯ï¼Œå§‹ç»ˆåªæœ‰ä¸€ä¸ª<code>YYTextDebugOption *option</code>çš„å­˜åœ¨ã€‚é€šè¿‡è·å–è¿™ä¸ª<code>option</code>çš„å€¼ï¼Œå°±çŸ¥é“ä½ çš„è®¾ç½®äº†ã€‚</li></ul><hr><ul><li>å…³é”®è®¾ç½®<code>Text</code>çš„ç›¸å…³ä»£ç ï¼š</li></ul><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">NSMutableAttributedString *text = [NSMutableAttributedString new]<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   &#123;</span><br><span class="line">       NSMutableAttributedString *one = [[NSMutableAttributedString alloc] initWithString:@<span class="string">"Shadow"</span>]<span class="comment">;</span></span><br><span class="line">       one.yy_font = [UIFont <span class="keyword">boldSystemFontOfSize:30];</span></span><br><span class="line"><span class="keyword"> </span>      one.yy_color = [UIColor whiteColor]<span class="comment">;</span></span><br><span class="line">       YYTextShadow *<span class="keyword">shadow </span>= [YYTextShadow new]<span class="comment">;</span></span><br><span class="line">       <span class="keyword">shadow.color </span>= [UIColor colorWithWhite:<span class="number">0</span>.<span class="number">000</span> alpha:<span class="number">0</span>.<span class="number">490</span>]<span class="comment">;</span></span><br><span class="line">       <span class="keyword">shadow.offset </span>= CGSizeMake(<span class="number">0</span>, <span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">       <span class="keyword">shadow.radius </span>= <span class="number">5</span><span class="comment">;</span></span><br><span class="line">       one.yy_textShadow = <span class="keyword">shadow;</span></span><br><span class="line"><span class="keyword"> </span>      [text appendAttributedString:one]<span class="comment">;</span></span><br><span class="line">       [text appendAttributedString:[self padding]]<span class="comment">;</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œè®¾ç½®<code>yy_font</code>ã€<code>yy_color</code>çš„æ—¶å€™ï¼Œç”¨æ³•å’Œæˆ‘ä»¬ä¹‹å‰è®¾ç½®labelçš„å±æ€§è®¾ç½®ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œç‚¹è¿›å»å¯ä»¥å‘ç°ï¼Œè¿™é‡Œæ˜¯å› ä¸ºä½œè€…å†™äº†ä¸€ä¸ª<code>NSMutableAttributedString</code>çš„ä¸€ä¸ª<code>category</code>ï¼Œå’Œä¹‹å‰çš„åšæ³•ä¸€æ ·,åœ¨setterå€¼çš„æ—¶å€™ï¼Œä½œè€…è¦†å†™äº†setterçš„å€¼æ–¹æ³•ï¼Œç»Ÿä¸€éƒ½è°ƒç”¨äº†ä¸€ä¸ªåŒä¸€ä¸ªçš„æ–¹æ³•ï¼š</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)<span class="string">yy_setFont:</span>(UIFont *)font <span class="string">range:</span>(NSRange)range &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     In iOS7 and later, UIFont is toll-free bridged to CTFontRef,</span></span><br><span class="line"><span class="comment">     although Apple does not mention it in documentation.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     In iOS6, UIFont is a wrapper for CTFontRef, so CoreText can alse use UIfont,</span></span><br><span class="line"><span class="comment">     but UILabel/UITextView cannot use CTFontRef.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     We use UIFont for both CoreText and UIKit.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    [self <span class="string">yy_setAttribute:</span>NSFontAttributeName <span class="string">value:</span>font <span class="string">range:</span>range];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)<span class="string">yy_setColor:</span>(UIColor *)color <span class="string">range:</span>(NSRange)range &#123;</span><br><span class="line">    [self <span class="string">yy_setAttribute:</span>(id)kCTForegroundColorAttributeName <span class="string">value:</span>(id)color.CGColor <span class="string">range:</span>range];</span><br><span class="line">    [self <span class="string">yy_setAttribute:</span>NSForegroundColorAttributeName <span class="string">value:</span>color <span class="string">range:</span>range];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)<span class="string">yy_setAttribute:</span>(NSString *)name <span class="string">value:</span>(id)value <span class="string">range:</span>(NSRange)range &#123;</span><br><span class="line">    <span class="keyword">if</span> (!name || [NSNull <span class="string">isEqual:</span>name]) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (value &amp;&amp; ![NSNull <span class="string">isEqual:</span>value]) [self <span class="string">addAttribute:</span>name <span class="string">value:</span>value <span class="string">range:</span>range];</span><br><span class="line">    <span class="keyword">else</span> [self <span class="string">removeAttribute:</span>name <span class="string">range:</span>range];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œå…¶å®å·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œæ‰€æœ‰çš„è®¾ç½®å±æ€§çš„æ—¶å€™ï¼Œéƒ½æ˜¯è°ƒç”¨çš„è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨è¿™ä¸ªå€¼ï¼Œå°±è®¾ç½®ä¸Šå»ï¼Œæ²¡æœ‰ï¼Œå°±å»é™¤æ‰ã€‚</li><li>è¿™é‡Œåœ¨è®¾ç½®é¢œè‰²çš„æ—¶å€™ï¼Œè¿ç€è®¾ç½®äº†ä¸¤ä¸ªå±æ€§ï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹ï¼Œä½†æ˜¯ç½‘ä¸Šéƒ½æ²¡æœ‰è¯´çš„å¾ˆæ¸…æ¥šï¼Œåº”è¯¥æ˜¯<code>å°±æ˜¯ä¸ºäº†æŸäº›ç‰ˆæœ¬çš„å…¼å®¹é—®é¢˜çš„å§ï¼Œçœ‹ä¸€ä¸‹mattå¤§ç¥çš„è§£é‡Šå§ï¼š</code> [<a href="https://github.com/TTTAttributedLabel/TTTAttributedLabel/pull/416]" target="_blank" rel="noopener">https://github.com/TTTAttributedLabel/TTTAttributedLabel/pull/416]</a></li></ul><blockquote><p>Unfortunately, this patch appears to actually degrade support for iOS 8, as NS text attributes do not seem to apply in Core Text rendering for whatever reason.</p></blockquote><blockquote><p>As inconvenient as they are, everything works in iOS 4 â€“ 8 if kCT. Am I missing something? This feels like more of a â€œif it ainâ€™t broke, donâ€™t fix itâ€ type of situationâ€¦</p></blockquote><ul><li>å…³é”®è¿™é‡Œçš„shadowè®©äººçœ‹çš„å¾ˆæ‡µé€¼ï¼Œå› ä¸ºçœ‹ä»£ç å°±å¯ä»¥çŸ¥é“ï¼Œä½œè€…è¿™é‡Œè‡ªå®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿äº†<code>NSObject</code>çš„<code>Shadow</code>å¯¹è±¡<code>YYTextShadow *shadow = [YYTextShadow new];</code>,åŒæ ·å®ƒå’Œè®¾ç½®fontï¼Œcolorä¸€æ ·ï¼Œéƒ½æ˜¯æœ€ç»ˆè°ƒç”¨åˆ°äº†<code>- (void)yy_setAttribute:(NSString *)name value:(id)value range:(NSRange)range {}</code>,<strong>å‰é¢æˆ‘å¥½ç†è§£ï¼Œä»–éƒ½æ˜¯è®¾ç½®çš„ç³»ç»Ÿçš„è®¾ç½®ï¼Œæ‰€ä»¥ä½ ä¸ç®¡è®¾ç½®fontï¼Œcolorå…¶å®æœ€ç»ˆéƒ½æ˜¯èµ°åˆ°ç³»ç»Ÿçš„è®¾ç½®ä¸Šå»äº†ï¼Œä½†æ˜¯è¿™é‡Œè®¾ç½®çš„å¯¹è±¡ï¼Œkeyéƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼Œè¿™é‡Œç³»ç»Ÿæ˜¯æ€ä¹ˆè®¤è¯†çš„å‘¢ï¼Ÿå¼€å§‹çœ‹åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæˆ‘å°±æœ‰ç‚¹ä¸æ˜¯å¾ˆç†è§£äº†ï¼Œä½†æ˜¯å½“æˆ‘çœ‹åˆ°ä¸‹é¢çš„æ—¶å€™æˆ‘å°±æ˜ç™½äº†ã€‚</strong></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">YYLabel *<span class="keyword">label</span><span class="bash"> = [YYLabel new];</span></span><br><span class="line"><span class="bash"> label.attributedText = text;</span></span><br><span class="line"><span class="bash"> label.width = self.view.width;</span></span><br><span class="line"><span class="bash"> label.height = self.view.height - (kiOS7Later ? 64 : 44);</span></span><br><span class="line"><span class="bash"> label.top = (kiOS7Later ? 64 : 0);</span></span><br><span class="line"><span class="bash"> label.textAlignment = NSTextAlignmentCenter;</span></span><br><span class="line"><span class="bash"> label.textVerticalAlignment = YYTextVerticalAlignmentCenter;</span></span><br><span class="line"><span class="bash"> label.numberOfLines = 0;</span></span><br><span class="line"><span class="bash"> label.backgroundColor = [UIColor colorWithWhite:0.933 alpha:1.000];</span></span><br><span class="line"><span class="bash"> [self.view addSubview:label];</span></span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆè¿™é‡Œå®šä¹‰ä¸€ä¸ªæ–°çš„å±æ€§å€¼ï¼Œå«åš<code>YYLabel</code>,ç‚¹è¿›å»å¯ä»¥å‘ç°ï¼Œè¿™ä¸ª<code>YYLabel</code>çš„å¯¹è±¡ç»§æ‰¿çš„æ˜¯<code>UIView</code>çš„,è¿™é‡Œä½œè€…è¦åšçš„åº”è¯¥å°±æ˜¯å†™ä¸€ä¸ªå˜åŒ–çš„<code>UILabel</code>:</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> The YYLabel <span class="built_in">class</span> implements a <span class="built_in">read</span>-only <span class="built_in">text</span> view.</span><br><span class="line"></span><br><span class="line"> @discussion The API <span class="keyword">and</span> behavior <span class="keyword">is</span> similar <span class="keyword">to</span> UILabel, <span class="keyword">but</span> provides more features:</span><br><span class="line"></span><br><span class="line"> * It supports asynchronous layout <span class="keyword">and</span> rendering (<span class="keyword">to</span> avoid blocking UI thread).</span><br><span class="line"> * It extends <span class="keyword">the</span> CoreText attributes <span class="keyword">to</span> support more <span class="built_in">text</span> effects.</span><br><span class="line"> * It allows <span class="keyword">to</span> add UIImage, UIView <span class="keyword">and</span> CALayer <span class="keyword">as</span> <span class="built_in">text</span> attachments.</span><br><span class="line"> * It allows <span class="keyword">to</span> add 'highlight' link <span class="keyword">to</span> <span class="keyword">some</span> range <span class="keyword">of</span> <span class="built_in">text</span> <span class="keyword">to</span> allow user interact <span class="keyword">with</span>.</span><br><span class="line"> * It allows <span class="keyword">to</span> add container path <span class="keyword">and</span> exclusion paths <span class="keyword">to</span> control <span class="built_in">text</span> container's shape.</span><br><span class="line"> * It supports vertical form layout <span class="keyword">to</span> display CJK <span class="built_in">text</span>.</span><br><span class="line"></span><br><span class="line"> See NSAttributedString+YYText.h <span class="keyword">for</span> more convenience methods <span class="keyword">to</span> <span class="keyword">set</span> <span class="keyword">the</span> attributes.</span><br><span class="line"> See YYTextAttribute.h <span class="keyword">and</span> YYTextLayout.h <span class="keyword">for</span> more information.</span><br><span class="line"> */</span><br><span class="line">@interface YYLabel : UIView &lt;NSCoding&gt;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°YYLabelé™¤äº†UILabelæä¾›çš„é‚£äº›ä¸œè¥¿å¤–ï¼Œæˆ‘ä»¬è¿˜æä¾›å¾ˆå¤šç‰›é€¼çš„åŠŸèƒ½ï¼Œè¿™äº›åŠ¨èƒ½çš„å®ç°ï¼Œæˆ‘è¿˜æ²¡æœ‰çœ‹ï¼Œå…ˆæ¥çœ‹çœ‹ä¹‹å‰æˆ‘ä»¬è®¾ç½®çš„<code>NSMutableAttributedString</code>æ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„ï¼Ÿ</li><li>åœ¨ç¬¬äºŒè¡Œä»£ç ï¼Œæˆ‘ä»¬ç›´æ¥å°†æˆ‘ä»¬å‰é¢è®¾ç½®çš„textå±æ€§å€¼è¿›è¡Œè®¾å®š<code>label.attributedText = text;</code>:</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setAttributedText:(<span class="built_in">NSAttributedString</span> *)attributedText &#123;</span><br><span class="line">    <span class="keyword">if</span> (attributedText.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        _innerText = attributedText.mutableCopy;</span><br><span class="line">        <span class="keyword">switch</span> (_lineBreakMode) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">NSLineBreakByWordWrapping</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">NSLineBreakByCharWrapping</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">NSLineBreakByClipping</span>: &#123;</span><br><span class="line">                _innerText.yy_lineBreakMode = _lineBreakMode;</span><br><span class="line">            &#125; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">NSLineBreakByTruncatingHead</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">NSLineBreakByTruncatingTail</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">NSLineBreakByTruncatingMiddle</span>: &#123;</span><br><span class="line">                _innerText.yy_lineBreakMode = <span class="built_in">NSLineBreakByWordWrapping</span>;</span><br><span class="line">            &#125; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _innerText = [<span class="built_in">NSMutableAttributedString</span> new];</span><br><span class="line">    &#125;</span><br><span class="line">    [_textParser parseText:_innerText selectedRange:<span class="literal">NULL</span>];</span><br><span class="line">    <span class="keyword">if</span> (!_ignoreCommonProperties) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_displaysAsynchronously &amp;&amp; _clearContentsBeforeAsynchronouslyDisplay) &#123;</span><br><span class="line">            [<span class="keyword">self</span> _clearContents];</span><br><span class="line">        &#125;</span><br><span class="line">        [<span class="keyword">self</span> _updateOuterTextProperties];</span><br><span class="line">        [<span class="keyword">self</span> _setLayoutNeedUpdate];</span><br><span class="line">        [<span class="keyword">self</span> _endTouch];</span><br><span class="line">        [<span class="keyword">self</span> invalidateIntrinsicContentSize];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œçš„ä»£ç åº”è¯¥å°±æ˜¯è§£ææˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„<code>NSAttributedString</code>å±æ€§ã€‚</li><li>æŒ‰ç…§ä»£ç ï¼Œå…ˆåˆ¤æ–­_lineBreakModeï¼Œç„¶åç»™<code>NSAttributedString</code>è®¾ç½®<code>yy_lineBreakMode</code>çš„å€¼ã€‚</li><li><code>[_textParser parseText:_innerText selectedRange:NULL];</code>è¿™ä¸ªæ˜¯ä¸€ä¸ªä»£ç†æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ç°åœ¨æˆ‘è¿™é‡Œçš„<code>_textParser</code>æ˜¯<code>nil</code>,é‚£ä¹Ÿå°±ä¸ä¼šè°ƒç”¨è¿™ä¸ªä»£ç†æ–¹æ³•ï¼Œä»å‡½æ•°åå­—ä¸Šå¯ä»¥çŸ¥é“ï¼Œè¿™é‡Œçš„å‡½æ•°ä¸»è¦åšçš„ä¸Šå°±æ˜¯å»è§£ææŸä¸ª<code>Text</code>ã€‚</li><li>è°ƒç”¨<code>[self _updateOuterTextProperties];</code></li></ul><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (void)<span class="variable">_updateOuterTextProperties</span> &#123;</span><br><span class="line">    <span class="variable">_text</span> = [<span class="variable">_innerText</span> yy_plainTextForRange:NSMakeRange(<span class="number">0</span>, <span class="variable">_innerText</span>.length)];</span><br><span class="line">    <span class="variable">_font</span> = <span class="variable">_innerText</span>.yy_font;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">_font</span>) <span class="variable">_font</span> = [self <span class="variable">_defaultFont</span>];</span><br><span class="line">    <span class="variable">_textColor</span> = <span class="variable">_innerText</span>.yy_color;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">_textColor</span>) <span class="variable">_textColor</span> = [UIColor blackColor];</span><br><span class="line">    <span class="variable">_textAlignment</span> = <span class="variable">_innerText</span>.yy_alignment;</span><br><span class="line">    <span class="variable">_lineBreakMode</span> = <span class="variable">_innerText</span>.yy_lineBreakMode;</span><br><span class="line">    NSShadow *shadow = <span class="variable">_innerText</span>.yy_shadow;</span><br><span class="line">    <span class="variable">_shadowColor</span> = shadow.shadowColor;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !TARGET_INTERFACE_BUILDER</span></span><br><span class="line">    <span class="variable">_shadowOffset</span> = shadow.shadowOffset;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="variable">_shadowOffset</span> = CGPointMake(shadow.shadowOffset.width, shadow.shadowOffset.height);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="variable">_shadowBlurRadius</span> = shadow.shadowBlurRadius;</span><br><span class="line">    <span class="variable">_attributedText</span> = <span class="variable">_innerText</span>;</span><br><span class="line">    [self <span class="variable">_updateOuterLineBreakMode</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»ä¸Šé¢çš„ä»£ç çš„é€»è¾‘ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯è®²æˆ‘ä»¬å‰é¢ä¼ å…¥è¿›æ¥çš„<code>NSAttributedString</code>ä¸€ä¸ªä¸ªå–å‡ºæ¥</li><li><code>- (NSString *)yy_plainTextForRange:(NSRange)range {}</code>è¿™ä¸ªå‡½æ•°çš„ä¸»è¦æ˜¯ä»<code>NSAttributedString</code>ä¸­å–å‡ºTextçš„å€¼ï¼Œå¤åˆ¶ç»™ä¸€ä¸ªå…¨å±€çš„textçš„å€¼ï¼Œçœ‹ä¸€ä¸‹è¿™é‡Œçš„å®ç°ï¼š</li></ul><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">NSString</span> *)yy_plainTextForRange:(<span class="type">NSRange</span>)<span class="built_in">range</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">range</span>.location == <span class="type">NSNotFound</span> ||<span class="built_in">range</span>.length == <span class="type">NSNotFound</span>) <span class="keyword">return</span> <span class="keyword">nil</span>;</span><br><span class="line">    <span class="type">NSMutableString</span> *<span class="literal">result</span> = [<span class="type">NSMutableString</span> <span class="built_in">string</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">range</span>.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">    <span class="type">NSString</span> *<span class="built_in">string</span> = self.<span class="built_in">string</span>;</span><br><span class="line">    [self enumerateAttribute:<span class="type">YYTextBackedStringAttributeName</span> inRange:<span class="built_in">range</span> options:kNilOptions usingBlock:^(id value, <span class="type">NSRange</span> <span class="built_in">range</span>, <span class="type">BOOL</span> *stop) &#123;</span><br><span class="line">        <span class="type">YYTextBackedString</span> *backed = value;</span><br><span class="line">        <span class="keyword">if</span> (backed &amp;&amp; backed.<span class="built_in">string</span>) &#123;</span><br><span class="line">            [<span class="literal">result</span> appendString:backed.<span class="built_in">string</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            [<span class="literal">result</span> appendString:[<span class="built_in">string</span> substringWithRange:<span class="built_in">range</span>]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œä»–æšä¸¾äº†<code>NSAttributedString</code>çš„å±æ€§å€¼ï¼Œå¦‚æœå‰é¢è®¾ç½®è¿‡<code>YYTextBackedStringAttributeName</code>,è¿™é‡Œå®ƒä¼šè¿›è¡Œæ‹¼æ¥ï¼Œä½†æ˜¯æˆ‘ä»¬å‰é¢æ²¡æœ‰è®¾ç½®è¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæšä¸¾å‡ºçš„<code>value = nil</code>ã€‚å¯ä»¥é€šè¿‡è¿™é‡Œçš„æšä¸¾æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æšä¸¾å‡ºæˆ‘ä»¬æƒ³è¦<code>attribute</code>å€¼ï¼Œå¹¶è¿›è¡Œä¿®æ”¹ï¼š</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *res = [<span class="keyword">self</span>.richTextEditor.attributedText mutableCopy];</span><br><span class="line"></span><br><span class="line">[res beginEditing];</span><br><span class="line">__block <span class="built_in">BOOL</span> found = <span class="literal">NO</span>;</span><br><span class="line">[res enumerateAttribute:<span class="built_in">NSFontAttributeName</span> inRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, res.length) options:<span class="number">0</span> usingBlock:^(<span class="keyword">id</span> value, <span class="built_in">NSRange</span> range, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">        <span class="built_in">UIFont</span> *oldFont = (<span class="built_in">UIFont</span> *)value;</span><br><span class="line">        <span class="built_in">UIFont</span> *newFont = [oldFont fontWithSize:oldFont.pointSize * <span class="number">2</span>];</span><br><span class="line">        [res removeAttribute:<span class="built_in">NSFontAttributeName</span> range:range];</span><br><span class="line">        [res addAttribute:<span class="built_in">NSFontAttributeName</span> value:newFont range:range];</span><br><span class="line">        found = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line"><span class="keyword">if</span> (!found) &#123;</span><br><span class="line">    <span class="comment">// No font was found - do something else?</span></span><br><span class="line">&#125;</span><br><span class="line">[res endEditing];</span><br><span class="line"><span class="keyword">self</span>.richTextEditor.attributedText = res;</span><br></pre></td></tr></table></figure><ul><li>ä¸‹é¢å°±æ˜¯ç®€å•çš„å¯¹å…¨å±€çš„å€¼è¿›è¡Œèµ‹å€¼,çœ‹åˆ°è¿™é‡Œï¼Œå°±å¯ä»¥ç¨å¾®æ˜ç™½äº†ä¹‹å‰çš„è‡ªå®šä¹‰è®¾ç½®Shadowçš„é—®é¢˜äº†ï¼š<code>NSShadow *shadow = _innerText.yy_shadow;</code>,ç„¶åå°†shadowçš„å€¼è¿›è¡Œèµ‹å€¼ï¼š</li></ul><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="variable">_shadowColor</span> = shadow.shadowColor;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !TARGET_INTERFACE_BUILDER</span></span><br><span class="line">    <span class="variable">_shadowOffset</span> = shadow.shadowOffset;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="variable">_shadowOffset</span> = CGPointMake(shadow.shadowOffset.width, shadow.shadowOffset.height);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="variable">_shadowBlurRadius</span> = shadow.shadowBlurRadius;</span><br></pre></td></tr></table></figure><ul><li>æœ€ååˆè®¾ç½®äº†ä¸€ä¸‹<code>- (void)_updateOuterLineBreakMode {}</code>ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)_updateOuterLineBreakMode &#123;</span><br><span class="line">    <span class="keyword">if</span> (_innerContainer.truncationType) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (_innerContainer.truncationType) &#123;</span><br><span class="line">            <span class="keyword">case</span> YYTextTruncationTypeStart: &#123;</span><br><span class="line">                _lineBreakMode = <span class="built_in">NSLineBreakByTruncatingHead</span>;</span><br><span class="line">            &#125; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> YYTextTruncationTypeEnd: &#123;</span><br><span class="line">                _lineBreakMode = <span class="built_in">NSLineBreakByTruncatingTail</span>;</span><br><span class="line">            &#125; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> YYTextTruncationTypeMiddle: &#123;</span><br><span class="line">                _lineBreakMode = <span class="built_in">NSLineBreakByTruncatingMiddle</span>;</span><br><span class="line">            &#125; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _lineBreakMode = _innerText.yy_lineBreakMode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œåˆè®¾è®¡åˆ°äº†ä¸€ä¸‹æ–°çš„å¯¹è±¡<code>YYTextContainer *_innerContainer;</code>,è¿™é‡Œæˆ‘ç›®å‰æ²¡ç”¨åˆ°è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥æš‚ä¸”å…ˆå¿½ç•¥å®ƒã€‚</li><li>ä¸‹é¢è°ƒç”¨äº†æ–°çš„æ–¹æ³•<code>- (void)_setLayoutNeedUpdate {}</code>,è¿™ä¸ªæ–¹æ³•è®¾ç½®äº†ä¸€ä¸ªå±æ€§å€¼ï¼Œç„¶åè°ƒç”¨<code>- (void)_clearInnerLayout {}</code>ç”±äºè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰è®¾ç½®å€¼ï¼Œæ‰€ä»¥ç›´æ¥returnæ‰äº†ï¼Œæœ€åè°ƒç”¨äº†ä¸€ä¸‹<code>[self.layer setNeedsDisplay];</code></li><li>åœ¨æœ€åçš„æœ€åè°ƒç”¨äº†<code>[self invalidateIntrinsicContentSize];</code>,è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æˆ‘ä¹‹å‰ä¹Ÿæ²¡æœ‰ç”¨è¿‡ï¼Œä½†æ˜¯çœ‹è§£é‡Šåº”è¯¥å¯ä»¥çŒœå‡ºä¸€éƒ¨åˆ†ï¼š</li></ul><blockquote><p>call this when something changes that affects the intrinsicContentSize.  Otherwise UIKit wonâ€™t notice that it changed.<br>æˆ‘çš„çŒœæµ‹æ˜¯å½“çˆ¶è§†å›¾çš„å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥é€šçŸ¥å­è§†å›¾ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚</p></blockquote><h4 id="åˆ°ç›®å‰ä¸ºæ­¢å¤–é¢åªäº†è§£å®Œäº†æœ€æœ€åŸºç¡€çš„é‚£ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè®¾ç½®shadowï¼Œtextcolorï¼Œfontï¼Œè¶³ä»¥çœ‹å‡ºè¿™ä¸ªyyTextçš„å¼ºå¤§äº†ã€‚"><a href="#åˆ°ç›®å‰ä¸ºæ­¢å¤–é¢åªäº†è§£å®Œäº†æœ€æœ€åŸºç¡€çš„é‚£ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè®¾ç½®shadowï¼Œtextcolorï¼Œfontï¼Œè¶³ä»¥çœ‹å‡ºè¿™ä¸ªyyTextçš„å¼ºå¤§äº†ã€‚" class="headerlink" title="åˆ°ç›®å‰ä¸ºæ­¢å¤–é¢åªäº†è§£å®Œäº†æœ€æœ€åŸºç¡€çš„é‚£ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè®¾ç½®shadowï¼Œtextcolorï¼Œfontï¼Œè¶³ä»¥çœ‹å‡ºè¿™ä¸ªyyTextçš„å¼ºå¤§äº†ã€‚"></a>åˆ°ç›®å‰ä¸ºæ­¢å¤–é¢åªäº†è§£å®Œäº†æœ€æœ€åŸºç¡€çš„é‚£ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè®¾ç½®shadowï¼Œtextcolorï¼Œfontï¼Œè¶³ä»¥çœ‹å‡ºè¿™ä¸ªyyTextçš„å¼ºå¤§äº†ã€‚</h4><hr><ul><li>ç½‘ä¸Šæ‰¾äº†äº›èµ„æ–™ï¼Œå¤§éƒ¨åˆ†éƒ½æ²¡æœ‰è¯´æ¸…æ¥šï¼Œèƒ½è¯´æ¸…æ¥šä¸‹é¢ä¸¤ç¯‡æ–‡ç« ï¼šå¯ä»¥çœ‹çœ‹ : [<a href="http://www.jianshu.com/p/f0c33d6c39bb" target="_blank" rel="noopener">http://www.jianshu.com/p/f0c33d6c39bb</a>, <a href="http://blog.csdn.net/wypblog/article/details/7264315]" target="_blank" rel="noopener">http://blog.csdn.net/wypblog/article/details/7264315]</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;YYç³»åˆ—çš„å¾ˆå¤šä»£ç éƒ½å†™çš„å¾ˆæ£’ï¼Œæœ€è¿‘å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥å†³å®šç”¨YYText-ç”¨ä¹‹å‰çœ‹äº†ä¸€ä¸‹é‡Œé¢çš„ä»£ç ï¼Œè§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹è¦å­¦ä¹ çš„ã€‚ä»£ç é‡éå¸¸å¤§ï¼Œæ‰€ä»¥å¯èƒ½è¦åˆ†å‡ ç¯‡åšå®¢åˆ†åˆ«å»å†™ï¼Œç®€å•çš„é€»è¾‘å°±ä¸å†™äº†ã€‚&quot;&gt;&lt;a href=&quot;#YYç³»åˆ—çš„å¾ˆå¤šä»£ç éƒ½å†™çš„å¾ˆæ£’ï¼Œæœ€è¿‘å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥å†³å®šç”¨YYText-ç”¨ä¹‹å‰çœ‹äº†ä¸€ä¸‹é‡Œé¢çš„ä»£ç ï¼Œè§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹è¦å­¦ä¹ çš„ã€‚ä»£ç é‡éå¸¸å¤§ï¼Œæ‰€ä»¥å¯èƒ½è¦åˆ†å‡ ç¯‡åšå®¢åˆ†åˆ«å»å†™ï¼Œç®€å•çš„é€»è¾‘å°±ä¸å†™äº†ã€‚&quot; class=&quot;headerlink&quot; title=&quot;YYç³»åˆ—çš„å¾ˆå¤šä»£ç éƒ½å†™çš„å¾ˆæ£’ï¼Œæœ€è¿‘å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥å†³å®šç”¨YYText,ç”¨ä¹‹å‰çœ‹äº†ä¸€ä¸‹é‡Œé¢çš„ä»£ç ï¼Œè§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹è¦å­¦ä¹ çš„ã€‚ä»£ç é‡éå¸¸å¤§ï¼Œæ‰€ä»¥å¯èƒ½è¦åˆ†å‡ ç¯‡åšå®¢åˆ†åˆ«å»å†™ï¼Œç®€å•çš„é€»è¾‘å°±ä¸å†™äº†ã€‚&quot;&gt;&lt;/a&gt;YYç³»åˆ—çš„å¾ˆå¤šä»£ç éƒ½å†™çš„å¾ˆæ£’ï¼Œæœ€è¿‘å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥å†³å®šç”¨&lt;code&gt;YYText&lt;/code&gt;,ç”¨ä¹‹å‰çœ‹äº†ä¸€ä¸‹é‡Œé¢çš„ä»£ç ï¼Œè§‰å¾—è¿˜æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹è¦å­¦ä¹ çš„ã€‚ä»£ç é‡éå¸¸å¤§ï¼Œæ‰€ä»¥å¯èƒ½è¦åˆ†å‡ ç¯‡åšå®¢åˆ†åˆ«å»å†™ï¼Œç®€å•çš„é€»è¾‘å°±ä¸å†™äº†ã€‚&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;çœ‹&lt;code&gt;demo&lt;/code&gt;é‡Œé¢ï¼Œç¬¬ä¸€è¡Œçš„ä»£ç ï¼Œå…³äºçš„æµ‹è¯•éƒ¨åˆ†å°±å†™çš„å¾ˆç®€å•ï¼Œä½†æ˜¯æ·±ç©¶ä¸‹å»ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹çš„ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è¿™é‡Œçš„selfåªæ˜¯ä¸€ä¸ªä¼ å…¥çš„ViewControllerçš„å®ä¾‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;meta&quot;&gt;YYTextExampleHelper addDebugOptionToViewController:self&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Swift" scheme="http://www.ghcoder.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Core Dataçš„è¿ç§»å’Œåˆå¹¶(äº”)</title>
    <link href="http://www.ghcoder.com/2017/08/22/20170822/"/>
    <id>http://www.ghcoder.com/2017/08/22/20170822/</id>
    <published>2017-08-22T02:11:12.000Z</published>
    <updated>2017-09-01T03:06:15.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="è®°å¾—åœ¨ä¸¤å¹´å‰æˆ‘å»é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å…³äºCore-dataçš„é—®é¢˜ï¼Œä»–ä»¬å¤§éƒ½åªä¼šé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½å¤Ÿç­”å‡ºæ¥ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä½¿ç”¨è¿‡Core-Dataï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼šâ€œå¦‚ä½•è¿ç§»Core-Dataçš„æ•°æ®åº“â€ï¼Ÿå› ä¸ºè°éƒ½æ— æ³•é¢„æ–™ä¸šåŠ¡çš„å‘å±•ï¼Œä»¥åŠæ•°æ®åº“çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ã€‚è¿™é‡Œé‡ç‚¹åˆ—ä¸¾å‡ ä¸ªCore-Dataæ•°æ®åº“è¿ç§»çš„é—®é¢˜ï¼š"><a href="#è®°å¾—åœ¨ä¸¤å¹´å‰æˆ‘å»é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å…³äºCore-dataçš„é—®é¢˜ï¼Œä»–ä»¬å¤§éƒ½åªä¼šé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½å¤Ÿç­”å‡ºæ¥ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä½¿ç”¨è¿‡Core-Dataï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼šâ€œå¦‚ä½•è¿ç§»Core-Dataçš„æ•°æ®åº“â€ï¼Ÿå› ä¸ºè°éƒ½æ— æ³•é¢„æ–™ä¸šåŠ¡çš„å‘å±•ï¼Œä»¥åŠæ•°æ®åº“çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ã€‚è¿™é‡Œé‡ç‚¹åˆ—ä¸¾å‡ ä¸ªCore-Dataæ•°æ®åº“è¿ç§»çš„é—®é¢˜ï¼š" class="headerlink" title="è®°å¾—åœ¨ä¸¤å¹´å‰æˆ‘å»é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å…³äºCore dataçš„é—®é¢˜ï¼Œä»–ä»¬å¤§éƒ½åªä¼šé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½å¤Ÿç­”å‡ºæ¥ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä½¿ç”¨è¿‡Core Dataï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼šâ€œå¦‚ä½•è¿ç§»Core Dataçš„æ•°æ®åº“â€ï¼Ÿå› ä¸ºè°éƒ½æ— æ³•é¢„æ–™ä¸šåŠ¡çš„å‘å±•ï¼Œä»¥åŠæ•°æ®åº“çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ã€‚è¿™é‡Œé‡ç‚¹åˆ—ä¸¾å‡ ä¸ªCore Dataæ•°æ®åº“è¿ç§»çš„é—®é¢˜ï¼š"></a>è®°å¾—åœ¨ä¸¤å¹´å‰æˆ‘å»é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å…³äºCore dataçš„é—®é¢˜ï¼Œä»–ä»¬å¤§éƒ½åªä¼šé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½å¤Ÿç­”å‡ºæ¥ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä½¿ç”¨è¿‡Core Dataï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼šâ€œå¦‚ä½•è¿ç§»Core Dataçš„æ•°æ®åº“â€ï¼Ÿå› ä¸ºè°éƒ½æ— æ³•é¢„æ–™ä¸šåŠ¡çš„å‘å±•ï¼Œä»¥åŠæ•°æ®åº“çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ã€‚è¿™é‡Œé‡ç‚¹åˆ—ä¸¾å‡ ä¸ªCore Dataæ•°æ®åº“è¿ç§»çš„é—®é¢˜ï¼š</h4><ul><li><strong>é¦–å…ˆè¦è¯´ä¸€ä¸‹ï¼Œå¦‚æœä½ çš„Appï¼Œåªæ˜¯ç¼“å­˜ä¸€äº›ç¦»çº¿æ•°æ®çš„è¯ï¼Œå°±æ²¡å¿…è¦è€ƒè™‘ä»€ä¹ˆæ•°æ®åº“è¿ç§»äº†ï¼Œå› ä¸ºä½ åªéœ€è¦åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œåˆ é™¤ä¹‹å‰çš„core dataæ•°æ®ï¼Œæ–°å»ºä¸€ä¸ªå°±å¯ä»¥äº†</strong></li></ul><a id="more"></a><hr><ul><li>åªæ˜¯åœ¨åŸæœ‰çš„Entityä¸­æ·»åŠ å‡ ä¸ªå­—æ®µ,æ­¥éª¤å¦‚ä¸‹ï¼š</li></ul><ol><li>ç‚¹å‡»<code>Editor-&gt;Add Model Version</code>.</li><li>å‘½åæ–°ç‰ˆæœ¬çš„æ–‡å­—å°±å•¥ï¼š<code>xxx v2</code>.</li><li>å¦‚æœä½ æœ‰å¤šä¸ªCore Dataçš„é¡¹ç›®ï¼Œéœ€è¦å‹¾é€‰ä½ æƒ³è¦ä¿®æ”¹çš„Core Dataé¡¹ç›®çš„åå­—.</li><li>ç‚¹å‡»åˆ›å»ºå®Œæˆ.</li><li>ç‚¹å‡»<code>File Inspector</code>,åœ¨Model Versionä¸­å‹¾é€‰ä½ åˆšæ‰åˆ›å»ºçš„æ–°çš„Model.</li><li>æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥å‹¾é€‰è¿›æˆ‘ä»¬æ–°å»ºçš„Core Data Entityçš„å­—æ®µåˆ›å»ºè¡¨ä¸­å»ï¼Œåˆ›å»ºä½ æƒ³è¦ä¿®æ”¹çš„å­—æ®µ.</li><li>æ­¤æ—¶ä½ å°±å¯ä»¥å»æƒ³è¦çš„xxx.swiftçš„Model Template çš„æ–‡ä»¶ä¸­å»æ·»åŠ å­—æ®µäº†ï¼Œä¾‹å¦‚ï¼š<code>@NSManaged var image: UIImage?</code></li><li>æ­¤æ—¶ä½ å°±å¯ä»¥åƒä½¿ç”¨å…¶ä»–å­—æ®µä¸€æ ·ä½¿ç”¨ä½ æ–°å»ºçš„å­—æ®µäº†ï¼Œä¾‹å¦‚ä¸Šé¢çš„image<code>xxx.image = xxx</code></li></ol><hr><ul><li>åœ¨åŸæœ‰çš„Entityä¸­åˆ é™¤å­—æ®µï¼Œå¹¶ä¸”åˆ›å»ºæ–°çš„RelationShipå…³è”åˆ°æ–°çš„Entityå¯¹è±¡ï¼š</li></ul><ol><li>å‰é¢çš„1-5çš„æ“ä½œéƒ½æ˜¯ä¸€æ ·çš„.</li><li>ç‚¹å‡»Core Dataæ¥åˆ›å»ºæ–°å»ºçš„ä¸€ä¸ªEntity,å¹¶ä¸”è®¾ç½®ç›¸åº”çš„å­—æ®µ(è¿™é‡Œè®¾ç½®Module ä¸ºé¡¹ç›®çš„åå­—).</li><li>ç„¶åä»æˆ‘ä»¬æ–°å»ºçš„Entityä¸­å»ºç«‹æ–°çš„è”ç³»å»å…³è”åˆ°æˆ‘ä»¬ä¹‹å‰çš„Entity(é€šè¿‡è®¾ç½®destinationæ¥è®¾ç½®å…³è”).</li><li>å¹¶ä¸”å›åˆ°ä¹‹å‰çš„Entityä¸­ï¼Œåˆ é™¤æˆ–è€…ä¿®æ”¹æˆ‘ä»¬æƒ³è¦çš„ä¿®æ”¹çš„å­—æ®µ.</li><li>å¹¶ä¸”åœ¨ä¹‹å‰çš„Entityä¸­ï¼Œå»ºç«‹è”ç³»ï¼Œå…³è”åˆ°ä¹‹å‰æ–°å»ºçš„Entity(è¿™é‡Œéœ€è¦è®¾ç½®destinationä¸ºæ–°å»ºçš„Entityï¼Œå¹¶ä¸”è®¾ç½®inverse).</li><li>æ­¤æ—¶å·²ç»å¯ä»¥å¼€å§‹å‡†å¤‡åˆå¹¶äº†ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦åšäº›ä¿®æ”¹ï¼š</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œç±»åå’Œæˆ‘ä»¬æ–°å»ºçš„Entityçš„åå­—ä¸€æ ·ï¼Œå¹¶ä¸”åœ¨é‡Œé¢åˆ›å»ºæˆ‘ä»¬æ–°å»ºçš„å­—æ®µ.</li><li>ä¿®æ”¹ä¹‹å‰Entityå¯¹åº”çš„Swiftç±»ä¸­ï¼Œå¢åˆ ä¿®æ”¹å­—æ®µ.</li><li>ä¸‹é¢æ˜¯æœ€æœ€é‡è¦çš„ä¸€æ­¥ï¼šå»ºç«‹model æ˜ å°„ï¼š</li><li>åœ¨<code>New/File</code>ä¸­é€‰æ‹©<code>Mapping Model</code>,é€‰æ‹©ä½ ä¿®æ”¹çš„åŸºå‡†çš„Entityä¸ºSource, é€‰æ‹©æœ€æ–°çš„Entityä¸ºTarger Modelï¼Œåå­—ç±»ä¼¼ä¸ºï¼š<code>UnCloudNotesMappingModel_v2_to_v3</code></li><li>åœ¨è¿™ä¸ªæ–°å»ºçš„æ˜ å°„çš„æ–‡ä»¶ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¦‚æœæ˜¯ä¹‹å‰å°±å­˜åœ¨Entityçš„è¯ï¼Œé‚£ä¹ˆçš„å®ƒçš„å€¼<code>Value Expression</code>= <code>$source.xxx</code>ï¼Œå¯ä»¥çœ‹å‡ºæ¥è¿™æ ·çš„æ•°æ®æ˜¯æ²¡æœ‰å‘ç”Ÿæ”¹å˜çš„.(<strong>è¿™é‡Œçš„sourceå°±æ˜¯æˆ‘ä»¬å¼€å§‹åˆ›å»ºè¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™é€‰æ‹©çš„sourceæ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼šv3é‡Œé¢xxå­—æ®µçš„å€¼ï¼Œç›´æ¥å°±æ˜¯å–è‡ªv2å­—æ®µçš„åŒæ ·çš„å€¼</strong>).</li><li>åˆšä¸‹å·²ç»è¯´äº†éœ€è¦æ–°å»ºçš„ä¸€ä¸ªEntityå»ºç«‹å…³è”ï¼Œé‚£ä¹ˆå¿…ç„¶åœ¨è¿™ä¸ªRelationShipä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰æ–°å»ºå¥½çš„Relationshipçš„å­—æ®µï¼Œä½†æ˜¯åœ¨<code>Value Expression</code>ä¸­å‘ç°xcodeå¹¶æ²¡æœ‰ç»™æˆ‘ä»¬å¡«å…¥ä»€ä¹ˆå€¼ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œ<strong>ä¸ºè¿™ä¸ªå€¼ï¼Œå…³è”çš„æ˜¯æˆ‘ä»¬æ–°å»ºEntityå€¼ï¼Œå½“ç„¶ä¹‹å‰çš„Sourceä¸çŸ¥é“å•¦ï¼ï¼æ‰€ä»¥ä½ ç°åœ¨è¦åšçš„å°±æ˜¯åˆ é™¤è¿™æ®µå…³è”ï¼Œå› ä¸ºæ—¢ç„¶æ˜¯å…³è”ï¼Œæˆ‘å¯ä»¥ä»aå¯¹è±¡å…³è”bå¯¹è±¡ï¼Œé‚£æˆ‘åŒæ ·å¯ä»¥ä»bå¯¹è±¡å…³è”åˆ°aå¯¹è±¡</strong></li><li>å‹¾é€‰æ–°å»ºçš„Entityå¯¹è±¡ï¼Œå‘ç°æ­¤æ—¶çš„xodeæ²¡æœ‰ç»™æˆ‘ä»¬å‹¾é€‰Sourceï¼Œè¿™é‡Œçš„ç†è§£ä¸ºï¼š<strong>é»˜è®¤è¿™ä¸ªæ–°å»ºçš„Entityçš„å€¼ï¼Œæ‰€æœ‰çš„å€¼ï¼Œéƒ½æ˜¯æˆ‘ä»¬è‡ªå·±æ–°å»ºï¼Œä¸éœ€è¦ä»ä¹‹å‰çš„Entityä¸­è·å–å€¼,ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸€æ—¦å‹¾é€‰äº†sourceï¼Œä¸ºæŸä¸ªå¯¹è±¡çš„è¯ï¼Œxocdeä¼šè‡ªåŠ¨å»æ›´åŠ å­—ç¬¦åˆ›å»åŒ¹é…ï¼Œè·å–ç›¸åº”çš„å€¼ï¼Œé€‰æ‹©äº†sourceä¹‹åï¼Œå¯¹åº”çš„åå­—ä¹Ÿä»xxxæ”¹ä¸ºyyyToxxx</strong>.</li><li>é€šè¿‡ä¹‹å‰çš„ç†è§£æˆ‘ä»¬å…¶å®å¯ä»¥ç†è§£ä¸ºï¼Œæ¯ä¸€ä¸ªnoteéƒ½ä¼šå…³è”attachment,ä½†æ˜¯è¿™é‡Œæˆ‘ä¹Ÿå¯ä»¥åšä¸€ä¸‹è¿‡æ»¤ï¼Œå¦‚æœ<code>attachmenté‡Œçš„image != nil</code>,æ‰å°†æ•°æ®è¿›è¡Œå…³è”.</li><li><code>ä¹‹å‰xcodeä¸ºæˆ‘ä»¬åˆ›å»ºçš„Relationshipï¼Œç”±äºé‡Œé¢çš„value expressionæ˜¯æˆ‘ä»¬æ–°å»ºçš„Entity,æ‰€ä»¥æˆ‘ä»¬å°†ä¹‹å‰çš„RelationShipåˆ é™¤æ‰ï¼Œç„¶åä¸ºæ–°å»ºçš„Entityæ–°å»ºä¸€ä¸ªrelationshipå…³è”åˆ°ä¹‹å‰çš„æ—§Entity,å¹¶ä¸”è®¾ç½®Mapping Name,è¿™é‡Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°†value expressionå€¼å¡«ä¸Šruntimeçš„å‡½æ•°</code></li><li>æœ€åè®¾ç½®ä¸¤ä¸ªå±æ€§ï¼š</li></ol><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">description</span>.shouldMigrateStoreAutomatically = <span class="keyword">true</span></span><br><span class="line"><span class="keyword">description</span>.shouldInferMappingModelAutomatically = <span class="keyword">false</span></span><br></pre></td></tr></table></figure><hr><ul><li>åˆ é™¤å¯¹è±¡çš„å­—æ®µï¼Œå¹¶ä¸”å»ºç«‹ä¸€ä¸ªæ–°çš„Entity,é‡Œé¢åŒ…å«äº†å…¶ä»–æ–°å»ºçš„å­—æ®µ,æ˜¯å¹¶ä¸”è¿™ä¸ªEntityæ˜¯ä¹‹å‰æŸä¸ªEntityçš„å­ç±».</li></ul><ol><li>å‰é¢çš„1-5çš„æ“ä½œéƒ½æ˜¯ä¸€æ ·çš„.</li><li>ç‚¹å‡»Core Dataæ¥åˆ›å»ºæ–°å»ºçš„ä¸€ä¸ªEntity,å¹¶ä¸”è®¾ç½®ç›¸åº”çš„å­—æ®µ(è¿™é‡Œè®¾ç½®Module ä¸ºé¡¹ç›®çš„åå­—).</li><li>è®¾ç½®æ–°å»ºEntityçš„Parent Entity,å¹¶ä¸”ä¹Ÿå¯ä»¥è®¾ç½®ç›¸åº”çš„è‡ªå®šä¹‰å­—æ®µ.</li><li>ä¹‹åæ–°å»ºæˆ‘ä»¬æ–°å»º(EntityName).swiftï¼Œæ ¹æ®æ–°å»ºçš„å­—æ®µç±»å‹ï¼Œå®šä¹‰å­—æ®µï¼Œæ­¤æ—¶å¯ä»¥åŒæ ·è¡¨æ˜ç»§æ‰¿å…³ç³»<code>class ImageAttachment:Attachment {}</code></li><li>è™½ç„¶è¿™é‡Œåˆ›å»ºäº†æˆ‘ä»¬æƒ³è¦çš„Entityä»¥åŠå­—æ®µï¼Œä½†æ˜¯ä¹‹å‰çš„æ—§modelå¦‚ä½•ä½œè½¬åŒ–å‘¢ï¼Ÿè¿™é‡Œå°±åŒæ ·éœ€è¦æ˜ å°„ï¼Œå› æ­¤è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Mapping Model:<code>UnCloudNotesMappingModel_v3_to_v4</code>.</li><li>è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ›´åŠ éœ€è¦ï¼Œå¦‚æœæ–°å»ºçš„Entityçš„å­—æ®µç›´æ¥æ¥è‡ªäºä¹‹å‰çš„æŸä¸ªModelçš„è¯ï¼Œæˆ‘å°±å¯ä»¥å°†è¿™ä¸ªModelè®¾ç½®ä¸ºSourceï¼Œä½†æ˜¯å¦‚æœæœ‰äº›å­—æ®µæ²¡æœ‰ï¼Œæˆ–è€…ä¸æ˜¯ç›´æ¥å¯ä»¥è·å–åˆ°çš„è¯ï¼Œæˆ–è€…éœ€è¦ä»ä¸åŒçš„å­—æ®µä¸­è¿›è¡Œä¸€å®šçš„é€»è¾‘æ‰èƒ½å¤Ÿèµ‹å€¼çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œå°±éœ€è¦è‡ªå®šä¹‰<code>NSEntityMigrationPolicy</code>,è¿™é‡Œæˆ‘ä»¬æ–°å»ºçš„å­ç±»å¯¹è±¡ï¼Œå¹¶ä¸”å°†Modelçš„<code>Custom Policy</code>è®¾ç½®ä¸ºæˆ‘ä»¬æ–°å»ºçš„å­ç±»çš„è¯ï¼Œç³»ç»Ÿåœ¨è½½å…¥çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œæ¯”è¾ƒï¼Œå‡å¦‚ä½ ç°åœ¨çš„Core Dataçš„ç‰ˆæœ¬ç¡®å®éœ€è¦æ›´æ–°çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªç±».</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AttachmentToImageAttachmentMigrationPolicyV3toV4</span>: <span class="title">NSEntityMigrationPolicy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">createDestinationInstances</span><span class="params">(forSource sInstance: NSManagedObject, <span class="keyword">in</span> mapping: NSEntityMapping, manager: NSMigrationManager)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.è¿™é‡Œä¼šå­˜åœ¨ä¸¤ä¸ªcontextï¼Œä¸€ä¸ªè¯»å…¥çš„source contextï¼Œä¸€ä¸ªå†™å…¥destinationContext.è¿™é‡Œå½“ç„¶éœ€è¦è¯»å…¥çš„æœ€ç»ˆçš„è¿™ä¸ªcontext</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> description = <span class="type">NSEntityDescription</span>.entity(forEntityName: <span class="string">"ImageAttachment"</span>,</span><br><span class="line">                                                 <span class="keyword">in</span>: manager.destinationContext)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newAttachment = <span class="type">ImageAttachment</span>(entity: description!,</span><br><span class="line">                                        insertInto: manager.destinationContext)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. å°†å±æ€§è¿›è¡Œè¿­ä»£</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">traversePropertyMappings</span><span class="params">(block: <span class="params">(NSPropertyMapping, String)</span></span></span> -&gt; ()) <span class="keyword">throws</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> attributeMappings = mapping.attributeMappings &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> propertyMapping <span class="keyword">in</span> attributeMappings &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> <span class="keyword">let</span> destinationName = propertyMapping.name &#123;</span><br><span class="line">            block(propertyMapping, destinationName)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//3.å¦‚æœè¿™ä¸ªå¯¹è±¡ï¼Œè¿ç›¸åº”çš„å±æ€§å€¼éƒ½ä¸èƒ½åæ‚”çš„è¯ï¼Œé‚£å°±ä»£è¡¨è‚¯å®šæœ‰é—®é¢˜çš„ï¼Œéœ€è¦æŠ›å‡ºé—®é¢˜.</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> message = <span class="string">"Attribute destination not configured properly"</span></span><br><span class="line">            <span class="keyword">let</span> userInfo = [<span class="type">NSLocalizedFailureReasonErrorKey</span>: message]</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">NSError</span>(domain: errorDomain,</span><br><span class="line">                          code: <span class="number">0</span>,</span><br><span class="line">                          userInfo: userInfo)</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> message = <span class="string">"No Attribute Mappings found"</span></span><br><span class="line">        <span class="keyword">let</span> userInfo = [<span class="type">NSLocalizedFailureReasonErrorKey</span>: message]</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">NSError</span>(domain: errorDomain,</span><br><span class="line">                      code: <span class="number">0</span>,</span><br><span class="line">                      userInfo: userInfo)</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. è¿™ä¸€æ­¥æŒ‰ç…§æ˜ å°„å…³ç³»ï¼Œåº”è¯¥æ˜¯ä¸€ä¸€å¯¹è±¡è¿›è¡Œèµ‹å€¼çš„</span></span><br><span class="line">    <span class="keyword">try</span>  traversePropertyMappings &#123;</span><br><span class="line">      propertyMapping, destinationName <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> valueExpression = propertyMapping.valueExpression <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> context: <span class="type">NSMutableDictionary</span> = [<span class="string">"source"</span>: sInstance]</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> desinationValue = valueExpression.expressionValue(with: sInstance, context: context) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        newAttachment.setValue(desinationValue, forKey: destinationName)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. æ¥ä¸‹æ¥çš„æ•°æ®ï¼Œä½ å¯ä»¥è¿›è¡Œè®¡ç®—ï¼Œæˆ–è€…ä»å…¶ä»–Entityä¸­è·å–å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> image = sInstance.value(forKey: <span class="string">"image"</span>) <span class="keyword">as</span>? <span class="type">UIImage</span> &#123;</span><br><span class="line">      newAttachment.setValue(image.size.width, forKey: <span class="string">"width"</span>)</span><br><span class="line">      newAttachment.setValue(image.size.height, forKey: <span class="string">"height"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.</span></span><br><span class="line">    <span class="keyword">let</span> body = sInstance.value(forKeyPath: <span class="string">"note.body"</span>) <span class="keyword">as</span>? <span class="type">NSString</span> ?? <span class="string">""</span></span><br><span class="line">    newAttachment.setValue(body.substring(to: <span class="number">80</span>), forKey: <span class="string">"caption"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. ä¸‹é¢éœ€è¦å°†æ–°å»ºçš„Entityä¸source objectã€mapping ä¹‹é—´å»ºç«‹è”ç³»ï¼Œå¦‚æœåœ¨è¿ç§»æ•°æ®æ¥å—çš„æ—¶å€™ï¼Œæ­¤å‡½æ•°è°ƒç”¨å¤±è´¥çš„è¯ï¼Œæ•°æ®ä¼šä¸¢å¤±.</span></span><br><span class="line">    manager.associate(sourceInstance: sInstance, withDestinationInstance: newAttachment, <span class="keyword">for</span>: mapping)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><p>ä¹‹å‰æ‰€è®²çš„éƒ½æ˜¯ä»v1-&gt;v2,ä»v2-&gt;v3,ä»v3-&gt;v4ï¼Œä½†æ˜¯è¿™å…¶å®æ˜¯æœ€æœ€ç®€å•çš„æƒ…å†µï¼Œä½†äº‹å®æƒ…å†µä¼šæ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºä½ æ°¸è¿œä¸çŸ¥é“ç”¨æˆ·æ­¤æ—¶æ˜¯ä»€ä¹ˆç‰ˆæœ¬å·ï¼Ÿä»–ä»¬å¯ä»¥ä»v1-&gt;v4,ä¹Ÿå¯ä»¥ä»v2-&gt;v4ï¼Œé‚£ä¹ˆè¿™æ ·ä¸€æ¥å°±ä¼šæ¯”è¾ƒå¤æ‚äº†.æ­¤æ—¶æˆ‘ä»¬è¿™é‡Œå°±éœ€è¦è¿›è¡Œè‡ªå®šä¹‰æ•°æ®åˆå¹¶äº†.</p></li><li><p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…ï¼Œæ˜¯è¿›è¡Œæ¯”è¾ƒï¼Œè¦å…ˆä»bundleä¸­è¯»å–æ–‡ä»¶åï¼Œç„¶åæˆ‘ä»¬ä»æ–‡ä»¶åä¸­è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªbundleæ˜¯æ•°æ®v2ã€v3è¿˜æ˜¯v1.</p></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">extension NSManagedObjectModel &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">modelURLs</span></span>(</span><br><span class="line">    <span class="keyword">in</span> modelFolder: String) -&gt; [URL] &#123;</span><br><span class="line">    <span class="keyword">return</span> Bundle.main</span><br><span class="line">      .urls(forResourcesWithExtension: <span class="string">"mom"</span>,</span><br><span class="line">      subdirectory: <span class="string">"\(modelFolder).momd"</span>) ?? []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">modelVersionsFor</span></span>(</span><br><span class="line">    modelNamed modelName: String) -&gt; [NSManagedObjectModel] &#123;</span><br><span class="line">    <span class="keyword">return</span> modelURLs(<span class="keyword">in</span>: modelName)</span><br><span class="line">      .flatMap(NSManagedObjectModel.<span class="keyword">init</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">uncloudNotesModel</span></span>(</span><br><span class="line">    named modelName: String) -&gt; NSManagedObjectModel &#123;</span><br><span class="line">    let model = modelURLs(<span class="keyword">in</span>: <span class="string">"UnCloudNotesDataModel"</span>)</span><br><span class="line">      .filter &#123; $<span class="number">0</span>.lastPathComponent == <span class="string">"\(modelName).mom"</span> &#125;</span><br><span class="line">      .first</span><br><span class="line">      .flatMap(NSManagedObjectModel.<span class="keyword">init</span>)</span><br><span class="line">    <span class="keyword">return</span> model ?? NSManagedObjectModel()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç‰ˆæœ¬å·ä¹‹å‰çš„åˆ¤æ–­ï¼š</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">var</span> <span class="title">version1</span>: <span class="type">NSManagedObjectModel &#123;</span></span></span><br><span class="line">   <span class="keyword">return</span> uncloudNotesModel(named: <span class="string">"UnCloudNotesDataModel"</span>)</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">var</span> isVersion1: Bool &#123;</span><br><span class="line">   <span class="keyword">return</span> self == type(of: self).version1</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">var</span> <span class="title">version2</span>: <span class="type">NSManagedObjectModel &#123;</span></span></span><br><span class="line">   <span class="keyword">return</span> uncloudNotesModel(named: <span class="string">"UnCloudNotesDataModel v2"</span>)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> isVersion2: Bool &#123;</span><br><span class="line">   <span class="keyword">return</span> self == type(of: self).version2</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">var</span> <span class="title">version3</span>: <span class="type">NSManagedObjectModel &#123;</span></span></span><br><span class="line">   <span class="keyword">return</span> uncloudNotesModel(named: <span class="string">"UnCloudNotesDataModel v3"</span>)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> isVersion3: Bool &#123;</span><br><span class="line">   <span class="keyword">return</span> self == type(of: self).version3</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">var</span> <span class="title">version4</span>: <span class="type">NSManagedObjectModel &#123;</span></span></span><br><span class="line">   <span class="keyword">return</span> uncloudNotesModel(named: <span class="string">"UnCloudNotesDataModel v4"</span>)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> isVersion4: Bool &#123;</span><br><span class="line">   <span class="keyword">return</span> self == type(of: self).version4</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><ul><li>å•¥æ—¶å€™è¿›è¡Œæ•°æ®è¿ç§»å‘¢ï¼Ÿ</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stack: <span class="type">CoreDataStack</span> &#123;</span><br><span class="line">  <span class="keyword">guard</span> enableMigrations,</span><br><span class="line">       !store(at: storeURL,</span><br><span class="line">         isCompatibleWithModel: currentModel)</span><br><span class="line">  <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="type">CoreDataStack</span>(modelName: modelName) &#125;</span><br><span class="line">  performMigration()</span><br><span class="line">  <span class="keyword">return</span> <span class="type">CoreDataStack</span>(modelName: modelName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡è·å–å…ƒæ•°æ®ï¼Œå¹¶ä¸”è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœéœ€è¦æ›´æ–°çš„è¯ï¼Œå°±ä¼šå°†æ•°æ®è¿”å›</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">store</span><span class="params">(at storeURL: URL,</span></span></span><br><span class="line"><span class="function"><span class="params">                     isCompatibleWithModel model: NSManagedObjectModel)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> storeMetadata = metadataForStoreAtURL(storeURL: storeURL)</span><br><span class="line">    <span class="keyword">return</span> model.isConfiguration(withName: <span class="literal">nil</span>, compatibleWithStoreMetadata:storeMetadata)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">metadataForStoreAtURL</span><span class="params">(storeURL: URL)</span></span></span><br><span class="line">    -&gt; [<span class="type">String</span>: <span class="type">Any</span>] &#123;</span><br><span class="line">      <span class="keyword">let</span> metadata: [<span class="type">String</span>: <span class="type">Any</span>]</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        metadata = <span class="keyword">try</span> <span class="type">NSPersistentStoreCoordinator</span></span><br><span class="line">          .metadataForPersistentStore(ofType: <span class="type">NSSQLiteStoreType</span>,</span><br><span class="line">                                      at: storeURL, options: <span class="literal">nil</span>)</span><br><span class="line">      &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        metadata = [:]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Error retrieving metadata for store at URL:\(storeURL): \(error)"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> metadata</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li>æ•°æ®å¦‚ä½•è¿›è¡Œåˆå¹¶å‘¢ï¼Ÿ</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">migrateStoreAt</span><span class="params">(URL storeURL: URL,</span></span></span><br><span class="line"><span class="function"><span class="params">                             fromModel from:NSManagedObjectModel,</span></span></span><br><span class="line"><span class="function"><span class="params">                             toModel to:NSManagedObjectModel,</span></span></span><br><span class="line"><span class="function"><span class="params">                             mappingModel:NSMappingModel? = <span class="literal">nil</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 1.åˆ›å»ºmigration managerçš„å®ä¾‹å¯¹è±¡</span></span><br><span class="line">   <span class="keyword">let</span> migrationManager =</span><br><span class="line">     <span class="type">NSMigrationManager</span>(sourceModel: from, destinationModel: to)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2.å¦‚æœåœ¨æ–¹æ³•ä¸­ä¼ é€’mapping modelçš„å¯¹è±¡çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒï¼Œå¦åˆ™æˆ‘ä»¬å°±åˆ›å»ºå®ƒ.</span></span><br><span class="line">   <span class="keyword">var</span> migrationMappingModel: <span class="type">NSMappingModel</span></span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">let</span> mappingModel = mappingModel &#123;</span><br><span class="line">     migrationMappingModel = mappingModel</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     migrationMappingModel = <span class="keyword">try</span>! <span class="type">NSMappingModel</span></span><br><span class="line">       .inferredMappingModel(</span><br><span class="line">         forSourceModel: from, destinationModel: to)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 3</span></span><br><span class="line">   <span class="keyword">let</span> targetURL = storeURL.deletingLastPathComponent()</span><br><span class="line">   <span class="keyword">let</span> destinationName = storeURL.lastPathComponent + <span class="string">"~1"</span></span><br><span class="line">   <span class="keyword">let</span> destinationURL = targetURL</span><br><span class="line">     .appendingPathComponent(destinationName)</span><br><span class="line"></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"From Model: \(from.entityVersionHashesByName)"</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"To Model: \(to.entityVersionHashesByName)"</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"Migrating store \(storeURL) to \(destinationURL)"</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"Mapping model: \(String(describing: mappingModel))"</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 4</span></span><br><span class="line">   <span class="keyword">let</span> success: <span class="type">Bool</span></span><br><span class="line">   <span class="keyword">do</span> &#123;</span><br><span class="line">     <span class="keyword">try</span> migrationManager.migrateStore(from: storeURL,</span><br><span class="line">                                       sourceType:<span class="type">NSSQLiteStoreType</span>,</span><br><span class="line">                                       options:<span class="literal">nil</span>,</span><br><span class="line">                                       with:migrationMappingModel,</span><br><span class="line">                                       toDestinationURL:destinationURL,</span><br><span class="line">                                       destinationType:<span class="type">NSSQLiteStoreType</span>,</span><br><span class="line">                                       destinationOptions:<span class="literal">nil</span>)</span><br><span class="line">     success = <span class="literal">true</span></span><br><span class="line">   &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">     success = <span class="literal">false</span></span><br><span class="line">     <span class="built_in">print</span>(<span class="string">"Migration failed: \(error)"</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 5</span></span><br><span class="line">   <span class="keyword">if</span> success &#123;</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">"Migration Completed Successfully"</span>)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">let</span> fileManager = <span class="type">FileManager</span>.<span class="keyword">default</span></span><br><span class="line">     <span class="keyword">do</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> fileManager.removeItem(at: storeURL)</span><br><span class="line">       <span class="keyword">try</span> fileManager.moveItem(at: destinationURL,</span><br><span class="line">                                to: storeURL)</span><br><span class="line">     &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">"Error migrating \(error)"</span>)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚ä½•ä¸€æ­¥æ­¥çš„åˆå¹¶æ•°æ®ï¼Œè¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œä»è€Œæ—¶é—´ä¸€æ­¥æ­¥çš„åˆå¹¶æ•°æ®ï¼š</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">func performMigration() &#123;</span><br><span class="line">    <span class="keyword">if</span> !currentModel.isVersion4 &#123;</span><br><span class="line">      fatalError(<span class="string">"Can only handle migrations to version 4!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> storeModel = self.storeModel &#123;</span><br><span class="line">      <span class="keyword">if</span> storeModel.isVersion1 &#123;</span><br><span class="line">        <span class="keyword">let</span> destinationModel = NSManagedObjectModel.version2</span><br><span class="line"></span><br><span class="line">        migrateStoreAt(URL: storeURL,</span><br><span class="line">                       fromMode<span class="variable">l:</span> storeModel,</span><br><span class="line">                       toMode<span class="variable">l:</span> destinationModel)</span><br><span class="line"></span><br><span class="line">        performMigration()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> storeModel.isVersion2 &#123;</span><br><span class="line">        <span class="keyword">let</span> destinationModel = NSManagedObjectModel.version3</span><br><span class="line">        <span class="keyword">let</span> mappingModel = NSMappingModel(from: nil,</span><br><span class="line">                                          forSourceMode<span class="variable">l:</span> storeModel,</span><br><span class="line">                                          destinationMode<span class="variable">l:</span> destinationModel)</span><br><span class="line"></span><br><span class="line">        migrateStoreAt(URL: storeURL,</span><br><span class="line">                       fromMode<span class="variable">l:</span> storeModel,</span><br><span class="line">                       toMode<span class="variable">l:</span> destinationModel,</span><br><span class="line">                       mappingMode<span class="variable">l:</span> mappingModel)</span><br><span class="line"></span><br><span class="line">        performMigration()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> storeModel.isVersion3 &#123;</span><br><span class="line">        <span class="keyword">let</span> destinationModel = NSManagedObjectModel.version4</span><br><span class="line">        <span class="keyword">let</span> mappingModel = NSMappingModel(from: nil,</span><br><span class="line">                                          forSourceMode<span class="variable">l:</span> storeModel,</span><br><span class="line">                                          destinationMode<span class="variable">l:</span> destinationModel)</span><br><span class="line"></span><br><span class="line">        migrateStoreAt(URL: storeURL,</span><br><span class="line">                       fromMode<span class="variable">l:</span> storeModel,</span><br><span class="line">                       toMode<span class="variable">l:</span> destinationModel,</span><br><span class="line">                       mappingMode<span class="variable">l:</span> mappingModel)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;è®°å¾—åœ¨ä¸¤å¹´å‰æˆ‘å»é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å…³äºCore-dataçš„é—®é¢˜ï¼Œä»–ä»¬å¤§éƒ½åªä¼šé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½å¤Ÿç­”å‡ºæ¥ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä½¿ç”¨è¿‡Core-Dataï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼šâ€œå¦‚ä½•è¿ç§»Core-Dataçš„æ•°æ®åº“â€ï¼Ÿå› ä¸ºè°éƒ½æ— æ³•é¢„æ–™ä¸šåŠ¡çš„å‘å±•ï¼Œä»¥åŠæ•°æ®åº“çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ã€‚è¿™é‡Œé‡ç‚¹åˆ—ä¸¾å‡ ä¸ªCore-Dataæ•°æ®åº“è¿ç§»çš„é—®é¢˜ï¼š&quot;&gt;&lt;a href=&quot;#è®°å¾—åœ¨ä¸¤å¹´å‰æˆ‘å»é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å…³äºCore-dataçš„é—®é¢˜ï¼Œä»–ä»¬å¤§éƒ½åªä¼šé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½å¤Ÿç­”å‡ºæ¥ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä½¿ç”¨è¿‡Core-Dataï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼šâ€œå¦‚ä½•è¿ç§»Core-Dataçš„æ•°æ®åº“â€ï¼Ÿå› ä¸ºè°éƒ½æ— æ³•é¢„æ–™ä¸šåŠ¡çš„å‘å±•ï¼Œä»¥åŠæ•°æ®åº“çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ã€‚è¿™é‡Œé‡ç‚¹åˆ—ä¸¾å‡ ä¸ªCore-Dataæ•°æ®åº“è¿ç§»çš„é—®é¢˜ï¼š&quot; class=&quot;headerlink&quot; title=&quot;è®°å¾—åœ¨ä¸¤å¹´å‰æˆ‘å»é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å…³äºCore dataçš„é—®é¢˜ï¼Œä»–ä»¬å¤§éƒ½åªä¼šé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½å¤Ÿç­”å‡ºæ¥ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä½¿ç”¨è¿‡Core Dataï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼šâ€œå¦‚ä½•è¿ç§»Core Dataçš„æ•°æ®åº“â€ï¼Ÿå› ä¸ºè°éƒ½æ— æ³•é¢„æ–™ä¸šåŠ¡çš„å‘å±•ï¼Œä»¥åŠæ•°æ®åº“çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ã€‚è¿™é‡Œé‡ç‚¹åˆ—ä¸¾å‡ ä¸ªCore Dataæ•°æ®åº“è¿ç§»çš„é—®é¢˜ï¼š&quot;&gt;&lt;/a&gt;è®°å¾—åœ¨ä¸¤å¹´å‰æˆ‘å»é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å…³äºCore dataçš„é—®é¢˜ï¼Œä»–ä»¬å¤§éƒ½åªä¼šé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½å¤Ÿç­”å‡ºæ¥ï¼Œå°±è¯´æ˜è¿˜æ˜¯ä½¿ç”¨è¿‡Core Dataï¼Œè¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼šâ€œå¦‚ä½•è¿ç§»Core Dataçš„æ•°æ®åº“â€ï¼Ÿå› ä¸ºè°éƒ½æ— æ³•é¢„æ–™ä¸šåŠ¡çš„å‘å±•ï¼Œä»¥åŠæ•°æ®åº“çš„ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ã€‚è¿™é‡Œé‡ç‚¹åˆ—ä¸¾å‡ ä¸ªCore Dataæ•°æ®åº“è¿ç§»çš„é—®é¢˜ï¼š&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¦–å…ˆè¦è¯´ä¸€ä¸‹ï¼Œå¦‚æœä½ çš„Appï¼Œåªæ˜¯ç¼“å­˜ä¸€äº›ç¦»çº¿æ•°æ®çš„è¯ï¼Œå°±æ²¡å¿…è¦è€ƒè™‘ä»€ä¹ˆæ•°æ®åº“è¿ç§»äº†ï¼Œå› ä¸ºä½ åªéœ€è¦åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œåˆ é™¤ä¹‹å‰çš„core dataæ•°æ®ï¼Œæ–°å»ºä¸€ä¸ªå°±å¯ä»¥äº†&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ—¥å¿—" scheme="http://www.ghcoder.com/categories/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Core Data, Swift" scheme="http://www.ghcoder.com/tags/Core-Data-Swift/"/>
    
  </entry>
  
</feed>
